$_RUNTIME_DATA = {"runtime/index.html-template":{"name":"runtime/index.html-template","content":"ï»¿<!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n\n    <title>  __$% *title %$__  </title>\n\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n    <style>\n        __$% runtime/style.css %$__\n    </style>\n\n\n    <style>\n        __$% *user_css %$__\n    </style>\n\n\n</head>\n\n<body>\n\n    <div id=\"error-notifier\"></div>\n\n    <div class=\"outerContainer\">\n\n        <div id=\"controls\" class=\"buttons\">\n          <a id=\"rewind\" title=\"Restart story from beginning\">restart</a> |\n          <a id=\"save\" title=\"Save progress\">save</a> |\n          <a id=\"reload\" title=\"Reload from save point\">load</a> |\n          <a id=\"theme-switch\" title=\"Switch theme\">theme</a> |\n          <a id=\"about\" title=\"About\">about</a>\n        </div>\n\n        <div id=\"story\" class=\"container\">\n            <div class=\"header\">\n                <h1> __$% *title %$__ </h1>\n                <h2 class=\"byline\"></h2>\n            </div>\n        </div>\n    </div>\n\n\n    __$% *asset_loader_script %$__\n    __$% *story %$__\n\n\n    <script> __$% runtime/jquery-3.6.0.min.js %$__ </script>\n\n    <script> __$% runtime/howler.core.min.js %$__ </script>\n\n    <script> __$% runtime/moglimanager.js %$__ </script>    \n    <script> __$% runtime/ink-full.js %$__ </script>\n    <script> __$% runtime/main.js %$__ </script>\n\n\n    <script> __$% *user_js %$__ </script>\n\n\n</body>\n</html>\n"},"runtime/main.js":{"name":"runtime/main.js","content":"\n\n/*\n\nThis file is based on Inky's \"main.js\" standard web template file.\n\nInky is released under the MIT license: https://github.com/inkle/inky\n\nI release all changes under the same license.\n\n*/\n\n\n\n(function(storyContent) {\n\n\n    let debug_log_output = false\n\n    // Create ink story from the content using inkjs\n    var story = new inkjs.Story(storyContent);\n\n    const mogli = new MogliManager(story, continueStory)\n\n    var savePoint = \"\";\n\n    let savedTheme;\n    let globalTagTheme;\n\n    // Global tags - those at the top of the ink file\n    // We support:\n    //  # theme: dark\n    //  # author: Your Name\n    var globalTags = story.globalTags;\n    if( globalTags ) {\n        for(var i=0; i<story.globalTags.length; i++) {\n            var globalTag = story.globalTags[i];\n            var splitTag = splitPropertyTag(globalTag);\n\n            // THEME: dark\n            if( splitTag && splitTag.property == \"theme\" ) {\n                globalTagTheme = splitTag.val;\n            }\n\n            // author: Your Name\n            else if( splitTag && splitTag.property == \"author\" ) {\n                var byline = document.querySelector('.byline');\n                byline.innerHTML = \"by \"+splitTag.val;\n            }\n        }\n    }\n\n    var storyContainer = document.querySelector('#story');\n    var outerScrollContainer = document.querySelector('.outerContainer');\n\n    // page features setup\n    setupTheme(globalTagTheme);\n    var hasSave = loadSavePoint();\n    setupButtons(hasSave);\n\n    // Set initial save point\n    savePoint = story.state.toJson();\n\n    // Kick off the start of the story!\n    continueStory(true);\n\n\n\n    // Main story processing function. Each time this is called it generates\n    // all the next content up as far as the next set of choices.\n    function continueStory(firstTime) {\n        function incr_delay(t) {\n            delay += t\n        }\n\n        function get_delay(t) {\n            return delay\n        }\n\n        var paragraphIndex = 0;\n        var delay = 0.0;\n\n        // Don't over-scroll past new content\n        var previousBottomEdge = firstTime ? 0 : contentBottomEdgeY();\n\n        // Generate story text - loop through available content\n        while(story.canContinue) {\n\n            // Get ink to generate the next paragraph\n            var paragraphText = story.Continue();\n            if (debug_log_output) console.log(\"PARAGRAPH TEXT:\", paragraphText)\n\n            var tags = story.currentTags;\n\n            //ctx: whatever you want to pass to the moglimanager\n            //from here so it can do its job.\n            let ctx = {\n                //story,\n                incr_delay,\n                get_delay,\n                storyContainer,\n                showAfter,\n            }\n\n            mogli.process_tags(tags, ctx)\n\n            var customClasses = [];\n\n                        /*\n            // Any special tags included with this line\n\n            for(var i=0; i<tags.length; i++) {\n                var tag = tags[i];\n\n                // Detect tags of the form \"X: Y\". Currently used for IMAGE and CLASS but could be\n                // customised to be used for other things too.\n                var splitTag = splitPropertyTag(tag);\n\n                // AUDIO: src\n                if( splitTag && splitTag.property == \"AUDIO\" ) {\n                  if('audio' in this) {\n                    this.audio.pause();\n                    this.audio.removeAttribute('src');\n                    this.audio.load();\n                  }\n                  this.audio = new Audio(splitTag.val);\n                  this.audio.play();\n                }\n\n                // AUDIOLOOP: src\n                else if( splitTag && splitTag.property == \"AUDIOLOOP\" ) {\n                  if('audioLoop' in this) {\n                    this.audioLoop.pause();\n                    this.audioLoop.removeAttribute('src');\n                    this.audioLoop.load();\n                  }\n                  this.audioLoop = new Audio(splitTag.val);\n                  this.audioLoop.play();\n                  this.audioLoop.loop = true;\n                }\n\n                // IMAGE: src\n                if( splitTag && splitTag.property == \"IMAGE\" ) {\n                    var imageElement = document.createElement('img');\n                    imageElement.src = splitTag.val;\n                    storyContainer.appendChild(imageElement);\n\n                    showAfter(delay, imageElement);\n                    delay += 200.0;\n                }\n\n                // LINK: url\n                else if( splitTag && splitTag.property == \"LINK\" ) {\n                    window.location.href = splitTag.val;\n                }\n\n                // LINKOPEN: url\n                else if( splitTag && splitTag.property == \"LINKOPEN\" ) {\n                    window.open(splitTag.val);\n                }\n\n                // BACKGROUND: src\n                else if( splitTag && splitTag.property == \"BACKGROUND\" ) {\n                    outerScrollContainer.style.backgroundImage = 'url('+splitTag.val+')';\n                }\n\n                // CLASS: className\n                else if( splitTag && splitTag.property == \"CLASS\" ) {\n                    customClasses.push(splitTag.val);\n                }\n\n                // CLEAR - removes all existing content.\n                // RESTART - clears everything and restarts the story from the beginning\n                else if( tag == \"CLEAR\" || tag == \"RESTART\" ) {\n                    removeAll(\"p\");\n                    removeAll(\"img\");\n\n                    // Comment out this line if you want to leave the header visible when clearing\n                    setVisible(\".header\", false);\n\n                    if( tag == \"RESTART\" ) {\n                        restart();\n                        return;\n                    }\n                }\n            }\n            */\n\n            // Create paragraph element (initially hidden)\n            var paragraphElement = document.createElement('p');\n            paragraphElement.innerHTML = paragraphText;\n            storyContainer.appendChild(paragraphElement);\n\n            // Add any custom classes derived from ink tags\n            for(var i=0; i<customClasses.length; i++)\n                paragraphElement.classList.add(customClasses[i]);\n\n            // Fade in paragraph after a short delay\n            showAfter(delay, paragraphElement);\n            delay += 200.0;\n        }\n\n        // Create HTML choices from ink choices\n        story.currentChoices.forEach(function(choice) {\n\n            // Create paragraph with anchor element\n            var choiceParagraphElement = document.createElement('p');\n            choiceParagraphElement.classList.add(\"choice\");\n            choiceParagraphElement.innerHTML = `<a href='#'>${choice.text}</a>`\n            storyContainer.appendChild(choiceParagraphElement);\n            if (debug_log_output) console.log(\"CHOICE TEXT:\", choice.text)\n\n            // Fade choice in after a short delay\n            showAfter(delay, choiceParagraphElement);\n            delay += 200.0;\n\n            // Click on choice\n            var choiceAnchorEl = choiceParagraphElement.querySelectorAll(\"a\")[0];\n            choiceAnchorEl.addEventListener(\"click\", function(event) {\n\n                // Don't follow <a> link\n                event.preventDefault();\n\n                // Remove all existing choices\n                removeAll(\".choice\");\n\n                // Tell the story where to go next\n                story.ChooseChoiceIndex(choice.index);\n\n                // This is where the save button will save from\n                savePoint = story.state.toJson();\n\n                // Aaand loop\n                continueStory();\n            });\n        });\n\n\n        \n        /* Removed this bit:\n\n            // Extend height to fit\n            // We do this manually so that removing elements and creating new ones doesn't\n            // cause the height (and therefore scroll) to jump backwards temporarily.\n            storyContainer.style.height = contentBottomEdgeY()+\"px\";\n        \n        I honestly do not understand why the line\n        was here in the first place.\n        It seems to cause a bug where the first time the page loads, the height\n        of the content is too small and the bottom line of the story can be cut\n        off, not showing it at all. I don't fully understand it even after\n        messing around with it for over an hour,\n        but removing the line fixes the bug and does not seem to have\n        any negative effects (hopefully). \n        \n        */\n\n\n\n        if( !firstTime )\n            scrollDown(previousBottomEdge);\n\n\n    }\n\n    function restart() {\n        story.ResetState();\n\n        setVisible(\".header\", true);\n\n        // set save point to here\n        savePoint = story.state.toJson();\n\n        continueStory(true);\n\n        outerScrollContainer.scrollTo(0, 0);\n    }\n\n    // -----------------------------------\n    // Various Helper functions\n    // -----------------------------------\n\n    // Fades in an element after a specified delay\n    function showAfter(delay, el) {\n        el.classList.add(\"hide\");\n        setTimeout(function() { \n            el.classList.remove(\"hide\");\n            if (debug_log_output) console.log(\"unhiding\", el)\n        }, delay);\n    }\n\n    // Scrolls the page down, but no further than the bottom edge of what you could\n    // see previously, so it doesn't go too far.\n    function scrollDown(previousBottomEdge) {\n\n        // Line up top of screen with the bottom of where the previous content ended\n        var target = previousBottomEdge;\n\n        // Can't go further than the very bottom of the page\n        var limit = outerScrollContainer.scrollHeight - outerScrollContainer.clientHeight;\n        if( target > limit ) target = limit;\n\n        var start = outerScrollContainer.scrollTop;\n\n        var dist = target - start;\n        var duration = 300 + 300*dist/100;\n        var startTime = null;\n        function step(time) {\n            if( startTime == null ) startTime = time;\n            var t = (time-startTime) / duration;\n            var lerp = 3*t*t - 2*t*t*t; // ease in/out\n            outerScrollContainer.scrollTo(0, (1.0-lerp)*start + lerp*target);\n            if( t < 1 ) requestAnimationFrame(step);\n        }\n        requestAnimationFrame(step);\n    }\n\n    // The Y coordinate of the bottom end of all the story content, used\n    // for growing the container, and deciding how far to scroll.\n    function contentBottomEdgeY() {\n        var bottomElement = storyContainer.lastElementChild;\n        let res = bottomElement ? bottomElement.offsetTop + bottomElement.offsetHeight : 0;\n        return res\n    }\n\n    // Remove all elements that match the given selector. Used for removing choices after\n    // you've picked one, as well as for the CLEAR and RESTART tags.\n    function removeAll(selector)\n    {\n        var allElements = storyContainer.querySelectorAll(selector);\n        for(var i=0; i<allElements.length; i++) {\n            var el = allElements[i];\n            el.parentNode.removeChild(el);\n        }\n    }\n\n    // Used for hiding and showing the header when you CLEAR or RESTART the story respectively.\n    function setVisible(selector, visible)\n    {\n        var allElements = storyContainer.querySelectorAll(selector);\n        for(var i=0; i<allElements.length; i++) {\n            var el = allElements[i];\n            if( !visible )\n                el.classList.add(\"invisible\");\n            else\n                el.classList.remove(\"invisible\");\n        }\n    }\n\n    // Helper for parsing out tags of the form:\n    //  # PROPERTY: value\n    // e.g. IMAGE: source path\n    function splitPropertyTag(tag) {\n        var propertySplitIdx = tag.indexOf(\":\");\n        if( propertySplitIdx != null ) {\n            var property = tag.substr(0, propertySplitIdx).trim();\n            var val = tag.substr(propertySplitIdx+1).trim();\n            return {\n                property: property,\n                val: val\n            };\n        }\n\n        return null;\n    }\n\n    // Loads save state if exists in the browser memory\n    function loadSavePoint() {\n\n        try {\n            let savedState = window.localStorage.getItem('save-state');\n            if (savedState) {\n                story.state.LoadJson(savedState);\n                return true;\n            }\n        } catch (e) {\n            console.debug(\"Couldn't load save state\");\n        }\n        return false;\n    }\n\n    // Detects which theme (light or dark) to use\n    function setupTheme(globalTagTheme) {\n\n        // load theme from browser memory\n        var savedTheme;\n        try {\n            savedTheme = window.localStorage.getItem('theme');\n        } catch (e) {\n            console.debug(\"Couldn't load saved theme\");\n        }\n\n        // Check whether the OS/browser is configured for dark mode\n        var browserDark = window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\n\n        if (savedTheme === \"dark\"\n            || (savedTheme == undefined && globalTagTheme === \"dark\")\n            || (savedTheme == undefined && globalTagTheme == undefined && browserDark))\n            document.body.classList.add(\"dark\");\n    }\n\n    function clear_and_restart() {\n        removeAll(\"p\");\n        removeAll(\"img\");\n        setVisible(\".header\", false);\n        restart();\n    }\n\n    // Used to hook up the functionality for global functionality buttons\n    function setupButtons(hasSave) {\n\n        let rewindEl = document.getElementById(\"rewind\");\n        if (rewindEl) rewindEl.addEventListener(\"click\", clear_and_restart);\n\n        let saveEl = document.getElementById(\"save\");\n        if (saveEl) saveEl.addEventListener(\"click\", function(event) {\n            try {\n                window.localStorage.setItem('save-state', savePoint);\n                document.getElementById(\"reload\").removeAttribute(\"disabled\");\n                window.localStorage.setItem('theme', document.body.classList.contains(\"dark\") ? \"dark\" : \"\");\n            } catch (e) {\n                console.warn(\"Couldn't save state\");\n            }\n\n        });\n\n        let reloadEl = document.getElementById(\"reload\");\n        if (!hasSave) {\n            reloadEl.setAttribute(\"disabled\", \"disabled\");\n        }\n        reloadEl.addEventListener(\"click\", function(event) {\n            if (reloadEl.getAttribute(\"disabled\"))\n                return;\n\n            removeAll(\"p\");\n            removeAll(\"img\");\n            try {\n                let savedState = window.localStorage.getItem('save-state');\n                if (savedState) story.state.LoadJson(savedState);\n            } catch (e) {\n                console.debug(\"Couldn't load save state\");\n            }\n            continueStory(true);\n        });\n\n        let themeSwitchEl = document.getElementById(\"theme-switch\");\n        if (themeSwitchEl) themeSwitchEl.addEventListener(\"click\", function(event) {\n            document.body.classList.add(\"switched\");\n            document.body.classList.toggle(\"dark\");\n        });\n\n        let about_el = document.getElementById(\"about\")\n        if (about_el) {\n            about_el.addEventListener(\"click\", function(event) {\n                mogli.show_about()\n            })\n        }\n    }\n\n})(storyContent);\n"},"runtime/moglimanager.js":{"name":"runtime/moglimanager.js","content":"/*\nSyntax of Mogli tags:\n#image [/] name: castle / size: 5 / destroyer: true / maybe:true / text: Dunno. But maybe. [/]\n\nCommands can also define \"special_commands\".\nThese are just keys that do not need a value\n(but only when used for this command). If these special commands are provided\nwithout colon and value they are just initialized to the string \"yes\"\n\nAll other keys are initialized to the string (!) of value.\n\n*/\n\nclass MogliManager {\n    constructor(story, continueStory) {\n        /* story: the ink story */\n        this.story = story\n        this.continueStory = continueStory\n\n        this.item_separator = \"/\"\n        this.prop_separator = \":\"\n        this.commands = {}\n        this.load_commands()\n        this.yes = \"yes\"\n        this.no = \"no\"\n        window.onerror = this.on_error.bind(this)\n        this.sounds = {}\n    }\n\n    on_error(e) {\n        console.log(\"ERROR\", e)\n        document.body.innerHTML = e\n    }\n\n    add_command(names, command) {\n        for (let name of names) {\n            this.commands[name] = command\n        }\n    }\n\n    load_commands() {\n        this.add_command([\"image\", \"img\"], {\n            do_command_id: \"image\",\n            special_props: {\n                //center: true,\n            }\n        })\n\n        this.add_command([\"audio\"], {\n            do_command_id: \"audio\",\n            special_props: {mute: true, loop: true,}\n        })\n\n        this.add_command([\"stop_audio\"], {\n            do_command_id: \"stop_audio\",\n        })\n\n        this.add_command([\"pause_audio\"], {\n            do_command_id: \"pause_audio\",\n        })\n\n        this.add_command([\"resume_audio\"], {\n            do_command_id: \"resume_audio\",\n        })\n\n        this.add_command([\"resume_audio\"], {\n            do_command_id: \"resume_audio\",\n        })\n\n    }\n\n\n\n    normalize_yes(x) {\n        if (x === \"yes\") return true\n        if (x === \"no\") return false\n        return !!x\n    }\n\n    do_command_resume_audio(text, param, ctx) {\n        let sound = this.sounds[param.id]\n        if (!sound) return\n        sound.play()\n    }\n\n    do_command_pause_audio(text, param, ctx) {\n        let sound = this.sounds[param.id]\n        if (!sound) return\n        sound.pause()\n    }\n\n    do_command_stop_audio(text, param, ctx) {\n        let sound = this.sounds[param.id]\n        if (!sound) return //could throw error, but currently just ignores\n        //because it would be a bit too strict to throw error (what if you don't\n        //know whether the sound is still playing?)\n        sound.stop()\n    }\n\n    do_command_audio(text, param, ctx) {\n        let name = param.name\n        let audio = $_ASSETS[name]\n        if (!audio) {\n            this.mild_error(text, `No audio with name <b>${name}</b> found.`)\n            return\n        }\n        if (audio.type !== \"audio\") {\n            this.mild_error(text, `Asset with name <b>${name}</b> is not an audio.`)\n            return            \n        }\n\n        if (!param.volume && param.volume != 0) param.volume = 1.0 //default value if unspecified\n        if (!param.mute && param.mute != 0) param.mute = false //default value if unspecified\n\n        let sound = new Howl({\n            src: audio.data,\n            volume: Number(param.volume),\n            loop: this.normalize_yes(param.loop),\n            mute: this.normalize_yes(param.mute),\n        })\n\n        sound.play()\n\n        if (param.id) this.sounds[param.id] = sound\n    }\n\n    do_command_image(text, param, ctx) {\n        let name = param.name\n        let img = $_ASSETS[name]\n        if (!img) {\n            this.mild_error(text, `No image with name <b>${name}</b> found.`)\n            return\n        }\n        if (img.type !== \"image\") {\n            this.mild_error(text, `Asset with name <b>${name}</b> is not an image.`)\n            return            \n        }\n\n        let image_el = document.createElement('img')\n        ctx.storyContainer.appendChild(image_el)\n        image_el.src = img.data\n        ctx.showAfter(ctx.get_delay(), image_el)\n        ctx.incr_delay(200.0)\n\n    }\n\n\n    mild_error(...args) {\n        //you should only use mild_error if ignoring the error\n        //would be a feasible option, for example in the case\n        //of a tag command that is not recognized, the tag could be just\n        //ignored or an error could be thrown.\n        //currently we treat mild_errors just like errors, though \n        this.error(...args)\n    }\n\n    error (line_text, msg) {\n        let el = document.getElementById(\"error-notifier\")\n        if (!el) return\n        let m = `<p class=\"error-notifier-p\"><b>Error at line:</b> <i>${line_text}</i></p>\n            <p class=\"error-notifier-p\">${msg}</p>\n        `\n        /*             <button\n            onclick='document.getElementById(\"error-notifier\").style.display = \"none\"'>\n            Okay</button> */\n        el.style.display = \"block\"\n        el.innerHTML = m\n        throw msg\n    }\n\n    process_tags(tags, ctx) {\n        for (let tag of tags) {\n            let res = this.parse_tag(tag)\n            if (!res) continue\n            this.perform_command(tag, res.command, res.key_value_store, ctx)\n        }\n    }\n\n\n    inside_iframe () {\n        try {\n            return window.top !== window.self\n        } catch (e) {\n            return true\n        }\n    }\n\n    show_about() {\n        let href = `https://www.inklestudios.com/ink`\n        if (this.inside_iframe()) href = `#`\n        let link = `<a href=\"${href}\">Find out more about INK</a>`\n        let el = $(`\n        <div class=\"about-box\">\n            <div class=\"about-box-inner\">\n                <p>Created with Ink / Mogli.</p>\n                <p>${link}</p>     \n                <p><a href=\"#\" onclick=\"$('.about-box').remove()\">Close</a></p>           \n            </div>\n        </div>`)\n        $(\"body\").append(el)\n    }\n\n    perform_command(tag, command, store, ctx) {\n        this[\"do_command_\" + command.do_command_id](tag, store, ctx, command)\n    }\n\n    parse_tag(tag) {\n\n        tag = tag.trim()\n        let first_word\n        let rest = tag.replace(/.*?(\\s|$)/, (n) => {\n            first_word = n\n            return \"\"\n        })\n        first_word = first_word.trim().toLowerCase()\n        rest = rest.trim()\n\n        if ( first_word === \"note\" || first_word === \"n\"\n            || first_word === \"todo\" ) {\n            //comment. ignore.\n            return\n        }\n        \n        if ( first_word === \"js\" || first_word === \"javascript\" ) {\n            let info = {\n                story: this.story,\n                continueStory: this.continueStory,\n            }\n            window.info = info\n            try {\n                eval(rest)\n            } catch(e) {\n                console.log(\"#js LINE ERROR\", e)\n                let txt = `\n                    <p>A JavaScript line you wrote seems to be incorrect.</p>\n                    <p>The error is in this line: #<b>${tag}</b></p>\n                    <p>The browser thinks this is the error:</p>\n                    <p><b>${e}</b></p>`\n                document.body.innerHTML = txt                \n            }\n            \n            return\n        }\n        \n        let command = this.commands[first_word]\n        if (!command) {\n            if (first_word && first_word.includes(\":\")) {\n                this.mild_error(tag, `<b>#${first_word}</b> No colon (:) expected here.`)\n                return\n            }\n            this.mild_error(tag, `<b>#${first_word}</b> is not a valid tag command`)\n            return\n        }\n\n        let parts = rest.split(this.item_separator)\n            .map(n => n.trim()).filter(n => n)\n\n        let obj = {}\n\n        for (let part of parts) {\n            part = part.trim()\n            let key\n            let value\n            if (command.special_props && command.special_props[part.toLowerCase()]) {\n                key = part.toLowerCase()\n                value = this.yes\n            } else {\n\n                let ix = part.indexOf (this.prop_separator)\n                if (ix === -1) {\n                    this.mild_error(tag, `<b>${part}</b> - I expected something like \n                    <b>name: value</b> here.`)\n                    return\n                }\n                key = part.substr(0, ix).toLowerCase().trim()\n                value = part.substr(ix + 1).trim()\n            }\n            obj[key] = value\n        }\n\n        return {\n            command: command,\n            key_value_store: obj,\n        }\n    }\n\n\n\n\n\n}\n\n\n\n\n"},"runtime/ink-full.js":{"name":"runtime/ink-full.js","content":"\n/*\n\nink.js is released under the MIT license:\nhttps://github.com/y-lohse/inkjs/blob/compiler/LICENSE.md\n\n*/\n\n\n!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?e(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],e):e((t=\"undefined\"!=typeof globalThis?globalThis:t||self).inkjs={})}(this,(function(t){\"use strict\";function e(t){return(e=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,\"prototype\",{writable:!1}),t}function a(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,\"prototype\",{writable:!1}),e&&s(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function u(t,e,n){return(u=l()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&s(i,n.prototype),i}).apply(null,arguments)}function c(t){var e=\"function\"==typeof Map?new Map:void 0;return(c=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf(\"[native code]\")))return t;var n;if(\"function\"!=typeof t)throw new TypeError(\"Super expression must either be null or a function\");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return u(t,arguments,o(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,t)})(t)}function h(t){if(void 0===t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t}function f(t,e){if(e&&(\"object\"==typeof e||\"function\"==typeof e))return e;if(void 0!==e)throw new TypeError(\"Derived constructors may only return object or undefined\");return h(t)}function d(t){var e=l();return function(){var n,r=o(t);if(e){var i=o(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}function v(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}function p(){return(p=\"undefined\"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=v(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}}).apply(this,arguments)}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:\"undefined\"!=typeof Symbol&&t[Symbol.iterator]||t[\"@@iterator\"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(t,e)||g(t,e)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function y(t){return function(t){if(Array.isArray(t))return C(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t[\"@@iterator\"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function g(t,e){if(t){if(\"string\"==typeof t)return C(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return\"Object\"===n&&t.constructor&&(n=t.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(t):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function S(t,e){var n=\"undefined\"!=typeof Symbol&&t[Symbol.iterator]||t[\"@@iterator\"];if(!n){if(Array.isArray(t)||(n=g(t))||e&&t&&\"number\"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}var b,w=i((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;n(this,t),this.sourceFilename=e,this.pluginNames=r,this.countAllVisits=i,this.errorHandler=a,this.fileHandler=o})),_=i((function t(e,r,i){n(this,t),this.length=e,this.debugMetadata=r,this.text=i}));!function(t){t[t.Author=0]=\"Author\",t[t.Error=1]=\"Error\",t[t.Warning=2]=\"Warning\"}(b||(b={}));var E=i((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n(this,t),this.identifier=e,this.isByReference=r,this.isDivertTarget=i}));function k(t,e){return t instanceof e?x(t):null}function A(t,e){if(t instanceof e)return x(t);throw new Error(\"\".concat(t,\" is not of type \").concat(e))}function T(t){return t.hasValidName&&t.name?t:null}function P(t){return void 0===t?null:t}function O(t){return\"object\"===e(t)&&\"function\"==typeof t.Equals}function x(t,e){return t}function N(t){return null!=t}var I,W=function(){function t(){var e=this;n(this,t),this._alreadyHadError=!1,this._alreadyHadWarning=!1,this._debugMetadata=null,this._runtimeObject=null,this.content=[],this.parent=null,this.GetType=function(){return e.typeName},this.AddContent=function(t){null===e.content&&(e.content=[]);var n,r=S(Array.isArray(t)?t:[t]);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.hasOwnProperty(\"parent\")&&(i.parent=e),e.content.push(i)}}catch(t){r.e(t)}finally{r.f()}return Array.isArray(t)?void 0:t},this.InsertContent=function(t,n){return null===e.content&&(e.content=[]),n.parent=e,e.content.splice(t,0,n),n},this.Find=function(t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=k(e,t);if(null!==r&&(null===n||!0===n(r)))return r;if(null===e.content)return null;var i,a=S(e.content);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=o.Find&&o.Find(t)(n);if(s)return s}}catch(t){a.e(t)}finally{a.f()}return null}},this.FindAll=function(t){return function(n,r){var i=Array.isArray(r)?r:[],a=k(e,t);if(null===a||n&&!0!==n(a)||i.push(a),null===e.content)return[];var o,s=S(e.content);try{for(s.s();!(o=s.n()).done;){var l=o.value;l.FindAll&&l.FindAll(t)(n,i)}}catch(t){s.e(t)}finally{s.f()}return i}},this.Warning=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.Error(t,n,!0)}}return i(t,[{key:\"debugMetadata\",get:function(){return null===this._debugMetadata&&this.parent?this.parent.debugMetadata:this._debugMetadata},set:function(t){this._debugMetadata=t}},{key:\"hasOwnDebugMetadata\",get:function(){return Boolean(this.debugMetadata)}},{key:\"typeName\",get:function(){return\"ParsedObject\"}},{key:\"story\",get:function(){for(var t=this;t.parent;)t=t.parent;return t}},{key:\"runtimeObject\",get:function(){return this._runtimeObject||(this._runtimeObject=this.GenerateRuntimeObject(),this._runtimeObject&&(this._runtimeObject.debugMetadata=this.debugMetadata)),this._runtimeObject},set:function(t){this._runtimeObject=t}},{key:\"runtimePath\",get:function(){if(!this.runtimeObject.path)throw new Error;return this.runtimeObject.path}},{key:\"containerForCounting\",get:function(){return this.runtimeObject}},{key:\"ancestry\",get:function(){for(var t=[],e=this.parent;e;)t.push(e),e=e.parent;return t=t.reverse()}},{key:\"ResolveReferences\",value:function(t){if(null!==this.content){var e,n=S(this.content);try{for(n.s();!(e=n.n()).done;){e.value.ResolveReferences(t)}}catch(t){n.e(t)}finally{n.f()}}}},{key:\"Error\",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null===e&&(e=this),!(e._alreadyHadError&&!n||e._alreadyHadWarning&&n)){if(!this.parent)throw new Error(\"No parent object to send error to: \".concat(t));this.parent.Error(t,e,n),n?e._alreadyHadWarning=!0:e._alreadyHadError=!0}}))}]),t}(),F=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this)).warningMessage=t,i.GenerateRuntimeObject=function(){return i.Warning(i.warningMessage),null},i}return i(r)}(W),R=function(){function t(){if(n(this,t),this._components=[],this._componentsString=null,this._isRelative=!1,\"string\"==typeof arguments[0]){var e=arguments[0];this.componentsString=e}else if(arguments[0]instanceof t.Component&&arguments[1]instanceof t){var r=arguments[0],i=arguments[1];this._components.push(r),this._components=this._components.concat(i._components)}else if(arguments[0]instanceof Array){var a=arguments[0],o=!!arguments[1];this._components=this._components.concat(a),this._isRelative=o}}return i(t,[{key:\"isRelative\",get:function(){return this._isRelative}},{key:\"componentCount\",get:function(){return this._components.length}},{key:\"head\",get:function(){return this._components.length>0?this._components[0]:null}},{key:\"tail\",get:function(){return this._components.length>=2?new t(this._components.slice(1,this._components.length)):t.self}},{key:\"length\",get:function(){return this._components.length}},{key:\"lastComponent\",get:function(){var t=this._components.length-1;return t>=0?this._components[t]:null}},{key:\"containsNamedComponent\",get:function(){for(var t=0,e=this._components.length;t<e;t++)if(!this._components[t].isIndex)return!0;return!1}},{key:\"GetComponent\",value:function(t){return this._components[t]}},{key:\"PathByAppendingPath\",value:function(e){for(var n=new t,r=0,i=0;i<e._components.length&&e._components[i].isParent;++i)r++;for(var a=0;a<this._components.length-r;++a)n._components.push(this._components[a]);for(var o=r;o<e._components.length;++o)n._components.push(e._components[o]);return n}},{key:\"componentsString\",get:function(){return null==this._componentsString&&(this._componentsString=this._components.join(\".\"),this.isRelative&&(this._componentsString=\".\"+this._componentsString)),this._componentsString},set:function(e){if(this._components.length=0,this._componentsString=e,null!=this._componentsString&&\"\"!=this._componentsString){\".\"==this._componentsString[0]&&(this._isRelative=!0,this._componentsString=this._componentsString.substring(1));var n,r=S(this._componentsString.split(\".\"));try{for(r.s();!(n=r.n()).done;){var i=n.value;/^(\\-|\\+)?([0-9]+|Infinity)$/.test(i)?this._components.push(new t.Component(parseInt(i))):this._components.push(new t.Component(i))}}catch(t){r.e(t)}finally{r.f()}}}},{key:\"toString\",value:function(){return this.componentsString}},{key:\"Equals\",value:function(t){if(null==t)return!1;if(t._components.length!=this._components.length)return!1;if(t.isRelative!=this.isRelative)return!1;for(var e=0,n=t._components.length;e<n;e++)if(!t._components[e].Equals(this._components[e]))return!1;return!0}},{key:\"PathByAppendingComponent\",value:function(e){var n,r=new t;return(n=r._components).push.apply(n,y(this._components)),r._components.push(e),r}}],[{key:\"self\",get:function(){var e=new t;return e._isRelative=!0,e}}]),t}();R.parentId=\"^\",function(t){var e=function(){function e(t){n(this,e),this.index=-1,this.name=null,\"string\"==typeof t?this.name=t:this.index=t}return i(e,[{key:\"isIndex\",get:function(){return this.index>=0}},{key:\"isParent\",get:function(){return this.name==t.parentId}},{key:\"toString\",value:function(){return this.isIndex?this.index.toString():this.name}},{key:\"Equals\",value:function(t){return null!=t&&t.isIndex==this.isIndex&&(this.isIndex?this.index==t.index:this.name==t.name)}}],[{key:\"ToParent\",value:function(){return new e(t.parentId)}}]),e}();t.Component=e}(R||(R={})),function(t){function e(t,e){if(!t)throw void 0!==e&&console.warn(e),console.trace&&console.trace(),new Error(\"\")}t.AssertType=function(t,n,r){e(t instanceof n,r)},t.Assert=e}(I||(I={}));var D=function(t){a(r,t);var e=d(r);function r(){return n(this,r),e.apply(this,arguments)}return i(r)}(c(Error));function L(t){throw new D(\"\".concat(t,\" is null or undefined\"))}var V=function(){function t(){n(this,t),this.parent=null,this._debugMetadata=null,this._path=null}return i(t,[{key:\"debugMetadata\",get:function(){return null===this._debugMetadata&&this.parent?this.parent.debugMetadata:this._debugMetadata},set:function(t){this._debugMetadata=t}},{key:\"ownDebugMetadata\",get:function(){return this._debugMetadata}},{key:\"DebugLineNumberOfPath\",value:function(t){if(null===t)return null;var e=this.rootContentContainer;if(e){var n=e.ContentAtPath(t).obj;if(n){var r=n.debugMetadata;if(null!==r)return r.startLineNumber}}return null}},{key:\"path\",get:function(){if(null==this._path)if(null==this.parent)this._path=new R;else{for(var t=[],e=this,n=k(e.parent,tt);null!==n;){var r=T(e);if(null!=r&&r.hasValidName){if(null===r.name)return L(\"namedChild.name\");t.unshift(new R.Component(r.name))}else t.unshift(new R.Component(n.content.indexOf(e)));e=n,n=k(n.parent,tt)}this._path=new R(t)}return this._path}},{key:\"ResolvePath\",value:function(t){if(null===t)return L(\"path\");if(t.isRelative){var e=k(this,tt);return null===e&&(I.Assert(null!==this.parent,\"Can't resolve relative path because we don't have a parent\"),e=k(this.parent,tt),I.Assert(null!==e,\"Expected parent to be a container\"),I.Assert(t.GetComponent(0).isParent),t=t.tail),null===e?L(\"nearestContainer\"):e.ContentAtPath(t)}var n=this.rootContentContainer;return null===n?L(\"contentContainer\"):n.ContentAtPath(t)}},{key:\"ConvertPathToRelative\",value:function(t){for(var e=this.path,n=Math.min(t.length,e.length),r=-1,i=0;i<n;++i){var a=e.GetComponent(i),o=t.GetComponent(i);if(!a.Equals(o))break;r=i}if(-1==r)return t;for(var s=e.componentCount-1-r,l=[],u=0;u<s;++u)l.push(R.Component.ToParent());for(var c=r+1;c<t.componentCount;++c)l.push(t.GetComponent(c));return new R(l,!0)}},{key:\"CompactPathString\",value:function(t){var e=null,n=null;t.isRelative?(n=t.componentsString,e=this.path.PathByAppendingPath(t).componentsString):(n=this.ConvertPathToRelative(t).componentsString,e=t.componentsString);return n.length<e.length?n:e}},{key:\"rootContentContainer\",get:function(){for(var t=this;t.parent;)t=t.parent;return k(t,tt)}},{key:\"Copy\",value:function(){throw Error(\"Not Implemented: Doesn't support copying\")}},{key:\"SetChild\",value:function(t,e,n){t[e]&&(t[e]=null),t[e]=n,t[e]&&(t[e].parent=this)}},{key:\"Equals\",value:function(t){return t===this}}]),t}(),j=function(){function t(e){n(this,t),e=void 0!==e?e.toString():\"\",this.string=e}return i(t,[{key:\"Length\",get:function(){return this.string.length}},{key:\"Append\",value:function(t){null!==t&&(this.string+=t)}},{key:\"AppendLine\",value:function(t){void 0!==t&&this.Append(t),this.string+=\"\\n\"}},{key:\"AppendFormat\",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.string+=t.replace(/{(\\d+)}/g,(function(t,e){return void 0!==n[e]?n[e]:t}))}},{key:\"toString\",value:function(){return this.string}}]),t}(),M=function(){function t(){if(n(this,t),this.originName=null,this.itemName=null,void 0!==arguments[1]){var e=arguments[0],r=arguments[1];this.originName=e,this.itemName=r}else if(arguments[0]){var i=arguments[0],a=i.toString().split(\".\");this.originName=a[0],this.itemName=a[1]}}return i(t,[{key:\"isNull\",get:function(){return null==this.originName&&null==this.itemName}},{key:\"fullName\",get:function(){return(null!==this.originName?this.originName:\"?\")+\".\"+this.itemName}},{key:\"toString\",value:function(){return this.fullName}},{key:\"Equals\",value:function(e){if(e instanceof t){var n=e;return n.itemName==this.itemName&&n.originName==this.originName}return!1}},{key:\"copy\",value:function(){return new t(this.originName,this.itemName)}},{key:\"serialized\",value:function(){return JSON.stringify({originName:this.originName,itemName:this.itemName})}}],[{key:\"Null\",get:function(){return new t(null,null)}},{key:\"fromSerializedKey\",value:function(e){var n=JSON.parse(e);if(!t.isLikeInkListItem(n))return t.Null;var r=n;return new t(r.originName,r.itemName)}},{key:\"isLikeInkListItem\",value:function(t){return\"object\"===e(t)&&(!(!t.hasOwnProperty(\"originName\")||!t.hasOwnProperty(\"itemName\"))&&((\"string\"==typeof t.originName||null===typeof t.originName)&&(\"string\"==typeof t.itemName||null===typeof t.itemName)))}}]),t}(),B=function(t){a(o,t);var r=d(o);function o(){var t,i=arguments;if(n(this,o),(t=r.call(this,i[0]instanceof o?i[0]:[])).origins=null,t._originNames=[],arguments[0]instanceof o){var a=arguments[0];t._originNames=a.originNames,null!==a.origins&&(t.origins=a.origins.slice())}else if(\"string\"==typeof arguments[0]){var s=arguments[0],l=arguments[1];if(t.SetInitialOriginName(s),null===l.listDefinitions)return f(t,L(\"originStory.listDefinitions\"));var u=l.listDefinitions.TryListGetDefinition(s,null);if(!u.exists)throw new Error(\"InkList origin could not be found in story when constructing new list: \"+s);if(null===u.result)return f(t,L(\"def.result\"));t.origins=[u.result]}else if(\"object\"===e(arguments[0])&&arguments[0].hasOwnProperty(\"Key\")&&arguments[0].hasOwnProperty(\"Value\")){var c=arguments[0];t.Add(c.Key,c.Value)}return t}return i(o,[{key:\"AddItem\",value:function(t){if(t instanceof M){var e=t;if(null==e.originName)return void this.AddItem(e.itemName);if(null===this.origins)return L(\"this.origins\");var n,r=S(this.origins);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.name==e.originName){var a=i.TryGetValueForItem(e,0);if(a.exists)return void this.Add(e,a.result);throw new Error(\"Could not add the item \"+e+\" to this list because it doesn't exist in the original list definition in ink.\")}}}catch(t){r.e(t)}finally{r.f()}throw new Error(\"Failed to add item to list because the item was from a new list definition that wasn't previously known to this list. Only items from previously known lists can be used, so that the int value can be found.\")}var o=t,s=null;if(null===this.origins)return L(\"this.origins\");var l,u=S(this.origins);try{for(u.s();!(l=u.n()).done;){var c=l.value;if(null===o)return L(\"itemName\");if(c.ContainsItemWithName(o)){if(null!=s)throw new Error(\"Could not add the item \"+o+\" to this list because it could come from either \"+c.name+\" or \"+s.name);s=c}}}catch(t){u.e(t)}finally{u.f()}if(null==s)throw new Error(\"Could not add the item \"+o+\" to this list because it isn't known to any list definitions previously associated with this list.\");var h=new M(s.name,o),f=s.ValueForItem(h);this.Add(h,f)}},{key:\"ContainsItemNamed\",value:function(t){var e,n=S(this);try{for(n.s();!(e=n.n()).done;){var r=m(e.value,1)[0];if(M.fromSerializedKey(r).itemName==t)return!0}}catch(t){n.e(t)}finally{n.f()}return!1}},{key:\"ContainsKey\",value:function(t){return this.has(t.serialized())}},{key:\"Add\",value:function(t,e){var n=t.serialized();if(this.has(n))throw new Error(\"The Map already contains an entry for \".concat(t));this.set(n,e)}},{key:\"Remove\",value:function(t){return this.delete(t.serialized())}},{key:\"Count\",get:function(){return this.size}},{key:\"originOfMaxItem\",get:function(){if(null==this.origins)return null;var t=this.maxItem.Key.originName,e=null;return this.origins.every((function(n){return n.name!=t||(e=n,!1)})),e}},{key:\"originNames\",get:function(){if(this.Count>0){null==this._originNames&&this.Count>0?this._originNames=[]:(this._originNames||(this._originNames=[]),this._originNames.length=0);var t,e=S(this);try{for(e.s();!(t=e.n()).done;){var n=m(t.value,1)[0],r=M.fromSerializedKey(n);if(null===r.originName)return L(\"item.originName\");this._originNames.push(r.originName)}}catch(t){e.e(t)}finally{e.f()}}return this._originNames}},{key:\"SetInitialOriginName\",value:function(t){this._originNames=[t]}},{key:\"SetInitialOriginNames\",value:function(t){this._originNames=null==t?null:t.slice()}},{key:\"maxItem\",get:function(){var t,e={Key:M.Null,Value:0},n=S(this);try{for(n.s();!(t=n.n()).done;){var r=m(t.value,2),i=r[0],a=r[1],o=M.fromSerializedKey(i);(e.Key.isNull||a>e.Value)&&(e={Key:o,Value:a})}}catch(t){n.e(t)}finally{n.f()}return e}},{key:\"minItem\",get:function(){var t,e={Key:M.Null,Value:0},n=S(this);try{for(n.s();!(t=n.n()).done;){var r=m(t.value,2),i=r[0],a=r[1],o=M.fromSerializedKey(i);(e.Key.isNull||a<e.Value)&&(e={Key:o,Value:a})}}catch(t){n.e(t)}finally{n.f()}return e}},{key:\"inverse\",get:function(){var t=new o;if(null!=this.origins){var e,n=S(this.origins);try{for(n.s();!(e=n.n()).done;){var r,i=S(e.value.items);try{for(i.s();!(r=i.n()).done;){var a=m(r.value,2),s=a[0],l=a[1],u=M.fromSerializedKey(s);this.ContainsKey(u)||t.Add(u,l)}}catch(t){i.e(t)}finally{i.f()}}}catch(t){n.e(t)}finally{n.f()}}return t}},{key:\"all\",get:function(){var t=new o;if(null!=this.origins){var e,n=S(this.origins);try{for(n.s();!(e=n.n()).done;){var r,i=S(e.value.items);try{for(i.s();!(r=i.n()).done;){var a=m(r.value,2),s=a[0],l=a[1],u=M.fromSerializedKey(s);t.set(u.serialized(),l)}}catch(t){i.e(t)}finally{i.f()}}}catch(t){n.e(t)}finally{n.f()}}return t}},{key:\"Union\",value:function(t){var e,n=new o(this),r=S(t);try{for(r.s();!(e=r.n()).done;){var i=m(e.value,2),a=i[0],s=i[1];n.set(a,s)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:\"Intersect\",value:function(t){var e,n=new o,r=S(this);try{for(r.s();!(e=r.n()).done;){var i=m(e.value,2),a=i[0],s=i[1];t.has(a)&&n.set(a,s)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:\"Without\",value:function(t){var e,n=new o(this),r=S(t);try{for(r.s();!(e=r.n()).done;){var i=m(e.value,1)[0];n.delete(i)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:\"Contains\",value:function(t){var e,n=S(t);try{for(n.s();!(e=n.n()).done;){var r=m(e.value,1)[0];if(!this.has(r))return!1}}catch(t){n.e(t)}finally{n.f()}return!0}},{key:\"GreaterThan\",value:function(t){return 0!=this.Count&&(0==t.Count||this.minItem.Value>t.maxItem.Value)}},{key:\"GreaterThanOrEquals\",value:function(t){return 0!=this.Count&&(0==t.Count||this.minItem.Value>=t.minItem.Value&&this.maxItem.Value>=t.maxItem.Value)}},{key:\"LessThan\",value:function(t){return 0!=t.Count&&(0==this.Count||this.maxItem.Value<t.minItem.Value)}},{key:\"LessThanOrEquals\",value:function(t){return 0!=t.Count&&(0==this.Count||this.maxItem.Value<=t.maxItem.Value&&this.minItem.Value<=t.minItem.Value)}},{key:\"MaxAsList\",value:function(){return this.Count>0?new o(this.maxItem):new o}},{key:\"MinAsList\",value:function(){return this.Count>0?new o(this.minItem):new o}},{key:\"ListWithSubRange\",value:function(t,e){if(0==this.Count)return new o;var n=this.orderedItems,r=0,i=Number.MAX_SAFE_INTEGER;Number.isInteger(t)?r=t:t instanceof o&&t.Count>0&&(r=t.minItem.Value),Number.isInteger(e)?i=e:t instanceof o&&t.Count>0&&(i=e.maxItem.Value);var a=new o;a.SetInitialOriginNames(this.originNames);var s,l=S(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;u.Value>=r&&u.Value<=i&&a.Add(u.Key,u.Value)}}catch(t){l.e(t)}finally{l.f()}return a}},{key:\"Equals\",value:function(t){if(t instanceof o==!1)return!1;if(t.Count!=this.Count)return!1;var e,n=S(this);try{for(n.s();!(e=n.n()).done;){var r=m(e.value,1)[0];if(!t.has(r))return!1}}catch(t){n.e(t)}finally{n.f()}return!0}},{key:\"orderedItems\",get:function(){var t,e=new Array,n=S(this);try{for(n.s();!(t=n.n()).done;){var r=m(t.value,2),i=r[0],a=r[1],o=M.fromSerializedKey(i);e.push({Key:o,Value:a})}}catch(t){n.e(t)}finally{n.f()}return e.sort((function(t,e){return null===t.Key.originName?L(\"x.Key.originName\"):null===e.Key.originName?L(\"y.Key.originName\"):t.Value==e.Value?t.Key.originName.localeCompare(e.Key.originName):t.Value<e.Value?-1:t.Value>e.Value?1:0})),e}},{key:\"toString\",value:function(){for(var t=this.orderedItems,e=new j,n=0;n<t.length;n++){n>0&&e.Append(\", \");var r=t[n].Key;if(null===r.itemName)return L(\"item.itemName\");e.Append(r.itemName)}return e.toString()}},{key:\"valueOf\",value:function(){return NaN}}],[{key:\"FromString\",value:function(t,e){var n,r=null===(n=e.listDefinitions)||void 0===n?void 0:n.FindSingleItemListWithName(t);if(r)return null===r.value?L(\"listValue.value\"):new o(r.value);throw new Error(\"Could not find the InkListItem from the string '\"+t+\"' to create an InkList because it doesn't exist in the original list definition in ink.\")}}]),o}(c(Map)),G=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this,t)).useEndLineNumber=!1,i.message=t,i.name=\"StoryException\",i}return i(r)}(c(Error));function q(t,e,n){if(null===t)return{result:n,exists:!1};var r=t.get(e);return void 0===r?{result:n,exists:!1}:{result:r,exists:!0}}var U,K=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this)).value=t,i}return i(r,[{key:\"valueObject\",get:function(){return this.value}},{key:\"toString\",value:function(){return null===this.value?L(\"Value.value\"):this.value.toString()}}]),r}(function(t){a(r,t);var e=d(r);function r(){return n(this,r),e.apply(this,arguments)}return i(r,[{key:\"Copy\",value:function(){return A(r.Create(this.valueObject),V)}},{key:\"BadCastException\",value:function(t){return new G(\"Can't cast \"+this.valueObject+\" from \"+this.valueType+\" to \"+t)}}],[{key:\"Create\",value:function(t,e){if(e){if(e===U.Int&&Number.isInteger(Number(t)))return new J(Number(t));if(e===U.Float&&!isNaN(t))return new z(Number(t))}return\"boolean\"==typeof t?new H(Boolean(t)):\"string\"==typeof t?new $(String(t)):Number.isInteger(Number(t))?new J(Number(t)):isNaN(t)?t instanceof R?new X(A(t,R)):t instanceof B?new Z(A(t,B)):null:new z(Number(t))}}]),r}(V)),H=function(t){a(r,t);var e=d(r);function r(t){return n(this,r),e.call(this,t||!1)}return i(r,[{key:\"isTruthy\",get:function(){return Boolean(this.value)}},{key:\"valueType\",get:function(){return U.Bool}},{key:\"Cast\",value:function(t){if(null===this.value)return L(\"Value.value\");if(t==this.valueType)return this;if(t==U.Int)return new J(this.value?1:0);if(t==U.Float)return new z(this.value?1:0);if(t==U.String)return new $(this.value?\"true\":\"false\");throw this.BadCastException(t)}},{key:\"toString\",value:function(){return this.value?\"true\":\"false\"}}]),r}(K),J=function(t){a(r,t);var e=d(r);function r(t){return n(this,r),e.call(this,t||0)}return i(r,[{key:\"isTruthy\",get:function(){return 0!=this.value}},{key:\"valueType\",get:function(){return U.Int}},{key:\"Cast\",value:function(t){if(null===this.value)return L(\"Value.value\");if(t==this.valueType)return this;if(t==U.Bool)return new H(0!==this.value);if(t==U.Float)return new z(this.value);if(t==U.String)return new $(\"\"+this.value);throw this.BadCastException(t)}}]),r}(K),z=function(t){a(r,t);var e=d(r);function r(t){return n(this,r),e.call(this,t||0)}return i(r,[{key:\"isTruthy\",get:function(){return 0!=this.value}},{key:\"valueType\",get:function(){return U.Float}},{key:\"Cast\",value:function(t){if(null===this.value)return L(\"Value.value\");if(t==this.valueType)return this;if(t==U.Bool)return new H(0!==this.value);if(t==U.Int)return new J(this.value);if(t==U.String)return new $(\"\"+this.value);throw this.BadCastException(t)}}]),r}(K),$=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this,t||\"\"))._isNewline=\"\\n\"==i.value,i._isInlineWhitespace=!0,null===i.value?f(i,L(\"Value.value\")):(i.value.length>0&&i.value.split(\"\").every((function(t){return\" \"==t||\"\\t\"==t||(i._isInlineWhitespace=!1,!1)})),i)}return i(r,[{key:\"valueType\",get:function(){return U.String}},{key:\"isTruthy\",get:function(){return null===this.value?L(\"Value.value\"):this.value.length>0}},{key:\"isNewline\",get:function(){return this._isNewline}},{key:\"isInlineWhitespace\",get:function(){return this._isInlineWhitespace}},{key:\"isNonWhitespace\",get:function(){return!this.isNewline&&!this.isInlineWhitespace}},{key:\"Cast\",value:function(t){if(t==this.valueType)return this;if(t==U.Int){var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=parseInt(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}(this.value);if(e.exists)return new J(e.result);throw this.BadCastException(t)}if(t==U.Float){var n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=parseFloat(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}(this.value);if(n.exists)return new z(n.result);throw this.BadCastException(t)}throw this.BadCastException(t)}}]),r}(K),X=function(t){a(r,t);var e=d(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return n(this,r),e.call(this,t)}return i(r,[{key:\"valueType\",get:function(){return U.DivertTarget}},{key:\"targetPath\",get:function(){return null===this.value?L(\"Value.value\"):this.value},set:function(t){this.value=t}},{key:\"isTruthy\",get:function(){throw new Error(\"Shouldn't be checking the truthiness of a divert target\")}},{key:\"Cast\",value:function(t){if(t==this.valueType)return this;throw this.BadCastException(t)}},{key:\"toString\",value:function(){return\"DivertTargetValue(\"+this.targetPath+\")\"}}]),r}(K),Y=function(t){a(r,t);var e=d(r);function r(t){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n(this,r),(i=e.call(this,t))._contextIndex=a,i}return i(r,[{key:\"contextIndex\",get:function(){return this._contextIndex},set:function(t){this._contextIndex=t}},{key:\"variableName\",get:function(){return null===this.value?L(\"Value.value\"):this.value},set:function(t){this.value=t}},{key:\"valueType\",get:function(){return U.VariablePointer}},{key:\"isTruthy\",get:function(){throw new Error(\"Shouldn't be checking the truthiness of a variable pointer\")}},{key:\"Cast\",value:function(t){if(t==this.valueType)return this;throw this.BadCastException(t)}},{key:\"toString\",value:function(){return\"VariablePointerValue(\"+this.variableName+\")\"}},{key:\"Copy\",value:function(){return new r(this.variableName,this.contextIndex)}}]),r}(K),Z=function(t){a(r,t);var e=d(r);function r(t,i){var a;return n(this,r),a=e.call(this,null),t||i?t instanceof B?a.value=new B(t):t instanceof M&&\"number\"==typeof i&&(a.value=new B({Key:t,Value:i})):a.value=new B,a}return i(r,[{key:\"isTruthy\",get:function(){return null===this.value?L(\"this.value\"):this.value.Count>0}},{key:\"valueType\",get:function(){return U.List}},{key:\"Cast\",value:function(t){if(null===this.value)return L(\"Value.value\");if(t==U.Int){var e=this.value.maxItem;return e.Key.isNull?new J(0):new J(e.Value)}if(t==U.Float){var n=this.value.maxItem;return n.Key.isNull?new z(0):new z(n.Value)}if(t==U.String){var r=this.value.maxItem;return r.Key.isNull?new $(\"\"):new $(r.Key.toString())}if(t==this.valueType)return this;throw this.BadCastException(t)}}],[{key:\"RetainListOriginsForAssignment\",value:function(t,e){var n=k(t,r),i=k(e,r);return i&&null===i.value?L(\"newList.value\"):n&&null===n.value?L(\"oldList.value\"):void(n&&i&&0==i.value.Count&&i.value.SetInitialOriginNames(n.value.originNames))}}]),r}(K);!function(t){t[t.Bool=-1]=\"Bool\",t[t.Int=0]=\"Int\",t[t.Float=1]=\"Float\",t[t.List=2]=\"List\",t[t.String=3]=\"String\",t[t.DivertTarget=4]=\"DivertTarget\",t[t.VariablePointer=5]=\"VariablePointer\"}(U||(U={}));var Q=function(){function t(){n(this,t),this.obj=null,this.approximate=!1}return i(t,[{key:\"correctObj\",get:function(){return this.approximate?null:this.obj}},{key:\"container\",get:function(){return this.obj instanceof tt?this.obj:null}},{key:\"copy\",value:function(){var e=new t;return e.obj=this.obj,e.approximate=this.approximate,e}}]),t}(),tt=function(t){a(r,t);var e=d(r);function r(){var t;return n(this,r),(t=e.apply(this,arguments)).name=null,t._content=[],t.namedContent=new Map,t.visitsShouldBeCounted=!1,t.turnIndexShouldBeCounted=!1,t.countingAtStartOnly=!1,t._pathToFirstLeafContent=null,t}return i(r,[{key:\"hasValidName\",get:function(){return null!=this.name&&this.name.length>0}},{key:\"content\",get:function(){return this._content},set:function(t){this.AddContent(t)}},{key:\"namedOnlyContent\",get:function(){var t,e=new Map,n=S(this.namedContent);try{for(n.s();!(t=n.n()).done;){var r=m(t.value,2),i=r[0],a=A(r[1],V);e.set(i,a)}}catch(t){n.e(t)}finally{n.f()}var o,s=S(this.content);try{for(s.s();!(o=s.n()).done;){var l=T(o.value);null!=l&&l.hasValidName&&e.delete(l.name)}}catch(t){s.e(t)}finally{s.f()}return 0==e.size&&(e=null),e},set:function(t){var e=this.namedOnlyContent;if(null!=e){var n,r=S(e);try{for(r.s();!(n=r.n()).done;){var i=m(n.value,1)[0];this.namedContent.delete(i)}}catch(t){r.e(t)}finally{r.f()}}if(null!=t){var a,o=S(t);try{for(o.s();!(a=o.n()).done;){var s=T(m(a.value,2)[1]);null!=s&&this.AddToNamedContentOnly(s)}}catch(t){o.e(t)}finally{o.f()}}}},{key:\"countFlags\",get:function(){var t=0;return this.visitsShouldBeCounted&&(t|=r.CountFlags.Visits),this.turnIndexShouldBeCounted&&(t|=r.CountFlags.Turns),this.countingAtStartOnly&&(t|=r.CountFlags.CountStartOnly),t==r.CountFlags.CountStartOnly&&(t=0),t},set:function(t){var e=t;(e&r.CountFlags.Visits)>0&&(this.visitsShouldBeCounted=!0),(e&r.CountFlags.Turns)>0&&(this.turnIndexShouldBeCounted=!0),(e&r.CountFlags.CountStartOnly)>0&&(this.countingAtStartOnly=!0)}},{key:\"pathToFirstLeafContent\",get:function(){return null==this._pathToFirstLeafContent&&(this._pathToFirstLeafContent=this.path.PathByAppendingPath(this.internalPathToFirstLeafContent)),this._pathToFirstLeafContent}},{key:\"internalPathToFirstLeafContent\",get:function(){for(var t=[],e=this;e instanceof r;)e.content.length>0&&(t.push(new R.Component(0)),e=e.content[0]);return new R(t)}},{key:\"AddContent\",value:function(t){if(t instanceof Array){var e,n=S(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.AddContent(r)}}catch(t){n.e(t)}finally{n.f()}}else{var i=t;if(this._content.push(i),i.parent)throw new Error(\"content is already in \"+i.parent);i.parent=this,this.TryAddNamedContent(i)}}},{key:\"TryAddNamedContent\",value:function(t){var e=T(t);null!=e&&e.hasValidName&&this.AddToNamedContentOnly(e)}},{key:\"AddToNamedContentOnly\",value:function(t){if(I.AssertType(t,V,\"Can only add Runtime.Objects to a Runtime.Container\"),A(t,V).parent=this,null===t.name)return L(\"namedContentObj.name\");this.namedContent.set(t.name,t)}},{key:\"ContentAtPath\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;-1==n&&(n=t.length);var i=new Q;i.approximate=!1;for(var a=this,o=this,s=e;s<n;++s){var l=t.GetComponent(s);if(null==a){i.approximate=!0;break}var u=a.ContentWithPathComponent(l);if(null==u){i.approximate=!0;break}o=u,a=k(u,r)}return i.obj=o,i}},{key:\"InsertContent\",value:function(t,e){if(this.content.splice(e,0,t),t.parent)throw new Error(\"content is already in \"+t.parent);t.parent=this,this.TryAddNamedContent(t)}},{key:\"AddContentsOfContainer\",value:function(t){var e;(e=this.content).push.apply(e,y(t.content));var n,r=S(t.content);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.parent=this,this.TryAddNamedContent(i)}}catch(t){r.e(t)}finally{r.f()}}},{key:\"ContentWithPathComponent\",value:function(t){if(t.isIndex)return t.index>=0&&t.index<this.content.length?this.content[t.index]:null;if(t.isParent)return this.parent;if(null===t.name)return L(\"component.name\");var e=q(this.namedContent,t.name,null);return e.exists?A(e.result,V):null}},{key:\"BuildStringOfHierarchy\",value:function(){var t;if(0==arguments.length)return t=new j,this.BuildStringOfHierarchy(t,0,null),t.toString();t=arguments[0];var e=arguments[1],n=arguments[2];function i(){for(var n=0;n<4*e;++n)t.Append(\" \")}i(),t.Append(\"[\"),this.hasValidName&&t.AppendFormat(\" ({0})\",this.name),this==n&&t.Append(\"  <---\"),t.AppendLine(),e++;for(var a=0;a<this.content.length;++a){var o=this.content[a];if(o instanceof r){var s=o;s.BuildStringOfHierarchy(t,e,n)}else i(),o instanceof $?(t.Append('\"'),t.Append(o.toString().replace(\"\\n\",\"\\\\n\")),t.Append('\"')):t.Append(o.toString());a!=this.content.length-1&&t.Append(\",\"),o instanceof r||o!=n||t.Append(\"  <---\"),t.AppendLine()}var l,u=new Map,c=S(this.namedContent);try{for(c.s();!(l=c.n()).done;){var h=m(l.value,2),f=h[0],d=h[1];this.content.indexOf(A(d,V))>=0||u.set(f,d)}}catch(t){c.e(t)}finally{c.f()}if(u.size>0){i(),t.AppendLine(\"-- named: --\");var v,p=S(u);try{for(p.s();!(v=p.n()).done;){var y=m(v.value,2),g=y[1];I.AssertType(g,r,\"Can only print out named Containers\");var C=g;C.BuildStringOfHierarchy(t,e,n),t.AppendLine()}}catch(t){p.e(t)}finally{p.f()}}e--,i(),t.Append(\"]\")}}]),r}(V);!function(t){var e;(e=t.CountFlags||(t.CountFlags={}))[e.Visits=1]=\"Visits\",e[e.Turns=2]=\"Turns\",e[e.CountStartOnly=4]=\"CountStartOnly\"}(tt||(tt={}));var et=function(t){a(r,t);var e=d(r);function r(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.CommandType.NotSet;return n(this,r),(t=e.call(this))._commandType=i,t}return i(r,[{key:\"commandType\",get:function(){return this._commandType}},{key:\"Copy\",value:function(){return new r(this.commandType)}},{key:\"toString\",value:function(){return this.commandType.toString()}}],[{key:\"EvalStart\",value:function(){return new r(r.CommandType.EvalStart)}},{key:\"EvalOutput\",value:function(){return new r(r.CommandType.EvalOutput)}},{key:\"EvalEnd\",value:function(){return new r(r.CommandType.EvalEnd)}},{key:\"Duplicate\",value:function(){return new r(r.CommandType.Duplicate)}},{key:\"PopEvaluatedValue\",value:function(){return new r(r.CommandType.PopEvaluatedValue)}},{key:\"PopFunction\",value:function(){return new r(r.CommandType.PopFunction)}},{key:\"PopTunnel\",value:function(){return new r(r.CommandType.PopTunnel)}},{key:\"BeginString\",value:function(){return new r(r.CommandType.BeginString)}},{key:\"EndString\",value:function(){return new r(r.CommandType.EndString)}},{key:\"NoOp\",value:function(){return new r(r.CommandType.NoOp)}},{key:\"ChoiceCount\",value:function(){return new r(r.CommandType.ChoiceCount)}},{key:\"Turns\",value:function(){return new r(r.CommandType.Turns)}},{key:\"TurnsSince\",value:function(){return new r(r.CommandType.TurnsSince)}},{key:\"ReadCount\",value:function(){return new r(r.CommandType.ReadCount)}},{key:\"Random\",value:function(){return new r(r.CommandType.Random)}},{key:\"SeedRandom\",value:function(){return new r(r.CommandType.SeedRandom)}},{key:\"VisitIndex\",value:function(){return new r(r.CommandType.VisitIndex)}},{key:\"SequenceShuffleIndex\",value:function(){return new r(r.CommandType.SequenceShuffleIndex)}},{key:\"StartThread\",value:function(){return new r(r.CommandType.StartThread)}},{key:\"Done\",value:function(){return new r(r.CommandType.Done)}},{key:\"End\",value:function(){return new r(r.CommandType.End)}},{key:\"ListFromInt\",value:function(){return new r(r.CommandType.ListFromInt)}},{key:\"ListRange\",value:function(){return new r(r.CommandType.ListRange)}},{key:\"ListRandom\",value:function(){return new r(r.CommandType.ListRandom)}}]),r}(V);!function(t){var e;(e=t.CommandType||(t.CommandType={}))[e.NotSet=-1]=\"NotSet\",e[e.EvalStart=0]=\"EvalStart\",e[e.EvalOutput=1]=\"EvalOutput\",e[e.EvalEnd=2]=\"EvalEnd\",e[e.Duplicate=3]=\"Duplicate\",e[e.PopEvaluatedValue=4]=\"PopEvaluatedValue\",e[e.PopFunction=5]=\"PopFunction\",e[e.PopTunnel=6]=\"PopTunnel\",e[e.BeginString=7]=\"BeginString\",e[e.EndString=8]=\"EndString\",e[e.NoOp=9]=\"NoOp\",e[e.ChoiceCount=10]=\"ChoiceCount\",e[e.Turns=11]=\"Turns\",e[e.TurnsSince=12]=\"TurnsSince\",e[e.Random=13]=\"Random\",e[e.SeedRandom=14]=\"SeedRandom\",e[e.VisitIndex=15]=\"VisitIndex\",e[e.SequenceShuffleIndex=16]=\"SequenceShuffleIndex\",e[e.StartThread=17]=\"StartThread\",e[e.Done=18]=\"Done\",e[e.End=19]=\"End\",e[e.ListFromInt=20]=\"ListFromInt\",e[e.ListRange=21]=\"ListRange\",e[e.ListRandom=22]=\"ListRandom\",e[e.ReadCount=23]=\"ReadCount\",e[e.TOTAL_VALUES=24]=\"TOTAL_VALUES\"}(et||(et={}));var nt=function(t){a(r,t);var e=d(r);function r(){var t;return n(this,r),(t=e.apply(this,arguments))._prototypeRuntimeConstantExpression=null,t.outputWhenComplete=!1,t.GenerateRuntimeObject=function(){var e=new tt;return e.AddContent(et.EvalStart()),t.GenerateIntoContainer(e),t.outputWhenComplete&&e.AddContent(et.EvalOutput()),e.AddContent(et.EvalEnd()),e},t.GenerateConstantIntoContainer=function(e){null===t._prototypeRuntimeConstantExpression&&(t._prototypeRuntimeConstantExpression=new tt,t.GenerateIntoContainer(t._prototypeRuntimeConstantExpression));var n,r=S(t._prototypeRuntimeConstantExpression.content);try{for(r.s();!(n=r.n()).done;){var i=n.value.Copy();i&&e.AddContent(i)}}catch(t){r.e(t)}finally{r.f()}},t.toString=function(){return\"No string value in JavaScript.\"},t}return i(r)}(W),rt=function(t){a(r,t);var e=d(r);function r(){return n(this,r),e.apply(this,arguments)}return i(r)}(V),it=function(t){a(r,t);var e=d(r);function r(){var t;if(n(this,r),(t=e.call(this))._name=null,t._numberOfParameters=0,t._prototype=null,t._isPrototype=!1,t._operationFuncs=null,0===arguments.length)r.GenerateNativeFunctionsIfNecessary();else if(1===arguments.length){var i=arguments[0];r.GenerateNativeFunctionsIfNecessary(),t.name=i}else if(2===arguments.length){var a=arguments[0],o=arguments[1];t._isPrototype=!0,t.name=a,t.numberOfParameters=o}return t}return i(r,[{key:\"name\",get:function(){return null===this._name?L(\"NativeFunctionCall._name\"):this._name},set:function(t){this._name=t,this._isPrototype||(null===r._nativeFunctions?L(\"NativeFunctionCall._nativeFunctions\"):this._prototype=r._nativeFunctions.get(this._name)||null)}},{key:\"numberOfParameters\",get:function(){return this._prototype?this._prototype.numberOfParameters:this._numberOfParameters},set:function(t){this._numberOfParameters=t}},{key:\"Call\",value:function(t){if(this._prototype)return this._prototype.Call(t);if(this.numberOfParameters!=t.length)throw new Error(\"Unexpected number of parameters\");var e,n=!1,r=S(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i instanceof rt)throw new G('Attempting to perform operation on a void value. Did you forget to \"return\" a value from a function you called here?');i instanceof Z&&(n=!0)}}catch(t){r.e(t)}finally{r.f()}if(2==t.length&&n)return this.CallBinaryListOperation(t);var a=this.CoerceValuesToSingleType(t),o=a[0].valueType;return o==U.Int||o==U.Float||o==U.String||o==U.DivertTarget||o==U.List?this.CallType(a):null}},{key:\"CallType\",value:function(t){var e=A(t[0],K),n=e.valueType,i=e,a=t.length;if(2==a||1==a){if(null===this._operationFuncs)return L(\"NativeFunctionCall._operationFuncs\");var o=this._operationFuncs.get(n);if(!o){var s=U[n];throw new G(\"Cannot perform operation \"+this.name+\" on \"+s)}if(2==a){var l=A(t[1],K),u=o;if(null===i.value||null===l.value)return L(\"NativeFunctionCall.Call BinaryOp values\");var c=u(i.value,l.value);return K.Create(c)}var h=o;if(null===i.value)return L(\"NativeFunctionCall.Call UnaryOp value\");var f=h(i.value);return this.name===r.Int?K.Create(f,U.Int):this.name===r.Float?K.Create(f,U.Float):K.Create(f,e.valueType)}throw new Error(\"Unexpected number of parameters to NativeFunctionCall: \"+t.length)}},{key:\"CallBinaryListOperation\",value:function(t){if((\"+\"==this.name||\"-\"==this.name)&&t[0]instanceof Z&&t[1]instanceof J)return this.CallListIncrementOperation(t);var e=A(t[0],K),n=A(t[1],K);if(!(\"&&\"!=this.name&&\"||\"!=this.name||e.valueType==U.List&&n.valueType==U.List)){if(null===this._operationFuncs)return L(\"NativeFunctionCall._operationFuncs\");var r=this._operationFuncs.get(U.Int);if(null===r)return L(\"NativeFunctionCall.CallBinaryListOperation op\");var i=function(t){if(\"boolean\"==typeof t)return t;throw new Error(\"\".concat(t,\" is not a boolean\"))}(r(e.isTruthy?1:0,n.isTruthy?1:0));return new H(i)}if(e.valueType==U.List&&n.valueType==U.List)return this.CallType([e,n]);throw new G(\"Can not call use \"+this.name+\" operation on \"+U[e.valueType]+\" and \"+U[n.valueType])}},{key:\"CallListIncrementOperation\",value:function(t){var e=A(t[0],Z),n=A(t[1],J),r=new B;if(null===e.value)return L(\"NativeFunctionCall.CallListIncrementOperation listVal.value\");var i,a=S(e.value);try{for(a.s();!(i=a.n()).done;){var o=m(i.value,2),s=o[0],l=o[1],u=M.fromSerializedKey(s);if(null===this._operationFuncs)return L(\"NativeFunctionCall._operationFuncs\");var c=this._operationFuncs.get(U.Int);if(null===n.value)return L(\"NativeFunctionCall.CallListIncrementOperation intVal.value\");var h=c(l,n.value),f=null;if(null===e.value.origins)return L(\"NativeFunctionCall.CallListIncrementOperation listVal.value.origins\");var d,v=S(e.value.origins);try{for(v.s();!(d=v.n()).done;){var p=d.value;if(p.name==u.originName){f=p;break}}}catch(t){v.e(t)}finally{v.f()}if(null!=f){var y=f.TryGetItemWithValue(h,M.Null);y.exists&&r.Add(y.result,h)}}}catch(t){a.e(t)}finally{a.f()}return new Z(r)}},{key:\"CoerceValuesToSingleType\",value:function(t){var e,n=U.Int,r=null,i=S(t);try{for(i.s();!(e=i.n()).done;){var a=A(e.value,K);a.valueType>n&&(n=a.valueType),a.valueType==U.List&&(r=k(a,Z))}}catch(t){i.e(t)}finally{i.f()}var o=[];if(U[n]==U[U.List]){var s,l=S(t);try{for(l.s();!(s=l.n()).done;){var u=A(s.value,K);if(u.valueType==U.List)o.push(u);else{if(u.valueType!=U.Int){var c=U[u.valueType];throw new G(\"Cannot mix Lists and \"+c+\" values in this operation\")}var h=parseInt(u.valueObject);if(null===(r=A(r,Z)).value)return L(\"NativeFunctionCall.CoerceValuesToSingleType specialCaseList.value\");var f=r.value.originOfMaxItem;if(null===f)return L(\"NativeFunctionCall.CoerceValuesToSingleType list\");var d=f.TryGetItemWithValue(h,M.Null);if(!d.exists)throw new G(\"Could not find List item with the value \"+h+\" in \"+f.name);var v=new Z(d.result,h);o.push(v)}}}catch(t){l.e(t)}finally{l.f()}}else{var p,m=S(t);try{for(m.s();!(p=m.n()).done;){var y=A(p.value,K).Cast(n);o.push(y)}}catch(t){m.e(t)}finally{m.f()}}return o}},{key:\"AddOpFuncForType\",value:function(t,e){null==this._operationFuncs&&(this._operationFuncs=new Map),this._operationFuncs.set(t,e)}},{key:\"toString\",value:function(){return'Native \"'+this.name+'\"'}}],[{key:\"CallWithName\",value:function(t){return new r(t)}},{key:\"CallExistsWithName\",value:function(t){return this.GenerateNativeFunctionsIfNecessary(),this._nativeFunctions.get(t)}},{key:\"Identity\",value:function(t){return t}},{key:\"GenerateNativeFunctionsIfNecessary\",value:function(){if(null==this._nativeFunctions){this._nativeFunctions=new Map,this.AddIntBinaryOp(this.Add,(function(t,e){return t+e})),this.AddIntBinaryOp(this.Subtract,(function(t,e){return t-e})),this.AddIntBinaryOp(this.Multiply,(function(t,e){return t*e})),this.AddIntBinaryOp(this.Divide,(function(t,e){return Math.floor(t/e)})),this.AddIntBinaryOp(this.Mod,(function(t,e){return t%e})),this.AddIntUnaryOp(this.Negate,(function(t){return-t})),this.AddIntBinaryOp(this.Equal,(function(t,e){return t==e})),this.AddIntBinaryOp(this.Greater,(function(t,e){return t>e})),this.AddIntBinaryOp(this.Less,(function(t,e){return t<e})),this.AddIntBinaryOp(this.GreaterThanOrEquals,(function(t,e){return t>=e})),this.AddIntBinaryOp(this.LessThanOrEquals,(function(t,e){return t<=e})),this.AddIntBinaryOp(this.NotEquals,(function(t,e){return t!=e})),this.AddIntUnaryOp(this.Not,(function(t){return 0==t})),this.AddIntBinaryOp(this.And,(function(t,e){return 0!=t&&0!=e})),this.AddIntBinaryOp(this.Or,(function(t,e){return 0!=t||0!=e})),this.AddIntBinaryOp(this.Max,(function(t,e){return Math.max(t,e)})),this.AddIntBinaryOp(this.Min,(function(t,e){return Math.min(t,e)})),this.AddIntBinaryOp(this.Pow,(function(t,e){return Math.pow(t,e)})),this.AddIntUnaryOp(this.Floor,r.Identity),this.AddIntUnaryOp(this.Ceiling,r.Identity),this.AddIntUnaryOp(this.Int,r.Identity),this.AddIntUnaryOp(this.Float,(function(t){return t})),this.AddFloatBinaryOp(this.Add,(function(t,e){return t+e})),this.AddFloatBinaryOp(this.Subtract,(function(t,e){return t-e})),this.AddFloatBinaryOp(this.Multiply,(function(t,e){return t*e})),this.AddFloatBinaryOp(this.Divide,(function(t,e){return t/e})),this.AddFloatBinaryOp(this.Mod,(function(t,e){return t%e})),this.AddFloatUnaryOp(this.Negate,(function(t){return-t})),this.AddFloatBinaryOp(this.Equal,(function(t,e){return t==e})),this.AddFloatBinaryOp(this.Greater,(function(t,e){return t>e})),this.AddFloatBinaryOp(this.Less,(function(t,e){return t<e})),this.AddFloatBinaryOp(this.GreaterThanOrEquals,(function(t,e){return t>=e})),this.AddFloatBinaryOp(this.LessThanOrEquals,(function(t,e){return t<=e})),this.AddFloatBinaryOp(this.NotEquals,(function(t,e){return t!=e})),this.AddFloatUnaryOp(this.Not,(function(t){return 0==t})),this.AddFloatBinaryOp(this.And,(function(t,e){return 0!=t&&0!=e})),this.AddFloatBinaryOp(this.Or,(function(t,e){return 0!=t||0!=e})),this.AddFloatBinaryOp(this.Max,(function(t,e){return Math.max(t,e)})),this.AddFloatBinaryOp(this.Min,(function(t,e){return Math.min(t,e)})),this.AddFloatBinaryOp(this.Pow,(function(t,e){return Math.pow(t,e)})),this.AddFloatUnaryOp(this.Floor,(function(t){return Math.floor(t)})),this.AddFloatUnaryOp(this.Ceiling,(function(t){return Math.ceil(t)})),this.AddFloatUnaryOp(this.Int,(function(t){return Math.floor(t)})),this.AddFloatUnaryOp(this.Float,r.Identity),this.AddStringBinaryOp(this.Add,(function(t,e){return t+e})),this.AddStringBinaryOp(this.Equal,(function(t,e){return t===e})),this.AddStringBinaryOp(this.NotEquals,(function(t,e){return!(t===e)})),this.AddStringBinaryOp(this.Has,(function(t,e){return t.includes(e)})),this.AddStringBinaryOp(this.Hasnt,(function(t,e){return!t.includes(e)})),this.AddListBinaryOp(this.Add,(function(t,e){return t.Union(e)})),this.AddListBinaryOp(this.Subtract,(function(t,e){return t.Without(e)})),this.AddListBinaryOp(this.Has,(function(t,e){return t.Contains(e)})),this.AddListBinaryOp(this.Hasnt,(function(t,e){return!t.Contains(e)})),this.AddListBinaryOp(this.Intersect,(function(t,e){return t.Intersect(e)})),this.AddListBinaryOp(this.Equal,(function(t,e){return t.Equals(e)})),this.AddListBinaryOp(this.Greater,(function(t,e){return t.GreaterThan(e)})),this.AddListBinaryOp(this.Less,(function(t,e){return t.LessThan(e)})),this.AddListBinaryOp(this.GreaterThanOrEquals,(function(t,e){return t.GreaterThanOrEquals(e)})),this.AddListBinaryOp(this.LessThanOrEquals,(function(t,e){return t.LessThanOrEquals(e)})),this.AddListBinaryOp(this.NotEquals,(function(t,e){return!t.Equals(e)})),this.AddListBinaryOp(this.And,(function(t,e){return t.Count>0&&e.Count>0})),this.AddListBinaryOp(this.Or,(function(t,e){return t.Count>0||e.Count>0})),this.AddListUnaryOp(this.Not,(function(t){return 0==t.Count?1:0})),this.AddListUnaryOp(this.Invert,(function(t){return t.inverse})),this.AddListUnaryOp(this.All,(function(t){return t.all})),this.AddListUnaryOp(this.ListMin,(function(t){return t.MinAsList()})),this.AddListUnaryOp(this.ListMax,(function(t){return t.MaxAsList()})),this.AddListUnaryOp(this.Count,(function(t){return t.Count})),this.AddListUnaryOp(this.ValueOfList,(function(t){return t.maxItem.Value}));this.AddOpToNativeFunc(this.Equal,2,U.DivertTarget,(function(t,e){return t.Equals(e)})),this.AddOpToNativeFunc(this.NotEquals,2,U.DivertTarget,(function(t,e){return!t.Equals(e)}))}}},{key:\"AddOpToNativeFunc\",value:function(t,e,n,i){if(null===this._nativeFunctions)return L(\"NativeFunctionCall._nativeFunctions\");var a=this._nativeFunctions.get(t);a||(a=new r(t,e),this._nativeFunctions.set(t,a)),a.AddOpFuncForType(n,i)}},{key:\"AddIntBinaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,2,U.Int,e)}},{key:\"AddIntUnaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,1,U.Int,e)}},{key:\"AddFloatBinaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,2,U.Float,e)}},{key:\"AddFloatUnaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,1,U.Float,e)}},{key:\"AddStringBinaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,2,U.String,e)}},{key:\"AddListBinaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,2,U.List,e)}},{key:\"AddListUnaryOp\",value:function(t,e){this.AddOpToNativeFunc(t,1,U.List,e)}}]),r}(V);it.Add=\"+\",it.Subtract=\"-\",it.Divide=\"/\",it.Multiply=\"*\",it.Mod=\"%\",it.Negate=\"_\",it.Equal=\"==\",it.Greater=\">\",it.Less=\"<\",it.GreaterThanOrEquals=\">=\",it.LessThanOrEquals=\"<=\",it.NotEquals=\"!=\",it.Not=\"!\",it.And=\"&&\",it.Or=\"||\",it.Min=\"MIN\",it.Max=\"MAX\",it.Pow=\"POW\",it.Floor=\"FLOOR\",it.Ceiling=\"CEILING\",it.Int=\"INT\",it.Float=\"FLOAT\",it.Has=\"?\",it.Hasnt=\"!?\",it.Intersect=\"^\",it.ListMin=\"LIST_MIN\",it.ListMax=\"LIST_MAX\",it.All=\"LIST_ALL\",it.Count=\"LIST_COUNT\",it.ValueOfList=\"LIST_VALUE\",it.Invert=\"LIST_INVERT\",it._nativeFunctions=null;var at=function(t){a(r,t);var e=d(r);function r(t,i){var a;if(n(this,r),(a=e.call(this)).isInt=function(){return\"int\"==a.subtype},a.isFloat=function(){return\"float\"==a.subtype},a.isBool=function(){return\"bool\"==a.subtype},a.GenerateIntoContainer=function(t){a.isInt()?t.AddContent(new J(a.value)):a.isFloat()?t.AddContent(new z(a.value)):a.isBool()&&t.AddContent(new H(a.value))},a.toString=function(){return String(a.value)},(\"number\"!=typeof t||Number.isNaN(t))&&\"boolean\"!=typeof t)throw new Error(\"Unexpected object type in NumberExpression.\");return a.value=t,a.subtype=i,a}return i(r)}(nt),ot=function(t){a(r,t);var e=d(r);function r(t,i){var a;return n(this,r),(a=e.call(this)).op=i,a.GenerateIntoContainer=function(t){a.innerExpression.GenerateIntoContainer(t),t.AddContent(it.CallWithName(a.nativeNameForOp))},a.toString=function(){return a.nativeNameForOp+a.innerExpression},a.innerExpression=a.AddContent(t),a}return i(r,[{key:\"nativeNameForOp\",get:function(){return\"-\"===this.op?\"_\":\"not\"===this.op?\"!\":this.op}}]),r}(nt);ot.WithInner=function(t,e){var n=k(t,at);if(n){if(\"-\"===e){if(n.isInt())return new at(-n.value,\"int\");if(n.isFloat())return new at(-n.value,\"float\")}else if(\"!\"==e||\"not\"==e){if(n.isInt())return new at(0==n.value,\"bool\");if(n.isFloat())return new at(0==n.value,\"bool\");if(n.isBool())return new at(!n.value,\"bool\")}throw new Error(\"Unexpected operation or number type\")}return new ot(t,e)};var st=function(t){a(r,t);var e=d(r);function r(t,i,a){var o;return n(this,r),(o=e.call(this)).opName=a,o.GenerateIntoContainer=function(t){o.leftExpression.GenerateIntoContainer(t),o.rightExpression.GenerateIntoContainer(t),o.opName=o.NativeNameForOp(o.opName),t.AddContent(it.CallWithName(o.opName))},o.NativeNameForOp=function(t){return\"and\"===t?\"&&\":\"or\"===t?\"||\":\"mod\"===t?\"%\":\"has\"===t?\"?\":\"hasnt\"===t?\"!?\":t},o.toString=function(){return\"(\".concat(o.leftExpression,\" \").concat(o.opName,\" \").concat(o.rightExpression,\")\")},o.leftExpression=o.AddContent(t),o.rightExpression=o.AddContent(i),o.opName=a,o}return i(r,[{key:\"ResolveReferences\",value:function(t){if(p(o(r.prototype),\"ResolveReferences\",this).call(this,t),\"?\"===this.NativeNameForOp(this.opName)){var e=k(this.leftExpression,ot);null===e||\"not\"!==e.op&&\"!\"!==e.op||this.Error(\"Using 'not' or '!' here negates '\".concat(e.innerExpression,\"' rather than the result of the '?' or 'has' operator. You need to add parentheses around the (A ? B) expression.\"))}}}]),r}(nt),lt=i((function t(e){var r=this;n(this,t),this.set=new Set,this.Add=function(t){return r.set.add(t)},this.AddRange=function(t,e){for(var n=t.charCodeAt(0);n<=e.charCodeAt(0);++n)r.Add(String.fromCharCode(n));return r},this.AddCharacters=function(t){if(\"string\"==typeof t||Array.isArray(t)){var e,n=S(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;r.Add(i)}}catch(t){n.e(t)}finally{n.f()}}else{var a,o=S(t.set);try{for(o.s();!(a=o.n()).done;){var s=a.value;r.Add(s)}}catch(t){o.e(t)}finally{o.f()}}return r},e&&this.AddCharacters(e)}));lt.FromRange=function(t,e){return(new lt).AddRange(t,e)};var ut=function(){function t(e,r){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(n(this,t),this._start=e,this._end=r,this._correspondingCharSet=new lt,this._excludes=new Set,this.ToCharacterSet=function(){if(0===i._correspondingCharSet.set.size)for(var t=i.start.charCodeAt(0),e=String.fromCharCode(t);t<=i.end.charCodeAt(0);t+=1)i._excludes.has(e)||i._correspondingCharSet.AddCharacters(e);return i._correspondingCharSet},a instanceof lt)this._excludes=a.set;else{var o,s=S(a);try{for(s.s();!(o=s.n()).done;){var l=o.value;this._excludes.add(l)}}catch(t){s.e(t)}finally{s.f()}}}return i(t,[{key:\"start\",get:function(){return this._start}},{key:\"end\",get:function(){return this._end}}]),t}();ut.Define=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new ut(t,e,n)};var ct,ht=function(t){a(r,t);var e=d(r);function r(){var t,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return n(this,r),(t=e.call(this))._pathOnChoice=null,t.hasCondition=!1,t.hasStartContent=!1,t.hasChoiceOnlyContent=!1,t.isInvisibleDefault=!1,t.onceOnly=!0,t.onceOnly=i,t}return i(r,[{key:\"pathOnChoice\",get:function(){if(null!=this._pathOnChoice&&this._pathOnChoice.isRelative){var t=this.choiceTarget;t&&(this._pathOnChoice=t.path)}return this._pathOnChoice},set:function(t){this._pathOnChoice=t}},{key:\"choiceTarget\",get:function(){return null===this._pathOnChoice?L(\"ChoicePoint._pathOnChoice\"):this.ResolvePath(this._pathOnChoice).container}},{key:\"pathStringOnChoice\",get:function(){return null===this.pathOnChoice?L(\"ChoicePoint.pathOnChoice\"):this.CompactPathString(this.pathOnChoice)},set:function(t){this.pathOnChoice=new R(t)}},{key:\"flags\",get:function(){var t=0;return this.hasCondition&&(t|=1),this.hasStartContent&&(t|=2),this.hasChoiceOnlyContent&&(t|=4),this.isInvisibleDefault&&(t|=8),this.onceOnly&&(t|=16),t},set:function(t){this.hasCondition=(1&t)>0,this.hasStartContent=(2&t)>0,this.hasChoiceOnlyContent=(4&t)>0,this.isInvisibleDefault=(8&t)>0,this.onceOnly=(16&t)>0}},{key:\"toString\",value:function(){return null===this.pathOnChoice?L(\"ChoicePoint.pathOnChoice\"):\"Choice: -> \"+this.pathOnChoice.toString()}}]),r}(V);!function(t){t[t.Tunnel=0]=\"Tunnel\",t[t.Function=1]=\"Function\",t[t.FunctionEvaluationFromGame=2]=\"FunctionEvaluationFromGame\"}(ct||(ct={}));var ft,dt=function(){function t(){n(this,t),this.container=null,this.index=-1,2===arguments.length&&(this.container=arguments[0],this.index=arguments[1])}return i(t,[{key:\"Resolve\",value:function(){return this.index<0?this.container:null==this.container?null:0==this.container.content.length?this.container:this.index>=this.container.content.length?null:this.container.content[this.index]}},{key:\"isNull\",get:function(){return null==this.container}},{key:\"path\",get:function(){return this.isNull?null:this.index>=0?this.container.path.PathByAppendingComponent(new R.Component(this.index)):this.container.path}},{key:\"toString\",value:function(){return this.container?\"Ink Pointer -> \"+this.container.path.toString()+\" -- index \"+this.index:\"Ink Pointer (null)\"}},{key:\"copy\",value:function(){return new t(this.container,this.index)}}],[{key:\"StartOf\",value:function(e){return new t(e,0)}},{key:\"Null\",get:function(){return new t(null,-1)}}]),t}(),vt=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this))._targetPath=null,i._targetPointer=dt.Null,i.variableDivertName=null,i.pushesToStack=!1,i.stackPushType=0,i.isExternal=!1,i.externalArgs=0,i.isConditional=!1,i.pushesToStack=!1,void 0!==t&&(i.pushesToStack=!0,i.stackPushType=t),i}return i(r,[{key:\"targetPath\",get:function(){if(null!=this._targetPath&&this._targetPath.isRelative){var t=this.targetPointer.Resolve();t&&(this._targetPath=t.path)}return this._targetPath},set:function(t){this._targetPath=t,this._targetPointer=dt.Null}},{key:\"targetPointer\",get:function(){if(this._targetPointer.isNull){var t=this.ResolvePath(this._targetPath).obj;if(null===this._targetPath)return L(\"this._targetPath\");if(null===this._targetPath.lastComponent)return L(\"this._targetPath.lastComponent\");if(this._targetPath.lastComponent.isIndex){if(null===t)return L(\"targetObj\");this._targetPointer.container=t.parent instanceof tt?t.parent:null,this._targetPointer.index=this._targetPath.lastComponent.index}else this._targetPointer=dt.StartOf(t instanceof tt?t:null)}return this._targetPointer.copy()}},{key:\"targetPathString\",get:function(){return null==this.targetPath?null:this.CompactPathString(this.targetPath)},set:function(t){this.targetPath=null==t?null:new R(t)}},{key:\"hasVariableTarget\",get:function(){return null!=this.variableDivertName}},{key:\"Equals\",value:function(t){var e=t;return e instanceof r&&this.hasVariableTarget==e.hasVariableTarget&&(this.hasVariableTarget?this.variableDivertName==e.variableDivertName:null===this.targetPath?L(\"this.targetPath\"):this.targetPath.Equals(e.targetPath))}},{key:\"toString\",value:function(){if(this.hasVariableTarget)return\"Divert(variable: \"+this.variableDivertName+\")\";if(null==this.targetPath)return\"Divert(null)\";var t=new j,e=this.targetPath.toString();return t.Append(\"Divert\"),this.isConditional&&t.Append(\"?\"),this.pushesToStack&&(this.stackPushType==ct.Function?t.Append(\" function\"):t.Append(\" tunnel\")),t.Append(\" -> \"),t.Append(this.targetPathString),t.Append(\" (\"),t.Append(e),t.Append(\")\"),t.toString()}}]),r}(V);!function(t){t[t.Arg=0]=\"Arg\",t[t.Knot=1]=\"Knot\",t[t.List=2]=\"List\",t[t.ListItem=3]=\"ListItem\",t[t.SubFlowAndWeave=4]=\"SubFlowAndWeave\",t[t.Temp=5]=\"Temp\",t[t.Var=6]=\"Var\"}(ft||(ft={}));var pt=function(t){a(r,t);var e=d(r);function r(t,i){var a;return n(this,r),(a=e.call(this)).variableName=t||null,a.isNewDeclaration=!!i,a.isGlobal=!1,a}return i(r,[{key:\"toString\",value:function(){return\"VarAssign to \"+this.variableName}}]),r}(V),mt=function(t){a(r,t);var e=d(r);function r(t,i,a){var o;return n(this,r),(o=e.call(this))._condition=null,o._innerContentContainer=null,o._outerContainer=null,o._runtimeChoice=null,o._returnToR1=null,o._returnToR2=null,o._r1Label=null,o._r2Label=null,o._divertToStartContentOuter=null,o._divertToStartContentInner=null,o._startContentRuntimeContainer=null,o.isInvisibleDefault=!1,o.hasWeaveStyleInlineBrackets=!1,o.GenerateRuntimeObject=function(){if(o._outerContainer=new tt,o._runtimeChoice=new ht(o.onceOnly),o._runtimeChoice.isInvisibleDefault=o.isInvisibleDefault,(o.startContent||o.choiceOnlyContent||o.condition)&&o._outerContainer.AddContent(et.EvalStart()),o.startContent){o._returnToR1=new X,o._outerContainer.AddContent(o._returnToR1);var t=new pt(\"$r\",!0);o._outerContainer.AddContent(t),o._outerContainer.AddContent(et.BeginString()),o._divertToStartContentOuter=new vt,o._outerContainer.AddContent(o._divertToStartContentOuter),o._startContentRuntimeContainer=o.startContent.GenerateRuntimeObject(),o._startContentRuntimeContainer.name=\"s\";var e=new vt;e.variableDivertName=\"$r\",o._startContentRuntimeContainer.AddContent(e),o._outerContainer.AddToNamedContentOnly(o._startContentRuntimeContainer),o._r1Label=new tt,o._r1Label.name=\"$r1\",o._outerContainer.AddContent(o._r1Label),o._outerContainer.AddContent(et.EndString()),o._runtimeChoice.hasStartContent=!0}if(o.choiceOnlyContent){o._outerContainer.AddContent(et.BeginString());var n=o.choiceOnlyContent.GenerateRuntimeObject();o._outerContainer.AddContentsOfContainer(n),o._outerContainer.AddContent(et.EndString()),o._runtimeChoice.hasChoiceOnlyContent=!0}if(o.condition&&(o.condition.GenerateIntoContainer(o._outerContainer),o._runtimeChoice.hasCondition=!0),(o.startContent||o.choiceOnlyContent||o.condition)&&o._outerContainer.AddContent(et.EvalEnd()),o._outerContainer.AddContent(o._runtimeChoice),o._innerContentContainer=new tt,o.startContent){o._returnToR2=new X,o._innerContentContainer.AddContent(et.EvalStart()),o._innerContentContainer.AddContent(o._returnToR2),o._innerContentContainer.AddContent(et.EvalEnd());var r=new pt(\"$r\",!0);o._innerContentContainer.AddContent(r),o._divertToStartContentInner=new vt,o._innerContentContainer.AddContent(o._divertToStartContentInner),o._r2Label=new tt,o._r2Label.name=\"$r2\",o._innerContentContainer.AddContent(o._r2Label)}if(o.innerContent){var i=o.innerContent.GenerateRuntimeObject();o._innerContentContainer.AddContentsOfContainer(i)}return o.story.countAllVisits&&(o._innerContentContainer.visitsShouldBeCounted=!0),o._innerContentContainer.countingAtStartOnly=!0,o._outerContainer},o.toString=function(){return null!==o.choiceOnlyContent?\"* \".concat(o.startContent,\"[\").concat(o.choiceOnlyContent,\"]...\"):\"* \".concat(o.startContent,\"...\")},o.startContent=t,o.choiceOnlyContent=i,o.innerContent=a,o.indentationDepth=1,t&&o.AddContent(o.startContent),i&&o.AddContent(o.choiceOnlyContent),a&&o.AddContent(o.innerContent),o.onceOnly=!0,o}return i(r,[{key:\"runtimeChoice\",get:function(){if(!this._runtimeChoice)throw new Error;return this._runtimeChoice}},{key:\"name\",get:function(){var t;return(null===(t=this.identifier)||void 0===t?void 0:t.name)||null}},{key:\"condition\",get:function(){return this._condition},set:function(t){this._condition=t,t&&this.AddContent(t)}},{key:\"runtimeContainer\",get:function(){return this._innerContentContainer}},{key:\"innerContentContainer\",get:function(){return this._innerContentContainer}},{key:\"containerForCounting\",get:function(){return this._innerContentContainer}},{key:\"runtimePath\",get:function(){if(!this.innerContentContainer||!this.innerContentContainer.path)throw new Error;return this.innerContentContainer.path}},{key:\"typeName\",get:function(){return\"Choice\"}},{key:\"ResolveReferences\",value:function(t){var e;if(this._innerContentContainer&&(this.runtimeChoice.pathOnChoice=this._innerContentContainer.path,this.onceOnly&&(this._innerContentContainer.visitsShouldBeCounted=!0)),this._returnToR1){if(!this._r1Label)throw new Error;this._returnToR1.targetPath=this._r1Label.path}if(this._returnToR2){if(!this._r2Label)throw new Error;this._returnToR2.targetPath=this._r2Label.path}if(this._divertToStartContentOuter){if(!this._startContentRuntimeContainer)throw new Error;this._divertToStartContentOuter.targetPath=this._startContentRuntimeContainer.path}if(this._divertToStartContentInner){if(!this._startContentRuntimeContainer)throw new Error;this._divertToStartContentInner.targetPath=this._startContentRuntimeContainer.path}p(o(r.prototype),\"ResolveReferences\",this).call(this,t),this.identifier&&((null===(e=this.identifier)||void 0===e?void 0:e.name)||\"\").length>0&&t.CheckForNamingCollisions(this,this.identifier,ft.SubFlowAndWeave)}}]),r}(W),yt=i((function t(){var e=this;n(this,t),this.characterIndex=0,this.characterInLineIndex=0,this.lineIndex=0,this.reportedErrorInScope=!1,this.uniqueId=0,this.customFlags=0,this.CopyFrom=function(n){t._uniqueIdCounter++,e.uniqueId=t._uniqueIdCounter,e.characterIndex=n.characterIndex,e.characterInLineIndex=n.characterInLineIndex,e.lineIndex=n.lineIndex,e.customFlags=n.customFlags,e.reportedErrorInScope=!1},this.SquashFrom=function(t){e.characterIndex=t.characterIndex,e.characterInLineIndex=t.characterInLineIndex,e.lineIndex=t.lineIndex,e.reportedErrorInScope=t.reportedErrorInScope}}));yt._uniqueIdCounter=1e3;var gt=function(){function t(){var e=this;n(this,t),this._stack=[],this._numElements=0,this.StringParserState=function(){e._stack=new Array(200);for(var t=0;t<200;++t)e._stack[t]=new yt;e._numElements=1},this.Push=function(){if(e._numElements>=e._stack.length&&e._numElements>0)throw new Error(\"Stack overflow in parser state.\");var t=e._stack[e._numElements-1],n=e._stack[e._numElements];return e._numElements++,n.CopyFrom(t),n.uniqueId},this.Pop=function(t){if(1==e._numElements)throw new Error(\"Attempting to remove final stack element is illegal! Mismatched Begin/Succceed/Fail?\");if(e.currentElement.uniqueId!=t)throw new Error(\"Mismatched rule IDs while Poping - do you have mismatched Begin/Succeed/Fail?\");e._numElements-=1},this.Peek=function(t){if(e.currentElement.uniqueId!=t)throw new Error(\"Mismatched rule IDs while Peeking - do you have mismatched Begin/Succeed/Fail?\");return e._stack[e._numElements-1]},this.PeekPenultimate=function(){return e._numElements>=2?e._stack[e._numElements-2]:null},this.Squash=function(){if(e._numElements<2)throw new Error(\"Attempting to remove final stack element is illegal! Mismatched Begin/Succceed/Fail?\");var t=e._stack[e._numElements-2],n=e._stack[e._numElements-1];t.SquashFrom(n),e._numElements-=1},this.NoteErrorReported=function(){var t,n=S(e._stack);try{for(n.s();!(t=n.n()).done;){t.value.reportedErrorInScope=!0}}catch(t){n.e(t)}finally{n.f()}};for(var r=0;r<200;r++)this._stack[r]=new yt;this._numElements=1}return i(t,[{key:\"currentElement\",get:function(){return this._stack[this._numElements-1]}},{key:\"lineIndex\",get:function(){return this.currentElement.lineIndex},set:function(t){this.currentElement.lineIndex=t}},{key:\"characterIndex\",get:function(){return this.currentElement.characterIndex},set:function(t){this.currentElement.characterIndex=t}},{key:\"characterInLineIndex\",get:function(){return this.currentElement.characterInLineIndex},set:function(t){this.currentElement.characterInLineIndex=t}},{key:\"customFlags\",get:function(){return this.currentElement.customFlags},set:function(t){this.currentElement.customFlags=t}},{key:\"errorReportedAlreadyInScope\",get:function(){return this.currentElement.reportedErrorInScope}},{key:\"stackHeight\",get:function(){return this._numElements}}]),t}(),Ct=Symbol(\"ParseSuccessStruct\"),St=function(){function t(e){var r=this;n(this,t),this.ParseRule=null,this.errorHandler=null,this.hadError=!1,this.BeginRule=function(){return r.state.Push()},this.FailRule=function(t){return r.state.Pop(t),null},this.CancelRule=function(t){r.state.Pop(t)},this.SucceedRule=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=r.state.Peek(e),a=r.state.PeekPenultimate();r.RuleDidSucceed&&r.RuleDidSucceed(n,a,i),r.state.Squash();var o=n;return null===o&&(o=t.ParseSuccess),o},this.Expect=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=r.ParseObject(t);if(null===i){var a;null===e&&(e=t.name);var o=r.LineRemainder();a=null===o||0===o.length?\"end of line\":\"'\".concat(o,\"'\"),r.Error(\"Expected \".concat(e,\" but saw \").concat(a)),null!==n&&(i=n())}return i},this.Error=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r.ErrorOnLine(t,r.lineIndex+1,e)},this.ErrorWithParsedObject=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r.ErrorOnLine(t,e.debugMetadata?e.debugMetadata.startLineNumber:-1,n)},this.ErrorOnLine=function(t,e,n){if(!r.state.errorReportedAlreadyInScope){var i=n?\"Warning\":\"Error\";if(!r.errorHandler)throw new Error(\"\".concat(i,\" on line \").concat(e,\": \").concat(t));r.errorHandler(t,r.index,e-1,n),r.state.NoteErrorReported()}n||(r.hadError=!0)},this.Warning=function(t){return r.Error(t,!0)},this.LineRemainder=function(){return r.Peek((function(){return r.ParseUntilCharactersFromString(\"\\n\\r\")}))},this.SetFlag=function(t,e){e?r.state.customFlags|=t:r.state.customFlags&=~t},this.GetFlag=function(t){return Boolean(r.state.customFlags&t)},this.ParseObject=function(t){var e=r.BeginRule(),n=r.state.stackHeight,i=t();if(n!==r.state.stackHeight)throw new Error(\"Mismatched Begin/Fail/Succeed rules\");return null===i?r.FailRule(e):(r.SucceedRule(e,i),i)},this.Parse=function(t){var e=r.BeginRule(),n=t();return null===n?(r.FailRule(e),null):(r.SucceedRule(e,n),n)},this.OneOf=function(t){var e,n=S(t);try{for(n.s();!(e=n.n()).done;){var i=e.value,a=r.ParseObject(i);if(null!==a)return a}}catch(t){n.e(t)}finally{n.f()}return null},this.OneOrMore=function(t){var e=[],n=null;do{null!==(n=r.ParseObject(t))&&e.push(n)}while(null!==n);return e.length>0?e:null},this.Optional=function(e){return function(){return r.ParseObject(e)||t.ParseSuccess}},this.Exclude=function(e){return function(){return r.ParseObject(e)&&t.ParseSuccess}},this.OptionalExclude=function(e){return function(){return r.ParseObject(e),t.ParseSuccess}},this.String=function(t){return function(){return r.ParseString(t)}},this.TryAddResultToList=function(e,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e!==t.ParseSuccess){if(r&&Array.isArray(e)){var i=e;if(null!==i){var a,o=S(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;n.push(s)}}catch(t){o.e(t)}finally{o.f()}return}}n.push(e)}},this.Interleave=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=r.BeginRule(),s=[],l=r.ParseObject(e);if(null===l)return r.FailRule(o);r.TryAddResultToList(l,s,a);var u=null,c=null;do{if(null!==i&&null!==r.Peek(i))break;if(null===(u=r.ParseObject(n)))break;if(r.TryAddResultToList(u,s,a),c=null,null!==u){if(null===(c=r.ParseObject(e)))break;r.TryAddResultToList(c,s,a)}}while((null!==u||null!==c)&&(u!==t.ParseSuccess||c!=t.ParseSuccess)&&r.remainingLength>0);return 0===s.length?r.FailRule(o):r.SucceedRule(o,s)},this.ParseString=function(t){if(t.length>r.remainingLength)return null;for(var e=r.BeginRule(),n=r.index,i=r.characterInLineIndex,a=r.lineIndex,o=!0,s=0;s<t.length;s+=1){var l=t[s];if(r._chars[n]!==l){o=!1;break}\"\\n\"===l&&(a++,i=-1),n++,i++}return r.index=n,r.characterInLineIndex=i,r.lineIndex=a,o?r.SucceedRule(e,t):r.FailRule(e)},this.ParseSingleCharacter=function(){if(r.remainingLength>0){var t=r._chars[r.index];return\"\\n\"===t&&(r.lineIndex+=1,r.characterInLineIndex=-1),r.index+=1,r.characterInLineIndex+=1,t}return\"0\"},this.ParseUntilCharactersFromString=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return r.ParseCharactersFromString(t,!1,e)},this.ParseUntilCharactersFromCharSet=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return r.ParseCharactersFromCharSet(t,!1,e)},this.ParseCharactersFromString=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,i=new lt(t);return\"number\"==typeof e?r.ParseCharactersFromCharSet(i,!0,e):r.ParseCharactersFromCharSet(i,e,n)},this.ParseCharactersFromCharSet=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;-1===n&&(n=Number.MAX_SAFE_INTEGER);for(var i=r.index,a=r.index,o=r.characterInLineIndex,s=r.lineIndex,l=0;a<r._chars.length&&t.set.has(r._chars[a])===e&&l<n;)\"\\n\"===r._chars[a]&&(s+=1,o=-1),a+=1,o+=1,l+=1;r.index=a,r.characterInLineIndex=o,r.lineIndex=s;var u=r.index;return u>i?r._chars.slice(i,r.index).join(\"\"):null},this.Peek=function(t){var e=r.BeginRule(),n=t();return r.CancelRule(e),n},this.ParseInt=function(){var e=r.index,n=r.characterInLineIndex,i=null!==r.ParseString(\"-\");r.ParseCharactersFromString(\" \\t\");var a,o=r.ParseCharactersFromCharSet(t.numbersCharacterSet);return null===o?(r.index=e,r.characterInLineIndex=n,null):Number.isNaN(Number(o))?(r.Error(\"Failed to read integer value: \"+o+\". Perhaps it's out of the range of acceptable numbers ink supports? (\"+Number.MIN_SAFE_INTEGER+\" to \"+Number.MAX_SAFE_INTEGER+\")\"),null):(a=Number(o),i?-a:a)},this.ParseFloat=function(){var e=r.index,n=r.characterInLineIndex,i=r.ParseInt();if(null!==i&&null!==r.ParseString(\".\")){var a=r.ParseCharactersFromCharSet(t.numbersCharacterSet);return Number(\"\".concat(i,\".\").concat(a))}return r.index=e,r.characterInLineIndex=n,null},this.ParseNewline=function(){var t=r.BeginRule();return r.ParseString(\"\\r\"),null===r.ParseString(\"\\n\")?r.FailRule(t):r.SucceedRule(t,\"\\n\")};var i=this.PreProcessInputString(e);this.state=new gt,this._chars=e?i.split(\"\"):[],this.inputString=i}return i(t,[{key:\"currentCharacter\",get:function(){return this.index>=0&&this.remainingLength>0?this._chars[this.index]:\"0\"}},{key:\"PreProcessInputString\",value:function(t){return t}},{key:\"endOfInput\",get:function(){return this.index>=this._chars.length}},{key:\"remainingString\",get:function(){return this._chars.slice(this.index,this.index+this.remainingLength).join(\"\")}},{key:\"remainingLength\",get:function(){return this._chars.length-this.index}},{key:\"lineIndex\",get:function(){return this.state.lineIndex},set:function(t){this.state.lineIndex=t}},{key:\"characterInLineIndex\",get:function(){return this.state.characterInLineIndex},set:function(t){this.state.characterInLineIndex=t}},{key:\"index\",get:function(){return this.state.characterIndex},set:function(t){this.state.characterIndex=t}},{key:\"ParseUntil\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.BeginRule(),i=new lt;null!==e&&(i.set=new Set([].concat(y(i.set.values()),y(e.set.values())))),null!==n&&(i.set=new Set([].concat(y(i.set.values()),y(n.set.values()))));for(var a=\"\";;){var o=this.ParseUntilCharactersFromCharSet(i);if(o&&(a+=o),null!==this.Peek(t))break;if(this.endOfInput)break;var s=this.currentCharacter;if(null===e||!e.set.has(s))break;a+=s,\"\\n\"===s&&(this.lineIndex+=1,this.characterInLineIndex=-1),this.index+=1,this.characterInLineIndex+=1}return a.length>0?this.SucceedRule(r,String(a)):this.FailRule(r)}}]),t}();St.ParseSuccess=Ct,St.numbersCharacterSet=new lt(\"0123456789\");var bt,wt=function(t){a(r,t);var e=d(r);function r(){var t;return n(this,r),(t=e.apply(this,arguments))._commentOrNewlineStartCharacter=new lt(\"/\\r\\n\"),t._commentBlockEndCharacter=new lt(\"*\"),t._newlineCharacters=new lt(\"\\n\\r\"),t.Process=function(){var e=t.Interleave(t.Optional(t.CommentsAndNewlines),t.Optional(t.MainInk));return null!==e?e.join(\"\"):\"\"},t.MainInk=function(){return t.ParseUntil(t.CommentsAndNewlines,t._commentOrNewlineStartCharacter,null)},t.CommentsAndNewlines=function(){var e=t.Interleave(t.Optional(t.ParseNewline),t.Optional(t.ParseSingleComment));return null!==e?e.join(\"\"):null},t.ParseSingleComment=function(){return t.OneOf([t.EndOfLineComment,t.BlockComment])},t.EndOfLineComment=function(){return null===t.ParseString(\"//\")?null:(t.ParseUntilCharactersFromCharSet(t._newlineCharacters),\"\")},t.BlockComment=function(){if(null===t.ParseString(\"/*\"))return null;var e=t.lineIndex,n=t.ParseUntil(t.String(\"*/\"),t._commentBlockEndCharacter,null);return t.endOfInput||t.ParseString(\"*/\"),null!=n?\"\\n\".repeat(t.lineIndex-e):null},t}return i(r,[{key:\"PreProcessInputString\",value:function(t){return t}}]),r}(St),_t=function(t){a(r,t);var e=d(r);function r(t,i){var a;return n(this,r),(a=e.call(this)).initialCondition=t,a.branches=i,a._reJoinTarget=null,a.GenerateRuntimeObject=function(){var t=new tt;a.initialCondition&&t.AddContent(a.initialCondition.runtimeObject);var e,n=S(a.branches);try{for(n.s();!(e=n.n()).done;){var r=e.value.runtimeObject;t.AddContent(r)}}catch(t){n.e(t)}finally{n.f()}return null===a.initialCondition||null===a.branches[0].ownExpression||a.branches[a.branches.length-1].isElse||t.AddContent(et.PopEvaluatedValue()),a._reJoinTarget=et.NoOp(),t.AddContent(a._reJoinTarget),t},a.initialCondition&&a.AddContent(a.initialCondition),null!==a.branches&&a.AddContent(a.branches),a}return i(r,[{key:\"ResolveReferences\",value:function(t){var e,n=this._reJoinTarget.path,i=S(this.branches);try{for(i.s();!(e=i.n()).done;){var a=e.value;if(!a.returnDivert)throw new Error;a.returnDivert.targetPath=n}}catch(t){i.e(t)}finally{i.f()}p(o(r.prototype),\"ResolveReferences\",this).call(this,t)}}]),r}(W),Et=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this)).text=t,i.GenerateRuntimeObject=function(){return new $(i.text)},i.toString=function(){return i.text},i}return i(r)}(W),kt=function(t){a(r,t);var e=d(r);function r(t,i){var a;return n(this,r),(a=e.call(this))._expression=null,a.GenerateRuntimeObject=function(){return null},a.constantIdentifier=t,i&&(a._expression=a.AddContent(i)),a}return i(r,[{key:\"constantName\",get:function(){var t;return null===(t=this.constantIdentifier)||void 0===t?void 0:t.name}},{key:\"expression\",get:function(){if(!this._expression)throw new Error;return this._expression}},{key:\"ResolveReferences\",value:function(t){p(o(r.prototype),\"ResolveReferences\",this).call(this,t),t.CheckForNamingCollisions(this,this.constantIdentifier,ft.Var)}},{key:\"typeName\",get:function(){return\"Constant\"}}]),r}(W);!function(t){t[t.Story=0]=\"Story\",t[t.Knot=1]=\"Knot\",t[t.Stitch=2]=\"Stitch\",t[t.WeavePoint=3]=\"WeavePoint\"}(bt||(bt={}));var At=function(t){a(r,t);var e=d(r);function r(t,i){var a;return n(this,r),(a=e.call(this)).indentationDepth=i,a.GenerateRuntimeObject=function(){var t=new tt;if(t.name=a.name,a.story.countAllVisits&&(t.visitsShouldBeCounted=!0),t.countingAtStartOnly=!0,a.content){var e,n=S(a.content);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.AddContent(r.runtimeObject)}}catch(t){n.e(t)}finally{n.f()}}return t},a.toString=function(){var t,e;return\"- \".concat((null===(t=a.identifier)||void 0===t?void 0:t.name)?\"(\"+(null===(e=a.identifier)||void 0===e?void 0:e.name)+\")\":\"gather\")},t&&(a.identifier=t),a}return i(r,[{key:\"name\",get:function(){var t;return(null===(t=this.identifier)||void 0===t?void 0:t.name)||null}},{key:\"runtimeContainer\",get:function(){return this.runtimeObject}},{key:\"typeName\",get:function(){return\"Gather\"}},{key:\"ResolveReferences\",value:function(t){p(o(r.prototype),\"ResolveReferences\",this).call(this,t),this.identifier&&(this.identifier.name||\"\").length>0&&t.CheckForNamingCollisions(this,this.identifier,ft.SubFlowAndWeave)}}]),r}(W),Tt=function(){function t(e,r){var i=this;n(this,t),this._dotSeparatedComponents=null,this.toString=function(){return null===i.components||0===i.components.length?i.baseTargetLevel===bt.WeavePoint?\"-> <next gather point>\":\"<invalid Path>\":\"-> \".concat(i.dotSeparatedComponents)},this.ResolveFromContext=function(t){if(null==i.components||0==i.components.length)return null;var e=i.ResolveBaseTarget(t);return null===e?null:i.components.length>1?i.ResolveTailComponents(e):e},this.ResolveBaseTarget=function(t){for(var e=i.firstComponent,n=t;n;){var r=n===t,a=i.GetChildFromContext(n,e,null,r);if(a)return a;n=n.parent}return null},this.ResolveTailComponents=function(t){var e=t;if(!i.components)return null;for(var n=1;n<i.components.length;++n){var r=i.components[n].name,a=void 0,o=k(e,Nt);if(a=null!==o?o.flowLevel+1:bt.WeavePoint,null===(e=i.GetChildFromContext(e,r,a)))break}return e},this.GetChildFromContext=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=null===n,a=k(t,zt);if(e&&null!==a&&(i||n===bt.WeavePoint))return a.WeavePointNamed(e);var o=k(t,Nt);if(e&&null!==o){var s=r||o.flowLevel===bt.Knot;return o.ContentWithNameAtLevel(e,n,s)}return null},Object.values(bt).includes(e)?(this._baseTargetLevel=e,this.components=r||[]):Array.isArray(e)?(this._baseTargetLevel=null,this.components=e||[]):(this._baseTargetLevel=null,this.components=[e])}return i(t,[{key:\"baseTargetLevel\",get:function(){return this.baseLevelIsAmbiguous?bt.Story:this._baseTargetLevel}},{key:\"baseLevelIsAmbiguous\",get:function(){return!this._baseTargetLevel}},{key:\"firstComponent\",get:function(){return null!=this.components&&this.components.length?this.components[0].name:null}},{key:\"numberOfComponents\",get:function(){return this.components?this.components.length:0}},{key:\"dotSeparatedComponents\",get:function(){return null==this._dotSeparatedComponents&&(this._dotSeparatedComponents=(this.components?this.components:[]).map((function(t){return t.name})).filter(N).join(\".\")),this._dotSeparatedComponents}}]),t}(),Pt=function(t){a(r,t);var e=d(r);function r(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return n(this,r),(t=e.call(this)).returnedExpression=null,t.GenerateRuntimeObject=function(){var e=new tt;return t.returnedExpression?e.AddContent(t.returnedExpression.runtimeObject):(e.AddContent(et.EvalStart()),e.AddContent(new rt),e.AddContent(et.EvalEnd())),e.AddContent(et.PopFunction()),e},i&&(t.returnedExpression=t.AddContent(i)),t}return i(r)}(W);function Ot(t){for(var e=t.parent;e;){if(e.hasOwnProperty(\"iamFlowbase\")&&e.iamFlowbase())return e;e=e.parent}return null}var xt=function(){function t(e){var r=this;n(this,t),this.debugMetadata=null,this.toString=function(){return r.name||\"undefined identifer\"},this.name=e}return i(t,null,[{key:\"Done\",value:function(){return new t(\"DONE\")}}]),t}(),Nt=function(t){a(r,t);var e=d(r);function r(t){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n(this,r),(i=e.call(this)).isFunction=s,i._rootWeave=null,i._subFlowsByName=new Map,i._startingSubFlowDivert=null,i._startingSubFlowRuntime=null,i._firstChildFlow=null,i.variableDeclarations=new Map,i.identifier=null,i.args=null,i.iamFlowbase=function(){return!0},i.SplitWeaveAndSubFlowContent=function(t,e){var n,a,o=[],s=[];i._subFlowsByName=new Map;var l,u=S(t);try{for(u.s();!(l=u.n()).done;){var c=l.value,h=k(c,r);h?(null===i._firstChildFlow&&(i._firstChildFlow=h),s.push(c),(null===(n=h.identifier)||void 0===n?void 0:n.name)&&i._subFlowsByName.set(null===(a=h.identifier)||void 0===a?void 0:a.name,h)):o.push(c)}}catch(t){u.e(t)}finally{u.f()}e&&o.push(new At(null,1),new jt(new Tt(xt.Done())));var f=[];return o.length>0&&(i._rootWeave=new zt(o,0),f.push(i._rootWeave)),s.length>0&&f.push.apply(f,s),f},i.ResolveVariableWithName=function(t,e){var n,r={},a=null===e?h(i):Ot(e);if(a){if(null!==a.args){var o,s=S(a.args);try{for(s.s();!(o=s.n()).done;){if((null===(n=o.value.identifier)||void 0===n?void 0:n.name)===t)return r.found=!0,r.isArgument=!0,r.ownerFlow=a,r}}catch(t){s.e(t)}finally{s.f()}}if(a!==i.story&&a.variableDeclarations.has(t))return r.found=!0,r.ownerFlow=a,r.isTemporary=!0,r}return i.story.variableDeclarations.has(t)?(r.found=!0,r.ownerFlow=i.story,r.isGlobal=!0,r):(r.found=!1,r)},i.AddNewVariableDeclaration=function(t){var e=t.variableName;if(i.variableDeclarations.has(e)){var n=i.variableDeclarations.get(e),r=\"\";return n.debugMetadata&&(r=\" (\".concat(n.debugMetadata,\")\")),void i.Error(\"found declaration variable '\".concat(e,\"' that was already declared\").concat(r),t,!1)}i.variableDeclarations.set(t.variableName,t)},i.ResolveWeavePointNaming=function(){i._rootWeave&&i._rootWeave.ResolveWeavePointNaming();var t,e=S(i._subFlowsByName);try{for(e.s();!(t=e.n()).done;){var n=m(t.value,2)[1];n.hasOwnProperty(\"ResolveWeavePointNaming\")&&n.ResolveWeavePointNaming()}}catch(t){e.e(t)}finally{e.f()}},i.GenerateRuntimeObject=function(){var t,e=null;i.isFunction?i.CheckForDisallowedFunctionFlowControl():i.flowLevel!==bt.Knot&&i.flowLevel!==bt.Stitch||null!==(e=i.Find(Pt)())&&i.Error(\"Return statements can only be used in knots that are declared as functions: == function \".concat(i.identifier,\" ==\"),e);var n=new tt;n.name=null===(t=i.identifier)||void 0===t?void 0:t.name,i.story.countAllVisits&&(n.visitsShouldBeCounted=!0),i.GenerateArgumentVariableAssignments(n);for(var a=0;null!==i.content&&a<i.content.length;){var o=i.content[a];if(o instanceof r){var s=o,l=s.runtimeObject;0!==a||s.hasParameters||i.flowLevel!==bt.Knot||(i._startingSubFlowDivert=new vt,n.AddContent(i._startingSubFlowDivert),i._startingSubFlowRuntime=l);var u=l,c=n.namedContent.get(u.name)||null;if(c){var h=\"\".concat(i.GetType(),\" already contains flow named '\").concat(u.name,\"' (at \").concat(c.debugMetadata,\")\");i.Error(h,s)}n.AddToNamedContentOnly(u)}else o&&n.AddContent(o.runtimeObject);a+=1}return i.flowLevel===bt.Story||i.isFunction||null===i._rootWeave||null!==e||i._rootWeave.ValidateTermination(i.WarningInTermination),n},i.GenerateArgumentVariableAssignments=function(t){var e;if(null!==i.args&&0!==i.args.length)for(var n=i.args.length-1;n>=0;--n){var r=(null===(e=i.args[n].identifier)||void 0===e?void 0:e.name)||null,a=new pt(r,!0);t.AddContent(a)}},i.ContentWithNameAtLevel=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((n===i.flowLevel||null===n)&&t===(null===(e=i.identifier)||void 0===e?void 0:e.name))return h(i);if(n===bt.WeavePoint||null===n){var a=null;if(i._rootWeave&&(a=i._rootWeave.WeavePointNamed(t)))return a;if(n===bt.WeavePoint)return r?i.DeepSearchForAnyLevelContent(t):null}if(null!==n&&n<i.flowLevel)return null;var o=i._subFlowsByName.get(t)||null;return!o||null!==n&&n!==o.flowLevel?r?i.DeepSearchForAnyLevelContent(t):null:o},i.DeepSearchForAnyLevelContent=function(t){var e=i.ContentWithNameAtLevel(t,bt.WeavePoint,!1);if(e)return e;var n,r=S(i._subFlowsByName);try{for(r.s();!(n=r.n()).done;){var a=m(n.value,2)[1].ContentWithNameAtLevel(t,null,!0);if(a)return a}}catch(t){r.e(t)}finally{r.f()}return null},i.CheckForDisallowedFunctionFlowControl=function(){i.flowLevel!==bt.Knot&&i.Error(\"Functions cannot be stitches - i.e. they should be defined as '== function myFunc ==' rather than internal to another knot.\");var t,e=S(i._subFlowsByName);try{for(e.s();!(t=e.n()).done;){var n=m(t.value,2),r=n[0],a=n[1];i.Error(\"Functions may not contain stitches, but saw '\".concat(r,\"' within the function '\").concat(i.identifier,\"'\"),a)}}catch(t){e.e(t)}finally{e.f()}if(!i._rootWeave)throw new Error;var o,s=S(i._rootWeave.FindAll(jt)());try{for(s.s();!(o=s.n()).done;){var l=o.value;l.isFunctionCall||l.parent instanceof Vt||i.Error(\"Functions may not contain diverts, but saw '\".concat(l,\"'\"),l)}}catch(t){s.e(t)}finally{s.f()}var u,c=S(i._rootWeave.FindAll(mt)());try{for(c.s();!(u=c.n()).done;){var h=u.value;i.Error(\"Functions may not contain choices, but saw '\".concat(h,\"'\"),h)}}catch(t){c.e(t)}finally{c.f()}},i.WarningInTermination=function(t){var e=\"Apparent loose end exists where the flow runs out. Do you need a '-> DONE' statement, choice or divert?\";t.parent===i._rootWeave&&i._firstChildFlow&&(e=\"\".concat(e,\" Note that if you intend to enter '\").concat(i._firstChildFlow.identifier,\"' next, you need to divert to it explicitly.\"));var n=k(t,jt);n&&n.isTunnel&&(e+=\" When final tunnel to '\".concat(n.target,\" ->' returns it won't have anywhere to go.\")),i.Warning(e,t)},i.toString=function(){return\"\".concat(i.typeName,\" '\").concat(i.identifier,\"'\")},i.identifier=t,i.args=o,null===a&&(a=[]),i.PreProcessTopLevelObjects(a),a=i.SplitWeaveAndSubFlowContent(a,\"Story\"==i.GetType()&&!l),i.AddContent(a),i}return i(r,[{key:\"hasParameters\",get:function(){return null!==this.args&&this.args.length>0}},{key:\"subFlowsByName\",get:function(){return this._subFlowsByName}},{key:\"typeName\",get:function(){return this.isFunction?\"Function\":String(this.flowLevel)}},{key:\"name\",get:function(){var t;return(null===(t=this.identifier)||void 0===t?void 0:t.name)||null}},{key:\"PreProcessTopLevelObjects\",value:function(t){}},{key:\"ResolveReferences\",value:function(t){var e,n;if(this._startingSubFlowDivert){if(!this._startingSubFlowRuntime)throw new Error;this._startingSubFlowDivert.targetPath=this._startingSubFlowRuntime.path}if(p(o(r.prototype),\"ResolveReferences\",this).call(this,t),null!==this.args){var i,a=S(this.args);try{for(a.s();!(i=a.n()).done;){var s=i.value;t.CheckForNamingCollisions(this,s.identifier,ft.Arg,\"argument\")}}catch(t){a.e(t)}finally{a.f()}for(var l=0;l<this.args.length;l+=1)for(var u=l+1;u<this.args.length;u+=1)(null===(e=this.args[l].identifier)||void 0===e?void 0:e.name)==(null===(n=this.args[u].identifier)||void 0===n?void 0:n.name)&&this.Error(\"Multiple arguments with the same name: '\".concat(this.args[l].identifier,\"'\"))}if(this.flowLevel!==bt.Story){var c=this.flowLevel===bt.Knot?ft.Knot:ft.SubFlowAndWeave;t.CheckForNamingCollisions(this,this.identifier,c)}}}]),r}(W),It=function(t){a(r,t);var e=d(r);function r(t){var i;n(this,r),(i=e.call(this)).dontFlatten=!1,i.TrimTrailingWhitespace=function(){for(var t=i.content.length-1;t>=0;--t){var e=k(i.content[t],Et);if(null===e)break;if(e.text=e.text.replace(new RegExp(/[ \\t]/g),\"\"),0!==e.text.length)break;i.content.splice(t,1)}},i.GenerateRuntimeObject=function(){var t=new tt;if(null!==i.content){var e,n=S(i.content);try{for(n.s();!(e=n.n()).done;){var r=e.value.runtimeObject;r&&t.AddContent(r)}}catch(t){n.e(t)}finally{n.f()}}return i.dontFlatten&&i.story.DontFlattenContainer(t),t},i.toString=function(){return\"ContentList(\".concat(i.content.join(\", \"),\")\")},t&&i.AddContent(t);for(var a=arguments.length,o=new Array(a>1?a-1:0),s=1;s<a;s++)o[s-1]=arguments[s];return o&&i.AddContent(o),i}return i(r,[{key:\"runtimeContainer\",get:function(){return this.runtimeObject}}]),r}(W),Wt=function(t){a(r,t);var e=d(r);function r(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return n(this,r),(t=e.call(this)).pathForCount=null,t.name=i,t}return i(r,[{key:\"containerForCount\",get:function(){return null===this.pathForCount?null:this.ResolvePath(this.pathForCount).container}},{key:\"pathStringForCount\",get:function(){return null===this.pathForCount?null:this.CompactPathString(this.pathForCount)},set:function(t){this.pathForCount=null===t?null:new R(t)}},{key:\"toString\",value:function(){return null!=this.name?\"var(\"+this.name+\")\":\"read_count(\"+this.pathStringForCount+\")\"}}]),r}(V),Ft=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this)).pathIdentifiers=t,i._runtimeVarRef=null,i.isConstantReference=!1,i.isListItemReference=!1,i.GenerateIntoContainer=function(t){var e=i.story.constants.get(i.name);if(e)return e.GenerateConstantIntoContainer(t),void(i.isConstantReference=!0);if(i._runtimeVarRef=new Wt(i.name),1===i.path.length||2===i.path.length){var n=\"\",r=\"\";1===i.path.length?n=i.path[0]:(r=i.path[0],n=i.path[1]),i.story.ResolveListItem(r,n,h(i))&&(i.isListItemReference=!0)}t.AddContent(i._runtimeVarRef)},i.toString=function(){return\"{\".concat(i.path.join(\".\"),\"}\")},i}return i(r,[{key:\"name\",get:function(){return this.path.join(\".\")}},{key:\"path\",get:function(){return this.pathIdentifiers.map((function(t){return t.name})).filter(N)}},{key:\"identifier\",get:function(){if(!this.pathIdentifiers||0==this.pathIdentifiers.length)return null;var t=this.path.join(\".\");return new xt(t)}},{key:\"runtimeVarRef\",get:function(){return this._runtimeVarRef}},{key:\"ResolveReferences\",value:function(t){if(p(o(r.prototype),\"ResolveReferences\",this).call(this,t),!this.isConstantReference&&!this.isListItemReference){var e=new Tt(this.pathIdentifiers),n=e.ResolveFromContext(this);if(n){if(!n.containerForCounting)throw new Error;if(n.containerForCounting.visitsShouldBeCounted=!0,null===this._runtimeVarRef)return;this._runtimeVarRef.pathForCount=n.runtimePath,this._runtimeVarRef.name=null;var i=k(n,Nt);i&&i.isFunction&&(parent instanceof zt||parent instanceof It||parent instanceof Nt)&&this.Warning(\"'\".concat(i.identifier,\"' being used as read count rather than being called as function. Perhaps you intended to write \").concat(i.identifier,\"()\"))}else{if(this.path.length>1){var a=\"Could not find target for read count: \".concat(e);return this.path.length<=2&&(a+=\", or couldn't find list item with the name \".concat(this.path.join(\",\"))),void this.Error(a)}t.ResolveVariableWithName(this.name,this).found||this.Error(\"Unresolved variable: \".concat(this),this)}}}}]),r}(nt),Rt=function(t){a(r,t);var e=d(r);function r(t,i){var a;return n(this,r),(a=e.call(this))._divertTargetToCount=null,a._variableReferenceToCount=null,a.shouldPopReturnedValue=!1,a.GenerateIntoContainer=function(t){var e=a.story.ResolveList(a.name),n=!1;if(a.isChoiceCount)a.args.length>0&&a.Error(\"The CHOICE_COUNT() function shouldn't take any arguments\"),t.AddContent(et.ChoiceCount());else if(a.isTurns)a.args.length>0&&a.Error(\"The TURNS() function shouldn't take any arguments\"),t.AddContent(et.Turns());else if(a.isTurnsSince||a.isReadCount){var r=k(a.args[0],Vt),i=k(a.args[0],Ft);if(1!==a.args.length||null===r&&null===i)return void a.Error(\"The \".concat(a.name,\"() function should take one argument: a divert target to the target knot, stitch, gather or choice you want to check. e.g. TURNS_SINCE(-> myKnot)\"));r?(a._divertTargetToCount=r,a.AddContent(a._divertTargetToCount),a._divertTargetToCount.GenerateIntoContainer(t)):i&&(a._variableReferenceToCount=i,a.AddContent(a._variableReferenceToCount),a._variableReferenceToCount.GenerateIntoContainer(t)),a.isTurnsSince?t.AddContent(et.TurnsSince()):t.AddContent(et.ReadCount())}else if(a.isRandom){2!==a.args.length&&a.Error(\"RANDOM should take 2 parameters: a minimum and a maximum integer\");for(var o=0;o<a.args.length;o+=1){var s=k(a.args[o],at);if(s&&!s.isInt()){var l=0===o?\"minimum\":\"maximum\";a.Error(\"RANDOM's \".concat(l,\" parameter should be an integer\"))}a.args[o].GenerateIntoContainer(t)}t.AddContent(et.Random())}else if(a.isSeedRandom){1!==a.args.length&&a.Error(\"SEED_RANDOM should take 1 parameter - an integer seed\");var u=k(a.args[0],at);u&&!u.isInt()&&a.Error(\"SEED_RANDOM's parameter should be an integer seed\"),a.args[0].GenerateIntoContainer(t),t.AddContent(et.SeedRandom())}else if(a.isListRange){3!==a.args.length&&a.Error(\"LIST_RANGE should take 3 parameters - a list, a min and a max\");for(var c=0;c<a.args.length;c+=1)a.args[c].GenerateIntoContainer(t);t.AddContent(et.ListRange())}else if(a.isListRandom)1!==a.args.length&&a.Error(\"LIST_RANDOM should take 1 parameter - a list\"),a.args[0].GenerateIntoContainer(t),t.AddContent(et.ListRandom());else if(it.CallExistsWithName(a.name)){var h=it.CallWithName(a.name);if(h.numberOfParameters!==a.args.length){var f=\"\".concat(name,\" should take \").concat(h.numberOfParameters,\" parameter\");h.numberOfParameters>1&&(f+=\"s\"),a.Error(f)}for(var d=0;d<a.args.length;d+=1)a.args[d].GenerateIntoContainer(t);t.AddContent(it.CallWithName(a.name))}else if(null!==e)if(a.args.length>1&&a.Error(\"Can currently only construct a list from one integer (or an empty list from a given list definition)\"),1===a.args.length)t.AddContent(new $(a.name)),a.args[0].GenerateIntoContainer(t),t.AddContent(et.ListFromInt());else{var v=new B;v.SetInitialOriginName(a.name),t.AddContent(new Z(v))}else t.AddContent(a._proxyDivert.runtimeObject),n=!0;n||a.content.splice(a.content.indexOf(a._proxyDivert),1),a.shouldPopReturnedValue&&t.AddContent(et.PopEvaluatedValue())},a.toString=function(){var t=a.args.join(\", \");return\"\".concat(a.name,\"(\").concat(t,\")\")},a._proxyDivert=new jt(new Tt(t),i),a._proxyDivert.isFunctionCall=!0,a.AddContent(a._proxyDivert),a}return i(r,[{key:\"proxyDivert\",get:function(){return this._proxyDivert}},{key:\"name\",get:function(){return this._proxyDivert.target.firstComponent||\"\"}},{key:\"args\",get:function(){return this._proxyDivert.args}},{key:\"runtimeDivert\",get:function(){return this._proxyDivert.runtimeDivert}},{key:\"isChoiceCount\",get:function(){return\"CHOICE_COUNT\"===this.name}},{key:\"isTurns\",get:function(){return\"TURNS\"===this.name}},{key:\"isTurnsSince\",get:function(){return\"TURNS_SINCE\"===this.name}},{key:\"isRandom\",get:function(){return\"RANDOM\"===this.name}},{key:\"isSeedRandom\",get:function(){return\"SEED_RANDOM\"===this.name}},{key:\"isListRange\",get:function(){return\"LIST_RANGE\"===this.name}},{key:\"isListRandom\",get:function(){return\"LIST_RANDOM\"===this.name}},{key:\"isReadCount\",get:function(){return\"READ_COUNT\"===this.name}},{key:\"ResolveReferences\",value:function(t){if(p(o(r.prototype),\"ResolveReferences\",this).call(this,t),!this.content.includes(this._proxyDivert)&&null!==this.args){var e,n=S(this.args);try{for(n.s();!(e=n.n()).done;){e.value.ResolveReferences(t)}}catch(t){n.e(t)}finally{n.f()}}if(this._divertTargetToCount){var i=this._divertTargetToCount.divert,a=null!=i.runtimeDivert.variableDivertName;if(a)return void this.Error(\"When getting the TURNS_SINCE() of a variable target, remove the '->' - i.e. it should just be TURNS_SINCE(\".concat(i.runtimeDivert.variableDivertName,\")\"));var s=i.targetContent;if(null===s)a||this.Error(\"Failed to find target for TURNS_SINCE: '\".concat(i.target,\"'\"));else{if(!s.containerForCounting)throw new Error;s.containerForCounting.turnIndexShouldBeCounted=!0}}else if(this._variableReferenceToCount){var l=this._variableReferenceToCount.runtimeVarRef;if(!l)throw new Error;null!==l.pathForCount&&this.Error(\"Should be '\".concat(name,\"'(-> '\").concat(this._variableReferenceToCount.name,\"). Usage without the '->' only makes sense for variable targets.\"))}}}]),r}(nt);Rt.IsBuiltIn=function(t){return!!it.CallExistsWithName(t)||(\"CHOICE_COUNT\"===t||\"TURNS_SINCE\"===t||\"TURNS\"===t||\"RANDOM\"===t||\"SEED_RANDOM\"===t||\"LIST_VALUE\"===t||\"LIST_RANDOM\"===t||\"READ_COUNT\"===t)};var Dt,Lt=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this)).GenerateIntoContainer=function(t){var e,n=!0,r=S(i.subExpressions);try{for(r.s();!(e=r.n()).done;){e.value.GenerateIntoContainer(t),n||t.AddContent(it.CallWithName(\"&&\")),n=!1}}catch(t){r.e(t)}finally{r.f()}},i.AddContent(t),i}return i(r,[{key:\"subExpressions\",get:function(){return this.content}}]),r}(nt),Vt=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this))._runtimeDivert=null,i._runtimeDivertTargetValue=null,i.GenerateIntoContainer=function(t){i.divert.GenerateRuntimeObject(),i._runtimeDivert=i.divert.runtimeDivert,i._runtimeDivertTargetValue=new X,t.AddContent(i.runtimeDivertTargetValue)},i.Equals=function(t){var e=k(t,r);return!!(e&&i.divert.target&&e.divert.target)&&i.divert.target.dotSeparatedComponents===e.divert.target.dotSeparatedComponents},i.divert=i.AddContent(t),i}return i(r,[{key:\"runtimeDivert\",get:function(){if(!this._runtimeDivert)throw new Error;return this._runtimeDivert}},{key:\"runtimeDivertTargetValue\",get:function(){if(!this._runtimeDivertTargetValue)throw new Error;return this._runtimeDivertTargetValue}},{key:\"ResolveReferences\",value:function(t){if(p(o(r.prototype),\"ResolveReferences\",this).call(this,t),this.divert.isDone||this.divert.isEnd)this.Error(\"Can't use -> DONE or -> END as variable divert targets\",this);else{for(var e=this;e&&e instanceof nt;){var n=!1,i=!1,a=e.parent;if(a instanceof st){var s=a;\"==\"!==s.opName&&\"!=\"!==s.opName?n=!0:(s.leftExpression instanceof r||s.leftExpression instanceof Ft)&&(s.rightExpression instanceof r||s.rightExpression instanceof Ft)||(n=!0),i=!0}else if(a instanceof Rt){var l=a;l.isTurnsSince||l.isReadCount||(n=!0),i=!0}else(a instanceof nt||a instanceof Lt||a instanceof mt&&a.condition===e||a instanceof _t||a instanceof $t)&&(n=!0,i=!0);if(n&&this.Error(\"Can't use a divert target like that. Did you intend to call '\".concat(this.divert.target,\"' as a function: likeThis(), or check the read count: likeThis, with no arrows?\"),this),i)break;e=a}if(this.runtimeDivert.hasVariableTarget){if(!this.divert.target)throw new Error;this.Error(\"Since '\".concat(this.divert.target.dotSeparatedComponents,\"' is a variable, it shouldn't be preceded by '->' here.\"))}this.runtimeDivert.targetPath&&(this.runtimeDivertTargetValue.targetPath=this.runtimeDivert.targetPath);var u=this.divert.targetContent;if(null!==u){var c=u.containerForCounting;if(null!==c){var h=k(this.parent,Rt);h&&h.isTurnsSince||(c.visitsShouldBeCounted=!0),c.turnIndexShouldBeCounted=!0}var f=k(u,Nt);if(null!=f&&null!==f.args){var d,v=S(f.args);try{for(v.s();!(d=v.n()).done;){var m=d.value;m.isByReference&&this.Error(\"Can't store a divert target to a knot or function that has by-reference arguments ('\".concat(f.identifier,\"' has 'ref \").concat(m.identifier,\"').\"))}}catch(t){v.e(t)}finally{v.f()}}}}}}]),r}(nt),jt=function(t){a(r,t);var e=d(r);function r(t,i){var a;return n(this,r),(a=e.call(this)).args=[],a.target=null,a.targetContent=null,a._runtimeDivert=null,a.isFunctionCall=!1,a.isEmpty=!1,a.isTunnel=!1,a.isThread=!1,a.GenerateRuntimeObject=function(){if(a.isEnd)return et.End();if(a.isDone)return et.Done();a.runtimeDivert=new vt,a.ResolveTargetContent(),a.CheckArgumentValidity();var t=null!==a.args&&a.args.length>0;if(t||a.isFunctionCall||a.isTunnel||a.isThread){var e=new tt;if(t){a.isFunctionCall||e.AddContent(et.EvalStart());var n=null;a.targetContent&&(n=a.targetContent.args);for(var r=0;r<a.args.length;++r){var i=a.args[r],o=null;if(n&&r<n.length&&(o=n[r]),o&&o.isByReference){var s=k(i,Ft);if(!s){a.Error(\"Expected variable name to pass by reference to 'ref \".concat(o.identifier,\"' but saw \").concat(i));break}var l=new Tt(s.pathIdentifiers);if(l.ResolveFromContext(h(a))){a.Error(\"can't pass a read count by reference. '\".concat(l.dotSeparatedComponents,\"' is a knot/stitch/label, but '\").concat(a.target.dotSeparatedComponents,\"' requires the name of a VAR to be passed.\"));break}var u=new Y(s.name);e.AddContent(u)}else i.GenerateIntoContainer(e)}a.isFunctionCall||e.AddContent(et.EvalEnd())}return a.isThread?e.AddContent(et.StartThread()):(a.isFunctionCall||a.isTunnel)&&(a.runtimeDivert.pushesToStack=!0,a.runtimeDivert.stackPushType=a.isFunctionCall?ct.Function:ct.Tunnel),e.AddContent(a.runtimeDivert),e}return a.runtimeDivert},a.PathAsVariableName=function(){return a.target?a.target.firstComponent:null},a.ResolveTargetContent=function(){if(!a.isEmpty&&!a.isEnd&&null===a.targetContent){var t=a.PathAsVariableName();if(null!==t){var e=k(Ot(h(a)),Nt);if(e){var n=e.ResolveVariableWithName(t,h(a));if(n.found){if(n.isArgument&&n.ownerFlow&&n.ownerFlow.args){var r=n.ownerFlow.args.find((function(e){var n;return(null===(n=e.identifier)||void 0===n?void 0:n.name)==t}));r&&!r.isDivertTarget&&a.Error(\"Since '\".concat(r.identifier,\"' is used as a variable divert target (on \").concat(a.debugMetadata,\"), it should be marked as: -> \").concat(r.identifier),n.ownerFlow)}return void(a.runtimeDivert.variableDivertName=t)}}}if(!a.target)throw new Error;a.targetContent=a.target.ResolveFromContext(h(a))}},a.CheckArgumentValidity=function(){if(!a.isEmpty){var t=0;if(null!==a.args&&a.args.length>0&&(t=a.args.length),null!==a.targetContent){var e=k(a.targetContent,Nt);if(0!==t||null!==e&&e.hasParameters)if(null===e&&t>0)a.Error(\"target needs to be a knot or stitch in order to pass arguments\");else if(null!==e&&(null===e.args||!e.args&&t>0))a.Error(\"target (\".concat(e.name,\") doesn't take parameters\"));else if(a.parent instanceof Vt)t>0&&a.Error(\"can't store arguments in a divert target variable\");else{var n,r=e.args.length;if(r!==t)return n=0===t?\"but there weren't any passed to it\":t<r?\"but only got \".concat(t):\"but got \".concat(t),void a.Error(\"to '\".concat(e.identifier,\"' requires \").concat(r,\" arguments, \").concat(n));for(var i=0;i<r;++i){var o=e.args[i],s=a.args[i];if(o.isDivertTarget){var l=k(s,Ft);if(s instanceof Vt||null!==l){if(l){var u=new Tt(l.pathIdentifiers);u.ResolveFromContext(l)&&a.Error(\"Passing read count of '\".concat(u.dotSeparatedComponents,\"' instead of a divert target. You probably meant '\").concat(u,\"'\"))}}else a.Error(\"Target '\".concat(e.identifier,\"' expects a divert target for the parameter named -> \").concat(o.identifier,\" but saw \").concat(s),s)}}null!==e||a.Error(\"Can't call as a function or with arguments unless it's a knot or stitch\")}}}},a.CheckExternalArgumentValidity=function(t){var e=a.target?a.target.firstComponent:null,n=t.externals.get(e);if(!n)throw new Error(\"external not found\");var r=n.argumentNames.length,i=0;a.args&&(i=a.args.length),i!==r&&a.Error(\"incorrect number of arguments sent to external function '\".concat(e,\"'. Expected \").concat(r,\" but got \").concat(i))},a.toString=function(){var t=\"\";return null===a.target?\"-> <empty divert>\":(t+=a.target.toString(),a.isTunnel&&(t+=\" ->\"),a.isFunctionCall&&(t+=\" ()\"),t)},t&&(a.target=t),i&&(a.args=i,a.AddContent(i)),a}return i(r,[{key:\"runtimeDivert\",get:function(){if(!this._runtimeDivert)throw new Error;return this._runtimeDivert},set:function(t){this._runtimeDivert=t}},{key:\"isEnd\",get:function(){return Boolean(this.target&&\"END\"===this.target.dotSeparatedComponents)}},{key:\"isDone\",get:function(){return Boolean(this.target&&\"DONE\"===this.target.dotSeparatedComponents)}},{key:\"typeName\",get:function(){return\"Divert\"}},{key:\"ResolveReferences\",value:function(t){if(!(this.isEmpty||this.isEnd||this.isDone)){if(!this.runtimeDivert)throw new Error;this.targetContent&&(this.runtimeDivert.targetPath=this.targetContent.runtimePath),p(o(r.prototype),\"ResolveReferences\",this).call(this,t);var e=k(this.targetContent,Nt);e&&(!e.isFunction&&this.isFunctionCall?p(o(r.prototype),\"Error\",this).call(this,\"\".concat(e.identifier,\" hasn't been marked as a function, but it's being called as one. Do you need to delcare the knot as '== function \").concat(e.identifier,\" =='?\")):!e.isFunction||this.isFunctionCall||this.parent instanceof Vt||p(o(r.prototype),\"Error\",this).call(this,e.identifier+\" can't be diverted to. It can only be called as a function since it's been marked as such: '\"+e.identifier+\"(...)'\"));var n=null!==this.targetContent,i=!1,a=!1;if(!this.target)throw new Error;if(1===this.target.numberOfComponents){if(!this.target.firstComponent)throw new Error;if(i=Rt.IsBuiltIn(this.target.firstComponent),a=t.IsExternal(this.target.firstComponent),i||a)return this.isFunctionCall||p(o(r.prototype),\"Error\",this).call(this,\"\".concat(this.target.firstComponent,\" must be called as a function: ~ \").concat(this.target.firstComponent,\"()\")),void(a&&(this.runtimeDivert.isExternal=!0,null!==this.args&&(this.runtimeDivert.externalArgs=this.args.length),this.runtimeDivert.pushesToStack=!1,this.runtimeDivert.targetPath=new R(this.target.firstComponent),this.CheckExternalArgumentValidity(t)))}null==this.runtimeDivert.variableDivertName&&(n||i||a||this.Error(\"target not found: '\".concat(this.target,\"'\")))}}},{key:\"Error\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e!==this&&e?p(o(r.prototype),\"Error\",this).call(this,t,e):this.isFunctionCall?p(o(r.prototype),\"Error\",this).call(this,\"Function call \".concat(t),e,n):p(o(r.prototype),\"Error\",this).call(this,\"Divert \".concat(t),e,n)}}]),r}(W),Mt=i((function t(e,r){n(this,t),this.divert=e,this.targetRuntimeObj=r})),Bt=i((function t(e,r){n(this,t),this.divert=e,this.targetContent=r}));!function(t){t[t.Stopping=1]=\"Stopping\",t[t.Cycle=2]=\"Cycle\",t[t.Shuffle=4]=\"Shuffle\",t[t.Once=8]=\"Once\"}(Dt||(Dt={}));var Gt,qt=function(t){a(r,t);var e=d(r);function r(t,i){var a;n(this,r),(a=e.call(this)).sequenceType=i,a._sequenceDivertsToResolve=[],a.GenerateRuntimeObject=function(){var t=new tt;t.visitsShouldBeCounted=!0,t.countingAtStartOnly=!0,a._sequenceDivertsToResolve=[],t.AddContent(et.EvalStart()),t.AddContent(et.VisitIndex());var e=(a.sequenceType&Dt.Once)>0,n=(a.sequenceType&Dt.Cycle)>0,r=(a.sequenceType&Dt.Stopping)>0,i=(a.sequenceType&Dt.Shuffle)>0,o=a.sequenceElements.length;if(e&&(o+=1),r||e?(t.AddContent(new J(o-1)),t.AddContent(it.CallWithName(\"MIN\"))):n&&(t.AddContent(new J(a.sequenceElements.length)),t.AddContent(it.CallWithName(\"%\"))),i){var s=et.NoOp();if(e||r){var l=r?a.sequenceElements.length-1:a.sequenceElements.length;t.AddContent(et.Duplicate()),t.AddContent(new J(l)),t.AddContent(it.CallWithName(\"==\"));var u=new vt;u.isConditional=!0,t.AddContent(u),a.AddDivertToResolve(u,s)}var c=a.sequenceElements.length;r&&(c-=1),t.AddContent(new J(c)),t.AddContent(et.SequenceShuffleIndex()),(e||r)&&t.AddContent(s)}t.AddContent(et.EvalEnd());for(var h=et.NoOp(),f=0;f<o;f+=1){t.AddContent(et.EvalStart()),t.AddContent(et.Duplicate()),t.AddContent(new J(f)),t.AddContent(it.CallWithName(\"==\")),t.AddContent(et.EvalEnd());var d=new vt;d.isConditional=!0,t.AddContent(d);var v=void 0;if(f<a.sequenceElements.length)v=a.sequenceElements[f].runtimeObject;else v=new tt;v.name=\"s\".concat(f),v.InsertContent(et.PopEvaluatedValue(),0);var p=new vt;v.AddContent(p),t.AddToNamedContentOnly(v),a.AddDivertToResolve(d,v),a.AddDivertToResolve(p,h)}return t.AddContent(h),t},a.AddDivertToResolve=function(t,e){a._sequenceDivertsToResolve.push(new Bt(t,e))},a.sequenceType=i,a.sequenceElements=[];var o,s=S(t);try{for(s.s();!(o=s.n()).done;){var l=o.value,u=l.content,c=null;c=null===u||0===u.length?l:new zt(u),a.sequenceElements.push(c),a.AddContent(c)}}catch(t){s.e(t)}finally{s.f()}return a}return i(r,[{key:\"ResolveReferences\",value:function(t){p(o(r.prototype),\"ResolveReferences\",this).call(this,t);var e,n=S(this._sequenceDivertsToResolve);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.divert.targetPath=i.targetContent.path}}catch(t){n.e(t)}finally{n.f()}}}]),r}(W),Ut=function(t){a(r,t);var e=d(r);function r(){var t;return n(this,r),(t=e.apply(this,arguments))._overrideDivertTarget=null,t._divertAfter=null,t.GenerateRuntimeObject=function(){var e=new tt;if(e.AddContent(et.EvalStart()),t.divertAfter){var n=t.divertAfter.GenerateRuntimeObject();if(n){var r=t.divertAfter.args;if(null!==r&&r.length>0){for(var i=-1,a=-1,o=0;o<n.content.length;o+=1){var s=n.content[o];s&&(-1==i&&s.commandType===et.CommandType.EvalStart?i=o:s.commandType===et.CommandType.EvalEnd&&(a=o))}for(var l=i+1;l<a;l+=1){n.content[l].parent=null,e.AddContent(n.content[l])}}}t._overrideDivertTarget=new X,e.AddContent(t._overrideDivertTarget)}else e.AddContent(new rt);return e.AddContent(et.EvalEnd()),e.AddContent(et.PopTunnel()),e},t.toString=function(){return\" -> \".concat(t._divertAfter)},t}return i(r,[{key:\"divertAfter\",get:function(){return this._divertAfter},set:function(t){this._divertAfter=t,this._divertAfter&&this.AddContent(this._divertAfter)}},{key:\"ResolveReferences\",value:function(t){p(o(r.prototype),\"ResolveReferences\",this).call(this,t),this.divertAfter&&this.divertAfter.targetContent&&(this._overrideDivertTarget.targetPath=this.divertAfter.targetContent.runtimePath)}}]),r}(W),Kt=function(){function t(e,r){n(this,t),this._name=e||\"\",this._items=null,this._itemNameToValues=r||new Map}return i(t,[{key:\"name\",get:function(){return this._name}},{key:\"items\",get:function(){if(null==this._items){this._items=new Map;var t,e=S(this._itemNameToValues);try{for(e.s();!(t=e.n()).done;){var n=m(t.value,2),r=n[0],i=n[1],a=new M(this.name,r);this._items.set(a.serialized(),i)}}catch(t){e.e(t)}finally{e.f()}}return this._items}},{key:\"ValueForItem\",value:function(t){if(!t.itemName)return 0;var e=this._itemNameToValues.get(t.itemName);return void 0!==e?e:0}},{key:\"ContainsItem\",value:function(t){return!!t.itemName&&(t.originName==this.name&&this._itemNameToValues.has(t.itemName))}},{key:\"ContainsItemWithName\",value:function(t){return this._itemNameToValues.has(t)}},{key:\"TryGetItemWithValue\",value:function(t,e){var n,r=S(this._itemNameToValues);try{for(r.s();!(n=r.n()).done;){var i=m(n.value,2),a=i[0];if(i[1]==t)return{result:new M(this.name,a),exists:!0}}}catch(t){r.e(t)}finally{r.f()}return{result:M.Null,exists:!1}}},{key:\"TryGetValueForItem\",value:function(t,e){if(!t.itemName)return{result:0,exists:!1};var n=this._itemNameToValues.get(t.itemName);return n?{result:n,exists:!0}:{result:0,exists:!1}}}]),t}(),Ht=function(t){a(r,t);var e=d(r);function r(t){var i;n(this,r),(i=e.call(this)).itemDefinitions=t,i.identifier=null,i.variableAssignment=null,i._elementsByName=null,i.ItemNamed=function(t){if(null===i._elementsByName){i._elementsByName=new Map;var e,n=S(i.itemDefinitions);try{for(n.s();!(e=n.n()).done;){var r=e.value;i._elementsByName.set(r.name,r)}}catch(t){n.e(t)}finally{n.f()}}return i._elementsByName.get(t)||null},i.GenerateRuntimeObject=function(){var t,e,n,r=new B,a=S(i.itemDefinitions);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o.inInitialList){var s=new M((null===(t=i.identifier)||void 0===t?void 0:t.name)||null,o.name||null);r.Add(s,o.seriesValue)}}}catch(t){a.e(t)}finally{a.f()}return r.SetInitialOriginName((null===(e=i.identifier)||void 0===e?void 0:e.name)||\"\"),new Z(r)};var a,o=1,s=S(i.itemDefinitions);try{for(s.s();!(a=s.n()).done;){var l=a.value;null!==l.explicitValue&&(o=l.explicitValue),l.seriesValue=o,o+=1}}catch(t){s.e(t)}finally{s.f()}return i.AddContent(t),i}return i(r,[{key:\"typeName\",get:function(){return\"List definition\"}},{key:\"runtimeListDefinition\",get:function(){var t,e,n=new Map,r=S(this.itemDefinitions);try{for(r.s();!(e=r.n()).done;){var i=e.value;n.has(i.name)?this.Error(\"List '\".concat(this.identifier,\"' contains duplicate items called '\").concat(i.name,\"'\")):n.set(i.name,i.seriesValue)}}catch(t){r.e(t)}finally{r.f()}return new Kt((null===(t=this.identifier)||void 0===t?void 0:t.name)||\"\",n)}},{key:\"ResolveReferences\",value:function(t){p(o(r.prototype),\"ResolveReferences\",this).call(this,t),t.CheckForNamingCollisions(this,this.identifier,ft.List)}}]),r}(W),Jt=function(t){a(r,t);var e=d(r);function r(t){var i,a=t.assignedExpression,o=t.isGlobalDeclaration,s=t.isTemporaryNewDeclaration,l=t.listDef,u=t.variableIdentifier;return n(this,r),(i=e.call(this))._runtimeAssignment=null,i.expression=null,i.listDefinition=null,i.GenerateRuntimeObject=function(){var t=null;if(i.isGlobalDeclaration?t=i.story:i.isNewTemporaryDeclaration&&(t=Ot(h(i))),t&&t.AddNewVariableDeclaration(h(i)),i.isGlobalDeclaration)return null;var e=new tt;return i.expression?e.AddContent(i.expression.runtimeObject):i.listDefinition&&e.AddContent(i.listDefinition.runtimeObject),i._runtimeAssignment=new pt(i.variableName,i.isNewTemporaryDeclaration),e.AddContent(i._runtimeAssignment),e},i.toString=function(){return\"\".concat(i.isGlobalDeclaration?\"VAR\":i.isNewTemporaryDeclaration?\"~ temp\":\"\",\" \").concat(i.variableName)},i.variableIdentifier=u,i.isGlobalDeclaration=Boolean(o),i.isNewTemporaryDeclaration=Boolean(s),l instanceof Ht?(i.listDefinition=i.AddContent(l),i.listDefinition.variableAssignment=h(i),i.isGlobalDeclaration=!0):a&&(i.expression=i.AddContent(a)),i}return i(r,[{key:\"variableName\",get:function(){return this.variableIdentifier.name}},{key:\"typeName\",get:function(){return this.isNewTemporaryDeclaration?\"temp\":this.isGlobalDeclaration?\"VAR\":\"variable assignment\"}},{key:\"isDeclaration\",get:function(){return this.isGlobalDeclaration||this.isNewTemporaryDeclaration}},{key:\"ResolveReferences\",value:function(t){if(p(o(r.prototype),\"ResolveReferences\",this).call(this,t),this.isDeclaration&&null===this.listDefinition&&t.CheckForNamingCollisions(this,this.variableIdentifier,this.isGlobalDeclaration?ft.Var:ft.Temp),this.isGlobalDeclaration){var e=k(this.expression,Ft);!e||e.isConstantReference||e.isListItemReference||this.Error(\"global variable assignments cannot refer to other variables, only literal values, constants and list items\")}if(!this.isNewTemporaryDeclaration){var n=t.ResolveVariableWithName(this.variableName,this);n.found||(this.variableName in this.story.constants?this.Error(\"Can't re-assign to a constant (do you need to use VAR when declaring '\".concat(this.variableName,\"'?)\"),this):this.Error(\"Variable could not be found to assign to: '\".concat(this.variableName,\"'\"),this)),this._runtimeAssignment&&(this._runtimeAssignment.isGlobal=n.isGlobal)}}}]),r}(W),zt=function(t){a(r,t);var e=d(r);function r(t){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n(this,r),(i=e.call(this)).previousWeavePoint=null,i.addContentToPreviousWeavePoint=!1,i.hasSeenChoiceInSection=!1,i.currentContainer=null,i._unnamedGatherCount=0,i._choiceCount=0,i._rootContainer=null,i._namedWeavePoints=new Map,i.looseEnds=[],i.gatherPointsToResolve=[],i.ResolveWeavePointNaming=function(){var t,e,n,r=[].concat(y(i.FindAll(At)((function(t){return!(null===t.name||void 0===t.name)}))),y(i.FindAll(mt)((function(t){return!(null===t.name||void 0===t.name)}))));i._namedWeavePoints=new Map;var a,o=S(r);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=i.namedWeavePoints.get((null===(t=s.identifier)||void 0===t?void 0:t.name)||\"\");if(l){var u=l instanceof At?\"gather\":\"choice\",c=l;i.Error(\"A \".concat(u,\" with the same label name '\").concat(s.name,\"' already exists in this context on line \").concat(c.debugMetadata?c.debugMetadata.startLineNumber:\"NO DEBUG METADATA AVAILABLE\"),s)}(null===(e=s.identifier)||void 0===e?void 0:e.name)&&i.namedWeavePoints.set(null===(n=s.identifier)||void 0===n?void 0:n.name,s)}}catch(t){o.e(t)}finally{o.f()}},i.ConstructWeaveHierarchyFromIndentation=function(){for(var t=0;t<i.content.length;){var e=i.content[t];if(e instanceof mt||e instanceof At){var n=e.indentationDepth-1;if(n>i.baseIndentIndex){for(var a=t;t<i.content.length;){var o=k(i.content[t],mt)||k(i.content[t],At);if(null!==o)if(o.indentationDepth-1<=i.baseIndentIndex)break;t+=1}var s=t-a,l=i.content.slice(a,a+s);i.content.splice(a,s);var u=new r(l,n);i.InsertContent(a,u),t=a}}t+=1}},i.DetermineBaseIndentationFromContent=function(t){var e,n=S(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r instanceof mt||r instanceof At)return r.indentationDepth-1}}catch(t){n.e(t)}finally{n.f()}return 0},i.GenerateRuntimeObject=function(){i._rootContainer=new tt,i.currentContainer=i._rootContainer,i.looseEnds=[],i.gatherPointsToResolve=[];var t,e=S(i.content);try{for(e.s();!(t=e.n()).done;){var n=t.value;if(n instanceof mt||n instanceof At)i.AddRuntimeForWeavePoint(n);else if(n instanceof r){var a,o=n;i.AddRuntimeForNestedWeave(o),(a=i.gatherPointsToResolve).splice.apply(a,[0,0].concat(y(o.gatherPointsToResolve)))}else i.AddGeneralRuntimeContent(n.runtimeObject)}}catch(t){e.e(t)}finally{e.f()}return i.PassLooseEndsToAncestors(),i._rootContainer},i.AddRuntimeForGather=function(t){var e=!i.hasSeenChoiceInSection;i.hasSeenChoiceInSection=!1;var n=t.runtimeContainer;if(t.name||(n.name=\"g-\".concat(i._unnamedGatherCount),i._unnamedGatherCount+=1),e){if(!i.currentContainer)throw new Error;i.currentContainer.AddContent(n)}else i.rootContainer.AddToNamedContentOnly(n);var r,a=S(i.looseEnds);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o instanceof At)if(o.indentationDepth==t.indentationDepth)continue;var s=null;if(o instanceof jt)s=o.runtimeObject;else{s=new vt;var l=o;if(!l.runtimeContainer)throw new Error;l.runtimeContainer.AddContent(s)}i.gatherPointsToResolve.push(new Mt(s,n))}}catch(t){a.e(t)}finally{a.f()}i.looseEnds=[],i.currentContainer=n},i.AddRuntimeForWeavePoint=function(t){if(t instanceof At)i.AddRuntimeForGather(t);else if(t instanceof mt){if(!i.currentContainer)throw new Error;i.previousWeavePoint instanceof At&&i.looseEnds.splice(i.looseEnds.indexOf(i.previousWeavePoint),1);var e=t;if(i.currentContainer.AddContent(e.runtimeObject),!e.innerContentContainer)throw new Error;e.innerContentContainer.name=\"c-\".concat(i._choiceCount),i.currentContainer.AddToNamedContentOnly(e.innerContentContainer),i._choiceCount+=1,i.hasSeenChoiceInSection=!0}(i.addContentToPreviousWeavePoint=!1,i.WeavePointHasLooseEnd(t))&&(i.looseEnds.push(t),k(t,mt)&&(i.addContentToPreviousWeavePoint=!0));i.previousWeavePoint=t},i.AddRuntimeForNestedWeave=function(t){i.AddGeneralRuntimeContent(t.rootContainer),null!==i.previousWeavePoint&&(i.looseEnds.splice(i.looseEnds.indexOf(i.previousWeavePoint),1),i.addContentToPreviousWeavePoint=!1)},i.AddGeneralRuntimeContent=function(t){if(null!==t)if(i.addContentToPreviousWeavePoint){if(!i.previousWeavePoint||!i.previousWeavePoint.runtimeContainer)throw new Error;i.previousWeavePoint.runtimeContainer.AddContent(t)}else{if(!i.currentContainer)throw new Error;i.currentContainer.AddContent(t)}},i.PassLooseEndsToAncestors=function(){if(0!==i.looseEnds.length){for(var t=null,e=null,n=!1,a=i.parent;null!==a;a=a.parent){var o=k(a,r);o&&(n||null!==t||(t=o),n&&null===e&&(e=o)),(a instanceof qt||a instanceof _t)&&(n=!0)}if(null!==t||null!==e)for(var s=i.looseEnds.length-1;s>=0;s-=1){var l=i.looseEnds[s],u=!1;if(n){if(l instanceof mt&&null!==t)t.ReceiveLooseEnd(l),u=!0;else if(!(l instanceof mt)){var c=t||e;null!==c&&(c.ReceiveLooseEnd(l),u=!0)}}else(null==t?void 0:t.hasOwnProperty(\"ReceiveLooseEnd\"))&&t.ReceiveLooseEnd(l),u=!0;u&&i.looseEnds.splice(s,1)}}},i.ReceiveLooseEnd=function(t){i.looseEnds.push(t)},i.WeavePointNamed=function(t){if(!i.namedWeavePoints)return null;var e=i.namedWeavePoints.get(t);return e||null},i.IsGlobalDeclaration=function(t){var e=k(t,Jt);return!!(e&&e.isGlobalDeclaration&&e.isDeclaration)||!!k(t,kt)},i.ContentThatFollowsWeavePoint=function(t){var e=[],n=t;if(null!==n.content){var a,o=S(n.content);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.IsGlobalDeclaration(s)||e.push(s)}}catch(t){o.e(t)}finally{o.f()}}var l=k(n.parent,r);if(null===l)throw new Error(\"Expected weave point parent to be weave?\");for(var u=l.content.indexOf(n)+1;u<l.content.length;u+=1){var c=l.content[u];if(!i.IsGlobalDeclaration(c)){if(c instanceof mt||c instanceof At)break;if(c instanceof r)break;e.push(c)}}return e},i.ValidateTermination=function(t){if(!(i.lastParsedSignificantObject instanceof F))if(null!==i.looseEnds&&i.looseEnds.length>0){var e,n=S(i.looseEnds);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=i.ContentThatFollowsWeavePoint(r);i.ValidateFlowOfObjectsTerminates(a,r,t)}}catch(t){n.e(t)}finally{n.f()}}else{var o,s=S(i.content);try{for(s.s();!(o=s.n()).done;){var l=o.value;if(l instanceof mt||l instanceof jt)return}}catch(t){s.e(t)}finally{s.f()}i.ValidateFlowOfObjectsTerminates(i.content,h(i),t)}},i.BadNestedTerminationHandler=function(t){for(var e=null,n=t.parent;null!==n;n=n.parent)if(n instanceof qt||n instanceof _t){e=k(n,_t);break}var r=\"Choices nested in conditionals or sequences need to explicitly divert afterwards.\";null!==e&&(1===e.FindAll(mt)().length&&(r=\"Choices with conditions should be written: '* {condition} choice'. Otherwise, \".concat(r.toLowerCase())));i.Error(r,t)},i.ValidateFlowOfObjectsTerminates=function(t,e,n){var r,i=!1,a=e,o=S(t);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(null!==s.Find(jt)((function(t){return!(t.isThread||t.isTunnel||t.isFunctionCall||t.parent instanceof Vt)}))&&(i=!0),null!=s.Find(Ut)()){i=!0;break}a=s}}catch(t){o.e(t)}finally{o.f()}if(!i){if(a instanceof F)return;n(a)}},i.WeavePointHasLooseEnd=function(t){if(null===t.content)return!0;for(var e=t.content.length-1;e>=0;--e){var n=k(t.content[e],jt);if(n)if(!(n.isThread||n.isTunnel||n.isFunctionCall))return!1}return!0},i.CheckForWeavePointNamingCollisions=function(){if(i.namedWeavePoints){var t,e=[],n=S(i.ancestry);try{for(n.s();!(t=n.n()).done;){var r=k(t.value,Nt);if(!r)break;e.push(r)}}catch(t){n.e(t)}finally{n.f()}var a,o=S(i.namedWeavePoints);try{for(o.s();!(a=o.n()).done;){var s,l=m(a.value,2),u=l[0],c=l[1],h=S(e);try{for(h.s();!(s=h.n()).done;){var f=s.value.ContentWithNameAtLevel(u);if(f&&f!==c){var d=\"\".concat(c.GetType(),\" '\").concat(u,\"' has the same label name as a \").concat(f.GetType(),\" (on \").concat(f.debugMetadata,\")\");i.Error(d,c)}}}catch(t){h.e(t)}finally{h.f()}}}catch(t){o.e(t)}finally{o.f()}}},i.baseIndentIndex=-1==a?i.DetermineBaseIndentationFromContent(t):a,i.AddContent(t),i.ConstructWeaveHierarchyFromIndentation(),i}return i(r,[{key:\"rootContainer\",get:function(){return this._rootContainer||(this._rootContainer=this.GenerateRuntimeObject()),this._rootContainer}},{key:\"namedWeavePoints\",get:function(){return this._namedWeavePoints}},{key:\"lastParsedSignificantObject\",get:function(){if(0===this.content.length)return null;for(var t=null,e=this.content.length-1;e>=0;--e){var n=k(t=this.content[e],Et);if((!n||\"\\n\"!==n.text)&&!this.IsGlobalDeclaration(t))break}var i=k(t,r);return i&&(t=i.lastParsedSignificantObject),t}},{key:\"ResolveReferences\",value:function(t){if(p(o(r.prototype),\"ResolveReferences\",this).call(this,t),null!==this.looseEnds&&this.looseEnds.length>0){for(var e=!1,n=this.parent;null!==n;n=n.parent)if(n instanceof qt||n instanceof _t){e=!0;break}e&&this.ValidateTermination(this.BadNestedTerminationHandler)}var i,a=S(this.gatherPointsToResolve);try{for(a.s();!(i=a.n()).done;){var s=i.value;s.divert.targetPath=s.targetRuntimeObj.path}}catch(t){a.e(t)}finally{a.f()}this.CheckForWeavePointNamingCollisions()}}]),r}(W),$t=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this))._contentContainer=null,i._conditionalDivert=null,i._ownExpression=null,i._innerWeave=null,i.isTrueBranch=!1,i.matchingEquality=!1,i.isElse=!1,i.isInline=!1,i.returnDivert=null,i.GenerateRuntimeObject=function(){if(i._innerWeave){var t,e=S(i._innerWeave.content);try{for(e.s();!(t=e.n()).done;){var n=k(t.value,Et);n&&n.text.startsWith(\"else:\")&&i.Warning(\"Saw the text 'else:' which is being treated as content. Did you mean '- else:'?\",n)}}catch(t){e.e(t)}finally{e.f()}}var r=new tt,a=i.matchingEquality&&!i.isElse;if(a&&r.AddContent(et.Duplicate()),i._conditionalDivert=new vt,i._conditionalDivert.isConditional=!i.isElse,!i.isTrueBranch&&!i.isElse){var o=null!==i.ownExpression;o&&r.AddContent(et.EvalStart()),i.ownExpression&&i.ownExpression.GenerateIntoContainer(r),i.matchingEquality&&r.AddContent(it.CallWithName(\"==\")),o&&r.AddContent(et.EvalEnd())}return r.AddContent(i._conditionalDivert),i._contentContainer=i.GenerateRuntimeForContent(),i._contentContainer.name=\"b\",i.isInline||i._contentContainer.InsertContent(new $(\"\\n\"),0),(a||i.isElse&&i.matchingEquality)&&i._contentContainer.InsertContent(et.PopEvaluatedValue(),0),r.AddToNamedContentOnly(i._contentContainer),i.returnDivert=new vt,i._contentContainer.AddContent(i.returnDivert),r},i.GenerateRuntimeForContent=function(){return null===i._innerWeave?new tt:i._innerWeave.rootContainer},t&&(i._innerWeave=new zt(t),i.AddContent(i._innerWeave)),i}return i(r,[{key:\"ownExpression\",get:function(){return this._ownExpression},set:function(t){this._ownExpression=t,this._ownExpression&&this.AddContent(this._ownExpression)}},{key:\"ResolveReferences\",value:function(t){if(!this._conditionalDivert||!this._contentContainer)throw new Error;this._conditionalDivert.targetPath=this._contentContainer.path,p(o(r.prototype),\"ResolveReferences\",this).call(this,t)}}]),r}(W);!function(t){t[t.ParsingString=1]=\"ParsingString\"}(Gt||(Gt={}));var Xt,Yt=function(){function t(){n(this,t),this.startLineNumber=0,this.endLineNumber=0,this.startCharacterNumber=0,this.endCharacterNumber=0,this.fileName=null,this.sourceName=null}return i(t,[{key:\"Merge\",value:function(e){var n=new t;return n.fileName=this.fileName,n.sourceName=this.sourceName,this.startLineNumber<e.startLineNumber?(n.startLineNumber=this.startLineNumber,n.startCharacterNumber=this.startCharacterNumber):this.startLineNumber>e.startLineNumber?(n.startLineNumber=e.startLineNumber,n.startCharacterNumber=e.startCharacterNumber):(n.startLineNumber=this.startLineNumber,n.startCharacterNumber=Math.min(this.startCharacterNumber,e.startCharacterNumber)),this.endLineNumber>e.endLineNumber?(n.endLineNumber=this.endLineNumber,n.endCharacterNumber=this.endCharacterNumber):this.endLineNumber<e.endLineNumber?(n.endLineNumber=e.endLineNumber,n.endCharacterNumber=e.endCharacterNumber):(n.endLineNumber=this.endLineNumber,n.endCharacterNumber=Math.max(this.endCharacterNumber,e.endCharacterNumber)),n}},{key:\"toString\",value:function(){return null!==this.fileName?\"line \".concat(this.startLineNumber,\" of \").concat(this.fileName,'\"'):\"line \"+this.startLineNumber}}]),t}(),Zt=function(t){a(r,t);var e=d(r);function r(t,i){var a;return n(this,r),(a=e.call(this)).identifier=t,a.argumentNames=i,a.GenerateRuntimeObject=function(){return a.story.AddExternal(h(a)),null},a}return i(r,[{key:\"name\",get:function(){var t;return(null===(t=this.identifier)||void 0===t?void 0:t.name)||null}},{key:\"toString\",value:function(){var t;return\"EXTERNAL \".concat(null===(t=this.identifier)||void 0===t?void 0:t.name)}}]),r}(W),Qt=i((function t(e,r,i){n(this,t),this.name=e,this.args=r,this.isFunction=i})),te=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this))._objToWrap=t,i.GenerateRuntimeObject=function(){return i._objToWrap},i}return i(r)}(W),ee=function(t){a(r,t);var e=d(r);function r(t){return n(this,r),e.call(this,t)}return i(r)}(te),ne=function(t){a(r,t);var e=d(r);function r(){return n(this,r),e.apply(this,arguments)}return i(r,[{key:\"toString\",value:function(){return\"Glue\"}}]),r}(V),re=function(t){a(r,t);var e=d(r);function r(t,i,a){var o;return n(this,r),(o=e.call(this)).varIdentifier=t,o._runtimeAssignment=null,o.expression=null,o.GenerateIntoContainer=function(t){var e,n;t.AddContent(new Wt((null===(e=o.varIdentifier)||void 0===e?void 0:e.name)||null)),o.expression?o.expression.GenerateIntoContainer(t):t.AddContent(new J(1)),t.AddContent(it.CallWithName(o.isInc?\"+\":\"-\")),o._runtimeAssignment=new pt((null===(n=o.varIdentifier)||void 0===n?void 0:n.name)||null,!1),t.AddContent(o._runtimeAssignment)},o.toString=function(){var t,e;return o.expression?\"\".concat(null===(t=o.varIdentifier)||void 0===t?void 0:t.name).concat(o.isInc?\" += \":\" -= \").concat(o.expression):\"\".concat(null===(e=o.varIdentifier)||void 0===e?void 0:e.name)+(o.isInc?\"++\":\"--\")},i instanceof nt?(o.expression=i,o.AddContent(o.expression),o.isInc=Boolean(a)):o.isInc=i,o}return i(r,[{key:\"ResolveReferences\",value:function(t){var e;p(o(r.prototype),\"ResolveReferences\",this).call(this,t);var n=t.ResolveVariableWithName((null===(e=this.varIdentifier)||void 0===e?void 0:e.name)||\"\",this);if(n.found||this.Error(\"variable for \".concat(this.incrementDecrementWord,\" could not be found: '\").concat(this.varIdentifier,\"' after searching: {this.descriptionOfScope}\")),!this._runtimeAssignment)throw new Error;this._runtimeAssignment.isGlobal=n.isGlobal,this.parent instanceof zt||this.parent instanceof Nt||this.parent instanceof It||this.Error(\"Can't use \".concat(this.incrementDecrementWord,\" as sub-expression\"))}},{key:\"incrementDecrementWord\",get:function(){return this.isInc?\"increment\":\"decrement\"}}]),r}(nt),ie=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this)).includedStory=t,i.GenerateRuntimeObject=function(){return null},i}return i(r)}(W),ae=i((function t(e,r,i){var a=this;n(this,t),this.type=e,this.precedence=r,this.requireWhitespace=i,this.toString=function(){return a.type}})),oe=function(t){a(r,t);var e=d(r);function r(t,i,a,o){return n(this,r),e.call(this,t,i,a,o)}return i(r,[{key:\"flowLevel\",get:function(){return bt.Knot}},{key:\"ResolveReferences\",value:function(t){p(o(r.prototype),\"ResolveReferences\",this).call(this,t);var e=this.story;for(var n in this.subFlowsByName){var i=e.ContentWithNameAtLevel(n,bt.Knot,!1);if(i){var a=this.subFlowsByName.get(n),s=\"Stitch '\".concat(a?a.name:\"NO STITCH FOUND\",\"' has the same name as a knot (on \").concat(i.debugMetadata,\")\");this.Error(s,a)}}}}]),r}(Nt),se=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this)).itemIdentifierList=t,i.GenerateIntoContainer=function(t){var e,n,r=new B;if(null!=i.itemIdentifierList){var a,o=S(i.itemIdentifierList);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=(null===(e=null==s?void 0:s.name)||void 0===e?void 0:e.split(\".\"))||[],u=null,c=\"\";l.length>1?(u=l[0],c=l[1]):c=l[0];var f=i.story.ResolveListItem(u,c,h(i));if(null===f)null===u?i.Error(\"Could not find list definition that contains item '\".concat(s,\"'\")):i.Error(\"Could not find list item \".concat(s));else{if(null==f.parent)return void i.Error(\"Could not find list definition for item \".concat(s));u||(u=(null===(n=f.parent.identifier)||void 0===n?void 0:n.name)||null);var d=new M(u,f.name||null);r.has(d.serialized())?i.Warning(\"Duplicate of item '\".concat(s,\"' in list.\")):r.Add(d,f.seriesValue)}}}catch(t){o.e(t)}finally{o.f()}}t.AddContent(new Z(r))},i}return i(r)}(nt),le=function(t){a(r,t);var e=d(r);function r(t,i){var a,s,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n(this,r),(s=e.call(this)).indentifier=t,s.inInitialList=i,s.explicitValue=l,s.seriesValue=0,s.parent=null,s.GenerateRuntimeObject=function(){throw new Error(\"Not implemented.\")},s.toString=function(){return s.fullName},s.parent=p((a=h(s),o(r.prototype)),\"parent\",a),s}return i(r,[{key:\"fullName\",get:function(){var t,e=this.parent;if(null===e)throw new Error(\"Can't get full name without a parent list.\");return\"\".concat(null===(t=e.identifier)||void 0===t?void 0:t.name,\".\").concat(this.name)}},{key:\"typeName\",get:function(){return\"List element\"}},{key:\"name\",get:function(){var t;return(null===(t=this.indentifier)||void 0===t?void 0:t.name)||null}},{key:\"ResolveReferences\",value:function(t){p(o(r.prototype),\"ResolveReferences\",this).call(this,t),t.CheckForNamingCollisions(this,this.indentifier,ft.ListItem)}}]),r}(W);!function(t){t[t.InnerBlock=0]=\"InnerBlock\",t[t.Stitch=1]=\"Stitch\",t[t.Knot=2]=\"Knot\",t[t.Top=3]=\"Top\"}(Xt||(Xt={}));var ue=function(t){a(r,t);var e=d(r);function r(t,i,a,s){var l,u;return n(this,r),(u=e.call(this,t,i,a,s)).toString=function(){return\"\".concat(null!==u.parent?u.parent+\" > \":\"\").concat(p((l=h(u),o(r.prototype)),\"toString\",l).call(l))},u}return i(r,[{key:\"flowLevel\",get:function(){return bt.Stitch}}]),r}(Nt),ce=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this)).text=t.toString()||\"\",i}return i(r,[{key:\"toString\",value:function(){return\"# \"+this.text}}]),r}(V),he=function(t){a(r,t);var e=d(r);function r(){var t;return n(this,r),(t=e.apply(this,arguments)).text=\"\",t.index=0,t.threadAtGeneration=null,t.sourcePath=\"\",t.targetPath=null,t.isInvisibleDefault=!1,t.originalThreadIndex=0,t}return i(r,[{key:\"pathStringOnChoice\",get:function(){return null===this.targetPath?L(\"Choice.targetPath\"):this.targetPath.toString()},set:function(t){this.targetPath=new R(t)}}]),r}(V),fe=function(){function t(e){n(this,t),this._lists=new Map,this._allUnambiguousListValueCache=new Map;var r,i=S(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;this._lists.set(a.name,a);var o,s=S(a.items);try{for(s.s();!(o=s.n()).done;){var l=m(o.value,2),u=l[0],c=l[1],h=M.fromSerializedKey(u),f=new Z(h,c);if(!h.itemName)throw new Error(\"item.itemName is null or undefined.\");this._allUnambiguousListValueCache.set(h.itemName,f),this._allUnambiguousListValueCache.set(h.fullName,f)}}catch(t){s.e(t)}finally{s.f()}}}catch(t){i.e(t)}finally{i.f()}}return i(t,[{key:\"lists\",get:function(){var t,e=[],n=S(this._lists);try{for(n.s();!(t=n.n()).done;){var r=m(t.value,2)[1];e.push(r)}}catch(t){n.e(t)}finally{n.f()}return e}},{key:\"TryListGetDefinition\",value:function(t,e){if(null===t)return{result:e,exists:!1};var n=this._lists.get(t);return n?{result:n,exists:!0}:{result:e,exists:!1}}},{key:\"FindSingleItemListWithName\",value:function(t){if(null===t)return L(\"name\");var e=this._allUnambiguousListValueCache.get(t);return void 0!==e?e:null}}]),t}(),de=function(){function t(){n(this,t)}return i(t,null,[{key:\"JArrayToRuntimeObjList\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.length;e&&n--;for(var r=[],i=0;i<n;i++){var a=t[i],o=this.JTokenToRuntimeObject(a);if(null===o)return L(\"runtimeObj\");r.push(o)}return r}},{key:\"WriteDictionaryRuntimeObjs\",value:function(t,e){t.WriteObjectStart();var n,r=S(e);try{for(r.s();!(n=r.n()).done;){var i=m(n.value,2),a=i[0],o=i[1];t.WritePropertyStart(a),this.WriteRuntimeObject(t,o),t.WritePropertyEnd()}}catch(t){r.e(t)}finally{r.f()}t.WriteObjectEnd()}},{key:\"WriteListRuntimeObjs\",value:function(t,e){t.WriteArrayStart();var n,r=S(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.WriteRuntimeObject(t,i)}}catch(t){r.e(t)}finally{r.f()}t.WriteArrayEnd()}},{key:\"WriteIntDictionary\",value:function(t,e){t.WriteObjectStart();var n,r=S(e);try{for(r.s();!(n=r.n()).done;){var i=m(n.value,2),a=i[0],o=i[1];t.WriteIntProperty(a,o)}}catch(t){r.e(t)}finally{r.f()}t.WriteObjectEnd()}},{key:\"WriteRuntimeObject\",value:function(e,n){var r=k(n,tt);if(r)this.WriteRuntimeContainer(e,r);else{var i=k(n,vt);if(i){var a,o=\"->\";return i.isExternal?o=\"x()\":i.pushesToStack&&(i.stackPushType==ct.Function?o=\"f()\":i.stackPushType==ct.Tunnel&&(o=\"->t->\")),a=i.hasVariableTarget?i.variableDivertName:i.targetPathString,e.WriteObjectStart(),e.WriteProperty(o,a),i.hasVariableTarget&&e.WriteProperty(\"var\",!0),i.isConditional&&e.WriteProperty(\"c\",!0),i.externalArgs>0&&e.WriteIntProperty(\"exArgs\",i.externalArgs),void e.WriteObjectEnd()}var s=k(n,ht);if(s)return e.WriteObjectStart(),e.WriteProperty(\"*\",s.pathStringOnChoice),e.WriteIntProperty(\"flg\",s.flags),void e.WriteObjectEnd();var l=k(n,H);if(l)e.WriteBool(l.value);else{var u=k(n,J);if(u)e.WriteInt(u.value);else{var c=k(n,z);if(c)e.WriteFloat(c.value);else{var h=k(n,$);if(h)h.isNewline?e.Write(\"\\n\",!1):(e.WriteStringStart(),e.WriteStringInner(\"^\"),e.WriteStringInner(h.value),e.WriteStringEnd());else{var f=k(n,Z);if(f)this.WriteInkList(e,f);else{var d=k(n,X);if(d)return e.WriteObjectStart(),null===d.value?L(\"divTargetVal.value\"):(e.WriteProperty(\"^->\",d.value.componentsString),void e.WriteObjectEnd());var v=k(n,Y);if(v)return e.WriteObjectStart(),e.WriteProperty(\"^var\",v.value),e.WriteIntProperty(\"ci\",v.contextIndex),void e.WriteObjectEnd();if(k(n,ne))e.Write(\"<>\");else{var p=k(n,et);if(p)e.Write(t._controlCommandNames[p.commandType]);else{var m=k(n,it);if(m){var y=m.name;return\"^\"==y&&(y=\"L^\"),void e.Write(y)}var g=k(n,Wt);if(g){e.WriteObjectStart();var C=g.pathStringForCount;return null!=C?e.WriteProperty(\"CNT?\",C):e.WriteProperty(\"VAR?\",g.name),void e.WriteObjectEnd()}var S=k(n,pt);if(S){e.WriteObjectStart();var b=S.isGlobal?\"VAR=\":\"temp=\";return e.WriteProperty(b,S.variableName),S.isNewDeclaration||e.WriteProperty(\"re\",!0),void e.WriteObjectEnd()}if(k(n,rt))e.Write(\"void\");else{var w=k(n,ce);if(w)return e.WriteObjectStart(),e.WriteProperty(\"#\",w.text),void e.WriteObjectEnd();var _=k(n,he);if(!_)throw new Error(\"Failed to convert runtime object to Json token: \"+n);this.WriteChoice(e,_)}}}}}}}}}}},{key:\"JObjectToDictionaryRuntimeObjs\",value:function(t){var e=new Map;for(var n in t)if(t.hasOwnProperty(n)){var r=this.JTokenToRuntimeObject(t[n]);if(null===r)return L(\"inkObject\");e.set(n,r)}return e}},{key:\"JObjectToIntDictionary\",value:function(t){var e=new Map;for(var n in t)t.hasOwnProperty(n)&&e.set(n,parseInt(t[n]));return e}},{key:\"JTokenToRuntimeObject\",value:function(n){if(\"number\"==typeof n&&!isNaN(n)||\"boolean\"==typeof n)return K.Create(n);if(\"string\"==typeof n){var r=n.toString(),i=r[0];if(\"^\"==i)return new $(r.substring(1));if(\"\\n\"==i&&1==r.length)return new $(\"\\n\");if(\"<>\"==r)return new ne;for(var a=0;a<t._controlCommandNames.length;++a){if(r==t._controlCommandNames[a])return new et(a)}if(\"L^\"==r&&(r=\"^\"),it.CallExistsWithName(r))return it.CallWithName(r);if(\"->->\"==r)return et.PopTunnel();if(\"~ret\"==r)return et.PopFunction();if(\"void\"==r)return new rt}if(\"object\"===e(n)&&!Array.isArray(n)){var o,s=n;if(s[\"^->\"])return o=s[\"^->\"],new X(new R(o.toString()));if(s[\"^var\"]){o=s[\"^var\"];var l=new Y(o.toString());return\"ci\"in s&&(o=s.ci,l.contextIndex=parseInt(o)),l}var u=!1,c=!1,h=ct.Function,f=!1;if((o=s[\"->\"])?u=!0:(o=s[\"f()\"])?(u=!0,c=!0,h=ct.Function):(o=s[\"->t->\"])?(u=!0,c=!0,h=ct.Tunnel):(o=s[\"x()\"])&&(u=!0,f=!0,c=!1,h=ct.Function),u){var d=new vt;d.pushesToStack=c,d.stackPushType=h,d.isExternal=f;var v=o.toString();return(o=s.var)?d.variableDivertName=v:d.targetPathString=v,d.isConditional=!!s.c,f&&(o=s.exArgs)&&(d.externalArgs=parseInt(o)),d}if(o=s[\"*\"]){var p=new ht;return p.pathStringOnChoice=o.toString(),(o=s.flg)&&(p.flags=parseInt(o)),p}if(o=s[\"VAR?\"])return new Wt(o.toString());if(o=s[\"CNT?\"]){var m=new Wt;return m.pathStringForCount=o.toString(),m}var y=!1,g=!1;if((o=s[\"VAR=\"])?(y=!0,g=!0):(o=s[\"temp=\"])&&(y=!0,g=!1),y){var C=o.toString(),S=!s.re,b=new pt(C,S);return b.isGlobal=g,b}if(void 0!==s[\"#\"])return o=s[\"#\"],new ce(o.toString());if(o=s.list){var w=o,_=new B;if(o=s.origins){var E=o;_.SetInitialOriginNames(E)}for(var k in w)if(w.hasOwnProperty(k)){var A=w[k],T=new M(k),P=parseInt(A);_.Add(T,P)}return new Z(_)}if(null!=s.originalChoicePath)return this.JObjectToChoice(s)}if(Array.isArray(n))return this.JArrayToContainer(n);if(null==n)return null;throw new Error(\"Failed to convert token to runtime object: \"+this.toJson(n,[\"parent\"]))}},{key:\"toJson\",value:function(t,e,n){return JSON.stringify(t,(function(t,n){return(null==e?void 0:e.some((function(e){return e===t})))?void 0:n}),n)}},{key:\"WriteRuntimeContainer\",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.WriteArrayStart(),null===e)return L(\"container\");var r,i=S(e.content);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.WriteRuntimeObject(t,a)}}catch(t){i.e(t)}finally{i.f()}var o=e.namedOnlyContent,s=e.countFlags,l=null!=e.name&&!n,u=null!=o||s>0||l;if(u&&t.WriteObjectStart(),null!=o){var c,h=S(o);try{for(h.s();!(c=h.n()).done;){var f=m(c.value,2),d=f[0],v=f[1],p=d,y=k(v,tt);t.WritePropertyStart(p),this.WriteRuntimeContainer(t,y,!0),t.WritePropertyEnd()}}catch(t){h.e(t)}finally{h.f()}}s>0&&t.WriteIntProperty(\"#f\",s),l&&t.WriteProperty(\"#n\",e.name),u?t.WriteObjectEnd():t.WriteNull(),t.WriteArrayEnd()}},{key:\"JArrayToContainer\",value:function(t){var e=new tt;e.content=this.JArrayToRuntimeObjList(t,!0);var n=t[t.length-1];if(null!=n){var r=new Map;for(var i in n)if(\"#f\"==i)e.countFlags=parseInt(n[i]);else if(\"#n\"==i)e.name=n[i].toString();else{var a=this.JTokenToRuntimeObject(n[i]),o=k(a,tt);o&&(o.name=i),r.set(i,a)}e.namedOnlyContent=r}return e}},{key:\"JObjectToChoice\",value:function(t){var e=new he;return e.text=t.text.toString(),e.index=parseInt(t.index),e.sourcePath=t.originalChoicePath.toString(),e.originalThreadIndex=parseInt(t.originalThreadIndex),e.pathStringOnChoice=t.targetPath.toString(),e}},{key:\"WriteChoice\",value:function(t,e){t.WriteObjectStart(),t.WriteProperty(\"text\",e.text),t.WriteIntProperty(\"index\",e.index),t.WriteProperty(\"originalChoicePath\",e.sourcePath),t.WriteIntProperty(\"originalThreadIndex\",e.originalThreadIndex),t.WriteProperty(\"targetPath\",e.pathStringOnChoice),t.WriteObjectEnd()}},{key:\"WriteInkList\",value:function(t,e){var n=e.value;if(null===n)return L(\"rawList\");t.WriteObjectStart(),t.WritePropertyStart(\"list\"),t.WriteObjectStart();var r,i=S(n);try{for(i.s();!(r=i.n()).done;){var a=m(r.value,2),o=a[0],s=a[1],l=M.fromSerializedKey(o),u=s;if(null===l.itemName)return L(\"item.itemName\");t.WritePropertyNameStart(),t.WritePropertyNameInner(l.originName?l.originName:\"?\"),t.WritePropertyNameInner(\".\"),t.WritePropertyNameInner(l.itemName),t.WritePropertyNameEnd(),t.Write(u),t.WritePropertyEnd()}}catch(t){i.e(t)}finally{i.f()}if(t.WriteObjectEnd(),t.WritePropertyEnd(),0==n.Count&&null!=n.originNames&&n.originNames.length>0){t.WritePropertyStart(\"origins\"),t.WriteArrayStart();var c,h=S(n.originNames);try{for(h.s();!(c=h.n()).done;){var f=c.value;t.Write(f)}}catch(t){h.e(t)}finally{h.f()}t.WriteArrayEnd(),t.WritePropertyEnd()}t.WriteObjectEnd()}},{key:\"ListDefinitionsToJToken\",value:function(t){var e,n={},r=S(t.lists);try{for(r.s();!(e=r.n()).done;){var i,a=e.value,o={},s=S(a.items);try{for(s.s();!(i=s.n()).done;){var l=m(i.value,2),u=l[0],c=l[1],h=M.fromSerializedKey(u);if(null===h.itemName)return L(\"item.itemName\");o[h.itemName]=c}}catch(t){s.e(t)}finally{s.f()}n[a.name]=o}}catch(t){r.e(t)}finally{r.f()}return n}},{key:\"JTokenToListDefinitions\",value:function(t){var e=t,n=[];for(var r in e)if(e.hasOwnProperty(r)){var i=r.toString(),a=e[r],o=new Map;for(var s in a)if(e.hasOwnProperty(r)){var l=a[s];o.set(s,parseInt(l))}var u=new Kt(i,o);n.push(u)}return new fe(n)}}]),t}();de._controlCommandNames=function(){var t=[];t[et.CommandType.EvalStart]=\"ev\",t[et.CommandType.EvalOutput]=\"out\",t[et.CommandType.EvalEnd]=\"/ev\",t[et.CommandType.Duplicate]=\"du\",t[et.CommandType.PopEvaluatedValue]=\"pop\",t[et.CommandType.PopFunction]=\"~ret\",t[et.CommandType.PopTunnel]=\"->->\",t[et.CommandType.BeginString]=\"str\",t[et.CommandType.EndString]=\"/str\",t[et.CommandType.NoOp]=\"nop\",t[et.CommandType.ChoiceCount]=\"choiceCnt\",t[et.CommandType.Turns]=\"turn\",t[et.CommandType.TurnsSince]=\"turns\",t[et.CommandType.ReadCount]=\"readc\",t[et.CommandType.Random]=\"rnd\",t[et.CommandType.SeedRandom]=\"srnd\",t[et.CommandType.VisitIndex]=\"visit\",t[et.CommandType.SequenceShuffleIndex]=\"seq\",t[et.CommandType.StartThread]=\"thread\",t[et.CommandType.Done]=\"done\",t[et.CommandType.End]=\"end\",t[et.CommandType.ListFromInt]=\"listInt\",t[et.CommandType.ListRange]=\"range\",t[et.CommandType.ListRandom]=\"lrnd\";for(var e=0;e<et.CommandType.TOTAL_VALUES;++e)if(null==t[e])throw new Error(\"Control command not accounted for in serialisation\");return t}();var ve=function(){function e(){if(n(this,e),this._threadCounter=0,this._startOfRoot=dt.Null,arguments[0]instanceof t.Story){var r=arguments[0];this._startOfRoot=dt.StartOf(r.rootContentContainer),this.Reset()}else{var i=arguments[0];this._threads=[];var a,o=S(i._threads);try{for(o.s();!(a=o.n()).done;){var s=a.value;this._threads.push(s.Copy())}}catch(t){o.e(t)}finally{o.f()}this._threadCounter=i._threadCounter,this._startOfRoot=i._startOfRoot.copy()}}return i(e,[{key:\"elements\",get:function(){return this.callStack}},{key:\"depth\",get:function(){return this.elements.length}},{key:\"currentElement\",get:function(){var t=this._threads[this._threads.length-1].callstack;return t[t.length-1]}},{key:\"currentElementIndex\",get:function(){return this.callStack.length-1}},{key:\"currentThread\",get:function(){return this._threads[this._threads.length-1]},set:function(t){I.Assert(1==this._threads.length,\"Shouldn't be directly setting the current thread when we have a stack of them\"),this._threads.length=0,this._threads.push(t)}},{key:\"canPop\",get:function(){return this.callStack.length>1}},{key:\"Reset\",value:function(){this._threads=[],this._threads.push(new e.Thread),this._threads[0].callstack.push(new e.Element(ct.Tunnel,this._startOfRoot))}},{key:\"SetJsonToken\",value:function(t,n){this._threads.length=0;var r,i=S(t.threads);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=new e.Thread(a,n);this._threads.push(o)}}catch(t){i.e(t)}finally{i.f()}this._threadCounter=parseInt(t.threadCounter),this._startOfRoot=dt.StartOf(n.rootContentContainer)}},{key:\"WriteJson\",value:function(t){var e=this;t.WriteObject((function(t){t.WritePropertyStart(\"threads\"),t.WriteArrayStart();var n,r=S(e._threads);try{for(r.s();!(n=r.n()).done;){n.value.WriteJson(t)}}catch(t){r.e(t)}finally{r.f()}t.WriteArrayEnd(),t.WritePropertyEnd(),t.WritePropertyStart(\"threadCounter\"),t.WriteInt(e._threadCounter),t.WritePropertyEnd()}))}},{key:\"PushThread\",value:function(){var t=this.currentThread.Copy();this._threadCounter++,t.threadIndex=this._threadCounter,this._threads.push(t)}},{key:\"ForkThread\",value:function(){var t=this.currentThread.Copy();return this._threadCounter++,t.threadIndex=this._threadCounter,t}},{key:\"PopThread\",value:function(){if(!this.canPopThread)throw new Error(\"Can't pop thread\");this._threads.splice(this._threads.indexOf(this.currentThread),1)}},{key:\"canPopThread\",get:function(){return this._threads.length>1&&!this.elementIsEvaluateFromGame}},{key:\"elementIsEvaluateFromGame\",get:function(){return this.currentElement.type==ct.FunctionEvaluationFromGame}},{key:\"Push\",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=new e.Element(t,this.currentElement.currentPointer,!1);i.evaluationStackHeightWhenPushed=n,i.functionStartInOutputStream=r,this.callStack.push(i)}},{key:\"CanPop\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!!this.canPop&&(null==t||this.currentElement.type==t)}},{key:\"Pop\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.CanPop(t))throw new Error(\"Mismatched push/pop in Callstack\");this.callStack.pop()}},{key:\"GetTemporaryVariableWithName\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;-1==e&&(e=this.currentElementIndex+1);var n=this.callStack[e-1],r=q(n.temporaryVariables,t,null);return r.exists?r.result:null}},{key:\"SetTemporaryVariable\",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;-1==r&&(r=this.currentElementIndex+1);var i=this.callStack[r-1];if(!n&&!i.temporaryVariables.get(t))throw new Error(\"Could not find temporary variable to set: \"+t);var a=q(i.temporaryVariables,t,null);a.exists&&Z.RetainListOriginsForAssignment(a.result,e),i.temporaryVariables.set(t,e)}},{key:\"ContextForVariableNamed\",value:function(t){return this.currentElement.temporaryVariables.get(t)?this.currentElementIndex+1:0}},{key:\"ThreadWithIndex\",value:function(t){var e=this._threads.filter((function(e){if(e.threadIndex==t)return e}));return e.length>0?e[0]:null}},{key:\"callStack\",get:function(){return this.currentThread.callstack}},{key:\"callStackTrace\",get:function(){for(var t=new j,e=0;e<this._threads.length;e++){var n=this._threads[e],r=e==this._threads.length-1;t.AppendFormat(\"=== THREAD {0}/{1} {2}===\\n\",e+1,this._threads.length,r?\"(current) \":\"\");for(var i=0;i<n.callstack.length;i++){n.callstack[i].type==ct.Function?t.Append(\"  [FUNCTION] \"):t.Append(\"  [TUNNEL] \");var a=n.callstack[i].currentPointer;if(!a.isNull){if(t.Append(\"<SOMEWHERE IN \"),null===a.container)return L(\"pointer.container\");t.Append(a.container.path.toString()),t.AppendLine(\">\")}}}return t.toString()}}]),e}();!function(t){var e=function(){function t(e,r){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n(this,t),this.evaluationStackHeightWhenPushed=0,this.functionStartInOutputStream=0,this.currentPointer=r.copy(),this.inExpressionEvaluation=i,this.temporaryVariables=new Map,this.type=e}return i(t,[{key:\"Copy\",value:function(){var e=new t(this.type,this.currentPointer,this.inExpressionEvaluation);return e.temporaryVariables=new Map(this.temporaryVariables),e.evaluationStackHeightWhenPushed=this.evaluationStackHeightWhenPushed,e.functionStartInOutputStream=this.functionStartInOutputStream,e}}]),t}();t.Element=e;var r=function(){function t(){if(n(this,t),this.threadIndex=0,this.previousPointer=dt.Null,this.callstack=[],arguments[0]&&arguments[1]){var r=arguments[0],i=arguments[1];this.threadIndex=parseInt(r.threadIndex);var a,o=r.callstack,s=S(o);try{for(s.s();!(a=s.n()).done;){var l=a.value,u=l,c=parseInt(u.type),h=dt.Null,f=void 0,d=u.cPath;if(void 0!==d){f=d.toString();var v=i.ContentAtPath(new R(f));if(h.container=v.container,h.index=parseInt(u.idx),null==v.obj)throw new Error(\"When loading state, internal story location couldn't be found: \"+f+\". Has the story changed since this save data was created?\");if(v.approximate){if(null===h.container)return L(\"pointer.container\");i.Warning(\"When loading state, exact internal story location couldn't be found: '\"+f+\"', so it was approximated to '\"+h.container.path.toString()+\"' to recover. Has the story changed since this save data was created?\")}}var p=!!u.exp,m=new e(c,h,p),y=u.temp;void 0!==y?m.temporaryVariables=de.JObjectToDictionaryRuntimeObjs(y):m.temporaryVariables.clear(),this.callstack.push(m)}}catch(t){s.e(t)}finally{s.f()}var g=r.previousContentObject;if(void 0!==g){var C=new R(g.toString());this.previousPointer=i.PointerAtPath(C)}}}return i(t,[{key:\"Copy\",value:function(){var e=new t;e.threadIndex=this.threadIndex;var n,r=S(this.callstack);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.callstack.push(i.Copy())}}catch(t){r.e(t)}finally{r.f()}return e.previousPointer=this.previousPointer.copy(),e}},{key:\"WriteJson\",value:function(t){t.WriteObjectStart(),t.WritePropertyStart(\"callstack\"),t.WriteArrayStart();var e,n=S(this.callstack);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(t.WriteObjectStart(),!r.currentPointer.isNull){if(null===r.currentPointer.container)return L(\"el.currentPointer.container\");t.WriteProperty(\"cPath\",r.currentPointer.container.path.componentsString),t.WriteIntProperty(\"idx\",r.currentPointer.index)}t.WriteProperty(\"exp\",r.inExpressionEvaluation),t.WriteIntProperty(\"type\",r.type),r.temporaryVariables.size>0&&(t.WritePropertyStart(\"temp\"),de.WriteDictionaryRuntimeObjs(t,r.temporaryVariables),t.WritePropertyEnd()),t.WriteObjectEnd()}}catch(t){n.e(t)}finally{n.f()}if(t.WriteArrayEnd(),t.WritePropertyEnd(),t.WriteIntProperty(\"threadIndex\",this.threadIndex),!this.previousPointer.isNull){var i=this.previousPointer.Resolve();if(null===i)return L(\"this.previousPointer.Resolve()\");t.WriteProperty(\"previousContentObject\",i.path.toString())}t.WriteObjectEnd()}}]),t}();t.Thread=r}(ve||(ve={}));var pe=function(){function t(e,r){n(this,t),this.variableChangedEventCallbacks=[],this.patch=null,this._batchObservingVariableChanges=!1,this._defaultGlobalVariables=new Map,this._changedVariablesForBatchObs=new Set,this._globalVariables=new Map,this._callStack=e,this._listDefsOrigin=r;try{return new Proxy(this,{get:function(t,e){return e in t?t[e]:t.$(e)},set:function(t,e,n){return e in t?t[e]=n:t.$(e,n),!0}})}catch(t){}}return i(t,[{key:\"variableChangedEvent\",value:function(t,e){var n,r=S(this.variableChangedEventCallbacks);try{for(r.s();!(n=r.n()).done;){(0,n.value)(t,e)}}catch(t){r.e(t)}finally{r.f()}}},{key:\"batchObservingVariableChanges\",get:function(){return this._batchObservingVariableChanges},set:function(t){if(this._batchObservingVariableChanges=t,t)this._changedVariablesForBatchObs=new Set;else if(null!=this._changedVariablesForBatchObs){var e,n=S(this._changedVariablesForBatchObs);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this._globalVariables.get(r);i?this.variableChangedEvent(r,i):L(\"currentValue\")}}catch(t){n.e(t)}finally{n.f()}this._changedVariablesForBatchObs=null}}},{key:\"callStack\",get:function(){return this._callStack},set:function(t){this._callStack=t}},{key:\"$\",value:function(t,e){if(void 0===e){var n=null;return null!==this.patch&&(n=this.patch.TryGetGlobal(t,null)).exists?n.result.valueObject:(void 0===(n=this._globalVariables.get(t))&&(n=this._defaultGlobalVariables.get(t)),void 0!==n?n.valueObject:null)}if(void 0===this._defaultGlobalVariables.get(t))throw new G(\"Cannot assign to a variable (\"+t+\") that hasn't been declared in the story\");var r=K.Create(e);if(null==r)throw null==e?new Error(\"Cannot pass null to VariableState\"):new Error(\"Invalid value passed to VariableState: \"+e.toString());this.SetGlobal(t,r)}},{key:\"ApplyPatch\",value:function(){if(null===this.patch)return L(\"this.patch\");var t,e=S(this.patch.globals);try{for(e.s();!(t=e.n()).done;){var n=m(t.value,2),r=n[0],i=n[1];this._globalVariables.set(r,i)}}catch(t){e.e(t)}finally{e.f()}if(null!==this._changedVariablesForBatchObs){var a,o=S(this.patch.changedVariables);try{for(o.s();!(a=o.n()).done;){var s=a.value;this._changedVariablesForBatchObs.add(s)}}catch(t){o.e(t)}finally{o.f()}}this.patch=null}},{key:\"SetJsonToken\",value:function(t){this._globalVariables.clear();var e,n=S(this._defaultGlobalVariables);try{for(n.s();!(e=n.n()).done;){var r=m(e.value,2),i=r[0],a=r[1],o=t[i];if(void 0!==o){var s=de.JTokenToRuntimeObject(o);if(null===s)return L(\"tokenInkObject\");this._globalVariables.set(i,s)}else this._globalVariables.set(i,a)}}catch(t){n.e(t)}finally{n.f()}}},{key:\"WriteJson\",value:function(e){e.WriteObjectStart();var n,r=S(this._globalVariables);try{for(r.s();!(n=r.n()).done;){var i=m(n.value,2),a=i[0],o=i[1],s=a,l=o;if(t.dontSaveDefaultValues&&this._defaultGlobalVariables.has(s)){var u=this._defaultGlobalVariables.get(s);if(this.RuntimeObjectsEqual(l,u))continue}e.WritePropertyStart(s),de.WriteRuntimeObject(e,l),e.WritePropertyEnd()}}catch(t){r.e(t)}finally{r.f()}e.WriteObjectEnd()}},{key:\"RuntimeObjectsEqual\",value:function(t,e){if(null===t)return L(\"obj1\");if(null===e)return L(\"obj2\");if(t.constructor!==e.constructor)return!1;var n=k(t,H);if(null!==n)return n.value===A(e,H).value;var r=k(t,J);if(null!==r)return r.value===A(e,J).value;var i=k(t,z);if(null!==i)return i.value===A(e,z).value;var a=k(t,K),o=k(e,K);if(null!==a&&null!==o)return O(a.valueObject)&&O(o.valueObject)?a.valueObject.Equals(o.valueObject):a.valueObject===o.valueObject;throw new Error(\"FastRoughDefinitelyEquals: Unsupported runtime object type: \"+t.constructor.name)}},{key:\"GetVariableWithName\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=this.GetRawVariableWithName(t,e),r=k(n,Y);return null!==r&&(n=this.ValueAtVariablePointer(r)),n}},{key:\"TryGetDefaultVariableValue\",value:function(t){var e=q(this._defaultGlobalVariables,t,null);return e.exists?e.result:null}},{key:\"GlobalVariableExistsWithName\",value:function(t){return this._globalVariables.has(t)||null!==this._defaultGlobalVariables&&this._defaultGlobalVariables.has(t)}},{key:\"GetRawVariableWithName\",value:function(t,e){if(0==e||-1==e){var n=null;if(null!==this.patch&&(n=this.patch.TryGetGlobal(t,null)).exists)return n.result;if((n=q(this._globalVariables,t,null)).exists)return n.result;if(null!==this._defaultGlobalVariables&&(n=q(this._defaultGlobalVariables,t,null)).exists)return n.result;if(null===this._listDefsOrigin)return L(\"VariablesState._listDefsOrigin\");var r=this._listDefsOrigin.FindSingleItemListWithName(t);if(r)return r}return this._callStack.GetTemporaryVariableWithName(t,e)}},{key:\"ValueAtVariablePointer\",value:function(t){return this.GetVariableWithName(t.variableName,t.contextIndex)}},{key:\"Assign\",value:function(t,e){var n=t.variableName;if(null===n)return L(\"name\");var r=-1,i=!1;if(i=t.isNewDeclaration?t.isGlobal:this.GlobalVariableExistsWithName(n),t.isNewDeclaration){var a=k(e,Y);if(null!==a)e=this.ResolveVariablePointer(a)}else{var o=null;do{null!=(o=k(this.GetRawVariableWithName(n,r),Y))&&(n=o.variableName,i=0==(r=o.contextIndex))}while(null!=o)}i?this.SetGlobal(n,e):this._callStack.SetTemporaryVariable(n,e,t.isNewDeclaration,r)}},{key:\"SnapshotDefaultGlobals\",value:function(){this._defaultGlobalVariables=new Map(this._globalVariables)}},{key:\"RetainListOriginsForAssignment\",value:function(t,e){var n=A(t,Z),r=A(e,Z);n.value&&r.value&&0==r.value.Count&&r.value.SetInitialOriginNames(n.value.originNames)}},{key:\"SetGlobal\",value:function(t,e){var n=null;if(null===this.patch&&(n=q(this._globalVariables,t,null)),null!==this.patch&&((n=this.patch.TryGetGlobal(t,null)).exists||(n=q(this._globalVariables,t,null))),Z.RetainListOriginsForAssignment(n.result,e),null===t)return L(\"variableName\");if(null!==this.patch?this.patch.SetGlobal(t,e):this._globalVariables.set(t,e),null!==this.variableChangedEvent&&null!==n&&e!==n.result)if(this.batchObservingVariableChanges){if(null===this._changedVariablesForBatchObs)return L(\"this._changedVariablesForBatchObs\");null!==this.patch?this.patch.AddChangedVariable(t):null!==this._changedVariablesForBatchObs&&this._changedVariablesForBatchObs.add(t)}else this.variableChangedEvent(t,e)}},{key:\"ResolveVariablePointer\",value:function(t){var e=t.contextIndex;-1==e&&(e=this.GetContextIndexOfVariableNamed(t.variableName));var n=k(this.GetRawVariableWithName(t.variableName,e),Y);return null!=n?n:new Y(t.variableName,e)}},{key:\"GetContextIndexOfVariableNamed\",value:function(t){return this.GlobalVariableExistsWithName(t)?0:this._callStack.currentElementIndex}},{key:\"ObserveVariableChange\",value:function(t){this.variableChangedEventCallbacks.push(t)}}]),t}();pe.dontSaveDefaultValues=!0;var me=function(){function t(e){n(this,t),this.seed=e%2147483647,this.seed<=0&&(this.seed+=2147483646)}return i(t,[{key:\"next\",value:function(){return this.seed=16807*this.seed%2147483647}},{key:\"nextFloat\",value:function(){return(this.next()-1)/2147483646}}]),t}(),ye=function(){function t(){if(n(this,t),this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map,1===arguments.length&&null!==arguments[0]){var e=arguments[0];this._globals=new Map(e._globals),this._changedVariables=new Set(e._changedVariables),this._visitCounts=new Map(e._visitCounts),this._turnIndices=new Map(e._turnIndices)}else this._globals=new Map,this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map}return i(t,[{key:\"globals\",get:function(){return this._globals}},{key:\"changedVariables\",get:function(){return this._changedVariables}},{key:\"visitCounts\",get:function(){return this._visitCounts}},{key:\"turnIndices\",get:function(){return this._turnIndices}},{key:\"TryGetGlobal\",value:function(t,e){return null!==t&&this._globals.has(t)?{result:this._globals.get(t),exists:!0}:{result:e,exists:!1}}},{key:\"SetGlobal\",value:function(t,e){this._globals.set(t,e)}},{key:\"AddChangedVariable\",value:function(t){return this._changedVariables.add(t)}},{key:\"TryGetVisitCount\",value:function(t,e){return this._visitCounts.has(t)?{result:this._visitCounts.get(t),exists:!0}:{result:e,exists:!1}}},{key:\"SetVisitCount\",value:function(t,e){this._visitCounts.set(t,e)}},{key:\"SetTurnIndex\",value:function(t,e){this._turnIndices.set(t,e)}},{key:\"TryGetTurnIndex\",value:function(t,e){return this._turnIndices.has(t)?{result:this._turnIndices.get(t),exists:!0}:{result:e,exists:!1}}}]),t}(),ge=function(){function t(){n(this,t)}return i(t,null,[{key:\"TextToDictionary\",value:function(e){return new t.Reader(e).ToDictionary()}},{key:\"TextToArray\",value:function(e){return new t.Reader(e).ToArray()}}]),t}();!function(t){var e=function(){function t(e){n(this,t),this._rootObject=JSON.parse(e)}return i(t,[{key:\"ToDictionary\",value:function(){return this._rootObject}},{key:\"ToArray\",value:function(){return this._rootObject}}]),t}();t.Reader=e;var r=function(){function e(){n(this,e),this._currentPropertyName=null,this._currentString=null,this._stateStack=[],this._collectionStack=[],this._propertyNameStack=[],this._jsonObject=null}return i(e,[{key:\"WriteObject\",value:function(t){this.WriteObjectStart(),t(this),this.WriteObjectEnd()}},{key:\"WriteObjectStart\",value:function(){this.StartNewObject(!0);var e={};if(this.state===t.Writer.State.Property){this.Assert(null!==this.currentCollection),this.Assert(null!==this.currentPropertyName);var n=this._propertyNameStack.pop();this.currentCollection[n]=e,this._collectionStack.push(e)}else this.state===t.Writer.State.Array?(this.Assert(null!==this.currentCollection),this.currentCollection.push(e),this._collectionStack.push(e)):(this.Assert(this.state===t.Writer.State.None),this._jsonObject=e,this._collectionStack.push(e));this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Object))}},{key:\"WriteObjectEnd\",value:function(){this.Assert(this.state===t.Writer.State.Object),this._collectionStack.pop(),this._stateStack.pop()}},{key:\"WriteProperty\",value:function(t,e){if(this.WritePropertyStart(t),arguments[1]instanceof Function){var n=arguments[1];n(this)}else{var r=arguments[1];this.Write(r)}this.WritePropertyEnd()}},{key:\"WriteIntProperty\",value:function(t,e){this.WritePropertyStart(t),this.WriteInt(e),this.WritePropertyEnd()}},{key:\"WriteFloatProperty\",value:function(t,e){this.WritePropertyStart(t),this.WriteFloat(e),this.WritePropertyEnd()}},{key:\"WritePropertyStart\",value:function(e){this.Assert(this.state===t.Writer.State.Object),this._propertyNameStack.push(e),this.IncrementChildCount(),this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Property))}},{key:\"WritePropertyEnd\",value:function(){this.Assert(this.state===t.Writer.State.Property),this.Assert(1===this.childCount),this._stateStack.pop()}},{key:\"WritePropertyNameStart\",value:function(){this.Assert(this.state===t.Writer.State.Object),this.IncrementChildCount(),this._currentPropertyName=\"\",this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Property)),this._stateStack.push(new t.Writer.StateElement(t.Writer.State.PropertyName))}},{key:\"WritePropertyNameEnd\",value:function(){this.Assert(this.state===t.Writer.State.PropertyName),this.Assert(null!==this._currentPropertyName),this._propertyNameStack.push(this._currentPropertyName),this._currentPropertyName=null,this._stateStack.pop()}},{key:\"WritePropertyNameInner\",value:function(e){this.Assert(this.state===t.Writer.State.PropertyName),this.Assert(null!==this._currentPropertyName),this._currentPropertyName+=e}},{key:\"WriteArrayStart\",value:function(){this.StartNewObject(!0);var e=[];if(this.state===t.Writer.State.Property){this.Assert(null!==this.currentCollection),this.Assert(null!==this.currentPropertyName);var n=this._propertyNameStack.pop();this.currentCollection[n]=e,this._collectionStack.push(e)}else this.state===t.Writer.State.Array?(this.Assert(null!==this.currentCollection),this.currentCollection.push(e),this._collectionStack.push(e)):(this.Assert(this.state===t.Writer.State.None),this._jsonObject=e,this._collectionStack.push(e));this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Array))}},{key:\"WriteArrayEnd\",value:function(){this.Assert(this.state===t.Writer.State.Array),this._collectionStack.pop(),this._stateStack.pop()}},{key:\"Write\",value:function(t){null!==t?(this.StartNewObject(!1),this._addToCurrentObject(t)):console.error(\"Warning: trying to write a null value\")}},{key:\"WriteBool\",value:function(t){null!==t&&(this.StartNewObject(!1),this._addToCurrentObject(t))}},{key:\"WriteInt\",value:function(t){null!==t&&(this.StartNewObject(!1),this._addToCurrentObject(Math.floor(t)))}},{key:\"WriteFloat\",value:function(t){null!==t&&(this.StartNewObject(!1),t==Number.POSITIVE_INFINITY?this._addToCurrentObject(34e37):t==Number.NEGATIVE_INFINITY?this._addToCurrentObject(-34e37):isNaN(t)?this._addToCurrentObject(0):this._addToCurrentObject(t))}},{key:\"WriteNull\",value:function(){this.StartNewObject(!1),this._addToCurrentObject(null)}},{key:\"WriteStringStart\",value:function(){this.StartNewObject(!1),this._currentString=\"\",this._stateStack.push(new t.Writer.StateElement(t.Writer.State.String))}},{key:\"WriteStringEnd\",value:function(){this.Assert(this.state==t.Writer.State.String),this._stateStack.pop(),this._addToCurrentObject(this._currentString),this._currentString=null}},{key:\"WriteStringInner\",value:function(e){this.Assert(this.state===t.Writer.State.String),null!==e?this._currentString+=e:console.error(\"Warning: trying to write a null string\")}},{key:\"toString\",value:function(){return null===this._jsonObject?\"\":JSON.stringify(this._jsonObject)}},{key:\"StartNewObject\",value:function(e){e?this.Assert(this.state===t.Writer.State.None||this.state===t.Writer.State.Property||this.state===t.Writer.State.Array):this.Assert(this.state===t.Writer.State.Property||this.state===t.Writer.State.Array),this.state===t.Writer.State.Property&&this.Assert(0===this.childCount),this.state!==t.Writer.State.Array&&this.state!==t.Writer.State.Property||this.IncrementChildCount()}},{key:\"state\",get:function(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].type:t.Writer.State.None}},{key:\"childCount\",get:function(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].childCount:0}},{key:\"currentCollection\",get:function(){return this._collectionStack.length>0?this._collectionStack[this._collectionStack.length-1]:null}},{key:\"currentPropertyName\",get:function(){return this._propertyNameStack.length>0?this._propertyNameStack[this._propertyNameStack.length-1]:null}},{key:\"IncrementChildCount\",value:function(){this.Assert(this._stateStack.length>0);var t=this._stateStack.pop();t.childCount++,this._stateStack.push(t)}},{key:\"Assert\",value:function(t){if(!t)throw Error(\"Assert failed while writing JSON\")}},{key:\"_addToCurrentObject\",value:function(e){this.Assert(null!==this.currentCollection),this.state===t.Writer.State.Array?(this.Assert(Array.isArray(this.currentCollection)),this.currentCollection.push(e)):this.state===t.Writer.State.Property&&(this.Assert(!Array.isArray(this.currentCollection)),this.Assert(null!==this.currentPropertyName),this.currentCollection[this.currentPropertyName]=e,this._propertyNameStack.pop())}}]),e}();t.Writer=r,function(e){var r;(r=e.State||(e.State={}))[r.None=0]=\"None\",r[r.Object=1]=\"Object\",r[r.Array=2]=\"Array\",r[r.Property=3]=\"Property\",r[r.PropertyName=4]=\"PropertyName\",r[r.String=5]=\"String\";var a=i((function e(r){n(this,e),this.type=t.Writer.State.None,this.childCount=0,this.type=r}));e.StateElement=a}(r=t.Writer||(t.Writer={}))}(ge||(ge={}));var Ce,Se=function(){function t(){n(this,t);var e=arguments[0],r=arguments[1];if(this.name=e,this.callStack=new ve(r),arguments[2]){var i=arguments[2];this.callStack.SetJsonToken(i.callstack,r),this.outputStream=de.JArrayToRuntimeObjList(i.outputStream),this.currentChoices=de.JArrayToRuntimeObjList(i.currentChoices);var a=i.choiceThreads;void 0!==a&&this.LoadFlowChoiceThreads(a,r)}else this.outputStream=[],this.currentChoices=[]}return i(t,[{key:\"WriteJson\",value:function(t){var e=this;t.WriteObjectStart(),t.WriteProperty(\"callstack\",(function(t){return e.callStack.WriteJson(t)})),t.WriteProperty(\"outputStream\",(function(t){return de.WriteListRuntimeObjs(t,e.outputStream)}));var n,r=!1,i=S(this.currentChoices);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(null===a.threadAtGeneration)return L(\"c.threadAtGeneration\");a.originalThreadIndex=a.threadAtGeneration.threadIndex,null===this.callStack.ThreadWithIndex(a.originalThreadIndex)&&(r||(r=!0,t.WritePropertyStart(\"choiceThreads\"),t.WriteObjectStart()),t.WritePropertyStart(a.originalThreadIndex),a.threadAtGeneration.WriteJson(t),t.WritePropertyEnd())}}catch(t){i.e(t)}finally{i.f()}r&&(t.WriteObjectEnd(),t.WritePropertyEnd()),t.WriteProperty(\"currentChoices\",(function(t){t.WriteArrayStart();var n,r=S(e.currentChoices);try{for(r.s();!(n=r.n()).done;){var i=n.value;de.WriteChoice(t,i)}}catch(t){r.e(t)}finally{r.f()}t.WriteArrayEnd()})),t.WriteObjectEnd()}},{key:\"LoadFlowChoiceThreads\",value:function(t,e){var n,r=S(this.currentChoices);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.callStack.ThreadWithIndex(i.originalThreadIndex);if(null!==a)i.threadAtGeneration=a.Copy();else{var o=t[\"\".concat(i.originalThreadIndex)];i.threadAtGeneration=new ve.Thread(o,e)}}}catch(t){r.e(t)}finally{r.f()}}}]),t}(),be=function(){function e(t){n(this,e),this.kInkSaveStateVersion=9,this.kMinCompatibleLoadVersion=8,this.onDidLoadState=null,this._currentErrors=null,this._currentWarnings=null,this.divertedPointer=dt.Null,this._currentTurnIndex=0,this.storySeed=0,this.previousRandom=0,this.didSafeExit=!1,this._currentText=null,this._currentTags=null,this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0,this._patch=null,this._namedFlows=null,this.kDefaultFlowName=\"DEFAULT_FLOW\",this.story=t,this._currentFlow=new Se(this.kDefaultFlowName,t),this.OutputStreamDirty(),this._evaluationStack=[],this._variablesState=new pe(this.callStack,t.listDefinitions),this._visitCounts=new Map,this._turnIndices=new Map,this.currentTurnIndex=-1;var r=(new Date).getTime();this.storySeed=new me(r).next()%100,this.previousRandom=0,this.GoToStart()}return i(e,[{key:\"ToJson\",value:function(){var t=new ge.Writer;return this.WriteJson(t),t.toString()}},{key:\"toJson\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.ToJson(t)}},{key:\"LoadJson\",value:function(t){var e=ge.TextToDictionary(t);this.LoadJsonObj(e),null!==this.onDidLoadState&&this.onDidLoadState()}},{key:\"VisitCountAtPathString\",value:function(t){var e;if(null!==this._patch){var n=this.story.ContentAtPath(new R(t)).container;if(null===n)throw new Error(\"Content at path not found: \"+t);if((e=this._patch.TryGetVisitCount(n,0)).exists)return e.result}return(e=q(this._visitCounts,t,null)).exists?e.result:0}},{key:\"VisitCountForContainer\",value:function(t){if(null===t)return L(\"container\");if(!t.visitsShouldBeCounted)return this.story.Error(\"Read count for target (\"+t.name+\" - on \"+t.debugMetadata+\") unknown. The story may need to be compiled with countAllVisits flag (-c).\"),0;if(null!==this._patch){var e=this._patch.TryGetVisitCount(t,0);if(e.exists)return e.result}var n=t.path.toString(),r=q(this._visitCounts,n,null);return r.exists?r.result:0}},{key:\"IncrementVisitCountForContainer\",value:function(t){if(null!==this._patch){var e=this.VisitCountForContainer(t);return e++,void this._patch.SetVisitCount(t,e)}var n=t.path.toString(),r=q(this._visitCounts,n,null);r.exists?this._visitCounts.set(n,r.result+1):this._visitCounts.set(n,1)}},{key:\"RecordTurnIndexVisitToContainer\",value:function(t){if(null===this._patch){var e=t.path.toString();this._turnIndices.set(e,this.currentTurnIndex)}else this._patch.SetTurnIndex(t,this.currentTurnIndex)}},{key:\"TurnsSinceForContainer\",value:function(t){if(t.turnIndexShouldBeCounted||this.story.Error(\"TURNS_SINCE() for target (\"+t.name+\" - on \"+t.debugMetadata+\") unknown. The story may need to be compiled with countAllVisits flag (-c).\"),null!==this._patch){var e=this._patch.TryGetTurnIndex(t,0);if(e.exists)return this.currentTurnIndex-e.result}var n=t.path.toString(),r=q(this._turnIndices,n,0);return r.exists?this.currentTurnIndex-r.result:-1}},{key:\"callstackDepth\",get:function(){return this.callStack.depth}},{key:\"outputStream\",get:function(){return this._currentFlow.outputStream}},{key:\"currentChoices\",get:function(){return this.canContinue?[]:this._currentFlow.currentChoices}},{key:\"generatedChoices\",get:function(){return this._currentFlow.currentChoices}},{key:\"currentErrors\",get:function(){return this._currentErrors}},{key:\"currentWarnings\",get:function(){return this._currentWarnings}},{key:\"variablesState\",get:function(){return this._variablesState},set:function(t){this._variablesState=t}},{key:\"callStack\",get:function(){return this._currentFlow.callStack}},{key:\"evaluationStack\",get:function(){return this._evaluationStack}},{key:\"currentTurnIndex\",get:function(){return this._currentTurnIndex},set:function(t){this._currentTurnIndex=t}},{key:\"currentPathString\",get:function(){var t=this.currentPointer;return t.isNull?null:null===t.path?L(\"pointer.path\"):t.path.toString()}},{key:\"currentPointer\",get:function(){return this.callStack.currentElement.currentPointer.copy()},set:function(t){this.callStack.currentElement.currentPointer=t.copy()}},{key:\"previousPointer\",get:function(){return this.callStack.currentThread.previousPointer.copy()},set:function(t){this.callStack.currentThread.previousPointer=t.copy()}},{key:\"canContinue\",get:function(){return!this.currentPointer.isNull&&!this.hasError}},{key:\"hasError\",get:function(){return null!=this.currentErrors&&this.currentErrors.length>0}},{key:\"hasWarning\",get:function(){return null!=this.currentWarnings&&this.currentWarnings.length>0}},{key:\"currentText\",get:function(){if(this._outputStreamTextDirty){var t,e=new j,n=S(this.outputStream);try{for(n.s();!(t=n.n()).done;){var r=k(t.value,$);null!==r&&e.Append(r.value)}}catch(t){n.e(t)}finally{n.f()}this._currentText=this.CleanOutputWhitespace(e.toString()),this._outputStreamTextDirty=!1}return this._currentText}},{key:\"CleanOutputWhitespace\",value:function(t){for(var e=new j,n=-1,r=0,i=0;i<t.length;i++){var a=t.charAt(i),o=\" \"==a||\"\\t\"==a;o&&-1==n&&(n=i),o||(\"\\n\"!=a&&n>0&&n!=r&&e.Append(\" \"),n=-1),\"\\n\"==a&&(r=i+1),o||e.Append(a)}return e.toString()}},{key:\"currentTags\",get:function(){if(this._outputStreamTagsDirty){this._currentTags=[];var t,e=S(this.outputStream);try{for(e.s();!(t=e.n()).done;){var n=k(t.value,ce);null!==n&&this._currentTags.push(n.text)}}catch(t){e.e(t)}finally{e.f()}this._outputStreamTagsDirty=!1}return this._currentTags}},{key:\"currentFlowName\",get:function(){return this._currentFlow.name}},{key:\"inExpressionEvaluation\",get:function(){return this.callStack.currentElement.inExpressionEvaluation},set:function(t){this.callStack.currentElement.inExpressionEvaluation=t}},{key:\"GoToStart\",value:function(){this.callStack.currentElement.currentPointer=dt.StartOf(this.story.mainContentContainer)}},{key:\"SwitchFlow_Internal\",value:function(t){if(null===t)throw new Error(\"Must pass a non-null string to Story.SwitchFlow\");if(null===this._namedFlows&&(this._namedFlows=new Map,this._namedFlows.set(this.kDefaultFlowName,this._currentFlow)),t!==this._currentFlow.name){var e,n=q(this._namedFlows,t,null);n.exists?e=n.result:(e=new Se(t,this.story),this._namedFlows.set(t,e)),this._currentFlow=e,this.variablesState.callStack=this._currentFlow.callStack,this.OutputStreamDirty()}}},{key:\"SwitchToDefaultFlow_Internal\",value:function(){null!==this._namedFlows&&this.SwitchFlow_Internal(this.kDefaultFlowName)}},{key:\"RemoveFlow_Internal\",value:function(t){if(null===t)throw new Error(\"Must pass a non-null string to Story.DestroyFlow\");if(t===this.kDefaultFlowName)throw new Error(\"Cannot destroy default flow\");if(this._currentFlow.name===t&&this.SwitchToDefaultFlow_Internal(),null===this._namedFlows)return L(\"this._namedFlows\");this._namedFlows.delete(t)}},{key:\"CopyAndStartPatching\",value:function(){var t,n,r,i,a,o=new e(this.story);if(o._patch=new ye(this._patch),o._currentFlow.name=this._currentFlow.name,o._currentFlow.callStack=new ve(this._currentFlow.callStack),(t=o._currentFlow.currentChoices).push.apply(t,y(this._currentFlow.currentChoices)),(n=o._currentFlow.outputStream).push.apply(n,y(this._currentFlow.outputStream)),o.OutputStreamDirty(),null!==this._namedFlows){o._namedFlows=new Map;var s,l=S(this._namedFlows);try{for(l.s();!(s=l.n()).done;){var u=m(s.value,2),c=u[0],h=u[1];o._namedFlows.set(c,h)}}catch(t){l.e(t)}finally{l.f()}o._namedFlows.set(this._currentFlow.name,o._currentFlow)}this.hasError&&(o._currentErrors=[],(i=o._currentErrors).push.apply(i,y(this.currentErrors||[])));this.hasWarning&&(o._currentWarnings=[],(a=o._currentWarnings).push.apply(a,y(this.currentWarnings||[])));return o.variablesState=this.variablesState,o.variablesState.callStack=o.callStack,o.variablesState.patch=o._patch,(r=o.evaluationStack).push.apply(r,y(this.evaluationStack)),this.divertedPointer.isNull||(o.divertedPointer=this.divertedPointer.copy()),o.previousPointer=this.previousPointer.copy(),o._visitCounts=this._visitCounts,o._turnIndices=this._turnIndices,o.currentTurnIndex=this.currentTurnIndex,o.storySeed=this.storySeed,o.previousRandom=this.previousRandom,o.didSafeExit=this.didSafeExit,o}},{key:\"RestoreAfterPatch\",value:function(){this.variablesState.callStack=this.callStack,this.variablesState.patch=this._patch}},{key:\"ApplyAnyPatch\",value:function(){if(null!==this._patch){this.variablesState.ApplyPatch();var t,e=S(this._patch.visitCounts);try{for(e.s();!(t=e.n()).done;){var n=m(t.value,2),r=n[0],i=n[1];this.ApplyCountChanges(r,i,!0)}}catch(t){e.e(t)}finally{e.f()}var a,o=S(this._patch.turnIndices);try{for(o.s();!(a=o.n()).done;){var s=m(a.value,2),l=s[0],u=s[1];this.ApplyCountChanges(l,u,!1)}}catch(t){o.e(t)}finally{o.f()}this._patch=null}}},{key:\"ApplyCountChanges\",value:function(t,e,n){(n?this._visitCounts:this._turnIndices).set(t.path.toString(),e)}},{key:\"WriteJson\",value:function(e){var n=this;if(e.WriteObjectStart(),e.WritePropertyStart(\"flows\"),e.WriteObjectStart(),null!==this._namedFlows){var r,i=S(this._namedFlows);try{var a=function(){var t=m(r.value,2),n=t[0],i=t[1];e.WriteProperty(n,(function(t){return i.WriteJson(t)}))};for(i.s();!(r=i.n()).done;)a()}catch(t){i.e(t)}finally{i.f()}}else e.WriteProperty(this._currentFlow.name,(function(t){return n._currentFlow.WriteJson(t)}));if(e.WriteObjectEnd(),e.WritePropertyEnd(),e.WriteProperty(\"currentFlowName\",this._currentFlow.name),e.WriteProperty(\"variablesState\",(function(t){return n.variablesState.WriteJson(t)})),e.WriteProperty(\"evalStack\",(function(t){return de.WriteListRuntimeObjs(t,n.evaluationStack)})),!this.divertedPointer.isNull){if(null===this.divertedPointer.path)return L(\"divertedPointer\");e.WriteProperty(\"currentDivertTarget\",this.divertedPointer.path.componentsString)}e.WriteProperty(\"visitCounts\",(function(t){return de.WriteIntDictionary(t,n._visitCounts)})),e.WriteProperty(\"turnIndices\",(function(t){return de.WriteIntDictionary(t,n._turnIndices)})),e.WriteIntProperty(\"turnIdx\",this.currentTurnIndex),e.WriteIntProperty(\"storySeed\",this.storySeed),e.WriteIntProperty(\"previousRandom\",this.previousRandom),e.WriteIntProperty(\"inkSaveVersion\",this.kInkSaveStateVersion),e.WriteIntProperty(\"inkFormatVersion\",t.Story.inkVersionCurrent),e.WriteObjectEnd()}},{key:\"LoadJsonObj\",value:function(t){var e=t,n=e.inkSaveVersion;if(null==n)throw new Error(\"ink save format incorrect, can't load.\");if(parseInt(n)<this.kMinCompatibleLoadVersion)throw new Error(\"Ink save format isn't compatible with the current version (saw '\"+n+\"', but minimum is \"+this.kMinCompatibleLoadVersion+\"), so can't load.\");var r=e.flows;if(null!=r){var i=r;1===Object.keys(i).length?this._namedFlows=null:null===this._namedFlows?this._namedFlows=new Map:this._namedFlows.clear();for(var a=0,o=Object.entries(i);a<o.length;a++){var s=m(o[a],2),l=s[0],u=s[1],c=new Se(l,this.story,u);if(1===Object.keys(i).length)this._currentFlow=new Se(l,this.story,u);else{if(null===this._namedFlows)return L(\"this._namedFlows\");this._namedFlows.set(l,c)}}if(null!=this._namedFlows&&this._namedFlows.size>1){var h=e.currentFlowName;this._currentFlow=this._namedFlows.get(h)}}else{this._namedFlows=null,this._currentFlow.name=this.kDefaultFlowName,this._currentFlow.callStack.SetJsonToken(e.callstackThreads,this.story),this._currentFlow.outputStream=de.JArrayToRuntimeObjList(e.outputStream),this._currentFlow.currentChoices=de.JArrayToRuntimeObjList(e.currentChoices);var f=e.choiceThreads;this._currentFlow.LoadFlowChoiceThreads(f,this.story)}this.OutputStreamDirty(),this.variablesState.SetJsonToken(e.variablesState),this.variablesState.callStack=this._currentFlow.callStack,this._evaluationStack=de.JArrayToRuntimeObjList(e.evalStack);var d=e.currentDivertTarget;if(null!=d){var v=new R(d.toString());this.divertedPointer=this.story.PointerAtPath(v)}this._visitCounts=de.JObjectToIntDictionary(e.visitCounts),this._turnIndices=de.JObjectToIntDictionary(e.turnIndices),this.currentTurnIndex=parseInt(e.turnIdx),this.storySeed=parseInt(e.storySeed),this.previousRandom=parseInt(e.previousRandom)}},{key:\"ResetErrors\",value:function(){this._currentErrors=null,this._currentWarnings=null}},{key:\"ResetOutput\",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.outputStream.length=0,null!==e&&(t=this.outputStream).push.apply(t,y(e)),this.OutputStreamDirty()}},{key:\"PushToOutputStream\",value:function(t){var e=k(t,$);if(null!==e){var n=this.TrySplittingHeadTailWhitespace(e);if(null!==n){var r,i=S(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.PushToOutputStreamIndividual(a)}}catch(t){i.e(t)}finally{i.f()}return void this.OutputStreamDirty()}}this.PushToOutputStreamIndividual(t),this.OutputStreamDirty()}},{key:\"PopFromOutputStream\",value:function(t){this.outputStream.splice(this.outputStream.length-t,t),this.OutputStreamDirty()}},{key:\"TrySplittingHeadTailWhitespace\",value:function(t){var e=t.value;if(null===e)return L(\"single.value\");for(var n=-1,r=-1,i=0;i<e.length;i++){var a=e[i];if(\"\\n\"!=a){if(\" \"==a||\"\\t\"==a)continue;break}-1==n&&(n=i),r=i}for(var o=-1,s=-1,l=e.length-1;l>=0;l--){var u=e[l];if(\"\\n\"!=u){if(\" \"==u||\"\\t\"==u)continue;break}-1==o&&(o=l),s=l}if(-1==n&&-1==o)return null;var c=[],h=0,f=e.length;if(-1!=n){if(n>0){var d=new $(e.substring(0,n));c.push(d)}c.push(new $(\"\\n\")),h=r+1}if(-1!=o&&(f=s),f>h){var v=e.substring(h,f-h);c.push(new $(v))}if(-1!=o&&s>r&&(c.push(new $(\"\\n\")),o<e.length-1)){var p=e.length-o-1,m=new $(e.substring(o+1,p));c.push(m)}return c}},{key:\"PushToOutputStreamIndividual\",value:function(t){var e=k(t,ne),n=k(t,$),r=!0;if(e)this.TrimNewlinesFromOutputStream(),r=!0;else if(n){var i=-1,a=this.callStack.currentElement;a.type==ct.Function&&(i=a.functionStartInOutputStream);for(var o=-1,s=this.outputStream.length-1;s>=0;s--){var l=this.outputStream[s],u=l instanceof et?l:null;if(null!=(l instanceof ne?l:null)){o=s;break}if(null!=u&&u.commandType==et.CommandType.BeginString){s>=i&&(i=-1);break}}if(-1!=(-1!=o&&-1!=i?Math.min(i,o):-1!=o?o:i)){if(n.isNewline)r=!1;else if(n.isNonWhitespace&&(o>-1&&this.RemoveExistingGlue(),i>-1))for(var c=this.callStack.elements,h=c.length-1;h>=0;h--){var f=c[h];if(f.type!=ct.Function)break;f.functionStartInOutputStream=-1}}else n.isNewline&&(!this.outputStreamEndsInNewline&&this.outputStreamContainsContent||(r=!1))}if(r){if(null===t)return L(\"obj\");this.outputStream.push(t),this.OutputStreamDirty()}}},{key:\"TrimNewlinesFromOutputStream\",value:function(){for(var t=-1,e=this.outputStream.length-1;e>=0;){var n=this.outputStream[e],r=k(n,et),i=k(n,$);if(null!=r||null!=i&&i.isNonWhitespace)break;null!=i&&i.isNewline&&(t=e),e--}if(t>=0)for(e=t;e<this.outputStream.length;){k(this.outputStream[e],$)?this.outputStream.splice(e,1):e++}this.OutputStreamDirty()}},{key:\"RemoveExistingGlue\",value:function(){for(var t=this.outputStream.length-1;t>=0;t--){var e=this.outputStream[t];if(e instanceof ne)this.outputStream.splice(t,1);else if(e instanceof et)break}this.OutputStreamDirty()}},{key:\"outputStreamEndsInNewline\",get:function(){if(this.outputStream.length>0)for(var t=this.outputStream.length-1;t>=0;t--){if(this.outputStream[t]instanceof et)break;var e=this.outputStream[t];if(e instanceof $){if(e.isNewline)return!0;if(e.isNonWhitespace)break}}return!1}},{key:\"outputStreamContainsContent\",get:function(){var t,e=S(this.outputStream);try{for(e.s();!(t=e.n()).done;){if(t.value instanceof $)return!0}}catch(t){e.e(t)}finally{e.f()}return!1}},{key:\"inStringEvaluation\",get:function(){for(var t=this.outputStream.length-1;t>=0;t--){var e=k(this.outputStream[t],et);if(e instanceof et&&e.commandType==et.CommandType.BeginString)return!0}return!1}},{key:\"PushEvaluationStack\",value:function(t){var e=k(t,Z);if(e){var n=e.value;if(null===n)return L(\"rawList\");if(null!=n.originNames){n.origins||(n.origins=[]),n.origins.length=0;var r,i=S(n.originNames);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(null===this.story.listDefinitions)return L(\"StoryState.story.listDefinitions\");var o=this.story.listDefinitions.TryListGetDefinition(a,null);if(null===o.result)return L(\"StoryState def.result\");n.origins.indexOf(o.result)<0&&n.origins.push(o.result)}}catch(t){i.e(t)}finally{i.f()}}}if(null===t)return L(\"obj\");this.evaluationStack.push(t)}},{key:\"PopEvaluationStack\",value:function(t){if(void 0===t)return P(this.evaluationStack.pop());if(t>this.evaluationStack.length)throw new Error(\"trying to pop too many objects\");return P(this.evaluationStack.splice(this.evaluationStack.length-t,t))}},{key:\"PeekEvaluationStack\",value:function(){return this.evaluationStack[this.evaluationStack.length-1]}},{key:\"ForceEnd\",value:function(){this.callStack.Reset(),this._currentFlow.currentChoices.length=0,this.currentPointer=dt.Null,this.previousPointer=dt.Null,this.didSafeExit=!0}},{key:\"TrimWhitespaceFromFunctionEnd\",value:function(){I.Assert(this.callStack.currentElement.type==ct.Function);var t=this.callStack.currentElement.functionStartInOutputStream;-1==t&&(t=0);for(var e=this.outputStream.length-1;e>=t;e--){var n=this.outputStream[e],r=k(n,$),i=k(n,et);if(null!=r){if(i)break;if(!r.isNewline&&!r.isInlineWhitespace)break;this.outputStream.splice(e,1),this.OutputStreamDirty()}}}},{key:\"PopCallStack\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.callStack.currentElement.type==ct.Function&&this.TrimWhitespaceFromFunctionEnd(),this.callStack.Pop(t)}},{key:\"SetChosenPath\",value:function(t,e){this._currentFlow.currentChoices.length=0;var n=this.story.PointerAtPath(t);n.isNull||-1!=n.index||(n.index=0),this.currentPointer=n,e&&this.currentTurnIndex++}},{key:\"StartFunctionEvaluationFromGame\",value:function(t,e){this.callStack.Push(ct.FunctionEvaluationFromGame,this.evaluationStack.length),this.callStack.currentElement.currentPointer=dt.StartOf(t),this.PassArgumentsToEvaluationStack(e)}},{key:\"PassArgumentsToEvaluationStack\",value:function(t){if(null!==t)for(var e=0;e<t.length;e++){if(\"number\"!=typeof t[e]&&\"string\"!=typeof t[e]||t[e]instanceof B)throw new Error((P(arguments[e]),\"null\"));this.PushEvaluationStack(K.Create(t[e]))}}},{key:\"TryExitFunctionEvaluationFromGame\",value:function(){return this.callStack.currentElement.type==ct.FunctionEvaluationFromGame&&(this.currentPointer=dt.Null,this.didSafeExit=!0,!0)}},{key:\"CompleteFunctionEvaluationFromGame\",value:function(){if(this.callStack.currentElement.type!=ct.FunctionEvaluationFromGame)throw new Error(\"Expected external function evaluation to be complete. Stack trace: \"+this.callStack.callStackTrace);for(var t=this.callStack.currentElement.evaluationStackHeightWhenPushed,e=null;this.evaluationStack.length>t;){var n=this.PopEvaluationStack();null===e&&(e=n)}if(this.PopCallStack(ct.FunctionEvaluationFromGame),e){if(e instanceof rt)return null;var r=A(e,K);return r.valueType==U.DivertTarget?r.valueObject.toString():r.valueObject}return null}},{key:\"AddError\",value:function(t,e){e?(null==this._currentWarnings&&(this._currentWarnings=[]),this._currentWarnings.push(t)):(null==this._currentErrors&&(this._currentErrors=[]),this._currentErrors.push(t))}},{key:\"OutputStreamDirty\",value:function(){this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0}}]),e}(),we=function(){function t(){n(this,t),this.startTime=void 0}return i(t,[{key:\"ElapsedMilliseconds\",get:function(){return void 0===this.startTime?0:(new Date).getTime()-this.startTime}},{key:\"Start\",value:function(){this.startTime=(new Date).getTime()}},{key:\"Stop\",value:function(){this.startTime=void 0}}]),t}();!function(t){t[t.Author=0]=\"Author\",t[t.Warning=1]=\"Warning\",t[t.Error=2]=\"Error\"}(Ce||(Ce={})),Number.isInteger||(Number.isInteger=function(t){return\"number\"==typeof t&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t}),t.Story=function(t){a(o,t);var r=d(o);function o(){var t,e;n(this,o),(t=r.call(this)).inkVersionMinimumCompatible=18,t.onError=null,t.onDidContinue=null,t.onMakeChoice=null,t.onEvaluateFunction=null,t.onCompleteEvaluateFunction=null,t.onChoosePathString=null,t._prevContainers=[],t.allowExternalFunctionFallbacks=!1,t._listDefinitions=null,t._variableObservers=null,t._hasValidatedExternals=!1,t._temporaryEvaluationContainer=null,t._asyncContinueActive=!1,t._stateSnapshotAtLastNewline=null,t._sawLookaheadUnsafeFunctionAfterNewline=!1,t._recursiveContinueCount=0,t._asyncSaving=!1,t._profiler=null;var i=null,a=null;if(arguments[0]instanceof tt)e=arguments[0],void 0!==arguments[1]&&(i=arguments[1]),t._mainContentContainer=e;else if(\"string\"==typeof arguments[0]){var s=arguments[0];a=ge.TextToDictionary(s)}else a=arguments[0];if(null!=i&&(t._listDefinitions=new fe(i)),t._externals=new Map,null!==a){var l=a,u=l.inkVersion;if(null==u)throw new Error(\"ink version number not found. Are you sure it's a valid .ink.json file?\");var c=parseInt(u);if(c>o.inkVersionCurrent)throw new Error(\"Version of ink used to build story was newer than the current version of the engine\");if(c<t.inkVersionMinimumCompatible)throw new Error(\"Version of ink used to build story is too old to be loaded by this version of the engine\");c!=o.inkVersionCurrent&&console.warn(\"WARNING: Version of ink used to build story doesn't match current version of engine. Non-critical, but recommend synchronising.\");var h,f=l.root;if(null==f)throw new Error(\"Root node for ink not found. Are you sure it's a valid .ink.json file?\");(h=l.listDefs)&&(t._listDefinitions=de.JTokenToListDefinitions(h)),t._mainContentContainer=A(de.JTokenToRuntimeObject(f),tt),t.ResetState()}return t}return i(o,[{key:\"currentChoices\",get:function(){var t=[];if(null===this._state)return L(\"this._state\");var e,n=S(this._state.currentChoices);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.isInvisibleDefault||(r.index=t.length,t.push(r))}}catch(t){n.e(t)}finally{n.f()}return t}},{key:\"currentText\",get:function(){return this.IfAsyncWeCant(\"call currentText since it's a work in progress\"),this.state.currentText}},{key:\"currentTags\",get:function(){return this.IfAsyncWeCant(\"call currentTags since it's a work in progress\"),this.state.currentTags}},{key:\"currentErrors\",get:function(){return this.state.currentErrors}},{key:\"currentWarnings\",get:function(){return this.state.currentWarnings}},{key:\"currentFlowName\",get:function(){return this.state.currentFlowName}},{key:\"hasError\",get:function(){return this.state.hasError}},{key:\"hasWarning\",get:function(){return this.state.hasWarning}},{key:\"variablesState\",get:function(){return this.state.variablesState}},{key:\"listDefinitions\",get:function(){return this._listDefinitions}},{key:\"state\",get:function(){return this._state}},{key:\"StartProfiling\",value:function(){}},{key:\"EndProfiling\",value:function(){}},{key:\"ToJson\",value:function(t){var e=this,n=!1;if(t||(n=!0,t=new ge.Writer),t.WriteObjectStart(),t.WriteIntProperty(\"inkVersion\",o.inkVersionCurrent),t.WriteProperty(\"root\",(function(t){return de.WriteRuntimeContainer(t,e._mainContentContainer)})),null!=this._listDefinitions){t.WritePropertyStart(\"listDefs\"),t.WriteObjectStart();var r,i=S(this._listDefinitions.lists);try{for(i.s();!(r=i.n()).done;){var a=r.value;t.WritePropertyStart(a.name),t.WriteObjectStart();var s,l=S(a.items);try{for(l.s();!(s=l.n()).done;){var u=m(s.value,2),c=u[0],h=u[1],f=M.fromSerializedKey(c),d=h;t.WriteIntProperty(f.itemName,d)}}catch(t){l.e(t)}finally{l.f()}t.WriteObjectEnd(),t.WritePropertyEnd()}}catch(t){i.e(t)}finally{i.f()}t.WriteObjectEnd(),t.WritePropertyEnd()}if(t.WriteObjectEnd(),n)return t.toString()}},{key:\"ResetState\",value:function(){this.IfAsyncWeCant(\"ResetState\"),this._state=new be(this),this._state.variablesState.ObserveVariableChange(this.VariableStateDidChangeEvent.bind(this)),this.ResetGlobals()}},{key:\"ResetErrors\",value:function(){if(null===this._state)return L(\"this._state\");this._state.ResetErrors()}},{key:\"ResetCallstack\",value:function(){if(this.IfAsyncWeCant(\"ResetCallstack\"),null===this._state)return L(\"this._state\");this._state.ForceEnd()}},{key:\"ResetGlobals\",value:function(){if(this._mainContentContainer.namedContent.get(\"global decl\")){var t=this.state.currentPointer.copy();this.ChoosePath(new R(\"global decl\"),!1),this.ContinueInternal(),this.state.currentPointer=t}this.state.variablesState.SnapshotDefaultGlobals()}},{key:\"SwitchFlow\",value:function(t){if(this.IfAsyncWeCant(\"switch flow\"),this._asyncSaving)throw new Error(\"Story is already in background saving mode, can't switch flow to \"+t);this.state.SwitchFlow_Internal(t)}},{key:\"RemoveFlow\",value:function(t){this.state.RemoveFlow_Internal(t)}},{key:\"SwitchToDefaultFlow\",value:function(){this.state.SwitchToDefaultFlow_Internal()}},{key:\"Continue\",value:function(){return this.ContinueAsync(0),this.currentText}},{key:\"canContinue\",get:function(){return this.state.canContinue}},{key:\"asyncContinueComplete\",get:function(){return!this._asyncContinueActive}},{key:\"ContinueAsync\",value:function(t){this._hasValidatedExternals||this.ValidateExternalBindings(),this.ContinueInternal(t)}},{key:\"ContinueInternal\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;null!=this._profiler&&this._profiler.PreContinue();var e=t>0;if(this._recursiveContinueCount++,!this._asyncContinueActive){if(this._asyncContinueActive=e,!this.canContinue)throw new Error(\"Can't continue - should check canContinue before calling Continue\");this._state.didSafeExit=!1,this._state.ResetOutput(),1==this._recursiveContinueCount&&(this._state.variablesState.batchObservingVariableChanges=!0)}var n=new we;n.Start();var r=!1;this._sawLookaheadUnsafeFunctionAfterNewline=!1;do{try{r=this.ContinueSingleStep()}catch(t){if(!(t instanceof G))throw t;this.AddError(t.message,void 0,t.useEndLineNumber);break}if(r)break;if(this._asyncContinueActive&&n.ElapsedMilliseconds>t)break}while(this.canContinue);if(n.Stop(),!r&&this.canContinue||(null!==this._stateSnapshotAtLastNewline&&this.RestoreStateSnapshot(),this.canContinue||(this.state.callStack.canPopThread&&this.AddError(\"Thread available to pop, threads should always be flat by the end of evaluation?\"),0!=this.state.generatedChoices.length||this.state.didSafeExit||null!=this._temporaryEvaluationContainer||(this.state.callStack.CanPop(ct.Tunnel)?this.AddError(\"unexpectedly reached end of content. Do you need a '->->' to return from a tunnel?\"):this.state.callStack.CanPop(ct.Function)?this.AddError(\"unexpectedly reached end of content. Do you need a '~ return'?\"):this.state.callStack.canPop?this.AddError(\"unexpectedly reached end of content for unknown reason. Please debug compiler!\"):this.AddError(\"ran out of content. Do you need a '-> DONE' or '-> END'?\"))),this.state.didSafeExit=!1,this._sawLookaheadUnsafeFunctionAfterNewline=!1,1==this._recursiveContinueCount&&(this._state.variablesState.batchObservingVariableChanges=!1),this._asyncContinueActive=!1,null!==this.onDidContinue&&this.onDidContinue()),this._recursiveContinueCount--,null!=this._profiler&&this._profiler.PostContinue(),this.state.hasError||this.state.hasWarning){if(null===this.onError){var i=new j;throw i.Append(\"Ink had \"),this.state.hasError&&(i.Append(\"\".concat(this.state.currentErrors.length)),i.Append(1==this.state.currentErrors.length?\" error\":\"errors\"),this.state.hasWarning&&i.Append(\" and \")),this.state.hasWarning&&(i.Append(\"\".concat(this.state.currentWarnings.length)),i.Append(1==this.state.currentWarnings.length?\" warning\":\"warnings\"),this.state.hasWarning&&i.Append(\" and \")),i.Append(\". It is strongly suggested that you assign an error handler to story.onError. The first issue was: \"),i.Append(this.state.hasError?this.state.currentErrors[0]:this.state.currentWarnings[0]),new G(i.toString())}if(this.state.hasError){var a,o=S(this.state.currentErrors);try{for(o.s();!(a=o.n()).done;){var s=a.value;this.onError(s,Ce.Error)}}catch(s){o.e(s)}finally{o.f()}}if(this.state.hasWarning){var l,u=S(this.state.currentWarnings);try{for(u.s();!(l=u.n()).done;){var c=l.value;this.onError(c,Ce.Warning)}}catch(s){u.e(s)}finally{u.f()}}this.ResetErrors()}}},{key:\"ContinueSingleStep\",value:function(){if(null!=this._profiler&&this._profiler.PreStep(),this.Step(),null!=this._profiler&&this._profiler.PostStep(),this.canContinue||this.state.callStack.elementIsEvaluateFromGame||this.TryFollowDefaultInvisibleChoice(),null!=this._profiler&&this._profiler.PreSnapshot(),!this.state.inStringEvaluation){if(null!==this._stateSnapshotAtLastNewline){if(null===this._stateSnapshotAtLastNewline.currentTags)return L(\"this._stateAtLastNewline.currentTags\");if(null===this.state.currentTags)return L(\"this.state.currentTags\");var t=this.CalculateNewlineOutputStateChange(this._stateSnapshotAtLastNewline.currentText,this.state.currentText,this._stateSnapshotAtLastNewline.currentTags.length,this.state.currentTags.length);if(t==o.OutputStateChange.ExtendedBeyondNewline||this._sawLookaheadUnsafeFunctionAfterNewline)return this.RestoreStateSnapshot(),!0;t==o.OutputStateChange.NewlineRemoved&&this.DiscardSnapshot()}this.state.outputStreamEndsInNewline&&(this.canContinue?null==this._stateSnapshotAtLastNewline&&this.StateSnapshot():this.DiscardSnapshot())}return null!=this._profiler&&this._profiler.PostSnapshot(),!1}},{key:\"CalculateNewlineOutputStateChange\",value:function(t,e,n,r){if(null===t)return L(\"prevText\");if(null===e)return L(\"currText\");var i=e.length>=t.length&&\"\\n\"==e.charAt(t.length-1);if(n==r&&t.length==e.length&&i)return o.OutputStateChange.NoChange;if(!i)return o.OutputStateChange.NewlineRemoved;if(r>n)return o.OutputStateChange.ExtendedBeyondNewline;for(var a=t.length;a<e.length;a++){var s=e.charAt(a);if(\" \"!=s&&\"\\t\"!=s)return o.OutputStateChange.ExtendedBeyondNewline}return o.OutputStateChange.NoChange}},{key:\"ContinueMaximally\",value:function(){this.IfAsyncWeCant(\"ContinueMaximally\");for(var t=new j;this.canContinue;)t.Append(this.Continue());return t.toString()}},{key:\"ContentAtPath\",value:function(t){return this.mainContentContainer.ContentAtPath(t)}},{key:\"KnotContainerWithName\",value:function(t){var e=this.mainContentContainer.namedContent.get(t);return e instanceof tt?e:null}},{key:\"PointerAtPath\",value:function(t){if(0==t.length)return dt.Null;var e=new dt,n=t.length,r=null;return null===t.lastComponent?L(\"path.lastComponent\"):(t.lastComponent.isIndex?(n=t.length-1,r=this.mainContentContainer.ContentAtPath(t,void 0,n),e.container=r.container,e.index=t.lastComponent.index):(r=this.mainContentContainer.ContentAtPath(t),e.container=r.container,e.index=-1),null==r.obj||r.obj==this.mainContentContainer&&n>0?this.Error(\"Failed to find content at path '\"+t+\"', and no approximation of it was possible.\"):r.approximate&&this.Warning(\"Failed to find content at path '\"+t+\"', so it was approximated to: '\"+r.obj.path+\"'.\"),e)}},{key:\"StateSnapshot\",value:function(){this._stateSnapshotAtLastNewline=this._state,this._state=this._state.CopyAndStartPatching()}},{key:\"RestoreStateSnapshot\",value:function(){null===this._stateSnapshotAtLastNewline&&L(\"_stateSnapshotAtLastNewline\"),this._stateSnapshotAtLastNewline.RestoreAfterPatch(),this._state=this._stateSnapshotAtLastNewline,this._stateSnapshotAtLastNewline=null,this._asyncSaving||this._state.ApplyAnyPatch()}},{key:\"DiscardSnapshot\",value:function(){this._asyncSaving||this._state.ApplyAnyPatch(),this._stateSnapshotAtLastNewline=null}},{key:\"CopyStateForBackgroundThreadSave\",value:function(){if(this.IfAsyncWeCant(\"start saving on a background thread\"),this._asyncSaving)throw new Error(\"Story is already in background saving mode, can't call CopyStateForBackgroundThreadSave again!\");var t=this._state;return this._state=this._state.CopyAndStartPatching(),this._asyncSaving=!0,t}},{key:\"BackgroundSaveComplete\",value:function(){null===this._stateSnapshotAtLastNewline&&this._state.ApplyAnyPatch(),this._asyncSaving=!1}},{key:\"Step\",value:function(){var t=!0,e=this.state.currentPointer.copy();if(!e.isNull){for(var n=k(e.Resolve(),tt);n&&(this.VisitContainer(n,!0),0!=n.content.length);)n=k((e=dt.StartOf(n)).Resolve(),tt);this.state.currentPointer=e.copy(),null!=this._profiler&&this._profiler.Step(this.state.callStack);var r=e.Resolve(),i=this.PerformLogicAndFlowControl(r);if(!this.state.currentPointer.isNull){i&&(t=!1);var a=k(r,ht);if(a){var o=this.ProcessChoice(a);o&&this.state.generatedChoices.push(o),r=null,t=!1}if(r instanceof tt&&(t=!1),t){var s=k(r,Y);if(s&&-1==s.contextIndex){var l=this.state.callStack.ContextForVariableNamed(s.variableName);r=new Y(s.variableName,l)}this.state.inExpressionEvaluation?this.state.PushEvaluationStack(r):this.state.PushToOutputStream(r)}this.NextContent();var u=k(r,et);u&&u.commandType==et.CommandType.StartThread&&this.state.callStack.PushThread()}}}},{key:\"VisitContainer\",value:function(t,e){t.countingAtStartOnly&&!e||(t.visitsShouldBeCounted&&this.state.IncrementVisitCountForContainer(t),t.turnIndexShouldBeCounted&&this.state.RecordTurnIndexVisitToContainer(t))}},{key:\"VisitChangedContainersDueToDivert\",value:function(){var t=this.state.previousPointer.copy(),e=this.state.currentPointer.copy();if(!e.isNull&&-1!=e.index){if(this._prevContainers.length=0,!t.isNull)for(var n=k(t.Resolve(),tt)||k(t.container,tt);n;)this._prevContainers.push(n),n=k(n.parent,tt);var r=e.Resolve();if(null!=r)for(var i=k(r.parent,tt),a=!0;i&&(this._prevContainers.indexOf(i)<0||i.countingAtStartOnly);){var o=i.content.length>0&&r==i.content[0]&&a;o||(a=!1),this.VisitContainer(i,o),r=i,i=k(i.parent,tt)}}}},{key:\"ProcessChoice\",value:function(t){var e=!0;if(t.hasCondition){var n=this.state.PopEvaluationStack();this.IsTruthy(n)||(e=!1)}var r=\"\",i=\"\";t.hasChoiceOnlyContent&&(i=A(this.state.PopEvaluationStack(),$).value||\"\");t.hasStartContent&&(r=A(this.state.PopEvaluationStack(),$).value||\"\");t.onceOnly&&(this.state.VisitCountForContainer(t.choiceTarget)>0&&(e=!1));if(!e)return null;var a=new he;return a.targetPath=t.pathOnChoice,a.sourcePath=t.path.toString(),a.isInvisibleDefault=t.isInvisibleDefault,a.threadAtGeneration=this.state.callStack.ForkThread(),a.text=(r+i).replace(/^[ \\t]+|[ \\t]+$/g,\"\"),a}},{key:\"IsTruthy\",value:function(t){if(t instanceof K){var e=t;if(e instanceof X){var n=e;return this.Error(\"Shouldn't use a divert target (to \"+n.targetPath+\") as a conditional value. Did you intend a function call 'likeThis()' or a read count check 'likeThis'? (no arrows)\"),!1}return e.isTruthy}return!1}},{key:\"PerformLogicAndFlowControl\",value:function(t){if(null==t)return!1;if(t instanceof vt){var e=t;if(e.isConditional){var n=this.state.PopEvaluationStack();if(!this.IsTruthy(n))return!0}if(e.hasVariableTarget){var r=e.variableDivertName,i=this.state.variablesState.GetVariableWithName(r);if(null==i)this.Error(\"Tried to divert using a target from a variable that could not be found (\"+r+\")\");else if(!(i instanceof X)){var a=k(i,J),o=\"Tried to divert to a target from a variable, but the variable (\"+r+\") didn't contain a divert target, it \";a instanceof J&&0==a.value?o+=\"was empty/null (the value 0).\":o+=\"contained '\"+i+\"'.\",this.Error(o)}var s=A(i,X);this.state.divertedPointer=this.PointerAtPath(s.targetPath)}else{if(e.isExternal)return this.CallExternalFunction(e.targetPathString,e.externalArgs),!0;this.state.divertedPointer=e.targetPointer.copy()}return e.pushesToStack&&this.state.callStack.Push(e.stackPushType,void 0,this.state.outputStream.length),this.state.divertedPointer.isNull&&!e.isExternal&&(e&&e.debugMetadata&&null!=e.debugMetadata.sourceName?this.Error(\"Divert target doesn't exist: \"+e.debugMetadata.sourceName):this.Error(\"Divert resolution failed: \"+e)),!0}if(t instanceof et){var l=t;switch(l.commandType){case et.CommandType.EvalStart:this.Assert(!1===this.state.inExpressionEvaluation,\"Already in expression evaluation?\"),this.state.inExpressionEvaluation=!0;break;case et.CommandType.EvalEnd:this.Assert(!0===this.state.inExpressionEvaluation,\"Not in expression evaluation mode\"),this.state.inExpressionEvaluation=!1;break;case et.CommandType.EvalOutput:if(this.state.evaluationStack.length>0){var u=this.state.PopEvaluationStack();if(!(u instanceof rt)){var c=new $(u.toString());this.state.PushToOutputStream(c)}}break;case et.CommandType.NoOp:break;case et.CommandType.Duplicate:this.state.PushEvaluationStack(this.state.PeekEvaluationStack());break;case et.CommandType.PopEvaluatedValue:this.state.PopEvaluationStack();break;case et.CommandType.PopFunction:case et.CommandType.PopTunnel:var h=l.commandType==et.CommandType.PopFunction?ct.Function:ct.Tunnel,f=null;if(h==ct.Tunnel){var d=this.state.PopEvaluationStack();null===(f=k(d,X))&&this.Assert(d instanceof rt,\"Expected void if ->-> doesn't override target\")}if(this.state.TryExitFunctionEvaluationFromGame())break;if(this.state.callStack.currentElement.type==h&&this.state.callStack.canPop)this.state.PopCallStack(),f&&(this.state.divertedPointer=this.PointerAtPath(f.targetPath));else{var v=new Map;v.set(ct.Function,\"function return statement (~ return)\"),v.set(ct.Tunnel,\"tunnel onwards statement (->->)\");var p=v.get(this.state.callStack.currentElement.type);this.state.callStack.canPop||(p=\"end of flow (-> END or choice)\");var m=\"Found \"+v.get(h)+\", when expected \"+p;this.Error(m)}break;case et.CommandType.BeginString:this.state.PushToOutputStream(l),this.Assert(!0===this.state.inExpressionEvaluation,\"Expected to be in an expression when evaluating a string\"),this.state.inExpressionEvaluation=!1;break;case et.CommandType.EndString:for(var y=[],g=0,C=this.state.outputStream.length-1;C>=0;--C){var b=this.state.outputStream[C];g++;var w=k(b,et);if(w&&w.commandType==et.CommandType.BeginString)break;b instanceof $&&y.push(b)}this.state.PopFromOutputStream(g),y=y.reverse();var _,E=new j,T=S(y);try{for(T.s();!(_=T.n()).done;){var P=_.value;E.Append(P.toString())}}catch(t){T.e(t)}finally{T.f()}this.state.inExpressionEvaluation=!0,this.state.PushEvaluationStack(new $(E.toString()));break;case et.CommandType.ChoiceCount:var O=this.state.generatedChoices.length;this.state.PushEvaluationStack(new J(O));break;case et.CommandType.Turns:this.state.PushEvaluationStack(new J(this.state.currentTurnIndex+1));break;case et.CommandType.TurnsSince:case et.CommandType.ReadCount:var x=this.state.PopEvaluationStack();if(!(x instanceof X)){var N=\"\";x instanceof J&&(N=\". Did you accidentally pass a read count ('knot_name') instead of a target ('-> knot_name')?\"),this.Error(\"TURNS_SINCE / READ_COUNT expected a divert target (knot, stitch, label name), but saw \"+x+N);break}var I,W=A(x,X),F=k(this.ContentAtPath(W.targetPath).correctObj,tt);null!=F?I=l.commandType==et.CommandType.TurnsSince?this.state.TurnsSinceForContainer(F):this.state.VisitCountForContainer(F):(I=l.commandType==et.CommandType.TurnsSince?-1:0,this.Warning(\"Failed to find container for \"+l.toString()+\" lookup at \"+W.targetPath.toString())),this.state.PushEvaluationStack(new J(I));break;case et.CommandType.Random:var R=k(this.state.PopEvaluationStack(),J),D=k(this.state.PopEvaluationStack(),J);if(null==D||D instanceof J==!1)return this.Error(\"Invalid value for minimum parameter of RANDOM(min, max)\");if(null==R||D instanceof J==!1)return this.Error(\"Invalid value for maximum parameter of RANDOM(min, max)\");if(null===R.value)return L(\"maxInt.value\");if(null===D.value)return L(\"minInt.value\");var V=R.value-D.value+1;(!isFinite(V)||V>Number.MAX_SAFE_INTEGER)&&(V=Number.MAX_SAFE_INTEGER,this.Error(\"RANDOM was called with a range that exceeds the size that ink numbers can use.\")),V<=0&&this.Error(\"RANDOM was called with minimum as \"+D.value+\" and maximum as \"+R.value+\". The maximum must be larger\");var q=this.state.storySeed+this.state.previousRandom,U=new me(q).next(),H=U%V+D.value;this.state.PushEvaluationStack(new J(H)),this.state.previousRandom=U;break;case et.CommandType.SeedRandom:var z=k(this.state.PopEvaluationStack(),J);if(null==z||z instanceof J==!1)return this.Error(\"Invalid value passed to SEED_RANDOM\");if(null===z.value)return L(\"minInt.value\");this.state.storySeed=z.value,this.state.previousRandom=0,this.state.PushEvaluationStack(new rt);break;case et.CommandType.VisitIndex:var Y=this.state.VisitCountForContainer(this.state.currentPointer.container)-1;this.state.PushEvaluationStack(new J(Y));break;case et.CommandType.SequenceShuffleIndex:var Q=this.NextSequenceShuffleIndex();this.state.PushEvaluationStack(new J(Q));break;case et.CommandType.StartThread:break;case et.CommandType.Done:this.state.callStack.canPopThread?this.state.callStack.PopThread():(this.state.didSafeExit=!0,this.state.currentPointer=dt.Null);break;case et.CommandType.End:this.state.ForceEnd();break;case et.CommandType.ListFromInt:var nt=k(this.state.PopEvaluationStack(),J),at=A(this.state.PopEvaluationStack(),$);if(null===nt)throw new G(\"Passed non-integer when creating a list element from a numerical value.\");var ot=null;if(null===this.listDefinitions)return L(\"this.listDefinitions\");var st=this.listDefinitions.TryListGetDefinition(at.value,null);if(!st.exists)throw new G(\"Failed to find LIST called \"+at.value);if(null===nt.value)return L(\"minInt.value\");var lt=st.result.TryGetItemWithValue(nt.value,M.Null);lt.exists&&(ot=new Z(lt.result,nt.value)),null==ot&&(ot=new Z),this.state.PushEvaluationStack(ot);break;case et.CommandType.ListRange:var ut=k(this.state.PopEvaluationStack(),K),ht=k(this.state.PopEvaluationStack(),K),ft=k(this.state.PopEvaluationStack(),Z);if(null===ft||null===ht||null===ut)throw new G(\"Expected list, minimum and maximum for LIST_RANGE\");if(null===ft.value)return L(\"targetList.value\");var mt=ft.value.ListWithSubRange(ht.valueObject,ut.valueObject);this.state.PushEvaluationStack(new Z(mt));break;case et.CommandType.ListRandom:var yt=this.state.PopEvaluationStack();if(null===yt)throw new G(\"Expected list for LIST_RANDOM\");var gt=yt.value,Ct=null;if(null===gt)throw L(\"list\");if(0==gt.Count)Ct=new B;else{for(var St=this.state.storySeed+this.state.previousRandom,bt=new me(St).next(),wt=bt%gt.Count,_t=gt.entries(),Et=0;Et<=wt-1;Et++)_t.next();var kt=_t.next().value,At={Key:M.fromSerializedKey(kt[0]),Value:kt[1]};if(null===At.Key.originName)return L(\"randomItem.Key.originName\");(Ct=new B(At.Key.originName,this)).Add(At.Key,At.Value),this.state.previousRandom=bt}this.state.PushEvaluationStack(new Z(Ct));break;default:this.Error(\"unhandled ControlCommand: \"+l)}return!0}if(t instanceof pt){var Tt=t,Pt=this.state.PopEvaluationStack();return this.state.variablesState.Assign(Tt,Pt),!0}if(t instanceof Wt){var Ot=t,xt=null;if(null!=Ot.pathForCount){var Nt=Ot.containerForCount,It=this.state.VisitCountForContainer(Nt);xt=new J(It)}else null==(xt=this.state.variablesState.GetVariableWithName(Ot.name))&&(this.Warning(\"Variable not found: '\"+Ot.name+\"'. Using default value of 0 (false). This can happen with temporary variables if the declaration hasn't yet been hit. Globals are always given a default value on load if a value doesn't exist in the save state.\"),xt=new J(0));return this.state.PushEvaluationStack(xt),!0}if(t instanceof it){var Ft=t,Rt=this.state.PopEvaluationStack(Ft.numberOfParameters),Dt=Ft.Call(Rt);return this.state.PushEvaluationStack(Dt),!0}return!1}},{key:\"ChoosePathString\",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(this.IfAsyncWeCant(\"call ChoosePathString right now\"),null!==this.onChoosePathString&&this.onChoosePathString(t,n),e)this.ResetCallstack();else if(this.state.callStack.currentElement.type==ct.Function){var r=\"\",i=this.state.callStack.currentElement.currentPointer.container;throw null!=i&&(r=\"(\"+i.path.toString()+\") \"),new Error(\"Story was running a function \"+r+\"when you called ChoosePathString(\"+t+\") - this is almost certainly not not what you want! Full stack trace: \\n\"+this.state.callStack.callStackTrace)}this.state.PassArgumentsToEvaluationStack(n),this.ChoosePath(new R(t))}},{key:\"IfAsyncWeCant\",value:function(t){if(this._asyncContinueActive)throw new Error(\"Can't \"+t+\". Story is in the middle of a ContinueAsync(). Make more ContinueAsync() calls or a single Continue() call beforehand.\")}},{key:\"ChoosePath\",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.state.SetChosenPath(t,e),this.VisitChangedContainersDueToDivert()}},{key:\"ChooseChoiceIndex\",value:function(t){t=t;var e=this.currentChoices;this.Assert(t>=0&&t<e.length,\"choice out of range\");var n=e[t];return null!==this.onMakeChoice&&this.onMakeChoice(n),null===n.threadAtGeneration?L(\"choiceToChoose.threadAtGeneration\"):null===n.targetPath?L(\"choiceToChoose.targetPath\"):(this.state.callStack.currentThread=n.threadAtGeneration,void this.ChoosePath(n.targetPath))}},{key:\"HasFunction\",value:function(t){try{return null!=this.KnotContainerWithName(t)}catch(t){return!1}}},{key:\"EvaluateFunction\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null!==this.onEvaluateFunction&&this.onEvaluateFunction(t,e),this.IfAsyncWeCant(\"evaluate a function\"),null==t)throw new Error(\"Function is null\");if(\"\"==t||\"\"==t.trim())throw new Error(\"Function is empty or white space.\");var r=this.KnotContainerWithName(t);if(null==r)throw new Error(\"Function doesn't exist: '\"+t+\"'\");var i=[];i.push.apply(i,y(this.state.outputStream)),this._state.ResetOutput(),this.state.StartFunctionEvaluationFromGame(r,e);for(var a=new j;this.canContinue;)a.Append(this.Continue());var o=a.toString();this._state.ResetOutput(i);var s=this.state.CompleteFunctionEvaluationFromGame();return null!=this.onCompleteEvaluateFunction&&this.onCompleteEvaluateFunction(t,e,o,s),n?{returned:s,output:o}:s}},{key:\"EvaluateExpression\",value:function(t){var e=this.state.callStack.elements.length;this.state.callStack.Push(ct.Tunnel),this._temporaryEvaluationContainer=t,this.state.GoToStart();var n=this.state.evaluationStack.length;return this.Continue(),this._temporaryEvaluationContainer=null,this.state.callStack.elements.length>e&&this.state.PopCallStack(),this.state.evaluationStack.length>n?this.state.PopEvaluationStack():null}},{key:\"CallExternalFunction\",value:function(t,n){if(null===t)return L(\"funcName\");var r=this._externals.get(t),i=null,a=void 0!==r;if(!a||r.lookAheadSafe||null===this._stateSnapshotAtLastNewline){if(!a){if(this.allowExternalFunctionFallbacks)return i=this.KnotContainerWithName(t),this.Assert(null!==i,\"Trying to call EXTERNAL function '\"+t+\"' which has not been bound, and fallback ink function could not be found.\"),this.state.callStack.Push(ct.Function,void 0,this.state.outputStream.length),void(this.state.divertedPointer=dt.StartOf(i));this.Assert(!1,\"Trying to call EXTERNAL function '\"+t+\"' which has not been bound (and ink fallbacks disabled).\")}for(var o=[],s=0;s<n;++s){var l=A(this.state.PopEvaluationStack(),K).valueObject;o.push(l)}o.reverse();var u=r.function(o),c=null;null!=u?(c=K.Create(u),this.Assert(null!==c,\"Could not create ink value from returned object of type \"+e(u))):c=new rt,this.state.PushEvaluationStack(c)}else this._sawLookaheadUnsafeFunctionAfterNewline=!0}},{key:\"BindExternalFunctionGeneral\",value:function(t,e,n){this.IfAsyncWeCant(\"bind an external function\"),this.Assert(!this._externals.has(t),\"Function '\"+t+\"' has already been bound.\"),this._externals.set(t,{function:e,lookAheadSafe:n})}},{key:\"TryCoerce\",value:function(t){return t}},{key:\"BindExternalFunction\",value:function(t,e,n){var r=this;this.Assert(null!=e,\"Can't bind a null function\"),this.BindExternalFunctionGeneral(t,(function(t){r.Assert(t.length>=e.length,\"External function expected \"+e.length+\" arguments\");for(var n=[],i=0,a=t.length;i<a;i++)n[i]=r.TryCoerce(t[i]);return e.apply(null,n)}),n)}},{key:\"UnbindExternalFunction\",value:function(t){this.IfAsyncWeCant(\"unbind an external a function\"),this.Assert(this._externals.has(t),\"Function '\"+t+\"' has not been bound.\"),this._externals.delete(t)}},{key:\"ValidateExternalBindings\",value:function(){var t=null,e=null,n=arguments[1]||new Set;if(arguments[0]instanceof tt&&(t=arguments[0]),arguments[0]instanceof V&&(e=arguments[0]),null===t&&null===e)if(this.ValidateExternalBindings(this._mainContentContainer,n),this._hasValidatedExternals=!0,0==n.size)this._hasValidatedExternals=!0;else{var r=\"Error: Missing function binding for external\";r+=n.size>1?\"s\":\"\",r+=\": '\",r+=Array.from(n).join(\"', '\"),r+=\"' \",r+=this.allowExternalFunctionFallbacks?\", and no fallback ink function found.\":\" (ink fallbacks disabled)\",this.Error(r)}else if(null!=t){var i,a=S(t.content);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=o;null!=s&&s.hasValidName||this.ValidateExternalBindings(o,n)}}catch(t){a.e(t)}finally{a.f()}var l,u=S(t.namedContent);try{for(u.s();!(l=u.n()).done;){var c=m(l.value,2),h=c[1];this.ValidateExternalBindings(k(h,V),n)}}catch(t){u.e(t)}finally{u.f()}}else if(null!=e){var f=k(e,vt);if(f&&f.isExternal){var d=f.targetPathString;if(null===d)return L(\"name\");if(!this._externals.has(d))if(this.allowExternalFunctionFallbacks){var v=this.mainContentContainer.namedContent.has(d);v||n.add(d)}else n.add(d)}}}},{key:\"ObserveVariable\",value:function(t,e){if(this.IfAsyncWeCant(\"observe a new variable\"),null===this._variableObservers&&(this._variableObservers=new Map),!this.state.variablesState.GlobalVariableExistsWithName(t))throw new Error(\"Cannot observe variable '\"+t+\"' because it wasn't declared in the ink story.\");this._variableObservers.has(t)?this._variableObservers.get(t).push(e):this._variableObservers.set(t,[e])}},{key:\"ObserveVariables\",value:function(t,e){for(var n=0,r=t.length;n<r;n++)this.ObserveVariable(t[n],e[n])}},{key:\"RemoveVariableObserver\",value:function(t,e){if(this.IfAsyncWeCant(\"remove a variable observer\"),null!==this._variableObservers)if(null!=e){if(this._variableObservers.has(e))if(null!=t){var n=this._variableObservers.get(e);null!=n&&(n.splice(n.indexOf(t),1),0===n.length&&this._variableObservers.delete(e))}else this._variableObservers.delete(e)}else if(null!=t){var r,i=S(this._variableObservers.keys());try{for(i.s();!(r=i.n()).done;){var a=r.value,o=this._variableObservers.get(a);null!=o&&(o.splice(o.indexOf(t),1),0===o.length&&this._variableObservers.delete(a))}}catch(t){i.e(t)}finally{i.f()}}}},{key:\"VariableStateDidChangeEvent\",value:function(t,e){if(null!==this._variableObservers){var n=this._variableObservers.get(t);if(void 0!==n){if(!(e instanceof K))throw new Error(\"Tried to get the value of a variable that isn't a standard type\");var r,i=A(e,K),a=S(n);try{for(a.s();!(r=a.n()).done;){(0,r.value)(t,i.valueObject)}}catch(t){a.e(t)}finally{a.f()}}}}},{key:\"globalTags\",get:function(){return this.TagsAtStartOfFlowContainerWithPathString(\"\")}},{key:\"TagsForContentAtPath\",value:function(t){return this.TagsAtStartOfFlowContainerWithPathString(t)}},{key:\"TagsAtStartOfFlowContainerWithPathString\",value:function(t){var e=new R(t),n=this.ContentAtPath(e).container;if(null===n)return L(\"flowContainer\");for(;;){var r=n.content[0];if(!(r instanceof tt))break;n=r}var i,a=null,o=S(n.content);try{for(o.s();!(i=o.n()).done;){var s=k(i.value,ce);if(!s)break;null==a&&(a=[]),a.push(s.text)}}catch(t){o.e(t)}finally{o.f()}return a}},{key:\"BuildStringOfHierarchy\",value:function(){var t=new j;return this.mainContentContainer.BuildStringOfHierarchy(t,0,this.state.currentPointer.Resolve()),t.toString()}},{key:\"BuildStringOfContainer\",value:function(t){var e=new j;return t.BuildStringOfHierarchy(e,0,this.state.currentPointer.Resolve()),e.toString()}},{key:\"NextContent\",value:function(){if((this.state.previousPointer=this.state.currentPointer.copy(),this.state.divertedPointer.isNull||(this.state.currentPointer=this.state.divertedPointer.copy(),this.state.divertedPointer=dt.Null,this.VisitChangedContainersDueToDivert(),this.state.currentPointer.isNull))&&!this.IncrementContentPointer()){var t=!1;this.state.callStack.CanPop(ct.Function)?(this.state.PopCallStack(ct.Function),this.state.inExpressionEvaluation&&this.state.PushEvaluationStack(new rt),t=!0):this.state.callStack.canPopThread?(this.state.callStack.PopThread(),t=!0):this.state.TryExitFunctionEvaluationFromGame(),t&&!this.state.currentPointer.isNull&&this.NextContent()}}},{key:\"IncrementContentPointer\",value:function(){var t=!0,e=this.state.callStack.currentElement.currentPointer.copy();if(e.index++,null===e.container)return L(\"pointer.container\");for(;e.index>=e.container.content.length;){t=!1;var n=k(e.container.parent,tt);if(n instanceof tt==!1)break;var r=n.content.indexOf(e.container);if(-1==r)break;if((e=new dt(n,r)).index++,t=!0,null===e.container)return L(\"pointer.container\")}return t||(e=dt.Null),this.state.callStack.currentElement.currentPointer=e.copy(),t}},{key:\"TryFollowDefaultInvisibleChoice\",value:function(){var t=this._state.currentChoices,e=t.filter((function(t){return t.isInvisibleDefault}));if(0==e.length||t.length>e.length)return!1;var n=e[0];return null===n.targetPath?L(\"choice.targetPath\"):null===n.threadAtGeneration?L(\"choice.threadAtGeneration\"):(this.state.callStack.currentThread=n.threadAtGeneration,null!==this._stateSnapshotAtLastNewline&&(this.state.callStack.currentThread=this.state.callStack.ForkThread()),this.ChoosePath(n.targetPath,!1),!0)}},{key:\"NextSequenceShuffleIndex\",value:function(){var t=k(this.state.PopEvaluationStack(),J);if(!(t instanceof J))return this.Error(\"expected number of elements in sequence for shuffle index\"),0;var e=this.state.currentPointer.container;if(null===e)return L(\"seqContainer\");if(null===t.value)return L(\"numElementsIntVal.value\");var n=t.value,r=A(this.state.PopEvaluationStack(),J).value;if(null===r)return L(\"seqCount\");for(var i=r/n,a=r%n,o=e.path.toString(),s=0,l=0,u=o.length;l<u;l++)s+=o.charCodeAt(l)||0;for(var c=s+i+this.state.storySeed,h=new me(Math.floor(c)),f=[],d=0;d<n;++d)f.push(d);for(var v=0;v<=a;++v){var p=h.next()%f.length,m=f[p];if(f.splice(p,1),v==a)return m}throw new Error(\"Should never reach here\")}},{key:\"Error\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new G(t);throw n.useEndLineNumber=e,n}},{key:\"Warning\",value:function(t){this.AddError(t,!0)}},{key:\"AddError\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.currentDebugMetadata,i=e?\"WARNING\":\"ERROR\";if(null!=r){var a=n?r.endLineNumber:r.startLineNumber;t=\"RUNTIME \"+i+\": '\"+r.fileName+\"' line \"+a+\": \"+t}else t=this.state.currentPointer.isNull?\"RUNTIME \"+i+\": \"+t:\"RUNTIME \"+i+\": (\"+this.state.currentPointer+\"): \"+t;this.state.AddError(t,e),e||this.state.ForceEnd()}},{key:\"Assert\",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(0==t)throw null==e&&(e=\"Story assert\"),new Error(e+\" \"+this.currentDebugMetadata)}},{key:\"currentDebugMetadata\",get:function(){var t,e=this.state.currentPointer;if(!e.isNull&&null!==e.Resolve()&&null!==(t=e.Resolve().debugMetadata))return t;for(var n=this.state.callStack.elements.length-1;n>=0;--n)if(!(e=this.state.callStack.elements[n].currentPointer).isNull&&null!==e.Resolve()&&null!==(t=e.Resolve().debugMetadata))return t;for(var r=this.state.outputStream.length-1;r>=0;--r){if(null!==(t=this.state.outputStream[r].debugMetadata))return t}return null}},{key:\"mainContentContainer\",get:function(){return this._temporaryEvaluationContainer?this._temporaryEvaluationContainer:this._mainContentContainer}}]),o}(V),t.Story.inkVersionCurrent=20,function(t){var e;(e=t.OutputStateChange||(t.OutputStateChange={}))[e.NoChange=0]=\"NoChange\",e[e.ExtendedBeyondNewline=1]=\"ExtendedBeyondNewline\",e[e.NewlineRemoved=2]=\"NewlineRemoved\"}(t.Story||(t.Story={}));var _e=function(e){a(s,e);var r=d(s);function s(e){var i,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n(this,s),(i=r.call(this,null,e,null,!1,a))._errorHandler=null,i._hadError=!1,i._hadWarning=!1,i._dontFlattenContainers=new Set,i._listDefs=new Map,i.constants=new Map,i.externals=new Map,i.countAllVisits=!1,i.ExportRuntime=function(){var e,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i._errorHandler=r,i.constants=new Map;var a,o=S(i.FindAll(kt)());try{for(o.s();!(a=o.n()).done;){var s=a.value,l=i.constants.get(s.constantName);if(l){var u=l.GenerateRuntimeObject()||{Equals:function(){return!1}};if(!u.Equals(s.expression)){var c=\"CONST '\".concat(s.constantName,\"' has been redefined with a different value. Multiple definitions of the same CONST are valid so long as they contain the same value. Initial definition was on \").concat(l.debugMetadata,\".\");i.Error(c,s,!1)}}i.constants.set(s.constantName,s.expression)}}catch(t){o.e(t)}finally{o.f()}i._listDefs=new Map;var f,d=S(i.FindAll(Ht)());try{for(d.s();!(f=d.n()).done;){var v=f.value;(null===(e=v.identifier)||void 0===e?void 0:e.name)&&i._listDefs.set(null===(n=v.identifier)||void 0===n?void 0:n.name,v)}}catch(t){d.e(t)}finally{d.f()}i.externals=new Map,i.ResolveWeavePointNaming();var p=i.runtimeObject,y=new tt;y.AddContent(et.EvalStart());var g,C=[],b=S(i.variableDeclarations);try{for(b.s();!(g=b.n()).done;){var w=m(g.value,2),_=w[0],E=w[1];if(E.isGlobalDeclaration){if(E.listDefinition)i._listDefs.set(_,E.listDefinition),y.AddContent(E.listDefinition.runtimeObject),C.push(E.listDefinition.runtimeListDefinition);else{if(!E.expression)throw new Error;E.expression.GenerateIntoContainer(y)}var k=new pt(_,!0);k.isGlobal=!0,y.AddContent(k)}}}catch(t){b.e(t)}finally{b.f()}y.AddContent(et.EvalEnd()),y.AddContent(et.End()),i.variableDeclarations.size>0&&(y.name=\"global decl\",p.AddToNamedContentOnly(y)),p.AddContent(et.Done());var A=new t.Story(p,C);return i.runtimeObject=A,i.hadError?null:(i.FlattenContainersIn(p),i.ResolveReferences(h(i)),i.hadError?null:(A.ResetState(),A))},i.ResolveList=function(t){var e=i._listDefs.get(t);return e||null},i.ResolveListItem=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=null;if(t)return(r=i._listDefs.get(t))?r.ItemNamed(e):null;var a,o=null,s=null,l=S(i._listDefs.entries());try{for(l.s();!(a=l.n()).done;){var u=m(a.value,2),c=(u[0],u[1]),h=c.ItemNamed(e);h&&(o?i.Error(\"Ambiguous item name '\".concat(e,\"' found in multiple sets, including \").concat(s.identifier,\" and \").concat(c.identifier),n,!1):(o=h,s=c))}}catch(t){l.e(t)}finally{l.f()}return o},i.FlattenContainersIn=function(t){var e=new Set;if(t.content){var n,r=S(t.content);try{for(r.s();!(n=r.n()).done;){var a=k(n.value,tt);a&&e.add(a)}}catch(t){r.e(t)}finally{r.f()}}if(t.namedContent){var o,s=S(t.namedContent);try{for(s.s();!(o=s.n()).done;){var l=m(o.value,2),u=(l[0],k(l[1],tt));u&&e.add(u)}}catch(t){s.e(t)}finally{s.f()}}var c,h=S(e);try{for(h.s();!(c=h.n()).done;){var f=c.value;i.TryFlattenContainer(f),i.FlattenContainersIn(f)}}catch(t){h.e(t)}finally{h.f()}},i.TryFlattenContainer=function(t){if(!(t.namedContent&&t.namedContent.size>0||t.hasValidName||i._dontFlattenContainers.has(t))){var e=k(t.parent,tt);if(e){var n=e.content.indexOf(t);e.content.splice(n,1);var r=t.ownDebugMetadata;if(t.content){var a,o=S(t.content);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.parent=null,null!==r&&null===s.ownDebugMetadata&&(s.debugMetadata=r),e.InsertContent(s,n),n+=1}}catch(t){o.e(t)}finally{o.f()}}}}},i.Error=function(t,e,n){var r=n?b.Warning:b.Error,a=\"\";if(e instanceof F?(a+=\"TODO: \",r=b.Author):a+=n?\"WARNING: \":\"ERROR: \",e&&null!==e.debugMetadata&&e.debugMetadata.startLineNumber>=1&&(null!=e.debugMetadata.fileName&&(a+=\"'\".concat(e.debugMetadata.fileName,\"' \")),a+=\"line \".concat(e.debugMetadata.startLineNumber,\": \")),t=a+=t,null===i._errorHandler)throw new Error(t);i._errorHandler(t,r),i._hadError=r===b.Error,i._hadWarning=r===b.Warning},i.ResetError=function(){i._hadError=!1,i._hadWarning=!1},i.IsExternal=function(t){return i.externals.has(t)},i.AddExternal=function(t){i.externals.has(t.name)?i.Error(\"Duplicate EXTERNAL definition of '\".concat(t.name,\"'\"),t,!1):t.name&&i.externals.set(t.name,t)},i.DontFlattenContainer=function(t){i._dontFlattenContainers.add(t)},i.NameConflictError=function(t,e,n,r){t.Error(\"\".concat(r,\" '\").concat(e,\"': name has already been used for a \").concat(n.typeName.toLowerCase(),\" on \").concat(n.debugMetadata))},i.CheckForNamingCollisions=function(t,e,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:\"\",o=a||t.typeName;if(s.IsReservedKeyword(null==e?void 0:e.name))t.Error(\"'\".concat(e,\"' cannot be used for the name of a \").concat(o.toLowerCase(),\" because it's a reserved keyword\"));else if(Rt.IsBuiltIn((null==e?void 0:e.name)||\"\"))t.Error(\"'\".concat(e,\"' cannot be used for the name of a \").concat(o.toLowerCase(),\" because it's a built in function\"));else{var l=i.ContentWithNameAtLevel((null==e?void 0:e.name)||\"\",bt.Knot),u=k(l,Nt);if(!u||u===t&&n!==ft.Arg){if(!(n<ft.List)){var c,h=S(i._listDefs);try{for(h.s();!(c=h.n()).done;){var f=m(c.value,2),d=f[0],v=f[1];if((null==e?void 0:e.name)===d&&t!==v&&v.variableAssignment!==t&&i.NameConflictError(t,null==e?void 0:e.name,v,o),!(t instanceof le)){var p,y=S(v.itemDefinitions);try{for(y.s();!(p=y.n()).done;){var g=p.value;(null==e?void 0:e.name)===g.name&&i.NameConflictError(t,(null==e?void 0:e.name)||\"\",g,o)}}catch(t){y.e(t)}finally{y.f()}}}}catch(t){h.e(t)}finally{h.f()}if(!(n<=ft.Var)){var C=(null==e?void 0:e.name)&&i.variableDeclarations.get(null==e?void 0:e.name)||null;if(C&&C!==t&&C.isGlobalDeclaration&&null==C.listDefinition&&i.NameConflictError(t,(null==e?void 0:e.name)||\"\",C,o),!(n<ft.SubFlowAndWeave)){var b=new Tt(i.identifier),w=b.ResolveFromContext(t);if(w&&w!==t)i.NameConflictError(t,(null==e?void 0:e.name)||\"\",w,o);else if(!(n<ft.Arg)&&n!==ft.Arg){var _=k(t,Nt);if(_||(_=Ot(t)),_&&_.hasParameters&&_.args){var E,A=S(_.args);try{for(A.s();!(E=A.n()).done;){var T=E.value;if((null===(r=T.identifier)||void 0===r?void 0:r.name)===(null==e?void 0:e.name))return void t.Error(\"\".concat(o,\" '\").concat(e,\"': Name has already been used for a argument to \").concat(_.identifier,\" on \").concat(_.debugMetadata))}}catch(t){A.e(t)}finally{A.f()}}}}}}}else i.NameConflictError(t,(null==e?void 0:e.name)||\"\",u,o)}},i}return i(s,[{key:\"flowLevel\",get:function(){return bt.Story}},{key:\"hadError\",get:function(){return this._hadError}},{key:\"hadWarning\",get:function(){return this._hadWarning}},{key:\"typeName\",get:function(){return\"Story\"}},{key:\"PreProcessTopLevelObjects\",value:function(t){p(o(s.prototype),\"PreProcessTopLevelObjects\",this).call(this,t);var e,n=[],r=S(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i instanceof ie){var a=i,l=t.indexOf(i);if(t.splice(l,1),a.includedStory){var u=[],c=a.includedStory;if(null!=c.content){var h,f=S(c.content);try{for(f.s();!(h=f.n()).done;){var d=h.value;d instanceof Nt?n.push(d):u.push(d)}}catch(t){f.e(t)}finally{f.f()}u.push(new Et(\"\\n\")),t.splice.apply(t,[l,0].concat(u))}}}else;}}catch(t){r.e(t)}finally{r.f()}t.splice.apply(t,[0,0].concat(n))}}]),s}(Nt);_e.IsReservedKeyword=function(t){switch(t){case\"true\":case\"false\":case\"not\":case\"return\":case\"else\":case\"VAR\":case\"CONST\":case\"temp\":case\"LIST\":case\"function\":return!0}return!1};var Ee,ke=function(t){a(r,t);var e=d(r);function r(t){var i;return n(this,r),(i=e.call(this)).GenerateIntoContainer=function(t){t.AddContent(et.BeginString());var e,n=S(i.content);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.AddContent(r.runtimeObject)}}catch(t){n.e(t)}finally{n.f()}t.AddContent(et.EndString())},i.toString=function(){var t,e=\"\",n=S(i.content);try{for(n.s();!(t=n.n()).done;){e+=t.value}}catch(t){n.e(t)}finally{n.f()}return e},i.Equals=function(t){var e=k(t,r);return null!==e&&(!(!i.isSingleString||!e.isSingleString)&&i.toString()===e.toString())},i.AddContent(t),i}return i(r,[{key:\"isSingleString\",get:function(){return 1===this.content.length&&this.content[0]instanceof Et}}]),r}(nt),Ae=function(t){a(r,t);var e=d(r);function r(t){return n(this,r),e.call(this,t)}return i(r)}(te);!function(t){t[t.Author=0]=\"Author\",t[t.Error=1]=\"Error\",t[t.Warning=2]=\"Warning\"}(Ee||(Ee={}));var Te=function(t){a(o,t);var r=d(o);function o(t){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(n(this,o),(i=r.call(this,t))._filename=a,i._externalErrorHandler=s,i._fileHandler=u,i.ParseStory=function(){var t=i.StatementsAtLevel(Xt.Top);return new _e(t,i._rootParser!==h(i))},i.SeparatedList=function(t,e){var n=i.Parse(t);if(null===n)return null;var r=[];for(r.push(n);;){var a=i.BeginRule();if(null===e()){i.FailRule(a);break}var o=i.Parse(t);if(null===o){i.FailRule(a);break}i.SucceedRule(a),r.push(o)}return r},i.CreateDebugMetadata=function(t,e){var n=new Yt;return n.startLineNumber=((null==t?void 0:t.lineIndex)||0)+1,n.endLineNumber=e.lineIndex+1,n.startCharacterNumber=((null==t?void 0:t.characterInLineIndex)||0)+1,n.endCharacterNumber=e.characterInLineIndex+1,n.fileName=i._filename,n},i.RuleDidSucceed=function(t,e,n){var r=k(t,W);r&&(r.debugMetadata=i.CreateDebugMetadata(e,n));var a=Array.isArray(t)?t:null;if(null!==a){var o,s=S(a);try{for(s.s();!(o=s.n()).done;){var l=o.value;k(l,W)&&(l.hasOwnDebugMetadata||(l.debugMetadata=i.CreateDebugMetadata(e,n)))}}catch(t){s.e(t)}finally{s.f()}}var u=k(t,xt);null!=u&&(u.debugMetadata=i.CreateDebugMetadata(e,n))},i.OnStringParserError=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=r?\"WARNING:\":\"ERROR:\",o=a;if(null!==i._filename&&(o+=\" '\".concat(i._filename,\"'\")),o+=\" line \".concat(n+1,\": \").concat(t),null===i._externalErrorHandler)throw new Error(o);i._externalErrorHandler(o,r?Ee.Warning:Ee.Error)},i.AuthorWarning=function(){i.Whitespace();var t=i.Parse(i.IdentifierWithMetadata);if(null===t||\"TODO\"!==t.name)return null;i.Whitespace(),i.ParseString(\":\"),i.Whitespace();var e=i.ParseUntilCharactersFromString(\"\\n\\r\");return e?new F(e):null},i.ExtendIdentifierCharacterRanges=function(t){var e,n=S(o.ListAllCharacterRanges());try{for(n.s();!(e=n.n()).done;){var r=e.value;t.AddCharacters(r.ToCharacterSet())}}catch(t){n.e(t)}finally{n.f()}},i._parsingChoice=!1,i.Choice=function(){var t=!0,e=i.Interleave(i.OptionalExclude(i.Whitespace),i.String(\"*\"));if(!e){if(null===(e=i.Interleave(i.OptionalExclude(i.Whitespace),i.String(\"+\"))))return null;t=!1}var n=i.Parse(i.BracketedName);i.Whitespace();var r=i.Parse(i.ChoiceCondition);if(i.Whitespace(),i._parsingChoice)throw new Error(\"Already parsing a choice - shouldn't have nested choices\");i._parsingChoice=!0;var a=null,o=i.Parse(i.MixedTextAndLogic);o&&(a=new It(o));var s=null,l=null,u=null!==i.ParseString(\"[\");if(u){var c=i.Parse(i.MixedTextAndLogic);null!==c&&(s=new It(c)),i.Expect(i.String(\"]\"),\"closing ']' for weave-style option\");var h=i.Parse(i.MixedTextAndLogic);null!==h&&(l=new It(h))}i.Whitespace();var f=i.Parse(i.MultiDivert);i._parsingChoice=!1,i.Whitespace();var d=!a&&!l&&!s;d&&null===f&&i.Warning(\"Choice is completely empty. Interpretting as a default fallback choice. Add a divert arrow to remove this warning: * ->\"),a||!u||s||i.Warning(\"Blank choice - if you intended a default fallback choice, use the `* ->` syntax\"),l||(l=new It);var v=i.Parse(i.Tags);if(null!==v&&l.AddContent(v),null!==f){var p,m=S(f);try{for(m.s();!(p=m.n()).done;){var y=p.value,g=k(y,jt);g&&g.isEmpty||l.AddContent(y)}}catch(t){m.e(t)}finally{m.f()}}l.AddContent(new Et(\"\\n\"));var C=new mt(a,s,l);return n&&(C.identifier=n),C.indentationDepth=e.length,C.hasWeaveStyleInlineBrackets=u,C.condition=r,C.onceOnly=t,C.isInvisibleDefault=d,C},i.ChoiceCondition=function(){var t=i.Interleave(i.ChoiceSingleCondition,i.ChoiceConditionsSpace);return null===t?null:1===t.length?t[0]:new Lt(t)},i.ChoiceConditionsSpace=function(){return i.Newline(),i.Whitespace(),Ct},i.ChoiceSingleCondition=function(){if(null===i.ParseString(\"{\"))return null;var t=i.Expect(i.Expression,\"choice condition inside { }\");return i.DisallowIncrement(t),i.Expect(i.String(\"}\"),\"closing '}' for choice condition\"),t},i.Gather=function(){var t=i.Parse(i.GatherDashes);if(null===t)return null;var e=Number(t),n=i.Parse(i.BracketedName),r=new At(n,e);return i.Newline(),r},i.GatherDashes=function(){i.Whitespace();for(var t=0;null!==i.ParseDashNotArrow();)t+=1,i.Whitespace();return 0===t?null:t},i.ParseDashNotArrow=function(){var t=i.BeginRule();return null===i.ParseString(\"->\")&&\"-\"===i.ParseSingleCharacter()?i.SucceedRule(t):i.FailRule(t)},i.BracketedName=function(){if(null===i.ParseString(\"(\"))return null;i.Whitespace();var t=i.Parse(i.IdentifierWithMetadata);return null===t?null:(i.Whitespace(),i.Expect(i.String(\")\"),\"closing ')' for bracketed name\"),t)},i.InnerConditionalContent=function(t){if(void 0===t){var e=i.Parse(i.ConditionExpression),n=i.Parse((function(){return i.InnerConditionalContent(e)}));return null===n?null:n}var r,a=null!==t,o=null===i.Parse(i.Newline);if(o&&!a)return null;if(o)r=i.InlineConditionalBranches();else{if(null===(r=i.MultilineConditionalBranches())){if(t){var s=i.StatementsAtLevel(Xt.InnerBlock);if(null!==s){r=[new $t(s)];var l=i.Parse(i.SingleMultilineCondition);l&&(l.isElse||(i.ErrorWithParsedObject(\"Expected an '- else:' clause here rather than an extra condition\",l),l.isElse=!0),r.push(l))}}if(null===r)return null}else if(1===r.length&&r[0].isElse&&t){var u=new $t(null);u.isTrueBranch=!0,r.unshift(u)}if(t)for(var c=!1,h=0;h<r.length;++h){var f=r[h],d=h===r.length-1;f.ownExpression?(f.matchingEquality=!0,c=!0):c&&d?(f.matchingEquality=!0,f.isElse=!0):!d&&r.length>2?i.ErrorWithParsedObject(\"Only final branch can be an 'else'. Did you miss a ':'?\",f):0===h?f.isTrueBranch=!0:f.isElse=!0}else{for(var v=0;v<r.length;++v){var p=r[v],m=v===r.length-1;if(null===p.ownExpression)if(m)p.isElse=!0;else if(p.isElse){var y=r[r.length-1];y.isElse?i.ErrorWithParsedObject(\"Multiple 'else' cases. Can have a maximum of one, at the end.\",y):i.ErrorWithParsedObject(\"'else' case in conditional should always be the final one\",p)}else i.ErrorWithParsedObject(\"Branch doesn't have condition. Are you missing a ':'? \",p)}1===r.length&&null===r[0].ownExpression&&i.ErrorWithParsedObject(\"Condition block with no conditions\",r[0])}}if(null===r)return null;var g,C=S(r);try{for(C.s();!(g=C.n()).done;){g.value.isInline=o}}catch(t){C.e(t)}finally{C.f()}return new _t(t,r)},i.InlineConditionalBranches=function(){var t=i.Interleave(i.MixedTextAndLogic,i.Exclude(i.String(\"|\")),null,!1);if(null===t||0===t.length)return null;var e=[];if(t.length>2)i.Error(\"Expected one or two alternatives separated by '|' in inline conditional\");else{var n=new $t(t[0]);if(n.isTrueBranch=!0,e.push(n),t.length>1){var r=new $t(t[1]);r.isElse=!0,e.push(r)}}return e},i.MultilineConditionalBranches=function(){i.MultilineWhitespace();var t=i.OneOrMore(i.SingleMultilineCondition);return null===t?null:(i.MultilineWhitespace(),t)},i.SingleMultilineCondition=function(){if(i.Whitespace(),null!==i.ParseString(\"->\")||null===i.ParseString(\"-\"))return null;i.Whitespace();var t=null,e=null!==i.Parse(i.ElseExpression);e||(t=i.Parse(i.ConditionExpression));var n=i.StatementsAtLevel(Xt.InnerBlock);null===t&&null===n&&(i.Error(\"expected content for the conditional branch following '-'\"),n=[new Et(\"\")]),i.MultilineWhitespace();var r=new $t(n);return r.ownExpression=t,r.isElse=e,r},i.ConditionExpression=function(){var t=i.Parse(i.Expression);return null===t?null:(i.DisallowIncrement(t),i.Whitespace(),null===i.ParseString(\":\")?null:t)},i.ElseExpression=function(){return null===i.ParseString(\"else\")?null:(i.Whitespace(),null===i.ParseString(\":\")?null:Ct)},i._nonTextPauseCharacters=null,i._nonTextEndCharacters=null,i._notTextEndCharactersChoice=null,i._notTextEndCharactersString=null,i.TrimEndWhitespace=function(t,e){if(t.length>0){var n=t.length-1,r=t[n];if(r instanceof Et){var a=r;a.text=a.text.replace(new RegExp(/[ \\t]+$/g),\"\"),e?a.text+=\" \":0===a.text.length&&(t.splice(n,1),i.TrimEndWhitespace(t,!1))}}},i.LineOfMixedTextAndLogic=function(){i.Parse(i.Whitespace);var t=i.Parse(i.MixedTextAndLogic),e=!1,n=i.Parse(i.Tags);if(n)if(t){var r,a=S(n);try{for(a.s();!(r=a.n()).done;){var o=r.value;t.push(o)}}catch(t){a.e(t)}finally{a.f()}}else t=n,e=!0;if(!t||!t.length)return null;var s=t[0];return s&&s.text&&s.text.startsWith(\"return\")&&i.Warning(\"Do you need a '~' before 'return'? If not, perhaps use a glue: <> (since it's lowercase) or rewrite somehow?\"),0===t.length?null:(t[t.length-1]instanceof jt||i.TrimEndWhitespace(t,!1),e||t.push(new Et(\"\\n\")),i.Expect(i.EndOfLine,\"end of line\",i.SkipToNextLine),t)},i.MixedTextAndLogic=function(){null!==i.ParseObject(i.Spaced(i.String(\"~\")))&&i.Error(\"You shouldn't use a '~' here - tildas are for logic that's on its own line. To do inline logic, use { curly braces } instead\");var t=i.Interleave(i.Optional(i.ContentText),i.Optional(i.InlineLogicOrGlue));if(!i._parsingChoice){var e,n=i.Parse(i.MultiDivert);if(null!==n)null===t&&(t=[]),i.TrimEndWhitespace(t,!0),(e=t).push.apply(e,y(n))}return t||null},i.ContentText=function(){return i.ContentTextAllowingEscapeChar()},i.ContentTextAllowingEscapeChar=function(){for(var t=null;;){var e=i.Parse(i.ContentTextNoEscape),n=null!==i.ParseString(\"\\\\\");if(!n&&null===e)break;null===t&&(t=\"\"),null!==e&&(t+=String(e)),n&&(t+=i.ParseSingleCharacter())}return null!==t?new Et(t):null},i.ContentTextNoEscape=function(){null===i._nonTextPauseCharacters&&(i._nonTextPauseCharacters=new lt(\"-<\")),null===i._nonTextEndCharacters&&(i._nonTextEndCharacters=new lt(\"{}|\\n\\r\\\\#\"),i._notTextEndCharactersChoice=new lt(i._nonTextEndCharacters),i._notTextEndCharactersChoice.AddCharacters(\"[]\"),i._notTextEndCharactersString=new lt(i._nonTextEndCharacters),i._notTextEndCharactersString.AddCharacters('\"'));var t=null;t=i.parsingStringExpression?i._notTextEndCharactersString:i._parsingChoice?i._notTextEndCharactersChoice:i._nonTextEndCharacters;var e=i.ParseUntil((function(){return i.OneOf([i.ParseDivertArrow,i.ParseThreadArrow,i.EndOfLine,i.Glue])}),i._nonTextPauseCharacters,t);return null!==e?e:null},i.MultiDivert=function(){i.Whitespace();var t=[],e=i.Parse(i.StartThread);if(e)return t=[e];var n=i.Interleave(i.ParseDivertArrowOrTunnelOnwards,i.DivertIdentifierWithArguments);if(!n)return null;t=[];for(var r=0;r<n.length;++r){if(r%2==0){if(\"->->\"===n[r]){0===r||r===n.length-1||r===n.length-2||i.Error(\"Tunnel onwards '->->' must only come at the begining or the start of a divert\");var a=new Ut;if(r<n.length-1){var o=k(n[r+1],jt);a.divertAfter=o}t.push(a);break}}else{var s=n[r];r<n.length-1&&(s.isTunnel=!0),t.push(s)}}if(0===t.length&&1===n.length){var l=new jt(null);l.isEmpty=!0,t.push(l),i._parsingChoice||i.Error(\"Empty diverts (->) are only valid on choices\")}return t},i.StartThread=function(){if(i.Whitespace(),null===i.ParseThreadArrow())return null;i.Whitespace();var t=i.Expect(i.DivertIdentifierWithArguments,\"target for new thread\",(function(){return new jt(null)}));return t.isThread=!0,t},i.DivertIdentifierWithArguments=function(){i.Whitespace();var t=i.Parse(i.DotSeparatedDivertPathComponents);if(!t)return null;i.Whitespace();var e=i.Parse(i.ExpressionFunctionCallArguments);i.Whitespace();var n=new Tt(t);return new jt(n,e)},i.SingleDivert=function(){var t=i.Parse(i.MultiDivert);if(!t)return null;if(1!==t.length)return null;if(t[0]instanceof Ut)return null;var e=t[0];return e.isTunnel?null:e},i.DotSeparatedDivertPathComponents=function(){return i.Interleave(i.Spaced(i.IdentifierWithMetadata),i.Exclude(i.String(\".\")))},i.ParseDivertArrowOrTunnelOnwards=function(){for(var t=0;null!==i.ParseString(\"->\");)t+=1;return 0===t?null:1===t?\"->\":(2===t||i.Error(\"Unexpected number of arrows in divert. Should only have '->' or '->->'\"),\"->->\")},i.ParseDivertArrow=function(){return i.ParseString(\"->\")},i.ParseThreadArrow=function(){return i.ParseString(\"<-\")},i._binaryOperators=[],i._maxBinaryOpLength=0,i.TempDeclarationOrAssignment=function(){i.Whitespace();var t=i.ParseTempKeyword();i.Whitespace();var e=null;if(null===(e=t?i.Expect(i.IdentifierWithMetadata,\"variable name\"):i.Parse(i.IdentifierWithMetadata)))return null;i.Whitespace();var n=null!==i.ParseString(\"+\"),r=null!==i.ParseString(\"-\");if(n&&r&&i.Error(\"Unexpected sequence '+-'\"),null===i.ParseString(\"=\"))return t&&i.Error(\"Expected '='\"),null;var a=i.Expect(i.Expression,\"value expression to be assigned\");return n||r?new re(e,a,n):new Jt({variableIdentifier:e,assignedExpression:a,isTemporaryNewDeclaration:t})},i.DisallowIncrement=function(t){t instanceof re&&i.Error(\"Can't use increment/decrement here. It can only be used on a ~ line\")},i.ParseTempKeyword=function(){var t=i.BeginRule();return\"temp\"===i.Parse(i.Identifier)?(i.SucceedRule(t),!0):(i.FailRule(t),!1)},i.ReturnStatement=function(){if(i.Whitespace(),\"return\"!==i.Parse(i.Identifier))return null;i.Whitespace();var t=i.Parse(i.Expression);return new Pt(t)},i.Expression=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;i.Whitespace();var n=i.ExpressionUnary();if(null===n)return null;i.Whitespace();for(var r=function(){var e=i.BeginRule(),r=i.ParseInfixOperator();if(null!==r&&r.precedence>t){var a=\"right side of '\".concat(r.type,\"' expression\"),o=i.Expect((function(){return i.ExpressionInfixRight(n,r)}),a);return null===o?(i.FailRule(e),{v:null}):(n=i.SucceedRule(e,o),\"continue\")}return i.FailRule(e),\"break\"};;){var a=r();if(\"continue\"!==a){if(\"break\"===a)break;if(\"object\"===e(a))return a.v}}return i.Whitespace(),n},i.ExpressionUnary=function(){var t=i.Parse(i.ExpressionDivertTarget);if(null!==t)return t;var e=i.OneOf([i.String(\"-\"),i.String(\"!\")]);null===e&&(e=i.Parse(i.ExpressionNot)),i.Whitespace();var n=i.OneOf([i.ExpressionList,i.ExpressionParen,i.ExpressionFunctionCall,i.ExpressionVariableName,i.ExpressionLiteral]);if(null===n&&null!==e&&(n=i.ExpressionUnary()),null===n)return null;null!==e&&(n=ot.WithInner(n,e)),i.Whitespace();var r=i.OneOf([i.String(\"++\"),i.String(\"--\")]);if(null!==r){var a=\"++\"===r;if(n instanceof Ft)n=new re(n.identifier,a);else i.Error(\"can only increment and decrement variables, but saw '\".concat(n,\"'.\"))}return n},i.ExpressionNot=function(){var t=i.Identifier();return\"not\"===t?t:null},i.ExpressionLiteral=function(){return i.OneOf([i.ExpressionFloat,i.ExpressionInt,i.ExpressionBool,i.ExpressionString])},i.ExpressionDivertTarget=function(){i.Whitespace();var t=i.Parse(i.SingleDivert);return!t||t&&t.isThread?null:(i.Whitespace(),new Vt(t))},i.ExpressionInt=function(){var t=i.ParseInt();return null===t?null:new at(t,\"int\")},i.ExpressionFloat=function(){var t=i.ParseFloat();return null===t?null:new at(t,\"float\")},i.ExpressionString=function(){if(null===i.ParseString('\"'))return null;i.parsingStringExpression=!0;var t=i.Parse(i.MixedTextAndLogic);return i.Expect(i.String('\"'),\"close quote for string expression\"),i.parsingStringExpression=!1,null===t?t=[new Et(\"\")]:t.find((function(t){return t instanceof jt}))&&i.Error(\"String expressions cannot contain diverts (->)\"),new ke(t)},i.ExpressionBool=function(){var t=i.Parse(i.Identifier);return\"true\"===t?new at(!0,\"bool\"):\"false\"===t?new at(!1,\"bool\"):null},i.ExpressionFunctionCall=function(){var t=i.Parse(i.IdentifierWithMetadata);if(null===t)return null;i.Whitespace();var e=i.Parse(i.ExpressionFunctionCallArguments);return null===e?null:new Rt(t,e)},i.ExpressionFunctionCallArguments=function(){if(null===i.ParseString(\"(\"))return null;var t=i.Exclude(i.String(\",\")),e=i.Interleave(i.Expression,t);return null===e&&(e=[]),i.Whitespace(),i.Expect(i.String(\")\"),\"closing ')' for function call\"),e},i.ExpressionVariableName=function(){var t=i.Interleave(i.IdentifierWithMetadata,i.Exclude(i.Spaced(i.String(\".\"))));return null===t||_e.IsReservedKeyword(t[0].name)?null:new Ft(t)},i.ExpressionParen=function(){if(null===i.ParseString(\"(\"))return null;var t=i.Parse(i.Expression);return null===t?null:(i.Whitespace(),i.Expect(i.String(\")\"),\"closing parenthesis ')' for expression\"),t)},i.ExpressionInfixRight=function(t,e){if(!t)return null;i.Whitespace();var n=i.Parse((function(){return i.Expression(e.precedence)}));return n?new st(t,n,e.type):null},i.ParseInfixOperator=function(){var t,e=S(i._binaryOperators);try{for(e.s();!(t=e.n()).done;){var n=t.value,r=i.BeginRule();if(null!==i.ParseString(n.type)){if(n.requireWhitespace&&null===i.Whitespace()){i.FailRule(r);continue}return i.SucceedRule(r,n)}i.FailRule(r)}}catch(t){e.e(t)}finally{e.f()}return null},i.ExpressionList=function(){if(i.Whitespace(),null===i.ParseString(\"(\"))return null;i.Whitespace();var t=i.SeparatedList(i.ListMember,i.Spaced(i.String(\",\")));return i.Whitespace(),null===i.ParseString(\")\")?null:new se(t)},i.ListMember=function(){i.Whitespace();var t=i.Parse(i.IdentifierWithMetadata);if(null===t)return null;if(null!==i.ParseString(\".\")){var e=i.Expect(i.IdentifierWithMetadata,\"element name within the set \".concat(t));t.name+=\".\".concat(null==e?void 0:e.name)}return i.Whitespace(),t},i.RegisterExpressionOperators=function(){i.RegisterBinaryOperator(\"&&\",1),i.RegisterBinaryOperator(\"||\",1),i.RegisterBinaryOperator(\"and\",1,!0),i.RegisterBinaryOperator(\"or\",1,!0),i.RegisterBinaryOperator(\"==\",2),i.RegisterBinaryOperator(\">=\",2),i.RegisterBinaryOperator(\"<=\",2),i.RegisterBinaryOperator(\"<\",2),i.RegisterBinaryOperator(\">\",2),i.RegisterBinaryOperator(\"!=\",2),i.RegisterBinaryOperator(\"?\",3),i.RegisterBinaryOperator(\"has\",3,!0),i.RegisterBinaryOperator(\"!?\",3),i.RegisterBinaryOperator(\"hasnt\",3,!0),i.RegisterBinaryOperator(\"^\",3),i.RegisterBinaryOperator(\"+\",4),i.RegisterBinaryOperator(\"-\",5),i.RegisterBinaryOperator(\"*\",6),i.RegisterBinaryOperator(\"/\",7),i.RegisterBinaryOperator(\"%\",8),i.RegisterBinaryOperator(\"mod\",8,!0)},i.RegisterBinaryOperator=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=new ae(t,e,n);i._binaryOperators.push(r),i._maxBinaryOpLength=Math.max(i._maxBinaryOpLength,t.length)},i._openFilenames=[],i.IncludeStatement=function(){if(i.Whitespace(),null===i.ParseString(\"INCLUDE\"))return null;i.Whitespace();var t=i.Expect((function(){return i.ParseUntilCharactersFromString(\"\\n\\r\")}),\"filename for include statement\");t=t.replace(new RegExp(/[ \\t]+$/g),\"\");var e=i.fileHandler.ResolveInkFilename(t);if(i.FilenameIsAlreadyOpen(e))return i.Error(\"Recursive INCLUDE detected: '\".concat(e,\"' is already open.\")),i.ParseUntilCharactersFromString(\"\\r\\n\"),new ie(null);i.AddOpenFilename(e);var n=null,r=\"\";try{r=i._rootParser.fileHandler.LoadInkFileContents(e)}catch(e){i.Error(\"Failed to load: '\".concat(t,\"'.\\nError:\").concat(e))}r&&(n=new o(r,t,i._externalErrorHandler,i._rootParser,i.fileHandler).ParseStory());return i.RemoveOpenFilename(e),new ie(n)},i.FilenameIsAlreadyOpen=function(t){return i._rootParser._openFilenames.includes(t)},i.AddOpenFilename=function(t){i._rootParser._openFilenames.push(t)},i.RemoveOpenFilename=function(t){i._rootParser._openFilenames.splice(i._rootParser._openFilenames.indexOf(t),1)},i.KnotDefinition=function(){var t=i.Parse(i.KnotDeclaration);if(null===t)return null;i.Expect(i.EndOfLine,\"end of line after knot name definition\",i.SkipToNextLine);var e=i.Expect((function(){return i.StatementsAtLevel(Xt.Knot)}),\"at least one line within the knot\",i.KnotStitchNoContentRecoveryRule);return new oe(t.name,e,t.args,t.isFunction)},i.KnotDeclaration=function(){if(i.Whitespace(),null===i.KnotTitleEquals())return null;i.Whitespace();var t,e=i.Parse(i.IdentifierWithMetadata),n=\"function\"===(null==e?void 0:e.name);n?(i.Expect(i.Whitespace,\"whitespace after the 'function' keyword\"),t=i.Parse(i.IdentifierWithMetadata)):t=e,null===t&&(i.Error(\"Expected the name of the \".concat(n?\"function\":\"knot\")),t=new xt(\"\")),i.Whitespace();var r=i.Parse(i.BracketedKnotDeclArguments);return i.Whitespace(),i.Parse(i.KnotTitleEquals),new Qt(t,r,n)},i.KnotTitleEquals=function(){var t=i.ParseCharactersFromString(\"=\");return null===t||t.length<=1?null:t},i.StitchDefinition=function(){var t=i.Parse(i.StitchDeclaration);if(null===t)return null;i.Expect(i.EndOfLine,\"end of line after stitch name\",i.SkipToNextLine);var e=i.Expect((function(){return i.StatementsAtLevel(Xt.Stitch)}),\"at least one line within the stitch\",i.KnotStitchNoContentRecoveryRule);return new ue(t.name,e,t.args,t.isFunction)},i.StitchDeclaration=function(){if(i.Whitespace(),null===i.ParseString(\"=\"))return null;if(null!==i.ParseString(\"=\"))return null;i.Whitespace();var t=null!==i.ParseString(\"function\");t&&i.Whitespace();var e=i.Parse(i.IdentifierWithMetadata);if(null===e)return null;i.Whitespace();var n=i.Parse(i.BracketedKnotDeclArguments);return i.Whitespace(),new Qt(e,n,t)},i.KnotStitchNoContentRecoveryRule=function(){return i.ParseUntil(i.KnotDeclaration,new lt(\"=\"),null),[new Et(\"<ERROR IN FLOW>\")]},i.BracketedKnotDeclArguments=function(){if(null===i.ParseString(\"(\"))return null;var t=i.Interleave(i.Spaced(i.FlowDeclArgument),i.Exclude(i.String(\",\")));return i.Expect(i.String(\")\"),\"closing ')' for parameter list\"),null===t&&(t=[]),t},i.FlowDeclArgument=function(){var t=i.Parse(i.IdentifierWithMetadata);i.Whitespace();var e=i.ParseDivertArrow();i.Whitespace();var n=i.Parse(i.IdentifierWithMetadata);if(null==t&&null===n)return null;var r=new E;return null!==e&&(r.isDivertTarget=!0),null!==t&&\"ref\"===t.name?(null===n&&i.Error(\"Expected an parameter name after 'ref'\"),r.identifier=n,r.isByReference=!0):(r.isDivertTarget?r.identifier=n:r.identifier=t,null===r.identifier&&i.Error(\"Expected an parameter name\"),r.isByReference=!1),r},i.ExternalDeclaration=function(){i.Whitespace();var t=i.Parse(i.IdentifierWithMetadata);if(null===t||\"EXTERNAL\"!=t.name)return null;i.Whitespace();var e=i.Expect(i.IdentifierWithMetadata,\"name of external function\")||new xt(\"\");i.Whitespace();var n=i.Expect(i.BracketedKnotDeclArguments,\"declaration of arguments for EXTERNAL, even if empty, i.e. 'EXTERNAL \".concat(e,\"()'\"));null===n&&(n=[]);var r=n.map((function(t){var e;return null===(e=t.identifier)||void 0===e?void 0:e.name})).filter(N);return new Zt(e,r)},i._identifierCharSet=null,i.LogicLine=function(){if(i.Whitespace(),null===i.ParseString(\"~\"))return null;i.Whitespace();var t=i.Expect((function(){return i.OneOf([i.ReturnStatement,i.TempDeclarationOrAssignment,i.Expression])}),\"expression after '~'\",i.SkipToNextLine);if(null===t)return new It;t instanceof nt&&!(t instanceof Rt||t instanceof re)&&i.Error(\"Logic following a '~' can't be that type of expression. It can only be something like:\\n\\t~ return\\n\\t~ var x = blah\\n\\t~ x++\\n\\t~ myFunction()\");var e=k(t,Rt);return e&&(e.shouldPopReturnedValue=!0),null!==t.Find(Rt)()&&(t=new It(t,new Et(\"\\n\"))),i.Expect(i.EndOfLine,\"end of line\",i.SkipToNextLine),t},i.VariableDeclaration=function(){if(i.Whitespace(),\"VAR\"!==i.Parse(i.Identifier))return null;i.Whitespace();var t=i.Expect(i.IdentifierWithMetadata,\"variable name\");i.Whitespace(),i.Expect(i.String(\"=\"),\"the '=' for an assignment of a value, e.g. '= 5' (initial values are mandatory)\"),i.Whitespace();var e=i.Expect(i.Expression,\"initial value for \");if(e){if(e instanceof at||e instanceof ke||e instanceof Vt||e instanceof Ft||e instanceof se||i.Error(\"initial value for a variable must be a number, constant, list or divert target\"),null!==i.Parse(i.ListElementDefinitionSeparator))i.Error(\"Unexpected ','. If you're trying to declare a new list, use the LIST keyword, not VAR\");else if(e instanceof ke){e.isSingleString||i.Error(\"Constant strings cannot contain any logic.\")}return new Jt({assignedExpression:e,isGlobalDeclaration:!0,variableIdentifier:t})}return null},i.ListDeclaration=function(){if(i.Whitespace(),\"LIST\"!=i.Parse(i.Identifier))return null;i.Whitespace();var t=i.Expect(i.IdentifierWithMetadata,\"list name\");i.Whitespace(),i.Expect(i.String(\"=\"),\"the '=' for an assignment of the list definition\"),i.Whitespace();var e=i.Expect(i.ListDefinition,\"list item names\");return e?(e.identifier=new xt(t.name),new Jt({variableIdentifier:t,listDef:e})):null},i.ListDefinition=function(){i.AnyWhitespace();var t=i.SeparatedList(i.ListElementDefinition,i.ListElementDefinitionSeparator);return null===t?null:new Ht(t)},i.ListElementDefinitionSeparator=function(){return i.AnyWhitespace(),null===i.ParseString(\",\")?null:(i.AnyWhitespace(),\",\")},i.ListElementDefinition=function(){var t=null!==i.ParseString(\"(\"),e=t;i.Whitespace();var n=i.Parse(i.IdentifierWithMetadata);if(null===n)return null;i.Whitespace(),t&&null!=i.ParseString(\")\")&&(e=!1,i.Whitespace());var r=null;if(null!==i.ParseString(\"=\")){i.Whitespace();var a=i.Expect(i.ExpressionInt,\"value to be assigned to list item\");null!==a&&(r=a.value),e&&(i.Whitespace(),null!==i.ParseString(\")\")&&(e=!1))}return e&&i.Error(\"Expected closing ')'\"),new le(n,t,r)},i.ConstDeclaration=function(){if(i.Whitespace(),\"CONST\"!==i.Parse(i.Identifier))return null;i.Whitespace();var t=i.Expect(i.IdentifierWithMetadata,\"constant name\");i.Whitespace(),i.Expect(i.String(\"=\"),\"the '=' for an assignment of a value, e.g. '= 5' (initial values are mandatory)\"),i.Whitespace();var e=i.Expect(i.Expression,\"initial value for \");if(e instanceof at||e instanceof Vt||e instanceof ke){if(e instanceof ke){e.isSingleString||i.Error(\"Constant strings cannot contain any logic.\")}}else i.Error(\"initial value for a constant must be a number or divert target\");return new kt(t,e)},i.InlineLogicOrGlue=function(){return i.OneOf([i.InlineLogic,i.Glue])},i.Glue=function(){return null!==i.ParseString(\"<>\")?new ee(new ne):null},i.InlineLogic=function(){if(null===i.ParseString(\"{\"))return null;i.Whitespace();var t=i.Expect(i.InnerLogic,\"some kind of logic, conditional or sequence within braces: { ... }\");if(null===t)return null;i.DisallowIncrement(t);var e=k(t,It);return e||(e=new It(t)),i.Whitespace(),i.Expect(i.String(\"}\"),\"closing brace '}' for inline logic\"),e},i.InnerLogic=function(){i.Whitespace();var t=i.ParseObject(i.SequenceTypeAnnotation);if(null!==t){var e=i.Expect(i.InnerSequenceObjects,\"sequence elements (for cycle/stoping etc)\");return null===e?null:new qt(e,t)}var n=i.Parse(i.ConditionExpression);if(n)return i.Expect((function(){return i.InnerConditionalContent(n)}),\"conditional content following query\");for(var r=0,a=[i.InnerConditionalContent,i.InnerSequence,i.InnerExpression];r<a.length;r++){var o=a[r],s=i.BeginRule(),l=i.ParseObject(o);if(l){if(null!==i.Peek(i.Spaced(i.String(\"}\"))))return i.SucceedRule(s,l);i.FailRule(s)}else i.FailRule(s)}return null},i.InnerExpression=function(){var t=i.Parse(i.Expression);return t&&(t.outputWhenComplete=!0),t},i.IdentifierWithMetadata=function(){var t=i.Identifier();return null===t?null:new xt(t)},i.Identifier=function(){var t=i.ParseCharactersFromCharSet(i.identifierCharSet);if(null===t)return null;var e,n=!0,r=S(t);try{for(r.s();!(e=r.n()).done;){var a=e.value;if(!(a>=\"0\"&&a<=\"9\")){n=!1;break}}}catch(t){r.e(t)}finally{r.f()}return n?null:t},i._sequenceTypeSymbols=new lt(\"!&~$\"),i.InnerSequence=function(){i.Whitespace();var t=Dt.Stopping,e=i.Parse(i.SequenceTypeAnnotation);null!==e&&(t=e);var n=i.Parse(i.InnerSequenceObjects);return null===n||n.length<=1?null:new qt(n,t)},i.SequenceTypeAnnotation=function(){var t=i.Parse(i.SequenceTypeSymbolAnnotation);if(null===t&&(t=i.Parse(i.SequenceTypeWordAnnotation)),null===t)return null;switch(t){case Dt.Once:case Dt.Cycle:case Dt.Stopping:case Dt.Shuffle:case Dt.Shuffle|Dt.Stopping:case Dt.Shuffle|Dt.Once:break;default:return i.Error(\"Sequence type combination not supported: \".concat(t)),Dt.Stopping}return t},i.SequenceTypeSymbolAnnotation=function(){null===i._sequenceTypeSymbols&&(i._sequenceTypeSymbols=new lt(\"!&~$ \"));var t=0,e=i.ParseCharactersFromCharSet(i._sequenceTypeSymbols);if(null===e)return null;var n,r=S(e);try{for(r.s();!(n=r.n()).done;){switch(n.value){case\"!\":t|=Dt.Once;break;case\"&\":t|=Dt.Cycle;break;case\"~\":t|=Dt.Shuffle;break;case\"$\":t|=Dt.Stopping}}}catch(t){r.e(t)}finally{r.f()}return 0===t?null:t},i.SequenceTypeWordAnnotation=function(){var t=i.Interleave(i.SequenceTypeSingleWord,i.Exclude(i.Whitespace));if(null===t||0===t.length)return null;if(null===i.ParseString(\":\"))return null;var e,n=0,r=S(t);try{for(r.s();!(e=r.n()).done;){n|=e.value}}catch(t){r.e(t)}finally{r.f()}return n},i.SequenceTypeSingleWord=function(){var t=null,e=i.Parse(i.IdentifierWithMetadata);if(null!==e)switch(e.name){case\"once\":t=Dt.Once;break;case\"cycle\":t=Dt.Cycle;break;case\"shuffle\":t=Dt.Shuffle;break;case\"stopping\":t=Dt.Stopping}return null===t?null:t},i.InnerSequenceObjects=function(){return null!==i.Parse(i.Newline)?i.Parse(i.InnerMultilineSequenceObjects):i.Parse(i.InnerInlineSequenceObjects)},i.InnerInlineSequenceObjects=function(){var t=i.Interleave(i.Optional(i.MixedTextAndLogic),i.String(\"|\"),null,!1);if(null===t)return null;var e,n=[],r=!1,a=S(t);try{for(a.s();!(e=a.n()).done;){var o=e.value;if(\"|\"===o)r||n.push(new It),r=!1;else{var s=o;null===s?i.Error(\"Expected content, but got \".concat(o,\" (this is an ink compiler bug!)\")):n.push(new It(s)),r=!0}}}catch(t){a.e(t)}finally{a.f()}return r||n.push(new It),n},i.InnerMultilineSequenceObjects=function(){i.MultilineWhitespace();var t=i.OneOrMore(i.SingleMultilineSequenceElement);return null===t?null:t},i.SingleMultilineSequenceElement=function(){if(i.Whitespace(),null!==i.ParseString(\"->\"))return null;if(null===i.ParseString(\"-\"))return null;i.Whitespace();var t=i.StatementsAtLevel(Xt.InnerBlock);return null===t?i.MultilineWhitespace():t.unshift(new Et(\"\\n\")),new It(t)},i._statementRulesAtLevel=[],i._statementBreakRulesAtLevel=[],i.StatementsAtLevel=function(t){t===Xt.InnerBlock&&(null!==i.Parse(i.GatherDashes)&&i.Error(\"You can't use a gather (the dashes) within the { curly braces } context. For multi-line sequences and conditions, you should only use one dash.\"));return i.Interleave(i.Optional(i.MultilineWhitespace),(function(){return i.StatementAtLevel(t)}),(function(){return i.StatementsBreakForLevel(t)}))},i.StatementAtLevel=function(t){var e=i._statementRulesAtLevel[t],n=i.OneOf(e);return t===Xt.Top&&n instanceof Pt&&i.Error(\"should not have return statement outside of a knot\"),n},i.StatementsBreakForLevel=function(t){i.Whitespace();var e=i._statementBreakRulesAtLevel[t],n=i.OneOf(e);return null===n?null:n},i.GenerateStatementLevelRules=function(){var t=Object.values(Xt);i._statementRulesAtLevel=\"f\".repeat(t.length).split(\"f\").map((function(){return[]})),i._statementBreakRulesAtLevel=\"f\".repeat(t.length).split(\"f\").map((function(){return[]}));for(var e=0,n=t;e<n.length;e++){var r=n[e],a=[],o=[];a.push(i.Line(i.MultiDivert)),r>=Xt.Top&&a.push(i.KnotDefinition),a.push(i.Line(i.Choice)),a.push(i.Line(i.AuthorWarning)),r>Xt.InnerBlock&&a.push(i.Gather),r>=Xt.Knot&&a.push(i.StitchDefinition),a.push(i.Line(i.ListDeclaration)),a.push(i.Line(i.VariableDeclaration)),a.push(i.Line(i.ConstDeclaration)),a.push(i.Line(i.ExternalDeclaration)),a.push(i.Line(i.IncludeStatement)),a.push(i.LogicLine),a.push(i.LineOfMixedTextAndLogic),r<=Xt.Knot&&o.push(i.KnotDeclaration),r<=Xt.Stitch&&o.push(i.StitchDeclaration),r<=Xt.InnerBlock&&(o.push(i.ParseDashNotArrow),o.push(i.String(\"}\"))),i._statementRulesAtLevel[r]=a,i._statementBreakRulesAtLevel[r]=o}},i.SkipToNextLine=function(){return i.ParseUntilCharactersFromString(\"\\n\\r\"),i.ParseNewline(),Ct},i.Line=function(t){return function(){var e=i.ParseObject(t);return null===e?null:(i.Expect(i.EndOfLine,\"end of line\",i.SkipToNextLine),e)}},i._endOfTagCharSet=new lt(\"#\\n\\r\\\\\"),i.Tag=function(){if(i.Whitespace(),null===i.ParseString(\"#\"))return null;i.Whitespace();for(var t=\"\";;){if(t+=i.ParseUntilCharactersFromCharSet(i._endOfTagCharSet)||\"\",null===i.ParseString(\"\\\\\"))break;var e=i.ParseSingleCharacter();\"\\0\"!==e&&(t+=e)}var n=t.trim();return new Ae(new ce(n))},i.Tags=function(){var t=i.OneOrMore(i.Tag);return null===t?null:t},i._inlineWhitespaceChars=new lt(\" \\t\"),i.EndOfLine=function(){return i.OneOf([i.Newline,i.EndOfFile])},i.Newline=function(){return i.Whitespace(),null!==i.ParseNewline()?Ct:null},i.EndOfFile=function(){return i.Whitespace(),i.endOfInput?Ct:null},i.MultilineWhitespace=function(){var t=i.OneOrMore(i.Newline);return null===t?null:t.length>=1?Ct:null},i.Whitespace=function(){return null!==i.ParseCharactersFromCharSet(i._inlineWhitespaceChars)?Ct:null},i.Spaced=function(t){return function(){i.Whitespace();var e=i.ParseObject(t);return null===e?null:(i.Whitespace(),e)}},i.AnyWhitespace=function(){for(var t=!1;null!==i.OneOf([i.Whitespace,i.MultilineWhitespace]);)t=!0;return t?Ct:null},i.MultiSpaced=function(t){return function(){i.AnyWhitespace();var e=i.ParseObject(t);return null===e?null:(i.AnyWhitespace(),e)}},i.RegisterExpressionOperators(),i.GenerateStatementLevelRules(),i.errorHandler=i.OnStringParserError,null===l){if(i._rootParser=h(i),i._openFilenames=[],null!==i._filename){var c=i.fileHandler.ResolveInkFilename(i._filename);i._openFilenames.push(c)}}else i._rootParser=l;return i}return i(o,[{key:\"fileHandler\",get:function(){if(!this._fileHandler)throw new Error(\"No FileHandler defined\");return this._fileHandler},set:function(t){this._fileHandler=t}},{key:\"PreProcessInputString\",value:function(t){return new wt(t).Process()}},{key:\"parsingStringExpression\",get:function(){return this.GetFlag(Number(Gt.ParsingString))},set:function(t){this.SetFlag(Number(Gt.ParsingString),t)}},{key:\"identifierCharSet\",get:function(){return null===this._identifierCharSet&&((this._identifierCharSet=new lt).AddRange(\"A\",\"Z\").AddRange(\"a\",\"z\").AddRange(\"0\",\"9\").Add(\"_\"),this.ExtendIdentifierCharacterRanges(this._identifierCharSet)),this._identifierCharSet}}]),o}(St);Te.LatinBasic=ut.Define(\"A\",\"z\",(new lt).AddRange(\"[\",\"`\")),Te.LatinExtendedA=ut.Define(\"Ä\",\"Å¿\"),Te.LatinExtendedB=ut.Define(\"Æ\",\"É\"),Te.Greek=ut.Define(\"Í°\",\"Ï¿\",(new lt).AddRange(\"Í¸\",\"Î\").AddCharacters(\"Í´ÍµÍ¸ÎÎÎÎ¢\")),Te.Cyrillic=ut.Define(\"Ð\",\"Ó¿\",(new lt).AddRange(\"Ò\",\"Ò\")),Te.Armenian=ut.Define(\"Ô°\",\"Ö\",(new lt).AddCharacters(\"Ô°\").AddRange(\"Õ\",\"Õ \").AddRange(\"Ö\",\"Ö\")),Te.Hebrew=ut.Define(\"Ö\",\"×¿\",new lt),Te.Arabic=ut.Define(\"Ø\",\"Û¿\",new lt),Te.Korean=ut.Define(\"ê°\",\"í¯\",new lt),Te.ListAllCharacterRanges=function(){return[Te.LatinBasic,Te.LatinExtendedA,Te.LatinExtendedB,Te.Arabic,Te.Armenian,Te.Cyrillic,Te.Greek,Te.Hebrew,Te.Korean]};var Pe=function(){function t(e){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n(this,t),this._errors=[],this._warnings=[],this._authorMessages=[],this._parsedStory=null,this._runtimeStory=null,this._parser=null,this._debugSourceRanges=[],this.Compile=function(){return r._parser=new Te(r.inputString,r.options.sourceFilename||null,r.OnError,null,r.options.fileHandler),r._parsedStory=r.parser.ParseStory(),0===r.errors.length?(r.parsedStory.countAllVisits=r.options.countAllVisits,r._runtimeStory=r.parsedStory.ExportRuntime(r.OnError)):r._runtimeStory=null,r.runtimeStory},this.RetrieveDebugSourceForLatestContent=function(){var t,e,n=S(r.runtimeStory.state.outputStream);try{for(n.s();!(e=n.n()).done;){var i=k(e.value,$);if(null!==i){var a=new _((null===(t=i.value)||void 0===t?void 0:t.length)||0,i.debugMetadata,i.value||\"unknown\");r.debugSourceRanges.push(a)}}}catch(t){n.e(t)}finally{n.f()}},this.DebugMetadataForContentAtOffset=function(t){var e,n=0,i=null,a=S(r.debugSourceRanges);try{for(a.s();!(e=a.n()).done;){var o=e.value;if(null!==o.debugMetadata&&(i=o.debugMetadata),t>=n&&t<n+o.length)return i;n+=o.length}}catch(t){a.e(t)}finally{a.f()}return null},this.OnError=function(t,e){switch(e){case b.Author:r._authorMessages.push(t);break;case b.Warning:r._warnings.push(t);break;case b.Error:r._errors.push(t)}null!==r.options.errorHandler&&r.options.errorHandler(t,e)},this._inputString=e,this._options=i||new w}return i(t,[{key:\"errors\",get:function(){return this._errors}},{key:\"warnings\",get:function(){return this._warnings}},{key:\"authorMessages\",get:function(){return this._authorMessages}},{key:\"inputString\",get:function(){return this._inputString}},{key:\"options\",get:function(){return this._options}},{key:\"parsedStory\",get:function(){if(!this._parsedStory)throw new Error;return this._parsedStory}},{key:\"runtimeStory\",get:function(){if(!this._runtimeStory)throw new Error(\"Compilation failed.\");return this._runtimeStory}},{key:\"parser\",get:function(){if(!this._parser)throw new Error;return this._parser}},{key:\"debugSourceRanges\",get:function(){return this._debugSourceRanges}}]),t}();t.Compiler=Pe,t.CompilerOptions=w,t.InkList=B,Object.defineProperty(t,\"__esModule\",{value:!0})}));\n//# sourceMappingURL=ink-full.js.map\n"},"runtime/style.css":{"name":"runtime/style.css","content":"\n/*\n\nThis file is based on Inky's \"style.css\" standard web template file.\n\nInky is released under the MIT license: https://github.com/inkle/inky\n\nI release all changes under the same license.\n\n*/\n\n@import url('https://fonts.googleapis.com/css?family=Open+Sans:300,700|Quattrocento:700');\n\nbody {\n    font-family: 'Open Sans', sans-serif;\n    font-weight: lighter;\n    background: white;\n    overflow: hidden;\n}\n\nbody.switched {\n    transition: color 0.6s, background-color 0.6s;\n}\n\nh1,\nh2 {\n    text-align: center;\n    font-family: \"Quattrocento\", Georgia, 'Times New Roman', Times, serif;\n    margin: 0;\n    padding: 0;\n}\n\nh1 {\n    font-size: 30pt;\n    margin-bottom: 10px;\n}\n\nh2 {\n    font-size: 14pt;\n    font-style: italic;\n    font-family: sans-serif;\n    font-weight: lighter;\n    color: #BBB;\n}\n\n.header {\n    padding-top: 3em;\n    padding-bottom: 3em;\n}\n\n/*\n  Built-in class:\n    # author: Name\n*/\n.byline {\n    font-style: italic;\n}\n\n\n/* \n  Enables <iframe> support work on itch.io when using mobile iOS\n*/\n.outerContainer {\n    position: absolute;\n    display: block;\n    margin: 0;\n    padding: 0;\n    -webkit-overflow-scrolling: touch;\n    overflow: scroll;\n    overflow-x: hidden;\n    height: 100%;\n    width: 100%;\n    top: 0;\n    left: 0;\n    margin-top: 24px;\n    background-size: cover;\n    background-repeat: no-repeat;\n}\n\n@media screen and (max-width: 980px) {\n    .outerContainer {\n        margin-top: 44px;\n        background-size: cover;\n        background-repeat: no-repeat;\n    }\n}\n\n.container {\n    display: block;\n    max-width: 600px;\n    margin: 0 auto;\n    padding: 20px;\n    padding-top: 4em;\n    background: white;\n}\n\n.switched .container {\n    transition: background-color 0.6s;\n}\n\np {\n    font-size: 13pt;\n    color: #888;\n    line-height: 1.7em;\n    font-weight: lighter;\n}\n\na {\n    font-weight: 700;\n    color: #b97c2c;\n    font-family: sans-serif;\n    transition: color 0.6s;\n    text-decoration: none;\n}\n\na:hover {\n    color: black;\n    transition: color 0.1s;\n}\n\nstrong {\n    color: black;\n    font-weight: bold;\n}\n\nimg {\n    display: block;\n    margin: 0 auto;\n    max-width: 100%;\n}\n\n.container .hide {\n    opacity: 0.0;\n}\n\n.container .invisible {\n    display: none;\n}\n\n.container>* {\n    opacity: 1.0;\n    transition: opacity 1.0s;\n}\n\n/*\n  Class applied to all choices\n  (Will always appear inside <p> element by default.)\n*/\n.choice {\n    text-align: center;\n    line-height: 1.7em;\n}\n\n/* \n  Class applied to first choice\n*/\n:not(.choice)+.choice {\n    padding-top: 1em;\n}\n\n/*\n  Class applied to choice links\n*/\n.choice a {\n    font-size: 15pt;\n}\n\n/* \n  Built-in class:\n    The End # CLASS: end\n*/\n.end {\n    text-align: center;\n    font-weight: bold;\n    color: black;\n    padding-top: 20px;\n    padding-bottom: 20px;\n}\n\n#controls {\n    z-index: 4;\n    font-size: 9pt;\n    text-align: center;\n    padding-bottom: 6px;\n    position: fixed;\n    right: 14px;\n    top: 4px;\n    user-select: none;\n    background: white;\n    transition: color 0.6s, background 0.6s;\n}\n\n#controls [disabled] {\n    color: #ccc;\n}\n\n\n@media screen and (max-width: 980px) {\n    #controls {\n        z-index: 2;\n        padding-top: 24px;\n        top : 0;\n        left: 0;\n        right: 0;\n    }\n}\n\n/* \n  Dark Theme (Added in Inky 0.10.0)\n    # theme: dark\n*/\n\nbody.dark {\n    background: black;\n    color: white;\n}\n\n.dark h2 {\n    color: #666;\n}\n\n.dark .container {\n    background: black;\n}\n\n.dark .written-in-ink {\n    background: black;\n}\n\n.dark a {\n    color: #cc8f1a;\n    transition: color 0.6s;\n}\n\n.dark a:hover {\n    color: white;\n}\n\n.dark strong {\n    color: white;\n}\n\n.dark #controls [disabled] {\n    color: #444;\n}\n\n.dark .end {\n    color: white;\n}\n\n.dark #controls {\n    background: black;\n}\n\n\n.engine-error-text {\n    font-family: sans-serif;\n    color: red;\n}\n\n#error-notifier {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    background: rgb(250, 191, 191, 0.9);\n    font-family: sans-serif;\n    padding: 16px;\n    font-size: 16px;\n    z-index: 9000;\n    display: none;\n    border-radius: 8px;\n}\n\n.error-notifier-p {\n    color: black;\n}\n\na {\n    cursor: pointer;\n}\n\n.about-box {\n    position: absolute;\n    z-index: 9000;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    overflow: hidden;\n    background: rgba(255, 255, 255, 1);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.about-box-inner {\n    color: #000;\n    text-align: center;\n}\n\n#story {\n    padding-bottom: 100px;\n}"},"runtime/jquery-3.6.0.min.js":{"name":"runtime/jquery-3.6.0.min.js","content":"/*! jQuery v3.6.0 | (c) OpenJS Foundation and other contributors | jquery.org/license */\n!function(e,t){\"use strict\";\"object\"==typeof module&&\"object\"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error(\"jQuery requires a window with a document\");return t(e)}:t(e)}(\"undefined\"!=typeof window?window:this,function(C,e){\"use strict\";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return\"function\"==typeof e&&\"number\"!=typeof e.nodeType&&\"function\"!=typeof e.item},x=function(e){return null!=e&&e===e.window},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement(\"script\");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+\"\":\"object\"==typeof e||\"function\"==typeof e?n[o.call(e)]||\"object\":typeof e}var f=\"3.6.0\",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&\"length\"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&(\"array\"===n||0===t||\"number\"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:f,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for(\"boolean\"==typeof a&&(l=a,a=arguments[s]||{},s++),\"object\"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],\"__proto__\"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||S.isPlainObject(n)?n:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:\"jQuery\"+(f+Math.random()).replace(/\\D/g,\"\"),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||\"[object Object]\"!==o.call(e))&&(!(t=r(e))||\"function\"==typeof(n=v.call(t,\"constructor\")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?S.merge(n,\"string\"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),\"function\"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each(\"Boolean Number String Function Array Date RegExp Object Error Symbol\".split(\" \"),function(e,t){n[\"[object \"+t+\"]\"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S=\"sizzle\"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R=\"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",M=\"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",I=\"(?:\\\\\\\\[\\\\da-fA-F]{1,6}\"+M+\"?|\\\\\\\\[^\\\\r\\\\n\\\\f]|[\\\\w-]|[^\\0-\\\\x7f])+\",W=\"\\\\[\"+M+\"*(\"+I+\")(?:\"+M+\"*([*^$|!~]?=)\"+M+\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\"+I+\"))|)\"+M+\"*\\\\]\",F=\":(\"+I+\")(?:\\\\((('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\"+W+\")*)|.*)\\\\)|)\",B=new RegExp(M+\"+\",\"g\"),$=new RegExp(\"^\"+M+\"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\"+M+\"+$\",\"g\"),_=new RegExp(\"^\"+M+\"*,\"+M+\"*\"),z=new RegExp(\"^\"+M+\"*([>+~]|\"+M+\")\"+M+\"*\"),U=new RegExp(M+\"|>\"),X=new RegExp(F),V=new RegExp(\"^\"+I+\"$\"),G={ID:new RegExp(\"^#(\"+I+\")\"),CLASS:new RegExp(\"^\\\\.(\"+I+\")\"),TAG:new RegExp(\"^(\"+I+\"|[*])\"),ATTR:new RegExp(\"^\"+W),PSEUDO:new RegExp(\"^\"+F),CHILD:new RegExp(\"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\"+M+\"*(even|odd|(([+-]|)(\\\\d*)n|)\"+M+\"*(?:([+-]|)\"+M+\"*(\\\\d+)|))\"+M+\"*\\\\)|)\",\"i\"),bool:new RegExp(\"^(?:\"+R+\")$\",\"i\"),needsContext:new RegExp(\"^\"+M+\"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\"+M+\"*((?:-\\\\d)?\\\\d*)\"+M+\"*\\\\)|)(?=[^-]|$)\",\"i\")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\\d$/i,K=/^[^{]+\\{\\s*\\[native \\w/,Z=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,ee=/[+~]/,te=new RegExp(\"\\\\\\\\[\\\\da-fA-F]{1,6}\"+M+\"?|\\\\\\\\([^\\\\r\\\\n\\\\f])\",\"g\"),ne=function(e,t){var n=\"0x\"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\0-\\x1f\\x7f-\\uFFFF\\w-]/g,ie=function(e,t){return t?\"\\0\"===e?\"\\ufffd\":e.slice(0,-1)+\"\\\\\"+e.charCodeAt(e.length-1).toString(16)+\" \":\"\\\\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&\"fieldset\"===e.nodeName.toLowerCase()},{dir:\"parentNode\",next:\"legend\"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],\"string\"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+\" \"]&&(!v||!v.test(t))&&(1!==p||\"object\"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute(\"id\"))?s=s.replace(re,ie):e.setAttribute(\"id\",s=S)),o=(l=h(t)).length;while(o--)l[o]=(s?\"#\"+s:\":scope\")+\" \"+xe(l[o]);c=l.join(\",\")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute(\"id\")}}}return g(t.replace($,\"$1\"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+\" \")>b.cacheLength&&delete e[r.shift()],e[t+\" \"]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement(\"fieldset\");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split(\"|\"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return\"input\"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return(\"input\"===t||\"button\"===t)&&e.type===n}}function ge(t){return function(e){return\"form\"in e?e.parentNode&&!1===e.disabled?\"label\"in e?\"label\"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:\"label\"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&\"undefined\"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||\"HTML\")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener(\"unload\",oe,!1):n.attachEvent&&n.attachEvent(\"onunload\",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement(\"div\")),\"undefined\"!=typeof e.querySelectorAll&&!e.querySelectorAll(\":scope fieldset div\").length}),d.attributes=ce(function(e){return e.className=\"i\",!e.getAttribute(\"className\")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment(\"\")),!e.getElementsByTagName(\"*\").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute(\"id\")===t}},b.find.ID=function(e,t){if(\"undefined\"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t=\"undefined\"!=typeof e.getAttributeNode&&e.getAttributeNode(\"id\");return t&&t.value===n}},b.find.ID=function(e,t){if(\"undefined\"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode(\"id\"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode(\"id\"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return\"undefined\"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if(\"*\"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if(\"undefined\"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML=\"<a id='\"+S+\"'></a><select id='\"+S+\"-\\r\\\\' msallowcapture=''><option selected=''></option></select>\",e.querySelectorAll(\"[msallowcapture^='']\").length&&v.push(\"[*^$]=\"+M+\"*(?:''|\\\"\\\")\"),e.querySelectorAll(\"[selected]\").length||v.push(\"\\\\[\"+M+\"*(?:value|\"+R+\")\"),e.querySelectorAll(\"[id~=\"+S+\"-]\").length||v.push(\"~=\"),(t=C.createElement(\"input\")).setAttribute(\"name\",\"\"),e.appendChild(t),e.querySelectorAll(\"[name='']\").length||v.push(\"\\\\[\"+M+\"*name\"+M+\"*=\"+M+\"*(?:''|\\\"\\\")\"),e.querySelectorAll(\":checked\").length||v.push(\":checked\"),e.querySelectorAll(\"a#\"+S+\"+*\").length||v.push(\".#.+[+~]\"),e.querySelectorAll(\"\\\\\\f\"),v.push(\"[\\\\r\\\\n\\\\f]\")}),ce(function(e){e.innerHTML=\"<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>\";var t=C.createElement(\"input\");t.setAttribute(\"type\",\"hidden\"),e.appendChild(t).setAttribute(\"name\",\"D\"),e.querySelectorAll(\"[name=d]\").length&&v.push(\"name\"+M+\"*[*^$|!~]?=\"),2!==e.querySelectorAll(\":enabled\").length&&v.push(\":enabled\",\":disabled\"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(\":disabled\").length&&v.push(\":enabled\",\":disabled\"),e.querySelectorAll(\"*,:x\"),v.push(\",.*:\")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,\"*\"),c.call(e,\"[s!='']:x\"),s.push(\"!=\",F)}),v=v.length&&new RegExp(v.join(\"|\")),s=s.length&&new RegExp(s.join(\"|\")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+\" \"]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+\"\").replace(re,ie)},se.error=function(e){throw new Error(\"Syntax error, unrecognized expression: \"+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n=\"\",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if(\"string\"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{\">\":{dir:\"parentNode\",first:!0},\" \":{dir:\"parentNode\"},\"+\":{dir:\"previousSibling\",first:!0},\"~\":{dir:\"previousSibling\"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||\"\").replace(te,ne),\"~=\"===e[2]&&(e[3]=\" \"+e[3]+\" \"),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),\"nth\"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(\"even\"===e[3]||\"odd\"===e[3])),e[5]=+(e[7]+e[8]||\"odd\"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||\"\":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(\")\",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return\"*\"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+\" \"];return t||(t=new RegExp(\"(^|\"+M+\")\"+e+\"(\"+M+\"|$)\"))&&m(e,function(e){return t.test(\"string\"==typeof e.className&&e.className||\"undefined\"!=typeof e.getAttribute&&e.getAttribute(\"class\")||\"\")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?\"!=\"===r:!r||(t+=\"\",\"=\"===r?t===i:\"!=\"===r?t!==i:\"^=\"===r?i&&0===t.indexOf(i):\"*=\"===r?i&&-1<t.indexOf(i):\"$=\"===r?i&&t.slice(-i.length)===i:\"~=\"===r?-1<(\" \"+t.replace(B,\" \")+\" \").indexOf(i):\"|=\"===r&&(t===i||t.slice(0,i.length+1)===i+\"-\"))}},CHILD:function(h,e,t,g,v){var y=\"nth\"!==h.slice(0,3),m=\"last\"!==h.slice(-4),x=\"of-type\"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?\"nextSibling\":\"previousSibling\",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l=\"only\"===h&&!u&&\"nextSibling\"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error(\"unsupported pseudo: \"+e);return a[S]?a(o):1<a.length?(t=[e,e,\"\",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,\"$1\"));return s[S]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||\"\")||se.error(\"unsupported lang: \"+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute(\"xml:lang\")||e.getAttribute(\"lang\"))return(t=t.toLowerCase())===n||0===t.indexOf(n+\"-\")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return\"input\"===t&&!!e.checked||\"option\"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return\"input\"===t&&\"button\"===e.type||\"button\"===t},text:function(e){var t;return\"input\"===e.nodeName.toLowerCase()&&\"text\"===e.type&&(null==(t=e.getAttribute(\"type\"))||\"text\"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r=\"\";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&\"parentNode\"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||\"*\",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[\" \"],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:\" \"===e[s-2].type?\"*\":\"\"})).replace($,\"$1\"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+\" \"];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($,\" \")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+\" \"];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[S]?i.push(a):o.push(a);(a=A(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l=\"0\",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG(\"*\",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l=\"function\"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&\"ID\"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split(\"\").sort(j).join(\"\")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement(\"fieldset\"))}),ce(function(e){return e.innerHTML=\"<a href='#'></a>\",\"#\"===e.firstChild.getAttribute(\"href\")})||fe(\"type|href|height|width\",function(e,t,n){if(!n)return e.getAttribute(t,\"type\"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML=\"<input/>\",e.firstChild.setAttribute(\"value\",\"\"),\"\"===e.firstChild.getAttribute(\"value\")})||fe(\"value\",function(e,t,n){if(!n&&\"input\"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute(\"disabled\")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);S.find=d,S.expr=d.selectors,S.expr[\":\"]=S.expr.pseudos,S.uniqueSort=S.unique=d.uniqueSort,S.text=d.getText,S.isXMLDoc=d.isXML,S.contains=d.contains,S.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\\/\\0>:\\x20\\t\\r\\n\\f]*)[\\x20\\t\\r\\n\\f]*\\/?>(?:<\\/\\1>|)$/i;function j(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):\"string\"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=\":not(\"+e+\")\"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if(\"string\"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,\"string\"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var D,q=/^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]+))$/;(S.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,\"string\"==typeof e){if(!(r=\"<\"===e[0]&&\">\"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,D=S(E);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a=\"string\"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?\"string\"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,\"parentNode\")},parentsUntil:function(e,t,n){return h(e,\"parentNode\",n)},next:function(e){return O(e,\"nextSibling\")},prev:function(e){return O(e,\"previousSibling\")},nextAll:function(e){return h(e,\"nextSibling\")},prevAll:function(e){return h(e,\"previousSibling\")},nextUntil:function(e,t,n){return h(e,\"nextSibling\",n)},prevUntil:function(e,t,n){return h(e,\"previousSibling\",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,\"template\")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return\"Until\"!==r.slice(-5)&&(t=e),t&&\"string\"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\\x20\\t\\r\\n\\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r=\"string\"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:\"\")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&\"string\"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){var n;while(-1<(n=S.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t=\"\",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=\"\"),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[[\"notify\",\"progress\",S.Callbacks(\"memory\"),S.Callbacks(\"memory\"),2],[\"resolve\",\"done\",S.Callbacks(\"once memory\"),S.Callbacks(\"once memory\"),0,\"resolved\"],[\"reject\",\"fail\",S.Callbacks(\"once memory\"),S.Callbacks(\"once memory\"),1,\"rejected\"]],i=\"pending\",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},\"catch\":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+\"With\"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError(\"Thenable self-resolution\");t=e&&(\"object\"==typeof e||\"function\"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+\"With\"](this===s?void 0:this,arguments),this},s[t[0]+\"With\"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),\"pending\"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn(\"jQuery.Deferred exception: \"+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener(\"DOMContentLoaded\",B),C.removeEventListener(\"load\",B),S.ready()}S.fn.ready=function(e){return F.then(e)[\"catch\"](function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,\"complete\"===E.readyState||\"loading\"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener(\"DOMContentLoaded\",B),C.addEventListener(\"load\",B));var $=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if(\"object\"===w(n))for(s in i=!0,n)$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(S(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,\"ms-\").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if(\"string\"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&\"string\"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||S.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r=\"data-\"+t.replace(K,\"-$&\").toLowerCase(),\"string\"==typeof(n=e.getAttribute(r))){try{n=\"true\"===(i=n)||\"false\"!==i&&(\"null\"===i?null:i===+i+\"\"?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,\"hasDataAttrs\"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf(\"data-\")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,\"hasDataAttrs\",!0)}return i}return\"object\"==typeof n?this.each(function(){Q.set(this,n)}):$(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return t=(t||\"fx\")+\"queue\",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||\"fx\";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);\"inprogress\"===i&&(i=n.shift(),r--),i&&(\"fx\"===t&&n.unshift(\"inprogress\"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+\"queueHooks\";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks(\"once memory\").add(function(){Y.remove(e,[t+\"queue\",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return\"string\"!=typeof t&&(n=t,t=\"fx\",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),\"fx\"===t&&\"inprogress\"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||\"fx\",[])},promise:function(e,t){var n,r=1,i=S.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};\"string\"!=typeof e&&(t=e,e=void 0),e=e||\"fx\";while(a--)(n=Y.get(o[a],e+\"queueHooks\"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,te=new RegExp(\"^(?:([+-])=|)(\"+ee+\")([a-z%]*)$\",\"i\"),ne=[\"Top\",\"Right\",\"Bottom\",\"Left\"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return\"none\"===(e=t||e).style.display||\"\"===e.style.display&&ie(e)&&\"none\"===S.css(e,\"display\")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,\"\")},u=s(),l=n&&n[3]||(S.cssNumber[t]?\"\":\"px\"),c=e.nodeType&&(S.cssNumber[t]||\"px\"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?(\"none\"===n&&(l[c]=Y.get(r,\"display\")||null,l[c]||(r.style.display=\"\")),\"\"===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,\"display\"),o.parentNode.removeChild(o),\"none\"===u&&(u=\"block\"),ue[s]=u)))):\"none\"!==n&&(l[c]=\"none\",Y.set(r,\"display\",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return\"boolean\"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\\/\\0>\\x20\\t\\r\\n\\f]*)/i,he=/^$|^module$|\\/(?:java|ecma)script/i;ce=E.createDocumentFragment().appendChild(E.createElement(\"div\")),(fe=E.createElement(\"input\")).setAttribute(\"type\",\"radio\"),fe.setAttribute(\"checked\",\"checked\"),fe.setAttribute(\"name\",\"t\"),ce.appendChild(fe),y.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML=\"<textarea>x</textarea>\",y.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML=\"<option></option>\",y.option=!!ce.lastChild;var ge={thead:[1,\"<table>\",\"</table>\"],col:[2,\"<table><colgroup>\",\"</colgroup></table>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],td:[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],_default:[0,\"\",\"\"]};function ve(e,t){var n;return n=\"undefined\"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||\"*\"):\"undefined\"!=typeof e.querySelectorAll?e.querySelectorAll(t||\"*\"):[],void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],\"globalEval\",!t||Y.get(t[n],\"globalEval\"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,\"<select multiple='multiple'>\",\"</select>\"]);var me=/<|&#?\\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if(\"object\"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement(\"div\")),s=(de.exec(o)||[\"\",\"\"])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=\"\"}else p.push(t.createTextNode(o));f.textContent=\"\",d=0;while(o=p[d++])if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),\"script\"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||\"\")&&n.push(o)}return f}var be=/^([^.]*)(?:\\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==(\"focus\"===t)}function Ee(e,t,n,r,i,o){var a,s;if(\"object\"==typeof t){for(s in\"string\"!=typeof n&&(r=r||n,n=void 0),t)Ee(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&(\"string\"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,we)}S.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return\"undefined\"!=typeof S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||\"\").match(P)||[\"\"]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||\"\").split(\".\").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(\".\")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){l=(t=(t||\"\").match(P)||[\"\"]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||\"\").split(\".\").sort(),d){f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp(\"(^|\\\\.)\"+h.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&(\"**\"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,\"handle events\")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=S.event.fix(e),l=(Y.get(this,\"events\")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=S.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!(\"click\"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&(\"click\"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+\" \"]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,\"input\")&&Se(t,\"click\",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,\"input\")&&Se(t,\"click\"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,\"input\")&&Y.get(t,\"click\")||A(t,\"a\")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,\"char\":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:\"focusin\",blur:\"focusout\"},function(e,t){S.event.special[e]={setup:function(){return Se(this,e,Ce),!1},trigger:function(){return Se(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:\"mouseover\",mouseleave:\"mouseout\",pointerenter:\"pointerover\",pointerleave:\"pointerout\"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return Ee(this,e,t,n,r)},one:function(e,t,n,r){return Ee(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+\".\"+r.namespace:r.origType,r.selector,r.handler),this;if(\"object\"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&\"function\"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){S.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\\s*(?:[^=]|=\\s*.checked.)/i,Ne=/^\\s*<!(?:\\[CDATA\\[|--)|(?:\\]\\]|--)>\\s*$/g;function je(e,t){return A(e,\"table\")&&A(11!==t.nodeType?t:t.firstChild,\"tr\")&&S(e).children(\"tbody\")[0]||e}function De(e){return e.type=(null!==e.getAttribute(\"type\"))+\"/\"+e.type,e}function qe(e){return\"true/\"===(e.type||\"\").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute(\"type\"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,\"handle events\"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=S.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&\"string\"==typeof d&&!y.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,\"script\"),De)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,\"script\"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||\"\")&&!Y.access(u,\"globalEval\")&&S.contains(l,u)&&(u.src&&\"module\"!==(u.type||\"\").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute(\"nonce\")},l):b(u.textContent.replace(Ne,\"\"),u,l))}return n}function Oe(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,\"script\")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,\"input\"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:\"input\"!==l&&\"textarea\"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ve(c,\"script\")).length&&ye(a,!f&&ve(e,\"script\")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return $(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent=\"\");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if(\"string\"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||[\"\",\"\"])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp(\"^(\"+ee+\")(?!px)[a-z%]+$\",\"i\"),Re=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Me=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ie=new RegExp(ne.join(\"|\"),\"i\");function We(e,t,n){var r,i,o,a,s=e.style;return(n=n||Re(e))&&(\"\"!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&Pe.test(a)&&Ie.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+\"\":a}function Fe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText=\"position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0\",l.style.cssText=\"position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%\",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n=\"1%\"!==e.top,s=12===t(e.marginLeft),l.style.right=\"60%\",o=36===t(e.right),r=36===t(e.width),l.style.position=\"absolute\",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement(\"div\"),l=E.createElement(\"div\");l.style&&(l.style.backgroundClip=\"content-box\",l.cloneNode(!0).style.backgroundClip=\"\",y.clearCloneStyle=\"content-box\"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=E.createElement(\"table\"),t=E.createElement(\"tr\"),n=E.createElement(\"div\"),e.style.cssText=\"position:absolute;left:-11111px;border-collapse:separate\",t.style.cssText=\"border:1px solid\",t.style.height=\"1px\",n.style.height=\"9px\",n.style.display=\"block\",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var Be=[\"Webkit\",\"Moz\",\"ms\"],$e=E.createElement(\"div\").style,_e={};function ze(e){var t=S.cssProps[e]||_e[e];return t||(e in $e?e:_e[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Be.length;while(n--)if((e=Be[n]+t)in $e)return e}(e)||e)}var Ue=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ve={position:\"absolute\",visibility:\"hidden\",display:\"block\"},Ge={letterSpacing:\"0\",fontWeight:\"400\"};function Ye(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||\"px\"):t}function Qe(e,t,n,r,i,o){var a=\"width\"===t?1:0,s=0,u=0;if(n===(r?\"border\":\"content\"))return 0;for(;a<4;a+=2)\"margin\"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?(\"content\"===n&&(u-=S.css(e,\"padding\"+ne[a],!0,i)),\"margin\"!==n&&(u-=S.css(e,\"border\"+ne[a]+\"Width\",!0,i))):(u+=S.css(e,\"padding\"+ne[a],!0,i),\"padding\"!==n?u+=S.css(e,\"border\"+ne[a]+\"Width\",!0,i):s+=S.css(e,\"border\"+ne[a]+\"Width\",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e[\"offset\"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Je(e,t,n){var r=Re(e),i=(!y.boxSizingReliable()||n)&&\"border-box\"===S.css(e,\"boxSizing\",!1,r),o=i,a=We(e,t,r),s=\"offset\"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a=\"auto\"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,\"tr\")||\"auto\"===a||!parseFloat(a)&&\"inline\"===S.css(e,\"display\",!1,r))&&e.getClientRects().length&&(i=\"border-box\"===S.css(e,\"boxSizing\",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Qe(e,t,n||(i?\"border\":\"content\"),o,r,a)+\"px\"}function Ke(e,t,n,r,i){return new Ke.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=We(e,\"opacity\");return\"\"===n?\"1\":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Xe.test(t),l=e.style;if(u||(t=ze(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&\"get\"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];\"string\"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o=\"number\"),null!=n&&n==n&&(\"number\"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?\"\":\"px\")),y.clearCloneStyle||\"\"!==n||0!==t.indexOf(\"background\")||(l[t]=\"inherit\"),a&&\"set\"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Xe.test(t)||(t=ze(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&\"get\"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=We(e,t,r)),\"normal\"===i&&t in Ge&&(i=Ge[t]),\"\"===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each([\"height\",\"width\"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ue.test(S.css(e,\"display\"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,u,n):Me(e,Ve,function(){return Je(e,u,n)})},set:function(e,t,n){var r,i=Re(e),o=!y.scrollboxSize()&&\"absolute\"===i.position,a=(o||n)&&\"border-box\"===S.css(e,\"boxSizing\",!1,i),s=n?Qe(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e[\"offset\"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Qe(e,u,\"border\",!1,i)-.5)),s&&(r=te.exec(t))&&\"px\"!==(r[3]||\"px\")&&(e.style[u]=t,t=S.css(e,u)),Ye(0,t,s)}}}),S.cssHooks.marginLeft=Fe(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(We(e,\"marginLeft\"))||e.getBoundingClientRect().left-Me(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+\"px\"}),S.each({margin:\"\",padding:\"\",border:\"Width\"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r=\"string\"==typeof e?e.split(\" \"):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},\"margin\"!==i&&(S.cssHooks[i+o].set=Ye)}),S.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Re(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=Ke).prototype={constructor:Ke,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?\"\":\"px\")},cur:function(){var e=Ke.propHooks[this.prop];return e&&e.get?e.get(this):Ke.propHooks._default.get(this)},run:function(e){var t,n=Ke.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ke.propHooks._default.set(this),this}}).init.prototype=Ke.prototype,(Ke.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,\"\"))&&\"auto\"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ze(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ke.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:\"swing\"},S.fx=Ke.prototype.init,S.fx.step={};var Ze,et,tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){et&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(ot):C.setTimeout(ot,S.fx.interval),S.fx.tick())}function at(){return C.setTimeout(function(){Ze=void 0}),Ze=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i[\"margin\"+(n=ne[r])]=i[\"padding\"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners[\"*\"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(o,e,t){var n,a,r=0,i=lt.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=Ze||at(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:Ze||at(),duration:t.duration,tweens:[],createTween:function(e,t){var n=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&\"expand\"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=lt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ut,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(lt,{tweeners:{\"*\":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=[\"*\"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f=\"width\"in t||\"height\"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,\"fxshow\");for(r in n.queue||(null==(a=S._queueHooks(e,\"fx\")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,\"fx\").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||\"toggle\"===i,i===(g?\"hide\":\"show\")){if(\"show\"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,\"display\")),\"none\"===(c=S.css(e,\"display\"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,\"display\"),le([e]))),(\"inline\"===c||\"inline-block\"===c&&null!=l)&&\"none\"===S.css(e,\"float\")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l=\"none\"===c?\"\":c)),h.display=\"inline-block\")),n.overflow&&(h.overflow=\"hidden\",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?\"hidden\"in v&&(g=v.hidden):v=Y.access(e,\"fxshow\",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,\"fxshow\"),d)S.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&\"object\"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:\"number\"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue=\"fx\"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css(\"opacity\",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),o=S.speed(e,n,r),a=function(){var e=lt(this,S.extend({},t),o);(i||Y.get(this,\"finish\"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return\"string\"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||\"fx\",[]),this.each(function(){var e=!0,t=null!=i&&i+\"queueHooks\",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&it.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||\"fx\"),this.each(function(){var e,t=Y.get(this),n=t[a+\"queue\"],r=t[a+\"queueHooks\"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each([\"toggle\",\"show\",\"hide\"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||\"boolean\"==typeof e?i.apply(this,arguments):this.animate(st(r,!0),e,t,n)}}),S.each({slideDown:st(\"show\"),slideUp:st(\"hide\"),slideToggle:st(\"toggle\"),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"},fadeToggle:{opacity:\"toggle\"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(Ze=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),Ze=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){et||(et=!0,ot())},S.fx.stop=function(){et=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,e=e||\"fx\",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},tt=E.createElement(\"input\"),nt=E.createElement(\"select\").appendChild(E.createElement(\"option\")),tt.type=\"checkbox\",y.checkOn=\"\"!==tt.value,y.optSelected=nt.selected,(tt=E.createElement(\"input\")).value=\"t\",tt.type=\"radio\",y.radioValue=\"t\"===tt.value;var ct,ft=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return $(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return\"undefined\"==typeof e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&\"set\"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+\"\"),n):i&&\"get\"in i&&null!==(r=i.get(e,t))?r:null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&\"radio\"===t&&A(e,\"input\")){var n=e.value;return e.setAttribute(\"type\",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\\w+/g),function(e,t){var a=ft[t]||S.find.attr;ft[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ft[o],ft[o]=r,r=null!=a(e,t,n)?o:null,ft[o]=i),r}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(\" \")}function gt(e){return e.getAttribute&&e.getAttribute(\"class\")||\"\"}function vt(e){return Array.isArray(e)?e:\"string\"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return $(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&\"set\"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&\"get\"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,\"tabindex\");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{\"for\":\"htmlFor\",\"class\":\"className\"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each([\"tabIndex\",\"readOnly\",\"maxLength\",\"cellSpacing\",\"cellPadding\",\"rowSpan\",\"colSpan\",\"useMap\",\"frameBorder\",\"contentEditable\"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,gt(this)))});if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&\" \"+ht(i)+\" \"){a=0;while(o=e[a++])r.indexOf(\" \"+o+\" \")<0&&(r+=o+\" \");i!==(s=ht(r))&&n.setAttribute(\"class\",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,gt(this)))});if(!arguments.length)return this.attr(\"class\",\"\");if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&\" \"+ht(i)+\" \"){a=0;while(o=e[a++])while(-1<r.indexOf(\" \"+o+\" \"))r=r.replace(\" \"+o+\" \",\" \");i!==(s=ht(r))&&n.setAttribute(\"class\",s)}return this},toggleClass:function(i,t){var o=typeof i,a=\"string\"===o||Array.isArray(i);return\"boolean\"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,gt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=S(this),r=vt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&\"boolean\"!==o||((e=gt(this))&&Y.set(this,\"__className__\",e),this.setAttribute&&this.setAttribute(\"class\",e||!1===i?\"\":Y.get(this,\"__className__\")||\"\"))})},hasClass:function(e){var t,n,r=0;t=\" \"+e+\" \";while(n=this[r++])if(1===n.nodeType&&-1<(\" \"+ht(gt(n))+\" \").indexOf(t))return!0;return!1}});var yt=/\\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,S(this).val()):n)?t=\"\":\"number\"==typeof t?t+=\"\":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?\"\":e+\"\"})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&\"set\"in r&&void 0!==r.set(this,t,\"value\")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&\"get\"in r&&void 0!==(e=r.get(t,\"value\"))?e:\"string\"==typeof(e=t.value)?e.replace(yt,\"\"):null==e?\"\":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,\"value\");return null!=t?t:ht(S.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a=\"select-one\"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,\"optgroup\"))){if(t=S(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=S.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each([\"radio\",\"checkbox\"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute(\"value\")?\"on\":e.value})}),y.focusin=\"onfocusin\"in C;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,\"type\")?e.type:e,h=v.call(e,\"namespace\")?e.namespace.split(\".\"):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+S.event.triggered)&&(-1<d.indexOf(\".\")&&(d=(h=d.split(\".\")).shift(),h.sort()),u=d.indexOf(\":\")<0&&\"on\"+d,(e=e[S.expando]?e:new S.Event(d,\"object\"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join(\".\"),e.rnamespace=e.namespace?new RegExp(\"(^|\\\\.)\"+h.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,mt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,\"events\")||Object.create(null))[e.type]&&Y.get(o,\"handle\"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,xt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,xt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:\"focusin\",blur:\"focusout\"},function(n,r){var i=function(e){S.event.simulate(r,e.target,S.event.fix(e))};S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var bt=C.location,wt={guid:Date.now()},Tt=/\\?/;S.parseXML=function(e){var t,n;if(!e||\"string\"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,\"text/xml\")}catch(e){}return n=t&&t.getElementsByTagName(\"parsererror\")[0],t&&!n||S.error(\"Invalid XML: \"+(n?S.map(n.childNodes,function(e){return e.textContent}).join(\"\\n\"):e)),t};var Ct=/\\[\\]$/,Et=/\\r?\\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(n,e,r,i){var t;if(Array.isArray(e))S.each(e,function(e,t){r||Ct.test(n)?i(n,t):At(n+\"[\"+(\"object\"==typeof t&&null!=t?e:\"\")+\"]\",t,r,i)});else if(r||\"object\"!==w(e))i(n,e);else for(t in e)At(n+\"[\"+t+\"]\",e[t],r,i)}S.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+\"=\"+encodeURIComponent(null==n?\"\":n)};if(null==e)return\"\";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join(\"&\")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,\"elements\");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(\":disabled\")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Et,\"\\r\\n\")}}):{name:t.name,value:n.replace(Et,\"\\r\\n\")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \\t]*([^\\r\\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\\/\\//,Ot={},Pt={},Rt=\"*/\".concat(\"*\"),Mt=E.createElement(\"a\");function It(o){return function(e,t){\"string\"!=typeof e&&(t=e,e=\"*\");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])\"+\"===n[0]?(n=n.slice(1)||\"*\",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Wt(t,i,o,a){var s={},u=t===Pt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,t){var n=t(i,o,a);return\"string\"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s[\"*\"]&&l(\"*\")}function Ft(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&S.extend(!0,e,r),e}Mt.href=bt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:\"GET\",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:\"application/x-www-form-urlencoded; charset=UTF-8\",accepts:{\"*\":Rt,text:\"text/plain\",html:\"text/html\",xml:\"application/xml, text/xml\",json:\"application/json, text/javascript\"},contents:{xml:/\\bxml\\b/,html:/\\bhtml/,json:/\\bjson\\b/},responseFields:{xml:\"responseXML\",text:\"responseText\",json:\"responseJSON\"},converters:{\"* text\":String,\"text html\":!0,\"text json\":JSON.parse,\"text xml\":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,S.ajaxSettings),t):Ft(S.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,t){\"object\"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=S.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks(\"once memory\"),w=v.statusCode||{},a={},s={},u=\"canceled\",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=qt.exec(p))n[t[1].toLowerCase()+\" \"]=(n[t[1].toLowerCase()+\" \"]||[]).concat(t[2])}t=n[e.toLowerCase()+\" \"]}return null==t?null:t.join(\", \")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||bt.href)+\"\").replace(Ht,bt.protocol+\"//\"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||\"*\").toLowerCase().match(P)||[\"\"],null==v.crossDomain){r=E.createElement(\"a\");try{r.href=v.url,r.href=r.href,v.crossDomain=Mt.protocol+\"//\"+Mt.host!=r.protocol+\"//\"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&\"string\"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Wt(Ot,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger(\"ajaxStart\"),v.type=v.type.toUpperCase(),v.hasContent=!Lt.test(v.type),f=v.url.replace(jt,\"\"),v.hasContent?v.data&&v.processData&&0===(v.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&(v.data=v.data.replace(Nt,\"+\")):(o=v.url.slice(f.length),v.data&&(v.processData||\"string\"==typeof v.data)&&(f+=(Tt.test(f)?\"&\":\"?\")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Dt,\"$1\"),o=(Tt.test(f)?\"&\":\"?\")+\"_=\"+wt.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader(\"If-Modified-Since\",S.lastModified[f]),S.etag[f]&&T.setRequestHeader(\"If-None-Match\",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader(\"Content-Type\",v.contentType),T.setRequestHeader(\"Accept\",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+(\"*\"!==v.dataTypes[0]?\", \"+Rt+\"; q=0.01\":\"\"):v.accepts[\"*\"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u=\"abort\",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Wt(Pt,v,t,T)){if(T.readyState=1,g&&m.trigger(\"ajaxSend\",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort(\"timeout\")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,\"No Transport\");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||\"\",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while(\"*\"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader(\"Content-Type\"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+\" \"+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<S.inArray(\"script\",v.dataTypes)&&S.inArray(\"json\",v.dataTypes)<0&&(v.converters[\"text script\"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if(\"*\"===o)o=u;else if(\"*\"!==u&&u!==o){if(!(a=l[u+\" \"+o]||l[\"* \"+o]))for(i in l)if((s=i.split(\" \"))[1]===o&&(a=l[u+\" \"+s[0]]||l[\"* \"+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e[\"throws\"])t=a(t);else try{t=a(t)}catch(e){return{state:\"parsererror\",error:a?e:\"No conversion from \"+u+\" to \"+o}}}return{state:\"success\",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader(\"Last-Modified\"))&&(S.lastModified[f]=u),(u=T.getResponseHeader(\"etag\"))&&(S.etag[f]=u)),204===e||\"HEAD\"===v.type?l=\"nocontent\":304===e?l=\"notmodified\":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l=\"error\",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+\"\",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?\"ajaxSuccess\":\"ajaxError\",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger(\"ajaxComplete\",[T,v]),--S.active||S.event.trigger(\"ajaxStop\")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,\"json\")},getScript:function(e,t){return S.get(e,void 0,t,\"script\")}}),S.each([\"get\",\"post\"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){var t;for(t in e.headers)\"content-type\"===t.toLowerCase()&&(e.contentType=e.headers[t]||\"\")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:\"GET\",dataType:\"script\",cache:!0,async:!1,global:!1,converters:{\"text script\":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not(\"body\").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=S.ajaxSettings.xhr();y.cors=!!$t&&\"withCredentials\"in $t,y.ajax=$t=!!$t,S.ajaxTransport(function(i){var o,a;if(y.cors||$t&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e[\"X-Requested-With\"]||(e[\"X-Requested-With\"]=\"XMLHttpRequest\"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,\"abort\"===e?r.abort():\"error\"===e?\"number\"!=typeof r.status?t(0,\"error\"):t(r.status,r.statusText):t(Bt[r.status]||r.status,r.statusText,\"text\"!==(r.responseType||\"text\")||\"string\"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o(\"error\"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o(\"abort\");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:\"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"},contents:{script:/\\b(?:java|ecma)script\\b/},converters:{\"text script\":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter(\"script\",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type=\"GET\")}),S.ajaxTransport(\"script\",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S(\"<script>\").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on(\"load error\",i=function(e){r.remove(),i=null,e&&t(\"error\"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var _t,zt=[],Ut=/(=)\\?(?=&|$)|\\?\\?/;S.ajaxSetup({jsonp:\"callback\",jsonpCallback:function(){var e=zt.pop()||S.expando+\"_\"+wt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter(\"json jsonp\",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Ut.test(e.url)?\"url\":\"string\"==typeof e.data&&0===(e.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&Ut.test(e.data)&&\"data\");if(a||\"jsonp\"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ut,\"$1\"+r):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?\"&\":\"?\")+e.jsonp+\"=\"+r),e.converters[\"script json\"]=function(){return o||S.error(r+\" was not called\"),o[0]},e.dataTypes[0]=\"json\",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,zt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),\"script\"}),y.createHTMLDocument=((_t=E.implementation.createHTMLDocument(\"\").body).innerHTML=\"<form></form><form></form>\",2===_t.childNodes.length),S.parseHTML=function(e,t,n){return\"string\"!=typeof e?[]:(\"boolean\"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument(\"\")).createElement(\"base\")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var r,i,o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(\" \");return-1<s&&(r=ht(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&\"object\"==typeof t&&(i=\"POST\"),0<a.length&&S.ajax({url:e,type:i||\"GET\",dataType:\"html\",data:t}).done(function(e){o=arguments,a.html(r?S(\"<div>\").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=S.css(e,\"position\"),c=S(e),f={};\"static\"===l&&(e.style.position=\"relative\"),s=c.offset(),o=S.css(e,\"top\"),u=S.css(e,\"left\"),(\"absolute\"===l||\"fixed\"===l)&&-1<(o+u).indexOf(\"auto\")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,S.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),\"using\"in t?t.using.call(e,f):c.css(f)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if(\"fixed\"===S.css(r,\"position\"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&\"static\"===S.css(e,\"position\"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,\"borderTopWidth\",!0),i.left+=S.css(e,\"borderLeftWidth\",!0))}return{top:t.top-i.top-S.css(r,\"marginTop\",!0),left:t.left-i.left-S.css(r,\"marginLeft\",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&\"static\"===S.css(e,\"position\"))e=e.offsetParent;return e||re})}}),S.each({scrollLeft:\"pageXOffset\",scrollTop:\"pageYOffset\"},function(t,i){var o=\"pageYOffset\"===i;S.fn[t]=function(e){return $(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),S.each([\"top\",\"left\"],function(e,n){S.cssHooks[n]=Fe(y.pixelPosition,function(e,t){if(t)return t=We(e,n),Pe.test(t)?S(e).position()[n]+\"px\":t})}),S.each({Height:\"height\",Width:\"width\"},function(a,s){S.each({padding:\"inner\"+a,content:s,\"\":\"outer\"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||\"boolean\"!=typeof e),i=r||(!0===e||!0===t?\"margin\":\"border\");return $(this,function(e,t,n){var r;return x(e)?0===o.indexOf(\"outer\")?e[\"inner\"+a]:e.document.documentElement[\"client\"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body[\"scroll\"+a],r[\"scroll\"+a],e.body[\"offset\"+a],r[\"offset\"+a],r[\"client\"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each([\"ajaxStart\",\"ajaxStop\",\"ajaxComplete\",\"ajaxError\",\"ajaxSuccess\",\"ajaxSend\"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,\"**\"):this.off(t,e||\"**\",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each(\"blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\".split(\" \"),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Xt=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g;S.proxy=function(e,t){var n,r,i;if(\"string\"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return(\"number\"===t||\"string\"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?\"\":(e+\"\").replace(Xt,\"\")},\"function\"==typeof define&&define.amd&&define(\"jquery\",[],function(){return S});var Vt=C.jQuery,Gt=C.$;return S.noConflict=function(e){return C.$===S&&(C.$=Gt),e&&C.jQuery===S&&(C.jQuery=Vt),S},\"undefined\"==typeof e&&(C.jQuery=C.$=S),S});\n"},"runtime/howler.core.min.js":{"name":"runtime/howler.core.min.js","content":"/*! howler.js v2.2.3 | (c) 2013-2020, James Simpson of GoldFire Studios | MIT License | howlerjs.com */\n!function(){\"use strict\";var e=function(){this.init()};e.prototype={init:function(){var e=this||n;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent=\"canplaythrough\",e._navigator=\"undefined\"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var o=this||n;if(e=parseFloat(e),o.ctx||_(),void 0!==e&&e>=0&&e<=1){if(o._volume=e,o._muted)return o;o.usingWebAudio&&o.masterGain.gain.setValueAtTime(e,n.ctx.currentTime);for(var t=0;t<o._howls.length;t++)if(!o._howls[t]._webAudio)for(var r=o._howls[t]._getSoundIds(),a=0;a<r.length;a++){var u=o._howls[t]._soundById(r[a]);u&&u._node&&(u._node.volume=u._volume*e)}return o}return o._volume},mute:function(e){var o=this||n;o.ctx||_(),o._muted=e,o.usingWebAudio&&o.masterGain.gain.setValueAtTime(e?0:o._volume,n.ctx.currentTime);for(var t=0;t<o._howls.length;t++)if(!o._howls[t]._webAudio)for(var r=o._howls[t]._getSoundIds(),a=0;a<r.length;a++){var u=o._howls[t]._soundById(r[a]);u&&u._node&&(u._node.muted=!!e||u._muted)}return o},stop:function(){for(var e=this||n,o=0;o<e._howls.length;o++)e._howls[o].stop();return e},unload:function(){for(var e=this||n,o=e._howls.length-1;o>=0;o--)e._howls[o].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,_()),e},codecs:function(e){return(this||n)._codecs[e.replace(/^x-/,\"\")]},_setup:function(){var e=this||n;if(e.state=e.ctx?e.ctx.state||\"suspended\":\"suspended\",e._autoSuspend(),!e.usingWebAudio)if(\"undefined\"!=typeof Audio)try{var o=new Audio;void 0===o.oncanplaythrough&&(e._canPlayEvent=\"canplay\")}catch(n){e.noAudio=!0}else e.noAudio=!0;try{var o=new Audio;o.muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||n,o=null;try{o=\"undefined\"!=typeof Audio?new Audio:null}catch(n){return e}if(!o||\"function\"!=typeof o.canPlayType)return e;var t=o.canPlayType(\"audio/mpeg;\").replace(/^no$/,\"\"),r=e._navigator?e._navigator.userAgent:\"\",a=r.match(/OPR\\/([0-6].)/g),u=a&&parseInt(a[0].split(\"/\")[1],10)<33,d=-1!==r.indexOf(\"Safari\")&&-1===r.indexOf(\"Chrome\"),i=r.match(/Version\\/(.*?) /),_=d&&i&&parseInt(i[1],10)<15;return e._codecs={mp3:!(u||!t&&!o.canPlayType(\"audio/mp3;\").replace(/^no$/,\"\")),mpeg:!!t,opus:!!o.canPlayType('audio/ogg; codecs=\"opus\"').replace(/^no$/,\"\"),ogg:!!o.canPlayType('audio/ogg; codecs=\"vorbis\"').replace(/^no$/,\"\"),oga:!!o.canPlayType('audio/ogg; codecs=\"vorbis\"').replace(/^no$/,\"\"),wav:!!(o.canPlayType('audio/wav; codecs=\"1\"')||o.canPlayType(\"audio/wav\")).replace(/^no$/,\"\"),aac:!!o.canPlayType(\"audio/aac;\").replace(/^no$/,\"\"),caf:!!o.canPlayType(\"audio/x-caf;\").replace(/^no$/,\"\"),m4a:!!(o.canPlayType(\"audio/x-m4a;\")||o.canPlayType(\"audio/m4a;\")||o.canPlayType(\"audio/aac;\")).replace(/^no$/,\"\"),m4b:!!(o.canPlayType(\"audio/x-m4b;\")||o.canPlayType(\"audio/m4b;\")||o.canPlayType(\"audio/aac;\")).replace(/^no$/,\"\"),mp4:!!(o.canPlayType(\"audio/x-mp4;\")||o.canPlayType(\"audio/mp4;\")||o.canPlayType(\"audio/aac;\")).replace(/^no$/,\"\"),weba:!(_||!o.canPlayType('audio/webm; codecs=\"vorbis\"').replace(/^no$/,\"\")),webm:!(_||!o.canPlayType('audio/webm; codecs=\"vorbis\"').replace(/^no$/,\"\")),dolby:!!o.canPlayType('audio/mp4; codecs=\"ec-3\"').replace(/^no$/,\"\"),flac:!!(o.canPlayType(\"audio/x-flac;\")||o.canPlayType(\"audio/flac;\")).replace(/^no$/,\"\")},e},_unlockAudio:function(){var e=this||n;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var o=function(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var t=new Audio;t._unlocked=!0,e._releaseHtml5Audio(t)}catch(n){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var a=e._howls[r]._getSoundIds(),u=0;u<a.length;u++){var d=e._howls[r]._soundById(a[u]);d&&d._node&&!d._node._unlocked&&(d._node._unlocked=!0,d._node.load())}e._autoResume();var i=e.ctx.createBufferSource();i.buffer=e._scratchBuffer,i.connect(e.ctx.destination),void 0===i.start?i.noteOn(0):i.start(0),\"function\"==typeof e.ctx.resume&&e.ctx.resume(),i.onended=function(){i.disconnect(0),e._audioUnlocked=!0,document.removeEventListener(\"touchstart\",o,!0),document.removeEventListener(\"touchend\",o,!0),document.removeEventListener(\"click\",o,!0),document.removeEventListener(\"keydown\",o,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit(\"unlock\")}};return document.addEventListener(\"touchstart\",o,!0),document.addEventListener(\"touchend\",o,!0),document.addEventListener(\"click\",o,!0),document.addEventListener(\"keydown\",o,!0),e}},_obtainHtml5Audio:function(){var e=this||n;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var o=(new Audio).play();return o&&\"undefined\"!=typeof Promise&&(o instanceof Promise||\"function\"==typeof o.then)&&o.catch(function(){console.warn(\"HTML5 Audio pool exhausted, returning potentially locked audio object.\")}),new Audio},_releaseHtml5Audio:function(e){var o=this||n;return e._unlocked&&o._html5AudioPool.push(e),o},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&n.usingWebAudio){for(var o=0;o<e._howls.length;o++)if(e._howls[o]._webAudio)for(var t=0;t<e._howls[o]._sounds.length;t++)if(!e._howls[o]._sounds[t]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){if(e.autoSuspend){e._suspendTimer=null,e.state=\"suspending\";var n=function(){e.state=\"suspended\",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(n,n)}},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&n.usingWebAudio)return\"running\"===e.state&&\"interrupted\"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):\"suspended\"===e.state||\"running\"===e.state&&\"interrupted\"===e.ctx.state?(e.ctx.resume().then(function(){e.state=\"running\";for(var n=0;n<e._howls.length;n++)e._howls[n]._emit(\"resume\")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):\"suspending\"===e.state&&(e._resumeAfterSuspend=!0),e}};var n=new e,o=function(e){var n=this;if(!e.src||0===e.src.length)return void console.error(\"An array of source files must be passed with any new Howl.\");n.init(e)};o.prototype={init:function(e){var o=this;return n.ctx||_(),o._autoplay=e.autoplay||!1,o._format=\"string\"!=typeof e.format?e.format:[e.format],o._html5=e.html5||!1,o._muted=e.mute||!1,o._loop=e.loop||!1,o._pool=e.pool||5,o._preload=\"boolean\"!=typeof e.preload&&\"metadata\"!==e.preload||e.preload,o._rate=e.rate||1,o._sprite=e.sprite||{},o._src=\"string\"!=typeof e.src?e.src:[e.src],o._volume=void 0!==e.volume?e.volume:1,o._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:\"GET\",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},o._duration=0,o._state=\"unloaded\",o._sounds=[],o._endTimers={},o._queue=[],o._playLock=!1,o._onend=e.onend?[{fn:e.onend}]:[],o._onfade=e.onfade?[{fn:e.onfade}]:[],o._onload=e.onload?[{fn:e.onload}]:[],o._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],o._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],o._onpause=e.onpause?[{fn:e.onpause}]:[],o._onplay=e.onplay?[{fn:e.onplay}]:[],o._onstop=e.onstop?[{fn:e.onstop}]:[],o._onmute=e.onmute?[{fn:e.onmute}]:[],o._onvolume=e.onvolume?[{fn:e.onvolume}]:[],o._onrate=e.onrate?[{fn:e.onrate}]:[],o._onseek=e.onseek?[{fn:e.onseek}]:[],o._onunlock=e.onunlock?[{fn:e.onunlock}]:[],o._onresume=[],o._webAudio=n.usingWebAudio&&!o._html5,void 0!==n.ctx&&n.ctx&&n.autoUnlock&&n._unlockAudio(),n._howls.push(o),o._autoplay&&o._queue.push({event:\"play\",action:function(){o.play()}}),o._preload&&\"none\"!==o._preload&&o.load(),o},load:function(){var e=this,o=null;if(n.noAudio)return void e._emit(\"loaderror\",null,\"No audio support.\");\"string\"==typeof e._src&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var u,d;if(e._format&&e._format[r])u=e._format[r];else{if(\"string\"!=typeof(d=e._src[r])){e._emit(\"loaderror\",null,\"Non-string found in selected audio sources - ignoring.\");continue}u=/^data:audio\\/([^;,]+);/i.exec(d),u||(u=/\\.([^.]+)$/.exec(d.split(\"?\",1)[0])),u&&(u=u[1].toLowerCase())}if(u||console.warn('No file extension was found. Consider using the \"format\" property or specify an extension.'),u&&n.codecs(u)){o=e._src[r];break}}return o?(e._src=o,e._state=\"loading\",\"https:\"===window.location.protocol&&\"http:\"===o.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new t(e),e._webAudio&&a(e),e):void e._emit(\"loaderror\",null,\"No codec support for selected audio sources.\")},play:function(e,o){var t=this,r=null;if(\"number\"==typeof e)r=e,e=null;else{if(\"string\"==typeof e&&\"loaded\"===t._state&&!t._sprite[e])return null;if(void 0===e&&(e=\"__default\",!t._playLock)){for(var a=0,u=0;u<t._sounds.length;u++)t._sounds[u]._paused&&!t._sounds[u]._ended&&(a++,r=t._sounds[u]._id);1===a?e=null:r=null}}var d=r?t._soundById(r):t._inactiveSound();if(!d)return null;if(r&&!e&&(e=d._sprite||\"__default\"),\"loaded\"!==t._state){d._sprite=e,d._ended=!1;var i=d._id;return t._queue.push({event:\"play\",action:function(){t.play(i)}}),i}if(r&&!d._paused)return o||t._loadQueue(\"play\"),d._id;t._webAudio&&n._autoResume();var _=Math.max(0,d._seek>0?d._seek:t._sprite[e][0]/1e3),s=Math.max(0,(t._sprite[e][0]+t._sprite[e][1])/1e3-_),l=1e3*s/Math.abs(d._rate),c=t._sprite[e][0]/1e3,f=(t._sprite[e][0]+t._sprite[e][1])/1e3;d._sprite=e,d._ended=!1;var p=function(){d._paused=!1,d._seek=_,d._start=c,d._stop=f,d._loop=!(!d._loop&&!t._sprite[e][2])};if(_>=f)return void t._ended(d);var m=d._node;if(t._webAudio){var v=function(){t._playLock=!1,p(),t._refreshBuffer(d);var e=d._muted||t._muted?0:d._volume;m.gain.setValueAtTime(e,n.ctx.currentTime),d._playStart=n.ctx.currentTime,void 0===m.bufferSource.start?d._loop?m.bufferSource.noteGrainOn(0,_,86400):m.bufferSource.noteGrainOn(0,_,s):d._loop?m.bufferSource.start(0,_,86400):m.bufferSource.start(0,_,s),l!==1/0&&(t._endTimers[d._id]=setTimeout(t._ended.bind(t,d),l)),o||setTimeout(function(){t._emit(\"play\",d._id),t._loadQueue()},0)};\"running\"===n.state&&\"interrupted\"!==n.ctx.state?v():(t._playLock=!0,t.once(\"resume\",v),t._clearTimer(d._id))}else{var h=function(){m.currentTime=_,m.muted=d._muted||t._muted||n._muted||m.muted,m.volume=d._volume*n.volume(),m.playbackRate=d._rate;try{var r=m.play();if(r&&\"undefined\"!=typeof Promise&&(r instanceof Promise||\"function\"==typeof r.then)?(t._playLock=!0,p(),r.then(function(){t._playLock=!1,m._unlocked=!0,o?t._loadQueue():t._emit(\"play\",d._id)}).catch(function(){t._playLock=!1,t._emit(\"playerror\",d._id,\"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.\"),d._ended=!0,d._paused=!0})):o||(t._playLock=!1,p(),t._emit(\"play\",d._id)),m.playbackRate=d._rate,m.paused)return void t._emit(\"playerror\",d._id,\"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.\");\"__default\"!==e||d._loop?t._endTimers[d._id]=setTimeout(t._ended.bind(t,d),l):(t._endTimers[d._id]=function(){t._ended(d),m.removeEventListener(\"ended\",t._endTimers[d._id],!1)},m.addEventListener(\"ended\",t._endTimers[d._id],!1))}catch(e){t._emit(\"playerror\",d._id,e)}};\"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA\"===m.src&&(m.src=t._src,m.load());var y=window&&window.ejecta||!m.readyState&&n._navigator.isCocoonJS;if(m.readyState>=3||y)h();else{t._playLock=!0,t._state=\"loading\";var g=function(){t._state=\"loaded\",h(),m.removeEventListener(n._canPlayEvent,g,!1)};m.addEventListener(n._canPlayEvent,g,!1),t._clearTimer(d._id)}}return d._id},pause:function(e){var n=this;if(\"loaded\"!==n._state||n._playLock)return n._queue.push({event:\"pause\",action:function(){n.pause(e)}}),n;for(var o=n._getSoundIds(e),t=0;t<o.length;t++){n._clearTimer(o[t]);var r=n._soundById(o[t]);if(r&&!r._paused&&(r._seek=n.seek(o[t]),r._rateSeek=0,r._paused=!0,n._stopFade(o[t]),r._node))if(n._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),n._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||n._emit(\"pause\",r?r._id:null)}return n},stop:function(e,n){var o=this;if(\"loaded\"!==o._state||o._playLock)return o._queue.push({event:\"stop\",action:function(){o.stop(e)}}),o;for(var t=o._getSoundIds(e),r=0;r<t.length;r++){o._clearTimer(t[r]);var a=o._soundById(t[r]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,o._stopFade(t[r]),a._node&&(o._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),o._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause(),a._node.duration===1/0&&o._clearSound(a._node))),n||o._emit(\"stop\",a._id))}return o},mute:function(e,o){var t=this;if(\"loaded\"!==t._state||t._playLock)return t._queue.push({event:\"mute\",action:function(){t.mute(e,o)}}),t;if(void 0===o){if(\"boolean\"!=typeof e)return t._muted;t._muted=e}for(var r=t._getSoundIds(o),a=0;a<r.length;a++){var u=t._soundById(r[a]);u&&(u._muted=e,u._interval&&t._stopFade(u._id),t._webAudio&&u._node?u._node.gain.setValueAtTime(e?0:u._volume,n.ctx.currentTime):u._node&&(u._node.muted=!!n._muted||e),t._emit(\"mute\",u._id))}return t},volume:function(){var e,o,t=this,r=arguments;if(0===r.length)return t._volume;if(1===r.length||2===r.length&&void 0===r[1]){t._getSoundIds().indexOf(r[0])>=0?o=parseInt(r[0],10):e=parseFloat(r[0])}else r.length>=2&&(e=parseFloat(r[0]),o=parseInt(r[1],10));var a;if(!(void 0!==e&&e>=0&&e<=1))return a=o?t._soundById(o):t._sounds[0],a?a._volume:0;if(\"loaded\"!==t._state||t._playLock)return t._queue.push({event:\"volume\",action:function(){t.volume.apply(t,r)}}),t;void 0===o&&(t._volume=e),o=t._getSoundIds(o);for(var u=0;u<o.length;u++)(a=t._soundById(o[u]))&&(a._volume=e,r[2]||t._stopFade(o[u]),t._webAudio&&a._node&&!a._muted?a._node.gain.setValueAtTime(e,n.ctx.currentTime):a._node&&!a._muted&&(a._node.volume=e*n.volume()),t._emit(\"volume\",a._id));return t},fade:function(e,o,t,r){var a=this;if(\"loaded\"!==a._state||a._playLock)return a._queue.push({event:\"fade\",action:function(){a.fade(e,o,t,r)}}),a;e=Math.min(Math.max(0,parseFloat(e)),1),o=Math.min(Math.max(0,parseFloat(o)),1),t=parseFloat(t),a.volume(e,r);for(var u=a._getSoundIds(r),d=0;d<u.length;d++){var i=a._soundById(u[d]);if(i){if(r||a._stopFade(u[d]),a._webAudio&&!i._muted){var _=n.ctx.currentTime,s=_+t/1e3;i._volume=e,i._node.gain.setValueAtTime(e,_),i._node.gain.linearRampToValueAtTime(o,s)}a._startFadeInterval(i,e,o,t,u[d],void 0===r)}}return a},_startFadeInterval:function(e,n,o,t,r,a){var u=this,d=n,i=o-n,_=Math.abs(i/.01),s=Math.max(4,_>0?t/_:t),l=Date.now();e._fadeTo=o,e._interval=setInterval(function(){var r=(Date.now()-l)/t;l=Date.now(),d+=i*r,d=Math.round(100*d)/100,d=i<0?Math.max(o,d):Math.min(o,d),u._webAudio?e._volume=d:u.volume(d,e._id,!0),a&&(u._volume=d),(o<n&&d<=o||o>n&&d>=o)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,u.volume(o,e._id),u._emit(\"fade\",e._id))},s)},_stopFade:function(e){var o=this,t=o._soundById(e);return t&&t._interval&&(o._webAudio&&t._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(t._interval),t._interval=null,o.volume(t._fadeTo,e),t._fadeTo=null,o._emit(\"fade\",e)),o},loop:function(){var e,n,o,t=this,r=arguments;if(0===r.length)return t._loop;if(1===r.length){if(\"boolean\"!=typeof r[0])return!!(o=t._soundById(parseInt(r[0],10)))&&o._loop;e=r[0],t._loop=e}else 2===r.length&&(e=r[0],n=parseInt(r[1],10));for(var a=t._getSoundIds(n),u=0;u<a.length;u++)(o=t._soundById(a[u]))&&(o._loop=e,t._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=e,e&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop,t.playing(a[u])&&(t.pause(a[u],!0),t.play(a[u],!0)))));return t},rate:function(){var e,o,t=this,r=arguments;if(0===r.length)o=t._sounds[0]._id;else if(1===r.length){var a=t._getSoundIds(),u=a.indexOf(r[0]);u>=0?o=parseInt(r[0],10):e=parseFloat(r[0])}else 2===r.length&&(e=parseFloat(r[0]),o=parseInt(r[1],10));var d;if(\"number\"!=typeof e)return d=t._soundById(o),d?d._rate:t._rate;if(\"loaded\"!==t._state||t._playLock)return t._queue.push({event:\"rate\",action:function(){t.rate.apply(t,r)}}),t;void 0===o&&(t._rate=e),o=t._getSoundIds(o);for(var i=0;i<o.length;i++)if(d=t._soundById(o[i])){t.playing(o[i])&&(d._rateSeek=t.seek(o[i]),d._playStart=t._webAudio?n.ctx.currentTime:d._playStart),d._rate=e,t._webAudio&&d._node&&d._node.bufferSource?d._node.bufferSource.playbackRate.setValueAtTime(e,n.ctx.currentTime):d._node&&(d._node.playbackRate=e);var _=t.seek(o[i]),s=(t._sprite[d._sprite][0]+t._sprite[d._sprite][1])/1e3-_,l=1e3*s/Math.abs(d._rate);!t._endTimers[o[i]]&&d._paused||(t._clearTimer(o[i]),t._endTimers[o[i]]=setTimeout(t._ended.bind(t,d),l)),t._emit(\"rate\",d._id)}return t},seek:function(){var e,o,t=this,r=arguments;if(0===r.length)t._sounds.length&&(o=t._sounds[0]._id);else if(1===r.length){var a=t._getSoundIds(),u=a.indexOf(r[0]);u>=0?o=parseInt(r[0],10):t._sounds.length&&(o=t._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),o=parseInt(r[1],10));if(void 0===o)return 0;if(\"number\"==typeof e&&(\"loaded\"!==t._state||t._playLock))return t._queue.push({event:\"seek\",action:function(){t.seek.apply(t,r)}}),t;var d=t._soundById(o);if(d){if(!(\"number\"==typeof e&&e>=0)){if(t._webAudio){var i=t.playing(o)?n.ctx.currentTime-d._playStart:0,_=d._rateSeek?d._rateSeek-d._seek:0;return d._seek+(_+i*Math.abs(d._rate))}return d._node.currentTime}var s=t.playing(o);s&&t.pause(o,!0),d._seek=e,d._ended=!1,t._clearTimer(o),t._webAudio||!d._node||isNaN(d._node.duration)||(d._node.currentTime=e);var l=function(){s&&t.play(o,!0),t._emit(\"seek\",o)};if(s&&!t._webAudio){var c=function(){t._playLock?setTimeout(c,0):l()};setTimeout(c,0)}else l()}return t},playing:function(e){var n=this;if(\"number\"==typeof e){var o=n._soundById(e);return!!o&&!o._paused}for(var t=0;t<n._sounds.length;t++)if(!n._sounds[t]._paused)return!0;return!1},duration:function(e){var n=this,o=n._duration,t=n._soundById(e);return t&&(o=n._sprite[t._sprite][1]/1e3),o},state:function(){return this._state},unload:function(){for(var e=this,o=e._sounds,t=0;t<o.length;t++)o[t]._paused||e.stop(o[t]._id),e._webAudio||(e._clearSound(o[t]._node),o[t]._node.removeEventListener(\"error\",o[t]._errorFn,!1),o[t]._node.removeEventListener(n._canPlayEvent,o[t]._loadFn,!1),o[t]._node.removeEventListener(\"ended\",o[t]._endFn,!1),n._releaseHtml5Audio(o[t]._node)),delete o[t]._node,e._clearTimer(o[t]._id);var a=n._howls.indexOf(e);a>=0&&n._howls.splice(a,1);var u=!0;for(t=0;t<n._howls.length;t++)if(n._howls[t]._src===e._src||e._src.indexOf(n._howls[t]._src)>=0){u=!1;break}return r&&u&&delete r[e._src],n.noAudio=!1,e._state=\"unloaded\",e._sounds=[],e=null,null},on:function(e,n,o,t){var r=this,a=r[\"_on\"+e];return\"function\"==typeof n&&a.push(t?{id:o,fn:n,once:t}:{id:o,fn:n}),r},off:function(e,n,o){var t=this,r=t[\"_on\"+e],a=0;if(\"number\"==typeof n&&(o=n,n=null),n||o)for(a=0;a<r.length;a++){var u=o===r[a].id;if(n===r[a].fn&&u||!n&&u){r.splice(a,1);break}}else if(e)t[\"_on\"+e]=[];else{var d=Object.keys(t);for(a=0;a<d.length;a++)0===d[a].indexOf(\"_on\")&&Array.isArray(t[d[a]])&&(t[d[a]]=[])}return t},once:function(e,n,o){var t=this;return t.on(e,n,o,1),t},_emit:function(e,n,o){for(var t=this,r=t[\"_on\"+e],a=r.length-1;a>=0;a--)r[a].id&&r[a].id!==n&&\"load\"!==e||(setTimeout(function(e){e.call(this,n,o)}.bind(t,r[a].fn),0),r[a].once&&t.off(e,r[a].fn,r[a].id));return t._loadQueue(e),t},_loadQueue:function(e){var n=this;if(n._queue.length>0){var o=n._queue[0];o.event===e&&(n._queue.shift(),n._loadQueue()),e||o.action()}return n},_ended:function(e){var o=this,t=e._sprite;if(!o._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(o._ended.bind(o,e),100),o;var r=!(!e._loop&&!o._sprite[t][2]);if(o._emit(\"end\",e._id),!o._webAudio&&r&&o.stop(e._id,!0).play(e._id),o._webAudio&&r){o._emit(\"play\",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=n.ctx.currentTime;var a=1e3*(e._stop-e._start)/Math.abs(e._rate);o._endTimers[e._id]=setTimeout(o._ended.bind(o,e),a)}return o._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,o._clearTimer(e._id),o._cleanBuffer(e._node),n._autoSuspend()),o._webAudio||r||o.stop(e._id,!0),o},_clearTimer:function(e){var n=this;if(n._endTimers[e]){if(\"function\"!=typeof n._endTimers[e])clearTimeout(n._endTimers[e]);else{var o=n._soundById(e);o&&o._node&&o._node.removeEventListener(\"ended\",n._endTimers[e],!1)}delete n._endTimers[e]}return n},_soundById:function(e){for(var n=this,o=0;o<n._sounds.length;o++)if(e===n._sounds[o]._id)return n._sounds[o];return null},_inactiveSound:function(){var e=this;e._drain();for(var n=0;n<e._sounds.length;n++)if(e._sounds[n]._ended)return e._sounds[n].reset();return new t(e)},_drain:function(){var e=this,n=e._pool,o=0,t=0;if(!(e._sounds.length<n)){for(t=0;t<e._sounds.length;t++)e._sounds[t]._ended&&o++;for(t=e._sounds.length-1;t>=0;t--){if(o<=n)return;e._sounds[t]._ended&&(e._webAudio&&e._sounds[t]._node&&e._sounds[t]._node.disconnect(0),e._sounds.splice(t,1),o--)}}},_getSoundIds:function(e){var n=this;if(void 0===e){for(var o=[],t=0;t<n._sounds.length;t++)o.push(n._sounds[t]._id);return o}return[e]},_refreshBuffer:function(e){var o=this;return e._node.bufferSource=n.ctx.createBufferSource(),e._node.bufferSource.buffer=r[o._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,n.ctx.currentTime),o},_cleanBuffer:function(e){var o=this,t=n._navigator&&n._navigator.vendor.indexOf(\"Apple\")>=0;if(n._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=n._scratchBuffer}catch(e){}return e.bufferSource=null,o},_clearSound:function(e){/MSIE |Trident\\//.test(n._navigator&&n._navigator.userAgent)||(e.src=\"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA\")}};var t=function(e){this._parent=e,this.init()};t.prototype={init:function(){var e=this,o=e._parent;return e._muted=o._muted,e._loop=o._loop,e._volume=o._volume,e._rate=o._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite=\"__default\",e._id=++n._counter,o._sounds.push(e),e.create(),e},create:function(){var e=this,o=e._parent,t=n._muted||e._muted||e._parent._muted?0:e._volume;return o._webAudio?(e._node=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),e._node.gain.setValueAtTime(t,n.ctx.currentTime),e._node.paused=!0,e._node.connect(n.masterGain)):n.noAudio||(e._node=n._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener(\"error\",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(n._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener(\"ended\",e._endFn,!1),e._node.src=o._src,e._node.preload=!0===o._preload?\"auto\":o._preload,e._node.volume=t*n.volume(),e._node.load()),e},reset:function(){var e=this,o=e._parent;return e._muted=o._muted,e._loop=o._loop,e._volume=o._volume,e._rate=o._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite=\"__default\",e._id=++n._counter,e},_errorListener:function(){var e=this;e._parent._emit(\"loaderror\",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener(\"error\",e._errorFn,!1)},_loadListener:function(){var e=this,o=e._parent;o._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(o._sprite).length&&(o._sprite={__default:[0,1e3*o._duration]}),\"loaded\"!==o._state&&(o._state=\"loaded\",o._emit(\"load\"),o._loadQueue()),e._node.removeEventListener(n._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,n=e._parent;n._duration===1/0&&(n._duration=Math.ceil(10*e._node.duration)/10,n._sprite.__default[1]===1/0&&(n._sprite.__default[1]=1e3*n._duration),n._ended(e)),e._node.removeEventListener(\"ended\",e._endFn,!1)}};var r={},a=function(e){var n=e._src;if(r[n])return e._duration=r[n].duration,void i(e);if(/^data:[^;]+;base64,/.test(n)){for(var o=atob(n.split(\",\")[1]),t=new Uint8Array(o.length),a=0;a<o.length;++a)t[a]=o.charCodeAt(a);d(t.buffer,e)}else{var _=new XMLHttpRequest;_.open(e._xhr.method,n,!0),_.withCredentials=e._xhr.withCredentials,_.responseType=\"arraybuffer\",e._xhr.headers&&Object.keys(e._xhr.headers).forEach(function(n){_.setRequestHeader(n,e._xhr.headers[n])}),_.onload=function(){var n=(_.status+\"\")[0];if(\"0\"!==n&&\"2\"!==n&&\"3\"!==n)return void e._emit(\"loaderror\",null,\"Failed loading audio file with status: \"+_.status+\".\");d(_.response,e)},_.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete r[n],e.load())},u(_)}},u=function(e){try{e.send()}catch(n){e.onerror()}},d=function(e,o){var t=function(){o._emit(\"loaderror\",null,\"Decoding audio data failed.\")},a=function(e){e&&o._sounds.length>0?(r[o._src]=e,i(o,e)):t()};\"undefined\"!=typeof Promise&&1===n.ctx.decodeAudioData.length?n.ctx.decodeAudioData(e).then(a).catch(t):n.ctx.decodeAudioData(e,a,t)},i=function(e,n){n&&!e._duration&&(e._duration=n.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),\"loaded\"!==e._state&&(e._state=\"loaded\",e._emit(\"load\"),e._loadQueue())},_=function(){if(n.usingWebAudio){try{\"undefined\"!=typeof AudioContext?n.ctx=new AudioContext:\"undefined\"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(e){n.usingWebAudio=!1}n.ctx||(n.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),o=n._navigator&&n._navigator.appVersion.match(/OS (\\d+)_(\\d+)_?(\\d+)?/),t=o?parseInt(o[1],10):null;if(e&&t&&t<9){var r=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());n._navigator&&!r&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.setValueAtTime(n._muted?0:n._volume,n.ctx.currentTime),n.masterGain.connect(n.ctx.destination)),n._setup()}};\"function\"==typeof define&&define.amd&&define([],function(){return{Howler:n,Howl:o}}),\"undefined\"!=typeof exports&&(exports.Howler=n,exports.Howl=o),\"undefined\"!=typeof global?(global.HowlerGlobal=e,global.Howler=n,global.Howl=o,global.Sound=t):\"undefined\"!=typeof window&&(window.HowlerGlobal=e,window.Howler=n,window.Howl=o,window.Sound=t)}();"}}